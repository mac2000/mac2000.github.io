<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.24.5"/><style data-href="/styles.f7b0302c8427f1a04772.css" data-identity="gatsby-global-css">@media (prefers-color-scheme:light){code[class*=language-],pre[class*=language-]{background:#fafafa;color:#383a42;direction:ltr;font-family:Fira Code,Fira Mono,Menlo,Consolas,DejaVu Sans Mono,monospace;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#e5e5e6;color:inherit}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection{background:#e5e5e6;color:inherit}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.2em .3em;white-space:normal}.token.cdata,.token.comment,.token.prolog{color:#a0a1a7}.token.doctype,.token.entity,.token.punctuation{color:#383a42}.token.atrule,.token.attr-name,.token.boolean,.token.class-name,.token.constant,.token.number{color:#b76b01}.token.keyword{color:#a626a4}.token.deleted,.token.important,.token.property,.token.symbol,.token.tag{color:#e45649}.token.attr-value,.token.attr-value>.token.punctuation,.token.builtin,.token.char,.token.inserted,.token.regex,.token.selector,.token.string{color:#50a14f}.token.function,.token.operator,.token.variable{color:#4078f2}.token.url{color:#0184bc}.token.attr-value>.token.punctuation.attr-equals,.token.special-attr>.token.attr-value>.token.value.css{color:#383a42}.language-css .token.selector{color:#e45649}.language-css .token.property{color:#383a42}.language-css .token.function,.language-css .token.url>.token.function{color:#0184bc}.language-css .token.url>.token.string.url{color:#50a14f}.language-css .token.atrule .token.rule,.language-css .token.important,.language-javascript .token.operator{color:#a626a4}.language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:#ca1243}.language-json .token.operator{color:#383a42}.language-json .token.null.keyword{color:#b76b01}.language-markdown .token.url,.language-markdown .token.url-reference.url>.token.string,.language-markdown .token.url>.token.operator{color:#383a42}.language-markdown .token.url>.token.content{color:#4078f2}.language-markdown .token.url-reference.url,.language-markdown .token.url>.token.url{color:#0184bc}.language-markdown .token.blockquote.punctuation,.language-markdown .token.hr.punctuation{color:#a0a1a7;font-style:italic}.language-markdown .token.code-snippet{color:#50a14f}.language-markdown .token.bold .token.content{color:#b76b01}.language-markdown .token.italic .token.content{color:#a626a4}.language-markdown .token.list.punctuation,.language-markdown .token.strike .token.content,.language-markdown .token.strike .token.punctuation,.language-markdown .token.title.important>.token.punctuation{color:#e45649}.token.bold{font-weight:700}.token.comment,.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.8}.token.token.cr:before,.token.token.lf:before,.token.token.space:before,.token.token.tab:not(:empty):before{color:rgba(56,58,66,.2)}div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:.4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:#e5e5e6;border-radius:.3em;color:#696c77;padding:.1em .4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover{background:#c6c7c7;color:#383a42}.line-highlight.line-highlight{background:rgba(56,58,66,.05)}.line-highlight.line-highlight:before,.line-highlight.line-highlight[data-end]:after{background:#e5e5e6;border-radius:.3em;box-shadow:0 2px 0 0 rgba(0,0,0,.2);color:#383a42;padding:.1em .6em}pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(56,58,66,.05)}.command-line .command-line-prompt,.line-numbers.line-numbers .line-numbers-rows{border-right-color:rgba(56,58,66,.2)}.command-line .command-line-prompt>span:before,.line-numbers .line-numbers-rows>span:before{color:#9d9d9f}.rainbow-braces .token.token.punctuation.brace-level-1,.rainbow-braces .token.token.punctuation.brace-level-5,.rainbow-braces .token.token.punctuation.brace-level-9{color:#e45649}.rainbow-braces .token.token.punctuation.brace-level-10,.rainbow-braces .token.token.punctuation.brace-level-2,.rainbow-braces .token.token.punctuation.brace-level-6{color:#50a14f}.rainbow-braces .token.token.punctuation.brace-level-11,.rainbow-braces .token.token.punctuation.brace-level-3,.rainbow-braces .token.token.punctuation.brace-level-7{color:#4078f2}.rainbow-braces .token.token.punctuation.brace-level-12,.rainbow-braces .token.token.punctuation.brace-level-4,.rainbow-braces .token.token.punctuation.brace-level-8{color:#a626a4}pre.diff-highlight>code .token.token.deleted:not(.prefix),pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:rgba(255,82,102,.15)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::-moz-selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix),pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:rgba(25,255,91,.15)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::-moz-selection{background-color:rgba(56,224,98,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection{background-color:rgba(56,224,98,.25)}.prism-previewer-gradient.prism-previewer-gradient div,.prism-previewer.prism-previewer:before{border-color:hsl(0,0,95%)}.prism-previewer-color.prism-previewer-color:before,.prism-previewer-easing.prism-previewer-easing:before,.prism-previewer-gradient.prism-previewer-gradient div{border-radius:.3em}.prism-previewer.prism-previewer:after{border-top-color:hsl(0,0,95%)}.prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:hsl(0,0,95%)}.prism-previewer-angle.prism-previewer-angle:before,.prism-previewer-easing.prism-previewer-easing,.prism-previewer-time.prism-previewer-time:before{background:#fff}.prism-previewer-angle.prism-previewer-angle circle,.prism-previewer-time.prism-previewer-time circle{stroke:#383a42;stroke-opacity:1}.prism-previewer-easing.prism-previewer-easing circle,.prism-previewer-easing.prism-previewer-easing line,.prism-previewer-easing.prism-previewer-easing path{stroke:#383a42}.prism-previewer-easing.prism-previewer-easing circle{fill:transparent}}@media (prefers-color-scheme:dark){code[class*=language-],pre[class*=language-]{background:#282c34;color:#abb2bf;direction:ltr;font-family:Fira Code,Fira Mono,Menlo,Consolas,DejaVu Sans Mono,monospace;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#3e4451;color:inherit;text-shadow:none}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection{background:#3e4451;color:inherit;text-shadow:none}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.2em .3em;white-space:normal}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}.token.cdata,.token.comment,.token.prolog{color:#5c6370}.token.doctype,.token.entity,.token.punctuation{color:#abb2bf}.token.atrule,.token.attr-name,.token.boolean,.token.class-name,.token.constant,.token.number{color:#d19a66}.token.keyword{color:#c678dd}.token.deleted,.token.important,.token.property,.token.symbol,.token.tag{color:#e06c75}.token.attr-value,.token.attr-value>.token.punctuation,.token.builtin,.token.char,.token.inserted,.token.regex,.token.selector,.token.string{color:#98c379}.token.function,.token.operator,.token.variable{color:#61afef}.token.url{color:#56b6c2}.token.attr-value>.token.punctuation.attr-equals,.token.special-attr>.token.attr-value>.token.value.css{color:#abb2bf}.language-css .token.selector{color:#e06c75}.language-css .token.property{color:#abb2bf}.language-css .token.function,.language-css .token.url>.token.function{color:#56b6c2}.language-css .token.url>.token.string.url{color:#98c379}.language-css .token.atrule .token.rule,.language-css .token.important,.language-javascript .token.operator{color:#c678dd}.language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:#be5046}.language-json .token.operator{color:#abb2bf}.language-json .token.null.keyword{color:#d19a66}.language-markdown .token.url,.language-markdown .token.url-reference.url>.token.string,.language-markdown .token.url>.token.operator{color:#abb2bf}.language-markdown .token.url>.token.content{color:#61afef}.language-markdown .token.url-reference.url,.language-markdown .token.url>.token.url{color:#56b6c2}.language-markdown .token.blockquote.punctuation,.language-markdown .token.hr.punctuation{color:#5c6370;font-style:italic}.language-markdown .token.code-snippet{color:#98c379}.language-markdown .token.bold .token.content{color:#d19a66}.language-markdown .token.italic .token.content{color:#c678dd}.language-markdown .token.list.punctuation,.language-markdown .token.strike .token.content,.language-markdown .token.strike .token.punctuation,.language-markdown .token.title.important>.token.punctuation{color:#e06c75}.token.bold{font-weight:700}.token.comment,.token.italic{font-style:italic}.token.entity{cursor:help}.token.namespace{opacity:.8}.token.token.cr:before,.token.token.lf:before,.token.token.space:before,.token.token.tab:not(:empty):before{color:rgba(171,178,191,.15);text-shadow:none}div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:.4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:#3a3f4b;border-radius:.3em;color:#828997;padding:.1em .4em}div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus,div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover{background:#3e4451;color:#abb2bf}.line-highlight.line-highlight{background:rgba(153,187,255,.04)}.line-highlight.line-highlight:before,.line-highlight.line-highlight[data-end]:after{background:#3a3f4b;border-radius:.3em;box-shadow:0 2px 0 0 rgba(0,0,0,.2);color:#abb2bf;padding:.1em .6em}pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(153,187,255,.04)}.command-line .command-line-prompt,.line-numbers.line-numbers .line-numbers-rows{border-right-color:rgba(171,178,191,.15)}.command-line .command-line-prompt>span:before,.line-numbers .line-numbers-rows>span:before{color:#636d83}.rainbow-braces .token.token.punctuation.brace-level-1,.rainbow-braces .token.token.punctuation.brace-level-5,.rainbow-braces .token.token.punctuation.brace-level-9{color:#e06c75}.rainbow-braces .token.token.punctuation.brace-level-10,.rainbow-braces .token.token.punctuation.brace-level-2,.rainbow-braces .token.token.punctuation.brace-level-6{color:#98c379}.rainbow-braces .token.token.punctuation.brace-level-11,.rainbow-braces .token.token.punctuation.brace-level-3,.rainbow-braces .token.token.punctuation.brace-level-7{color:#61afef}.rainbow-braces .token.token.punctuation.brace-level-12,.rainbow-braces .token.token.punctuation.brace-level-4,.rainbow-braces .token.token.punctuation.brace-level-8{color:#c678dd}pre.diff-highlight>code .token.token.deleted:not(.prefix),pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:rgba(255,82,102,.15)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::-moz-selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.deleted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection{background-color:rgba(251,86,105,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix),pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:rgba(25,255,91,.15)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::-moz-selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::-moz-selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::-moz-selection{background-color:rgba(56,224,98,.25)}pre.diff-highlight>code .token.token.inserted:not(.prefix) ::selection,pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix) ::selection,pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection{background-color:rgba(56,224,98,.25)}.prism-previewer-gradient.prism-previewer-gradient div,.prism-previewer.prism-previewer:before{border-color:#262931}.prism-previewer-color.prism-previewer-color:before,.prism-previewer-easing.prism-previewer-easing:before,.prism-previewer-gradient.prism-previewer-gradient div{border-radius:.3em}.prism-previewer.prism-previewer:after{border-top-color:#262931}.prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:#262931}.prism-previewer-angle.prism-previewer-angle:before,.prism-previewer-easing.prism-previewer-easing,.prism-previewer-time.prism-previewer-time:before{background:#31363f}.prism-previewer-angle.prism-previewer-angle circle,.prism-previewer-time.prism-previewer-time circle{stroke:#abb2bf;stroke-opacity:1}.prism-previewer-easing.prism-previewer-easing circle,.prism-previewer-easing.prism-previewer-easing line,.prism-previewer-easing.prism-previewer-easing path{stroke:#abb2bf}.prism-previewer-easing.prism-previewer-easing circle{fill:transparent}}:root{--foreground:#24292f;--background:#fff}a{color:#0969da}a.visited,a:visited{color:#57606a}.green{color:#1a7f37}.red{color:#cf222e}@media (prefers-color-scheme:dark){:root{--foreground:#adbac7;--background:#22272e}a{color:#539bf5}a.visited,a:visited{color:#768390}.green{color:#57ab5a}.red{color:#e5534b}}a{text-decoration:none}a:hover{text-decoration:underline}html{font-family:Ubuntu,sans-serif}body{background-color:var(--background);color:var(--foreground);margin:0;padding:0}#top{box-sizing:border-box;display:grid;grid-template-rows:1fr 2em;margin:0;min-height:100vh;padding:1em 2em}.graph polygon{fill:transparent}.graph g ellipse[stroke="#000"],.graph g ellipse[stroke="#000000"],.graph g ellipse[stroke=black],.graph g path[stroke="#000"],.graph g path[stroke="#000000"],.graph g path[stroke=black],.graph g polygon[stroke="#000"],.graph g polygon[stroke="#000000"],.graph g polygon[stroke=black]{stroke:var(--foreground)}.graph g text[fill="#000"],.graph g text[fill="#000000"],.graph g text[fill=black]{fill:var(--foreground)}code,pre{font-family:JetBrains Mono,monospace}pre[class*=language-]{word-wrap:break-word;border-radius:0;box-sizing:border-box;margin:1em -2em;max-width:100vw;padding:1em 2em}footer a{line-height:2em;margin-right:.5em}.delta{line-height:1;margin-left:1em;white-space:nowrap}.columns{display:grid;grid-template-columns:repeat(2,1fr)}@media only screen and (max-width:1024px){.columns{grid-template-columns:repeat(1,1fr)}}.pie{text-align:center}.pie figure{display:inline-block}.pie figcaption{font-size:80%;margin-top:.25em}</style><title data-gatsby-head="true">Automating IIS develpment environment setup</title><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=6389d5f13c96000946d60b6bb0a8b5a8" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=6389d5f13c96000946d60b6bb0a8b5a8"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="top"><main><div><h1>Automating IIS develpment environment setup</h1>
<p>We're working on few ASP.NET projects, so have need in some automatization.</p>
<p>Here is some brief notes and links:</p>
<p><strong>Run powershell script by pass execution policy from cmd file</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">isadmin.cmd
PowerShell.exe <span class="token parameter variable">-executionpolicy</span> bypass <span class="token parameter variable">-File</span> c:<span class="token punctuation">\</span>users<span class="token punctuation">\</span>alexandrm<span class="token punctuation">\</span>desktop<span class="token punctuation">\</span>isadmin.ps1</code></pre></div>
<p><strong>Make symlink to folder (on left - link, on right - directory)</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">mklink /D C:<span class="token punctuation">\</span>inetpub<span class="token punctuation">\</span>wwwroot<span class="token punctuation">\</span>CvPhotos D:<span class="token punctuation">\</span>CvPhotos</code></pre></div>
<p><strong>To setup all needed components run this command:</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">start /w pkgmgr /iu:IIS-WebServerRole<span class="token punctuation">;</span>IIS-WebServer<span class="token punctuation">;</span>IIS-ApplicationDevelopment<span class="token punctuation">;</span>IIS-CommonHttpFeatures<span class="token punctuation">;</span>IIS-HealthAndDiagnostics<span class="token punctuation">;</span>IIS-Performance<span class="token punctuation">;</span>IIS-Security<span class="token punctuation">;</span>IIS-WebServerManagementTools<span class="token punctuation">;</span>IIS-RequestFiltering<span class="token punctuation">;</span>IIS-HttpCompressionStatic<span class="token punctuation">;</span>IIS-HttpLogging<span class="token punctuation">;</span>IIS-RequestMonitor<span class="token punctuation">;</span>IIS-LoggingLibraries<span class="token punctuation">;</span>IIS-HttpTracing<span class="token punctuation">;</span>IIS-DefaultDocument<span class="token punctuation">;</span>IIS-DirectoryBrowsing<span class="token punctuation">;</span>IIS-HttpErrors<span class="token punctuation">;</span>IIS-HttpRedirect<span class="token punctuation">;</span>IIS-StaticContent<span class="token punctuation">;</span>IIS-NetFxExtensibility<span class="token punctuation">;</span>IIS-ASPNET<span class="token punctuation">;</span>IIS-ISAPIExtensions<span class="token punctuation">;</span>IIS-ISAPIFilter<span class="token punctuation">;</span>IIS-ManagementConsole<span class="token punctuation">;</span>IIS-ManagementScriptingTools</code></pre></div>
<p>Links:</p>
<p><a href="http://samag.ru/archive/article/1072">http://samag.ru/archive/article/1072</a></p>
<p><a href="http://technet.microsoft.com/en-us/library/ff716257%28v=ws.10%29.aspx">http://technet.microsoft.com/en-us/library/ff716257%28v=ws.10%29.aspx</a></p>
<p><strong>Setup all via Web Platform Installer</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$source</span> = <span class="token string">"http://www.iis.net/community/files/webpi/webpicmd_x86.zip"</span>
<span class="token variable">$destination</span> = <span class="token string">"C:\Users\AlexandrM\Desktop\webpicmd_x86.zip"</span>
<span class="token variable">$wc</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>WebClient
<span class="token variable">$wc</span><span class="token punctuation">.</span>DownloadFile<span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">,</span> <span class="token variable">$destination</span><span class="token punctuation">)</span>
<span class="token variable">$shell_app</span>=<span class="token function">New-Object</span> <span class="token operator">-</span>com shell<span class="token punctuation">.</span>application
<span class="token variable">$filename</span> = <span class="token string">"C:\Users\AlexandrM\Desktop\webpicmd_x86.zip"</span>
<span class="token variable">$zip_file</span> = <span class="token variable">$shell_app</span><span class="token punctuation">.</span>namespace<span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span>
<span class="token function">New-Item</span> <span class="token string">"C:\Users\AlexandrM\Desktop\webpicmd"</span> <span class="token operator">-</span><span class="token function">type</span> directory
<span class="token variable">$destination</span> = <span class="token variable">$shell_app</span><span class="token punctuation">.</span>namespace<span class="token punctuation">(</span><span class="token string">"C:\Users\AlexandrM\Desktop\webpicmd"</span><span class="token punctuation">)</span>
<span class="token variable">$destination</span><span class="token punctuation">.</span>Copyhere<span class="token punctuation">(</span><span class="token variable">$zip_file</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

C:\Users\user\Desktop\webpicmd\WebpiCmdLine<span class="token punctuation">.</span>exe <span class="token operator">/</span>Products: NETFramework4<span class="token punctuation">,</span> KB980423-Win7<span class="token punctuation">,</span> KB983484-Win7<span class="token punctuation">,</span> ASPNET<span class="token punctuation">,</span> DefaultDocument<span class="token punctuation">,</span> DirectoryBrowse<span class="token punctuation">,</span> HTTPErrors<span class="token punctuation">,</span> HTTPLogging<span class="token punctuation">,</span> IIS7<span class="token punctuation">,</span> IISManagementConsole<span class="token punctuation">,</span> ISAPIExtensions<span class="token punctuation">,</span> ISAPIFilters<span class="token punctuation">,</span> LoggingTools<span class="token punctuation">,</span> MVC<span class="token punctuation">,</span> MVC2<span class="token punctuation">,</span> MVC3<span class="token punctuation">,</span> MVC3Loc<span class="token punctuation">,</span> MVC3Runtime<span class="token punctuation">,</span> NETExtensibility<span class="token punctuation">,</span> NETFramework20SP2<span class="token punctuation">,</span> NETFramework35<span class="token punctuation">,</span> Plan9<span class="token punctuation">,</span> Plan9Loc<span class="token punctuation">,</span> PowerShell<span class="token punctuation">,</span> PowerShell2<span class="token punctuation">,</span> RequestFiltering<span class="token punctuation">,</span> RequestMonitor<span class="token punctuation">,</span> StaticContent<span class="token punctuation">,</span> StaticContentCompression<span class="token punctuation">,</span> IISManagementScriptsAndTools <span class="token operator">/</span>SuppressReboot <span class="token operator">/</span>AcceptEula</code></pre></div>
<p>Links:</p>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/gg433092.aspx">http://msdn.microsoft.com/en-us/library/windowsazure/gg433092.aspx</a></p>
<p><a href="http://blogs.iis.net/satishl/archive/2011/01/26/webpi-command-line.aspx">http://blogs.iis.net/satishl/archive/2011/01/26/webpi-command-line.aspx</a></p>
<h3>Powershell tips</h3>
<p><strong>Check is admin</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$principal</span> = <span class="token function">new-object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Principal<span class="token punctuation">.</span>WindowsPrincipal<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token variable">$isAdmin</span> = <span class="token variable">$principal</span><span class="token punctuation">.</span>IsInRole<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$isAdmin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"You are NOT admin"</span> <span class="token operator">-</span>ForegroundColor Red
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"You are admin"</span> <span class="token operator">-</span>ForegroundColor Green
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Retrieve environment variables</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token function">Get-ChildItem</span> Env:
<span class="token function">Get-ChildItem</span> Env:SystemRoot <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>expand Value</code></pre></div>
<p><em>Some variables</em></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">COMPUTERNAME                   MAC-PC
SystemDrive                    C:
SystemRoot                     C:\Windows
TEMP                           C:\Users\ALEXAN~1\AppData\Local\Temp
TMP                            C:\Users\ALEXAN~1\AppData\Local\Temp
USERDNSDOMAIN                  RABOTA.LOCAL
USERDOMAIN                     RABOTA
USERNAME                       AlexandrM
USERPROFILE                    C:\Users\AlexandrM</code></pre></div>
<p><strong>Include powershell file</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">    <span class="token builtin class-name">.</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>user<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>hosts.ps1</code></pre></div>
<p><em>Helper</em></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$currentDirectory</span> = <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$MyInvocation</span><span class="token punctuation">.</span>MyCommand<span class="token punctuation">.</span>Definition <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>
<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"inc.ps1"</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>Check that .NET 4.0 installed</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token function">Test-Path</span> <span class="token string">"${Env:ProgramFiles(x86)}\Microsoft ASP.NET\ASP.NET MVC 3"</span></code></pre></div>
<p><strong>Press any key to continue</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token function">Write-Host</span> <span class="token string">"Press any key to continue ..."</span>
<span class="token variable">$x</span> = <span class="token variable">$host</span><span class="token punctuation">.</span>UI<span class="token punctuation">.</span>RawUI<span class="token punctuation">.</span>ReadKey<span class="token punctuation">(</span><span class="token string">"NoEcho,IncludeKeyDown"</span><span class="token punctuation">)</span></code></pre></div>
<p><strong>Login info</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">Get-ChildItem</span> Env:USERDOMAIN <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Value<span class="token punctuation">)</span> <span class="token operator">-ne</span> <span class="token punctuation">(</span><span class="token function">Get-ChildItem</span> Env:COMPUTERNAME <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$logonServer</span> = <span class="token function">Get-ChildItem</span> Env:USERDOMAIN <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Value
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token variable">$logonServer</span> = <span class="token function">Get-ChildItem</span> Env:COMPUTERNAME <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Value
<span class="token punctuation">}</span>
<span class="token variable">$userName</span> = <span class="token function">Get-ChildItem</span> Env:USERNAME <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Value</code></pre></div>
<h3>Scheduled tasks</h3>
<p><a href="http://poshtips.com/2011/04/07/use-powershell-to-create-a-scheduled-task/">http://poshtips.com/2011/04/07/use-powershell-to-create-a-scheduled-task/</a></p>
<p><a href="http://technet.microsoft.com/en-us/library/cc725744(v=ws.10).aspx">http://technet.microsoft.com/en-us/library/cc725744(v=ws.10).aspx</a></p>
<p><strong>Creating tasks examples</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">schtasks.exe /Create /TN UpdateLocalAssets /RU user-PC<span class="token punctuation">\</span>user /SC DAILY /ST 09:00 /TR <span class="token string">"C:\Users\user\Desktop\schedule.cmd"</span>
schtasks.exe /Create /TN UpdateLocalAssets /RU system /SC DAILY /ST 09:00 /TR <span class="token string">"C:\Users\user\Desktop\schedule.cmd"</span></code></pre></div>
<h2>Automating</h2>
<p>Main idea is to have some scripts that will install all needed sites on local machine and make changes to hosts file.</p>
<p>We have config.xml file, like this one:</p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>users</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sv<span class="token punctuation">"</span></span> <span class="token attr-name">ip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>192.168.5.51<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mac<span class="token punctuation">"</span></span> <span class="token attr-name">ip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>192.168.5.52<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beta<span class="token punctuation">"</span></span> <span class="token attr-name">ip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>192.168.5.53<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>users</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sites</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

        <span class="token comment">&lt;!-- Admin sites --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

        <span class="token comment">&lt;!-- Micro sites --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-kiev.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-dp.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-kharkov.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-lviv.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-odessa.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job-in-donetsk.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gojobs.ru<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

        <span class="token comment">&lt;!-- Channels --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>finance.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pharma.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>student.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>marketing.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>it.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top.rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

        <span class="token comment">&lt;!-- Channels for partners --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.investgazeta.net<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.itc.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.delo.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.reklamaster.com<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>site</span> <span class="token attr-name">domain</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.ko.com.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sites</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>projects</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--
        Each project may have its own setup script in scripts/projects folder
        --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rabota.ua<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>micro<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gojobs<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>channels<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>admin<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>projects</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config</span><span class="token punctuation">></span></span></code></pre></div>
<p>In config, we have section with users and their ip addresses (will be used to create hosts file records).</p>
<p>Also there is sites section that also will be used for creating hosts files.</p>
<p>Projects section contains project names that will be added as sites to IIS, each project has its own setup script.</p>
<h2>Hosts</h2>
<p>SetupHosts.cmd will setup all needed hosts on your machine, so you will be able to work with local sites and check sites on other developer machines.</p>
<p><strong>SetupHosts.cmd</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">@ECHO OFF
REM http://stackoverflow.com/questions/659647/how-to-get-folder-path-from-file-path-with-cmd
PowerShell.exe <span class="token parameter variable">-executionpolicy</span> bypass <span class="token parameter variable">-File</span> %~dp0<span class="token punctuation">\</span>scripts<span class="token punctuation">\</span>hosts.ps1 %*
PAUSE</code></pre></div>
<p><strong>hosts.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Get current directory</span>
<span class="token variable">$currentDirectory</span> = <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$MyInvocation</span><span class="token punctuation">.</span>MyCommand<span class="token punctuation">.</span>Definition <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>
<span class="token comment"># Include inc.ps1 file</span>
<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"inc.ps1"</span><span class="token punctuation">)</span>

<span class="token comment"># Check that we have apropriate privilegies</span>
<span class="token variable">$principal</span> = <span class="token function">new-object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Principal<span class="token punctuation">.</span>WindowsPrincipal<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token variable">$isAdmin</span> = <span class="token variable">$principal</span><span class="token punctuation">.</span>IsInRole<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class="token punctuation">)</span>
<span class="token variable">$isHostsWriteable</span> = <span class="token function">Test-IsWritable</span> <span class="token operator">-</span>Path <span class="token string">"C:\Windows\System32\drivers\etc\hosts"</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$isAdmin</span> <span class="token operator">-And</span> <span class="token operator">-not</span> <span class="token variable">$isHostsWriteable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Can not modify hosts file, run me as admin or give permission to file"</span> <span class="token operator">-</span>ForegroundColor red
    <span class="token keyword">Exit</span>
<span class="token punctuation">}</span>

<span class="token comment"># Read config.xml</span>
<span class="token namespace">[xml]</span><span class="token variable">$xml</span> = <span class="token function">Get-Content</span> <span class="token punctuation">(</span><span class="token function">Join-Path</span> <span class="token operator">-</span>Path <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$currentDirectory</span> <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">-</span>ChildPath <span class="token string">"config.xml"</span><span class="token punctuation">)</span>

<span class="token comment">#http://technet.microsoft.com/en-us/library/ff730939.aspx</span>
<span class="token variable">$title</span> = <span class="token string">"Host types to write"</span>
<span class="token variable">$message</span> = <span class="token string">"What do you want to write to hosts file?"</span>
<span class="token variable">$all</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;All"</span><span class="token punctuation">,</span> <span class="token string">"Writes all possible hosts."</span>
<span class="token variable">$local</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;Local"</span><span class="token punctuation">,</span> <span class="token string">"Writes local only hosts, like: local.rabota.ua."</span>
<span class="token variable">$remote</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;Remote"</span><span class="token punctuation">,</span> <span class="token string">"Writes remote only hosts, like: beta.rabota.ua."</span>
<span class="token variable">$nothing</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;Nothing"</span><span class="token punctuation">,</span> <span class="token string">"Nothing will be written."</span>
<span class="token variable">$options</span> = <span class="token namespace">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class="token punctuation">(</span><span class="token variable">$all</span><span class="token punctuation">,</span> <span class="token variable">$local</span><span class="token punctuation">,</span> <span class="token variable">$remote</span><span class="token punctuation">,</span> <span class="token variable">$nothing</span><span class="token punctuation">)</span>
<span class="token variable">$hostsTypeToWrite</span> = <span class="token variable">$host</span><span class="token punctuation">.</span>ui<span class="token punctuation">.</span>PromptForChoice<span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">,</span> 0<span class="token punctuation">)</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$hostsTypeToWrite</span> <span class="token operator">-ne</span> 3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$hostsFilePath</span> = <span class="token function">Get-HostsFilePath</span>

    <span class="token comment"># Remove old entries (entries that has "# IIS" at end of line)</span>
    <span class="token variable">$hosts</span> = <span class="token function">Get-Content</span> <span class="token variable">$hostsFilePath</span>
    <span class="token variable">$hosts</span> = <span class="token variable">$hosts</span> <span class="token punctuation">|</span> Where <span class="token punctuation">{</span><span class="token variable">$_</span> <span class="token operator">-notmatch</span> <span class="token string">'^[^#].*?# IIS'</span><span class="token punctuation">}</span>
    <span class="token variable">$hosts</span> <span class="token punctuation">|</span> <span class="token function">Out-File</span> <span class="token variable">$hostsFilePath</span> <span class="token operator">-</span>Encoding ASCII

    <span class="token variable">$hosts</span> = <span class="token string">""</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$hostsTypeToWrite</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        0 <span class="token punctuation">{</span> <span class="token variable">$hosts</span> = <span class="token function">Get-AllProjectHosts</span> <span class="token punctuation">}</span>
        1 <span class="token punctuation">{</span> <span class="token variable">$hosts</span> = <span class="token function">Get-LocalProjectHosts</span> <span class="token punctuation">}</span>
        2 <span class="token punctuation">{</span> <span class="token variable">$hosts</span> = <span class="token function">Get-RemoteProjectHosts</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">Write-Host</span> <span class="token variable">$hosts</span> <span class="token operator">-</span>ForegroundColor DarkGray
    <span class="token function">Add-Content</span> <span class="token variable">$hostsFilePath</span> <span class="token variable">$hosts</span>
    <span class="token function">Write-Host</span> <span class="token string">"Hosts file successfully updated"</span> <span class="token operator">-</span>ForegroundColor green
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Nothing to do..."</span>
<span class="token punctuation">}</span>

<span class="token comment">#Write-Host "Press any key to continue ..."</span>
<span class="token comment">#$x = $host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")</span></code></pre></div>
<h2>IIS</h2>
<p>SetupIISComponents.cmd - will install all needed iis componenets</p>
<p><strong>SetupIISComponents.cmd</strong></p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">@ECHO OFF
PowerShell.exe <span class="token parameter variable">-executionpolicy</span> bypass <span class="token parameter variable">-File</span> %~dp0<span class="token punctuation">\</span>scripts<span class="token punctuation">\</span>iis.ps1 %*
PAUSE</code></pre></div>
<p><strong>iis.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Get current directory</span>
<span class="token variable">$currentDirectory</span> = <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$MyInvocation</span><span class="token punctuation">.</span>MyCommand<span class="token punctuation">.</span>Definition <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>
<span class="token comment"># Include inc.ps1 file</span>
<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"inc.ps1"</span><span class="token punctuation">)</span>

<span class="token comment"># Check that we have .net 4 installed</span>
<span class="token variable">$_DOT_NET_VERSION</span> = <span class="token string">"v4"</span>
<span class="token variable">$dotNet4Installed</span> = <span class="token punctuation">(</span><span class="token function">Get-ChildItem</span> <span class="token string">"HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP"</span> <span class="token punctuation">|</span> Where <span class="token punctuation">{</span> <span class="token variable">$_</span><span class="token punctuation">.</span>PSChildName <span class="token operator">-eq</span> <span class="token variable">$_DOT_NET_VERSION</span> <span class="token punctuation">}</span> <span class="token punctuation">|</span> <span class="token function">Measure-Object</span> <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>expand Count<span class="token punctuation">)</span> <span class="token operator">-eq</span> 1
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$dotNet4Installed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">".Net <span class="token variable">$_DOT_NET_VERSION</span> is not installed run Windows Update or instal it manualy before proceed"</span> <span class="token operator">-</span>ForegroundColor red
    <span class="token keyword">Exit</span>
<span class="token punctuation">}</span>

<span class="token function">Write-Host</span> <span class="token string">"Installing IIS Components"</span> <span class="token operator">-</span>ForegroundColor Blue
<span class="token function">Invoke-Expression</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"pkgmgr.cmd"</span><span class="token punctuation">)</span>
<span class="token function">Write-Host</span>
<span class="token function">Write-Host</span> <span class="token string">"Done"</span> <span class="token operator">-</span>ForegroundColor Green</code></pre></div>
<p><strong>pkgmgr.cmd</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">start /w pkgmgr /iu:IIS-WebServerRole<span class="token punctuation">;</span>IIS-WebServer<span class="token punctuation">;</span>IIS-ApplicationDevelopment<span class="token punctuation">;</span>IIS-CommonHttpFeatures<span class="token punctuation">;</span>IIS-HealthAndDiagnostics<span class="token punctuation">;</span>IIS-Performance<span class="token punctuation">;</span>IIS-Security<span class="token punctuation">;</span>IIS-WebServerManagementTools<span class="token punctuation">;</span>IIS-RequestFiltering<span class="token punctuation">;</span>IIS-HttpCompressionStatic<span class="token punctuation">;</span>IIS-HttpLogging<span class="token punctuation">;</span>IIS-RequestMonitor<span class="token punctuation">;</span>IIS-LoggingLibraries<span class="token punctuation">;</span>IIS-HttpTracing<span class="token punctuation">;</span>IIS-DefaultDocument<span class="token punctuation">;</span>IIS-DirectoryBrowsing<span class="token punctuation">;</span>IIS-HttpErrors<span class="token punctuation">;</span>IIS-HttpRedirect<span class="token punctuation">;</span>IIS-StaticContent<span class="token punctuation">;</span>IIS-NetFxExtensibility<span class="token punctuation">;</span>IIS-ASPNET<span class="token punctuation">;</span>IIS-ISAPIExtensions<span class="token punctuation">;</span>IIS-ISAPIFilter<span class="token punctuation">;</span>IIS-ManagementConsole<span class="token punctuation">;</span>IIS-ManagementScriptingTools</code></pre></div>
<h2>Sites</h2>
<p>Notice: Do not delete default site (at least one site must be present in IIS, otherwise scripts can not work - this is known problem, will hope will be fixed in next versions of IIS Web Management Scripts And Tools and\or Powershell)</p>
<p><strong>SetupSites.cmd</strong></p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">@ECHO OFF
PowerShell.exe <span class="token parameter variable">-executionpolicy</span> bypass <span class="token parameter variable">-File</span> %~dp0<span class="token punctuation">\</span>scripts<span class="token punctuation">\</span>sites.ps1 %*
PAUSE</code></pre></div>
<p><strong>sites.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$currentDirectory</span> = <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$MyInvocation</span><span class="token punctuation">.</span>MyCommand<span class="token punctuation">.</span>Definition <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>
<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"inc.ps1"</span><span class="token punctuation">)</span>

<span class="token comment"># Check that we have .net 4 installed</span>
<span class="token variable">$_DOT_NET_VERSION</span> = <span class="token string">"v4"</span>
<span class="token variable">$dotNet4Installed</span> = <span class="token punctuation">(</span><span class="token function">Get-ChildItem</span> <span class="token string">"HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP"</span> <span class="token punctuation">|</span> Where <span class="token punctuation">{</span> <span class="token variable">$_</span><span class="token punctuation">.</span>PSChildName <span class="token operator">-eq</span> <span class="token variable">$_DOT_NET_VERSION</span> <span class="token punctuation">}</span> <span class="token punctuation">|</span> <span class="token function">Measure-Object</span> <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>expand Count<span class="token punctuation">)</span> <span class="token operator">-eq</span> 1
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$dotNet4Installed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">".Net <span class="token variable">$_DOT_NET_VERSION</span> is not installed run Windows Update or instal it manualy before proceed"</span> <span class="token operator">-</span>ForegroundColor red
    <span class="token keyword">Exit</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check that we have apropriate privilegies</span>
<span class="token variable">$principal</span> = <span class="token function">new-object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>Principal<span class="token punctuation">.</span>WindowsPrincipal<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token variable">$isAdmin</span> = <span class="token variable">$principal</span><span class="token punctuation">.</span>IsInRole<span class="token punctuation">(</span><span class="token namespace">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$isAdmin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Run me as admin"</span> <span class="token operator">-</span>ForegroundColor red
    <span class="token keyword">Exit</span>
<span class="token punctuation">}</span>

<span class="token function">Write-Host</span> <span class="token string">"NOTICE: Run me after IIS Components are installed"</span> <span class="token operator">-</span>ForegroundColor Yellow

<span class="token comment"># Include Powershell IIS snap in</span>
<span class="token function">Import-Module</span> WebAdministration

<span class="token function">Write-Host</span> <span class="token string">"Stopping IIS and sites..."</span> <span class="token operator">-</span>ForegroundColor Green
<span class="token function">Get-Website</span> <span class="token punctuation">|</span> <span class="token keyword">foreach</span> <span class="token punctuation">{</span> <span class="token function">Stop-Website</span> <span class="token variable">$_</span><span class="token punctuation">.</span>name <span class="token punctuation">}</span>
net stop w3svc

<span class="token comment"># Read config.xml</span>
<span class="token namespace">[xml]</span><span class="token variable">$xml</span> = <span class="token function">Get-Content</span> <span class="token punctuation">(</span><span class="token function">Join-Path</span> <span class="token operator">-</span>Path <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$currentDirectory</span> <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">-</span>ChildPath <span class="token string">"config.xml"</span><span class="token punctuation">)</span>

<span class="token comment"># Retrieve current user</span>
<span class="token variable">$title</span> = <span class="token string">"Who are u?"</span>
<span class="token variable">$message</span> = <span class="token string">"Chose your user name from list"</span>
<span class="token variable">$choices</span> = @<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token variable">$userNames</span> = <span class="token variable">$xml</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>users<span class="token punctuation">.</span>user <span class="token punctuation">|</span> <span class="token function">sort</span> name
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$user</span> in <span class="token variable">$userNames</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$userVariables</span> = <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"users\"</span> <span class="token operator">+</span> <span class="token variable">$user</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">".ps1"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$userVariables</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment"># Show only users that have config files</span>
        <span class="token variable">$choices</span> <span class="token operator">+=</span> <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token variable">$user</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Will be used in bindings like: "</span> <span class="token operator">+</span> <span class="token variable">$user</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">".rabota.ua"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$options</span> = <span class="token namespace">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class="token punctuation">(</span><span class="token variable">$choices</span><span class="token punctuation">)</span>
<span class="token variable">$choice</span> = <span class="token variable">$host</span><span class="token punctuation">.</span>ui<span class="token punctuation">.</span>PromptForChoice<span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">,</span> 0<span class="token punctuation">)</span>
<span class="token variable">$user</span> = <span class="token variable">$options</span><span class="token punctuation">[</span><span class="token variable">$choice</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Label <span class="token comment"># user will contain selected user name</span>

<span class="token comment"># Load user specific variables</span>
<span class="token variable">$userVariables</span> = <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"users\"</span> <span class="token operator">+</span> <span class="token variable">$user</span> <span class="token operator">+</span> <span class="token string">".ps1"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$userVariables</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span> <span class="token variable">$userVariables</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check that $base path exists</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Can not access base path: <span class="token variable">$base</span>"</span> <span class="token operator">-</span>ForegroundColor Red
    <span class="token keyword">Exit</span>
<span class="token punctuation">}</span>

<span class="token comment"># Check that $temp path exists</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment"># If not try to create it</span>
    <span class="token function">New-Item</span> <span class="token variable">$temp</span> <span class="token operator">-</span><span class="token function">type</span> directory

<span class="token punctuation">}</span>

<span class="token comment"># Give IIS full access to temp directory</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$temp</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$acl</span> = <span class="token function">Get-Acl</span> <span class="token variable">$temp</span>
    <span class="token variable">$rule</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>AccessControl<span class="token punctuation">.</span>FileSystemAccessRule<span class="token punctuation">(</span><span class="token string">"IIS_IUSRS"</span><span class="token punctuation">,</span> <span class="token string">"FullControl"</span><span class="token punctuation">,</span> <span class="token string">"ContainerInherit, ObjectInherit"</span><span class="token punctuation">,</span> <span class="token string">"None"</span><span class="token punctuation">,</span> <span class="token string">"Allow"</span><span class="token punctuation">)</span>
    <span class="token variable">$acl</span><span class="token punctuation">.</span>AddAccessRule<span class="token punctuation">(</span><span class="token variable">$rule</span><span class="token punctuation">)</span>
    <span class="token function">Set-Acl</span> <span class="token variable">$temp</span> <span class="token variable">$acl</span>
<span class="token punctuation">}</span>

<span class="token variable">$base</span> = <span class="token variable">$base</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token string">"\"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>
<span class="token variable">$temp</span> = <span class="token variable">$temp</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token string">"\"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Trim<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"</span>

<span class="token comment">#if((Get-ChildItem Env:USERDOMAIN | Select -Expand Value) -ne (Get-ChildItem Env:COMPUTERNAME | Select -Expand Value)) {</span>
<span class="token comment">#   $logonServer = Get-ChildItem Env:USERDOMAIN | Select -Expand Value</span>
<span class="token comment">#} else {</span>
<span class="token comment">#   $logonServer = Get-ChildItem Env:COMPUTERNAME | Select -Expand Value</span>
<span class="token comment">#}</span>
<span class="token comment">#$userName = Get-ChildItem Env:USERNAME | Select -Expand Value</span>
<span class="token comment">#TODO: ask user for password to create Admin pool if it is not created</span>

<span class="token comment"># For each project run its setup script if exists</span>
<span class="token function">Write-Host</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$project</span> in <span class="token variable">$xml</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>projects<span class="token punctuation">.</span>project<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$setupScript</span> = <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"projects\"</span> <span class="token operator">+</span> <span class="token variable">$project</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">".ps1"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$setupScript</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$site</span> = <span class="token variable">$project</span><span class="token punctuation">.</span>name
        <span class="token punctuation">.</span> <span class="token variable">$setupScript</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">Write-Host</span> <span class="token string">"Starting IIS and sites..."</span> <span class="token operator">-</span>ForegroundColor Green
net <span class="token function">start</span> w3svc
<span class="token function">Get-Website</span> <span class="token punctuation">|</span> <span class="token keyword">foreach</span> <span class="token punctuation">{</span> <span class="token function">Start-Website</span> <span class="token variable">$_</span><span class="token punctuation">.</span>name <span class="token punctuation">}</span></code></pre></div>
<p><strong>Example of user config file: mac.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token comment"># This file contains user specific variables</span>

<span class="token comment"># VARIABLES:</span>
<span class="token comment"># ------------------------------------------------------------------------------</span>
<span class="token comment"># $base     base path for projects, like: C:\Rabota.UA\trunk\Version\</span>
<span class="token comment"># $temp     temp directory path for project, like: D:\Temp\</span>

<span class="token variable">$base</span> = <span class="token string">"C:\Rabota.UA\trunk\Version\"</span>
<span class="token variable">$temp</span> = <span class="token string">"C:\Temp"</span></code></pre></div>
<p><strong>Example of rabota.ua.ps1 setup script</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$todo</span> = Check-Site <span class="token comment"># 0 - create, 1 - delete and create, 2 - skip</span>

<span class="token comment"># $site - contains project name, eg: rabota.ua, channel.rabota.ua</span>
<span class="token comment"># $user - contains current user name, eg: mac, sv, beta</span>

<span class="token comment"># and all variables from user file</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$todo</span> <span class="token operator">-eq</span> 1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Deleting <span class="token variable">$site</span>"</span> <span class="token operator">-</span>ForegroundColor Blue

    <span class="token function">Remove-Website</span> <span class="token operator">-</span>Name <span class="token variable">$site</span>

    <span class="token comment">#TODO: Delete $site additional tasks here</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$todo</span> <span class="token operator">-eq</span> 0 <span class="token operator">-Or</span> <span class="token variable">$todo</span> <span class="token operator">-eq</span> 1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Creating <span class="token variable">$site</span>"</span> <span class="token operator">-</span>ForegroundColor Blue

    <span class="token function">New-WebSite</span> <span class="token operator">-</span>Name <span class="token variable">$site</span> <span class="token operator">-</span>Port 80 <span class="token operator">-</span>HostHeader <span class="token string">"local.rabota.ua"</span> <span class="token operator">-</span>PhysicalPath <span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">+</span> <span class="token string">"Rabota2.WebUI"</span><span class="token punctuation">)</span>

    <span class="token comment"># External bindings</span>
    <span class="token function">New-WebBinding</span> <span class="token operator">-</span>Name <span class="token variable">$site</span> <span class="token operator">-</span>IPAddress <span class="token string">"*"</span> <span class="token operator">-</span>Port 80 <span class="token operator">-</span>HostHeader <span class="token punctuation">(</span><span class="token variable">$user</span> <span class="token operator">+</span> <span class="token string">".rabota.ua"</span><span class="token punctuation">)</span>

    <span class="token comment"># Make temporary folders</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"info"</span><span class="token punctuation">)</span> <span class="token comment"># will be used to create info section apps</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"HtmlTemplates"</span><span class="token punctuation">)</span> <span class="token comment"># will be used to rewrite counters</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"CvPhotos"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"CvPhotos\Temp"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"Storage"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"Storage\Attaches"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"images"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"Data"</span><span class="token punctuation">)</span>
    Create-TempDir<span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"img"</span><span class="token punctuation">)</span>

    <span class="token comment"># Make symlinks</span>
    Create-SymLink<span class="token punctuation">(</span><span class="token string">"CvPhotos"</span><span class="token punctuation">)</span>
    Create-SymLink<span class="token punctuation">(</span><span class="token string">"Storage"</span><span class="token punctuation">)</span>
    Create-SymLink<span class="token punctuation">(</span><span class="token string">"images"</span><span class="token punctuation">)</span>
    Create-SymLink<span class="token punctuation">(</span><span class="token string">"Data"</span><span class="token punctuation">)</span>
    Create-SymLink<span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create virtual directories for assets</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name CvPhotos <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\CvPhotos"</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name Storage <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\Storage"</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name images <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\images"</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name <span class="token keyword">Data</span> <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\Data"</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name img <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\img"</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name HtmlTemplates <span class="token operator">-</span>PhysicalPath <span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"HtmlTemplates"</span><span class="token punctuation">)</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name Info <span class="token operator">-</span>PhysicalPath <span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"info"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create Virtual apps</span>
    <span class="token function">New-WebApplication</span> <span class="token operator">-</span>Name <span class="token string">"Info/Jobsearcher"</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>PhysicalPath <span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">+</span> <span class="token string">"Rabota2.CMS\BlogEngine.Web"</span><span class="token punctuation">)</span>
    <span class="token function">New-WebApplication</span> <span class="token operator">-</span>Name <span class="token string">"Info/Employer"</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>PhysicalPath <span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">+</span> <span class="token string">"Rabota2.CMS\BlogEngine.Web"</span><span class="token punctuation">)</span>

    <span class="token comment"># Create empty copies of HtmlTemplates files</span>
    <span class="token function">Get-ChildItem</span> <span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">+</span> <span class="token string">"Rabota2.WebUI\HtmlTemplates"</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">Select</span> Name <span class="token punctuation">|</span> <span class="token keyword">Foreach</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>Path <span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"HtmlTemplates\"</span> <span class="token operator">+</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">New-Item</span> <span class="token operator">-</span>path <span class="token punctuation">(</span><span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token string">"HtmlTemplates"</span><span class="token punctuation">)</span> <span class="token operator">-</span>name <span class="token variable">$_</span><span class="token punctuation">.</span>Name <span class="token operator">-</span><span class="token function">type</span> <span class="token string">"file"</span> <span class="token operator">-</span>value <span class="token string">""</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Move libs</span>
    <span class="token variable">$shell_app</span>=<span class="token function">New-Object</span> <span class="token operator">-</span>com shell<span class="token punctuation">.</span>application
    <span class="token variable">$filename</span> = <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"libs\ext.zip"</span><span class="token punctuation">)</span>
    <span class="token variable">$zip_file</span> = <span class="token variable">$shell_app</span><span class="token punctuation">.</span>namespace<span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span>
    <span class="token variable">$destination</span> = <span class="token variable">$shell_app</span><span class="token punctuation">.</span>namespace<span class="token punctuation">(</span><span class="token string">"C:\inetpub\wwwroot"</span><span class="token punctuation">)</span>
    <span class="token variable">$destination</span><span class="token punctuation">.</span>Copyhere<span class="token punctuation">(</span><span class="token variable">$zip_file</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">New-WebVirtualDirectory</span> <span class="token operator">-</span>Site <span class="token variable">$site</span> <span class="token operator">-</span>Name ext <span class="token operator">-</span>PhysicalPath <span class="token string">"C:\inetpub\wwwroot\ext"</span>

    <span class="token comment">#TODO: Create $site additional tasks here</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Helpers</h2>
<p><strong>inc.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token variable">$_HOSTS_FORMAT</span> = <span class="token string">"{0,-16}{1,-57}# IIS`n"</span>

<span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token variable">$currentDirectory</span> <span class="token operator">+</span> <span class="token string">"Test-IsWritable.ps1"</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Get-HostsFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Join-Path</span> <span class="token operator">-</span>path <span class="token punctuation">(</span><span class="token function">Get-ChildItem</span> Env:SystemRoot <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>expand Value<span class="token punctuation">)</span> <span class="token operator">-</span>childpath <span class="token string">"system32\drivers\etc\hosts"</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Get-Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">[xml]</span><span class="token variable">$xml</span> = <span class="token function">Get-Content</span> <span class="token punctuation">(</span><span class="token function">Join-Path</span> <span class="token operator">-</span>Path <span class="token punctuation">(</span><span class="token function">Split-Path</span> <span class="token operator">-</span>Path <span class="token variable">$currentDirectory</span> <span class="token operator">-</span>Parent<span class="token punctuation">)</span> <span class="token operator">-</span>ChildPath <span class="token string">"config.xml"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token variable">$xml</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Get-LocalProjectHosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$xml</span> = <span class="token function">Get-Config</span>
    <span class="token variable">$hosts</span> = <span class="token string">""</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$site</span> in <span class="token variable">$xml</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>sites<span class="token punctuation">.</span>site<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token variable">$_HOSTS_FORMAT</span> <span class="token operator">-</span>f <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"local."</span> <span class="token operator">+</span> <span class="token variable">$site</span><span class="token punctuation">.</span>domain<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$hosts</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Get-RemoteProjectHosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$xml</span> = <span class="token function">Get-Config</span>
    <span class="token variable">$hosts</span> = <span class="token string">""</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$user</span> in <span class="token variable">$xml</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>users<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$site</span> in <span class="token variable">$xml</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>sites<span class="token punctuation">.</span>site<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token variable">$_HOSTS_FORMAT</span> <span class="token operator">-</span>f <span class="token variable">$user</span><span class="token punctuation">.</span>ip<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token variable">$site</span><span class="token punctuation">.</span>domain<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token string">"`n"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$hosts</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Get-AllProjectHosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$hosts</span> = <span class="token string">""</span>
    <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token function">Get-LocalProjectHosts</span>
    <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token string">"`n"</span>
    <span class="token variable">$hosts</span> <span class="token operator">+=</span> <span class="token function">Get-RemoteProjectHosts</span>
    <span class="token keyword">return</span> <span class="token variable">$hosts</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> Check-Site<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">#$siteInfo = Get-WebSite -Name $site</span>
    <span class="token variable">$siteExists</span> = <span class="token punctuation">(</span>1 <span class="token operator">-eq</span> <span class="token punctuation">(</span><span class="token function">Get-WebSite</span> <span class="token punctuation">|</span> Where <span class="token punctuation">{</span> <span class="token variable">$_</span><span class="token punctuation">.</span>Name <span class="token operator">-eq</span> <span class="token variable">$site</span> <span class="token punctuation">}</span> <span class="token punctuation">|</span> <span class="token function">Measure-Object</span> <span class="token punctuation">|</span> <span class="token function">Select</span> <span class="token operator">-</span>Expand Count<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token variable">$overwriteSite</span> = <span class="token boolean">$False</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$siteExists</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$title</span> = <span class="token string">"Site <span class="token variable">$site</span> already exists"</span>
        <span class="token variable">$message</span> = <span class="token string">"What do you want to do?"</span>
        <span class="token variable">$overwrite</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;Overwrite"</span><span class="token punctuation">,</span> <span class="token string">"Site will be deleted and created again."</span>
        <span class="token variable">$skip</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Automation<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>ChoiceDescription <span class="token string">"&amp;Skip"</span><span class="token punctuation">,</span> <span class="token string">"Leave al as is."</span>
        <span class="token variable">$options</span> = <span class="token namespace">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class="token punctuation">(</span><span class="token variable">$overwrite</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span>
        <span class="token variable">$chosen</span> = <span class="token variable">$host</span><span class="token punctuation">.</span>ui<span class="token punctuation">.</span>PromptForChoice<span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$options</span><span class="token punctuation">,</span> 0<span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$chosen</span> <span class="token operator">-eq</span> 0<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> 1
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token variable">$siteExists</span> <span class="token operator">-Or</span> <span class="token variable">$overwriteSite</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> 0
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">Write-Host</span> <span class="token string">"Site <span class="token variable">$site</span> skipped"</span>
        <span class="token keyword">return</span> 2
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> Create-TempDir<span class="token punctuation">(</span><span class="token namespace">[string]</span><span class="token variable">$dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># If path not exists - create it</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-not</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">New-Item</span> <span class="token variable">$dir</span> <span class="token operator">-</span><span class="token function">type</span> directory
    <span class="token punctuation">}</span>

    <span class="token comment"># Give IIS full access to it</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>path <span class="token variable">$dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$acl</span> = <span class="token function">Get-Acl</span> <span class="token variable">$dir</span>
        <span class="token variable">$rule</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Security<span class="token punctuation">.</span>AccessControl<span class="token punctuation">.</span>FileSystemAccessRule<span class="token punctuation">(</span><span class="token string">"IIS_IUSRS"</span><span class="token punctuation">,</span> <span class="token string">"FullControl"</span><span class="token punctuation">,</span> <span class="token string">"ContainerInherit, ObjectInherit"</span><span class="token punctuation">,</span> <span class="token string">"None"</span><span class="token punctuation">,</span> <span class="token string">"Allow"</span><span class="token punctuation">)</span>
        <span class="token variable">$acl</span><span class="token punctuation">.</span>AddAccessRule<span class="token punctuation">(</span><span class="token variable">$rule</span><span class="token punctuation">)</span>
        <span class="token function">Set-Acl</span> <span class="token variable">$dir</span> <span class="token variable">$acl</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> Create-SymLink<span class="token punctuation">(</span><span class="token namespace">[string]</span><span class="token variable">$dirName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Invoke-Expression</span> <span class="token punctuation">(</span><span class="token string">"cmd /c mklink /D C:\inetpub\wwwroot\"</span> <span class="token operator">+</span> <span class="token variable">$dirName</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token variable">$temp</span> <span class="token operator">+</span> <span class="token variable">$dirName</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Test-IsWritable.ps1</strong></p>
<div class="gatsby-highlight" data-language="powershell"><pre class="language-powershell"><code class="language-powershell"><span class="token keyword">function</span> <span class="token function">Test-IsWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">&lt;#
    .Synopsis
        Command tests if a file is present and writable.
    .Description
        Command to test if a file is writeable. Returns true if file can be opened for write access.
    .Example
        Test-IsWritable -path $foo
                Test if file $foo is accesible for write access.
        .Example
        $bar | Test-IsWriteable
                Test if each file object in $bar is accesible for write access.
        .Parameter Path
        Psobject containing the path or object of the file to test for write access.
#></span>
        <span class="token namespace">[CmdletBinding()]</span>
        <span class="token keyword">param</span><span class="token punctuation">(</span><span class="token namespace">[Parameter(Mandatory=$true,ValueFromPipeline=$true)]</span><span class="token namespace">[psobject]</span><span class="token variable">$path</span><span class="token punctuation">)</span>

        <span class="token keyword">process</span><span class="token punctuation">{</span>
                <span class="token function">Write-Verbose</span> <span class="token string">"Test if file <span class="token variable">$path</span> is writeable"</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Test-Path</span> <span class="token operator">-</span>Path <span class="token variable">$path</span> <span class="token operator">-</span>PathType Leaf<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">Write-Verbose</span> <span class="token string">"File is present"</span>
                        <span class="token variable">$target</span> = <span class="token function">Get-Item</span> <span class="token variable">$path</span> <span class="token operator">-</span>Force
                        <span class="token function">Write-Verbose</span> <span class="token string">"File is readable"</span>
                        <span class="token keyword">try</span><span class="token punctuation">{</span>
                                <span class="token function">Write-Verbose</span> <span class="token string">"Trying to openwrite"</span>
                                <span class="token variable">$writestream</span> = <span class="token variable">$target</span><span class="token punctuation">.</span>Openwrite<span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token function">Write-Verbose</span> <span class="token string">"Openwrite succeded"</span>
                                <span class="token variable">$writestream</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">Out-Null</span>
                                <span class="token function">Write-Verbose</span> <span class="token string">"Closing file"</span>
                                <span class="token function">Remove-Variable</span> <span class="token operator">-</span>Name writestream
                                <span class="token function">Write-Verbose</span> <span class="token string">"File is writable"</span>
                                <span class="token function">Write-Output</span> <span class="token boolean">$true</span>
                                <span class="token punctuation">}</span>
                        <span class="token keyword">catch</span><span class="token punctuation">{</span>
                                <span class="token function">Write-Verbose</span> <span class="token string">"Openwrite failed"</span>
                                <span class="token function">Write-Verbose</span> <span class="token string">"File is not writable"</span>
                                <span class="token function">Write-Output</span> <span class="token boolean">$false</span>
                                <span class="token punctuation">}</span>
                        <span class="token function">Write-Verbose</span> <span class="token string">"Tidying up"</span>
                        <span class="token function">Remove-Variable</span> <span class="token operator">-</span>Name target
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token function">Write-Verbose</span> <span class="token string">"File <span class="token variable">$path</span> does not exist or is a directory"</span>
                        <span class="token function">Write-Output</span> <span class="token boolean">$false</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>TODO</h2>
<ul>
<li>Fill C:\inetpub\wwwroot\iisstart.htm with all sites</li>
<li>Create bach file for non developers to access sites on dev machines</li>
<li>Scheduled task for syncing assets</li>
<li>Scheduled task for checking building results and sites availability</li>
</ul></div></main><footer><a href="#top">top</a><a href="/">home</a><a href="/search">search</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/automating-iis-develpment-environment-setup";window.___webpackCompilationHash="d66156d9f10a2e2c3817";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b4bb882d10635d85fa25.js"],"app":["/app-98475b819971087d4b7e.js"],"component---src-pages-404-js":["/component---src-pages-404-js-2652c435d8decd31b8ef.js"],"component---src-pages-index-js":["/component---src-pages-index-js-05a3598fd09bcacab11e.js"],"component---src-pages-search-js":["/component---src-pages-search-js-078619e3aef857102623.js"],"component---src-templates-note-js":["/component---src-templates-note-js-b005c02681f20ea28edd.js"]};/*]]>*/</script><script src="/polyfill-b4bb882d10635d85fa25.js" nomodule=""></script><script src="/app-98475b819971087d4b7e.js" async=""></script><script src="/framework-2ce620c91826a79f925c.js" async=""></script><script src="/webpack-runtime-b5d9ed3760a9b31eebd6.js" async=""></script></body></html>
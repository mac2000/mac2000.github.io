{"componentChunkName":"component---src-templates-note-js","path":"/drupal-imagecache-do-not-cache-render-text-from-url/","result":{"data":{"remark":{"fields":{"path":"drupal-imagecache-do-not-cache-render-text-from-url"},"meta":{"title":""},"headings":[{"value":"Drupal imagecache do not cache, render text from url"}],"html":"<h1>Drupal imagecache do not cache, render text from url</h1>\n<p>Changes to <strong>imagecache.module</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">imagecache_cache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$args</span> <span class=\"token operator\">=</span> <span class=\"token function\">func_get_args</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$preset</span> <span class=\"token operator\">=</span> <span class=\"token function\">check_plain</span><span class=\"token punctuation\">(</span><span class=\"token function\">array_shift</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$path</span> <span class=\"token operator\">=</span> <span class=\"token function\">implode</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$args</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//start</span>\n<span class=\"token comment\">//delete file if it already exists</span>\n<span class=\"token variable\">$dst</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecache_create_path</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$preset</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$root_path</span><span class=\"token operator\">=</span><span class=\"token function\">realpath</span><span class=\"token punctuation\">(</span><span class=\"token function\">drupal_get_path</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'module'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'node'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'/../../'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n@<span class=\"token function\">unlink</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$root_path</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$dst</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//end</span>\n\n    <span class=\"token function\">_imagecache_cache</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$preset</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$path</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>Changes to drupal <strong>.htaccess</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\n#start\n#all request to image cache must be proccessed with drupal\n#no matter is file already exists\nRewriteCond %{REQUEST_URI} ^.*/imagecache/.*/.*$\nRewriteRule ^(.*)$ index.php?q=$1 [L,QSA]\n#end\n\n    # Rewrite URLs of the form 'x' to the form 'index.php?q=x'.\n    RewriteCond %{REQUEST_FILENAME} !-f\n    RewriteCond %{REQUEST_FILENAME} !-d\n    RewriteCond %{REQUEST_URI} !=/favicon.ico\n    RewriteRule ^(.*)$ index.php?q=$1 [L,QSA]\n...</code></pre></div>\n<p>Now every request to imagecache will be processed again and again, try to add <strong>Add Text</strong> action with following params:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">return</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'t'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'t'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'No text'</span></code></pre></div>\n<p>Do not forget to check <strong>Evaluate Text as PHP code</strong></p>\n<p>Now you can open urls like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://drupalimage.local/sites/default/files/imagecache/preset1/imagecache_sample.png?t=hello\nhttp://drupalimage.local/sites/default/files/imagecache/preset1/imagecache_sample.png?t=world</code></pre></div>\n<p>Each time you will get new image with new text.</p>\n<p>Now time for <strong>imagecache_external</strong> module, <strong>version 1, not 2</strong>. With it you will be able to do same things to external images, just make some changes to url like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">http://drupalimage.local/external/preset1/http://shtirlitz.com/wp-content/uploads/2011/03/vishenki1.jpg?t=hello</code></pre></div>\n<p>Notice: Question marks (?) in image url must be replaced to %3F</p>"}},"pageContext":{"id":"031c8d98-8cb7-51c4-b7b8-044bda012801"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/powershell-smtp-queue/","result":{"data":{"remark":{"fields":{"path":"powershell-smtp-queue"},"meta":{"title":""},"headings":[{"value":"powershell smtp queue"}],"html":"<h1>powershell smtp queue</h1>\n<p>display list of all smtp on all servers and their state plust queues and amount of incoming/outgoing messages</p>\n<p><strong>smtp.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ps1\"><pre class=\"language-ps1\"><code class=\"language-ps1\">$servers = @(&#39;SRV12&#39;, &#39;SRV14&#39;, &#39;SRV16&#39;, &#39;SRV17&#39;)\n$items = Get-WmiObject -ComputerName $servers IISSmtpServerSetting -Namespace &#39;ROOT\\MicrosoftIISv2&#39; | where ServerAutoStart | where FullyQualifiedDomainName -NotIn $servers\n$queue = @{\n    name = &#39;Queue&#39;\n    expression = {\n        $server = $_.PSComputerName\n        $id = $_.Name.Split(&#39;/&#39;)[1]\n        $counter = Get-Counter &quot;\\\\$server\\SMTP Server(SMTP $id)\\Remote Queue Length&quot; | Select-Object -First 1 -ExpandProperty CounterSamples | Select-Object -ExpandProperty CookedValue\n        return $counter\n    }\n}\n$received = @{\n    name = &#39;Received&#39;\n    expression = {\n        $server = $_.PSComputerName\n        $id = $_.Name.Split(&#39;/&#39;)[1]\n        $counter = Get-Counter &quot;\\\\$server\\SMTP Server(SMTP $id)\\Messages Received/sec&quot; -SampleInterval 1 -MaxSamples 5 | Select-Object -ExpandProperty CounterSamples | Measure-Object -Property CookedValue -Average | Select-Object -ExpandProperty Average\n        return $counter\n    }\n}\n$sent = @{\n    name = &#39;Sent&#39;\n    expression = {\n        $server = $_.PSComputerName\n        $id = $_.Name.Split(&#39;/&#39;)[1]\n        $counter = Get-Counter &quot;\\\\$server\\SMTP Server(SMTP $id)\\Messages Sent/sec&quot; -SampleInterval 1 -MaxSamples 5 | Select-Object -ExpandProperty CounterSamples | Measure-Object -Property CookedValue -Average | Select-Object -ExpandProperty Average\n        return $counter\n    }\n}\n$data = $items | Select-Object @{n=&#39;Server&#39;;e={ $_.PSComputerName }}, $queue, $received, $sent, FullyQualifiedDomainName -ExpandProperty ServerBindings | Select-Object Server, FullyQualifiedDomainName, IP, Queue, Received, Sent\n$data | ft -AutoSize\n$data | Out-GridView</code></pre></div>\n<p>output example:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Server FullyQualifiedDomainName IP            Queue          Received              Sent\n------ ------------------------ --            -----          --------              ----\nSRV12  srv12.rabota.ua          31.28.166.25      0                 0                 0\nSRV12  relay90.rabota.ua        62.149.24.190  1518                 0                 0\nSRV12  r202.rabota.ua           62.149.24.202  1739                 0                 0\nSRV12  r203.rabota.ua           62.149.24.203  1800                 0                 0\nSRV12  r204.rabota.ua           62.149.24.204  1775                 0                 0\nSRV12  r206.rabota.ua           62.149.24.206  1791                 0                 0\nSRV12  r199.rabota.ua           62.149.24.199  1571                 0                 0\nSRV12  r198.rabota.ua           62.149.24.198   193 0,777056468412247  1,55557288623282\nSRV12  relay78.rabota.ua        62.149.24.178  1543                 0                 0\nSRV12  relay84.rabota.ua        62.149.24.184  1547                 0                 0\nSRV12  relay5.rabota.ua         62.149.24.185  1518                 0                 0\nSRV12  relay86.rabota.ua        62.149.24.186  1788                 0                 0\nSRV12  relay87.rabota.ua        62.149.24.187  4507                 0                 0\nSRV12  relay88.rabota.ua        62.149.24.188  1841                 0                 0\nSRV14  relay79.rabota.ua        62.149.24.179     0 0,105093086207182                 0\nSRV14  mailsender.rabota.ua     62.149.24.181  2403  0,78956129991058 0,591535077232385\nSRV14  relay4.rabota.ua         62.149.24.182     0 0,197213325674989                 0\nSRV14  relay83.rabota.ua        62.149.24.183   260 0,388371007208467 0,789126664278788\nSRV14  relay89.rabota.ua        62.149.24.189  2988                 0                 0</code></pre></div>"}},"pageContext":{"id":"74ee0eb6-7f65-59a3-917b-608bcb1830d1"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/kubernetes-aspnet-webforms","result":{"data":{"remark":{"fields":{"path":"kubernetes-aspnet-webforms"},"meta":{"title":""},"headings":[{"value":"Run ASP.NET WebForms site in Kubernetes"}],"html":"<h1>Run ASP.NET WebForms site in Kubernetes</h1>\n<p>I did not believe but it did worked out</p>\n<p>After adding Windows node pool to cluster and playing with sample project I was able to get it up and running</p>\n<p>Here are samples which were used</p>\n<p><strong>Dockerfile</strong></p>\n<p>Here we are adding optional log monitoring, which will forward all logs to stdout, so we can use kubectl logs to see whats going on</p>\n<p><div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">FROM mcr.microsoft.com/dotnet/framework/sdk:4.8 as build\nWORKDIR /code\n\nCOPY App.sln .\nCOPY App/App.csproj App/App.csproj\nCOPY App/packages.config App/packages.config\nCOPY Lib/Lib.csproj Lib/Lib.csproj\nCOPY Lib/packages.config Lib/packages.config\nRUN nuget restore App.sln\n\nCOPY . .\nRUN msbuild App/App.csproj /p:PublishUrl=publish /p:DeployOnBuild=true /p:Configuration=Release /p:WebPublishMethod=FileSystem /p:DeployTarget=WebPublish\n\n\nFROM mcr.microsoft.com/dotnet/framework/aspnet:4.8-windowsservercore-ltsc2019\n\n# Optional: will forward logs to stdout, so we can use kubectl logs to see whats going on\nWORKDIR /LogMonitor\nADD https://github.com/microsoft/windows-container-tools/releases/download/v1.2/LogMonitor.exe .\nCOPY LogMonitorConfig.json .\n\nWORKDIR /\nCOPY entrypoint.ps1 .\n\nWORKDIR /inetpub/wwwroot\nCOPY --from=build /code/App/publish .\n\nENTRYPOINT [\"/LogMonitor/LogMonitor.exe\", \"powershell.exe\", \"-f\", \"/entrypoint.ps1\"]</code></pre></div></p>\n<p><strong>entrypoint.ps1</strong></p>\n<p>Once again, it is kind of optional, this script replaces app settings with corresponding environment variables like it is done in dotnet core. Technically we may rewrite app to do it out of the box, but in my case I wish not to touch app.</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$webConfigPath</span> = <span class=\"token function\">Get-ChildItem</span> <span class=\"token operator\">-</span>Include Web<span class=\"token punctuation\">.</span>config <span class=\"token operator\">-</span>Recurse <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>First 1 <span class=\"token operator\">-</span>ExpandProperty FullName\n<span class=\"token variable\">$webConfig</span> = <span class=\"token namespace\">[xml]</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token variable\">$webConfigPath</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$appSetting</span> in <span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span>appSettings<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$value</span> = <span class=\"token namespace\">[Environment]</span>::GetEnvironmentVariable<span class=\"token punctuation\">(</span><span class=\"token variable\">$appSetting</span><span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$appSetting</span><span class=\"token punctuation\">.</span>value = <span class=\"token variable\">$value</span>\n        <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$appSetting</span><span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span></span>: <span class=\"token variable\">$value</span>\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$connectionString</span> in <span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span>connectionStrings<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$value</span> = <span class=\"token namespace\">[Environment]</span>::GetEnvironmentVariable<span class=\"token punctuation\">(</span><span class=\"token variable\">$connectionString</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$connectionString</span><span class=\"token punctuation\">.</span>connectionString = <span class=\"token variable\">$value</span>\n        <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$connectionString</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></span>: <span class=\"token variable\">$value</span>\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span><span class=\"token string\">'system.web'</span><span class=\"token punctuation\">.</span>compilation<span class=\"token punctuation\">.</span>RemoveAttribute<span class=\"token punctuation\">(</span><span class=\"token string\">'debug'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$value</span> = <span class=\"token namespace\">[Environment]</span>::GetEnvironmentVariable<span class=\"token punctuation\">(</span><span class=\"token string\">'AUTHENTICATION_FORMS_NAME'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span><span class=\"token string\">'system.web'</span><span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>forms<span class=\"token punctuation\">.</span>SetAttribute<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"authentication.forms.name: <span class=\"token variable\">$value</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$value</span> = <span class=\"token namespace\">[Environment]</span>::GetEnvironmentVariable<span class=\"token punctuation\">(</span><span class=\"token string\">'AUTHENTICATION_FORMS_DOMAIN'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>configuration<span class=\"token punctuation\">.</span><span class=\"token string\">'system.web'</span><span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>forms<span class=\"token punctuation\">.</span>SetAttribute<span class=\"token punctuation\">(</span><span class=\"token string\">'domain'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"authentication.forms.domain: <span class=\"token variable\">$value</span>\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$webConfig</span><span class=\"token punctuation\">.</span>Save<span class=\"token punctuation\">(</span><span class=\"token variable\">$webConfigPath</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">/</span>ServiceMonitor<span class=\"token punctuation\">.</span>exe w3svc</code></pre></div></p>\n<p><strong>github-action.yml</strong></p>\n<p>Nothing special in github action, the only important change is that we are using <code class=\"language-text\">windows-latest</code> instead of <code class=\"language-text\">ubuntu-lates</code>. In my case I was on a macbook so literaly had no chance to build it localy.</p>\n<p><div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> experiment\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> main <span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">IMAGE</span><span class=\"token punctuation\">:</span> gcr.io/my/app\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token key atrule\">experiment</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> windows<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> github.actor <span class=\"token tag\">!=</span> 'dependabot<span class=\"token punctuation\">[</span>bot<span class=\"token punctuation\">]</span>'\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> variables\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> rabotaua/actions<span class=\"token punctuation\">-</span>version@main\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4.1</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> docker build\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> docker build <span class=\"token punctuation\">-</span>t $env<span class=\"token punctuation\">:</span>IMAGE .\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> docker login\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> $env<span class=\"token punctuation\">:</span>GOOGLE_KEY <span class=\"token punctuation\">|</span> docker login <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>username _json_key <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>password<span class=\"token punctuation\">-</span>stdin https<span class=\"token punctuation\">:</span>//gcr.io\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">GOOGLE_KEY</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GOOGLE_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> docker push\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          docker tag \"$($env:IMAGE)\" \"$($env:IMAGE):$($env:VERSION)\"\n          docker push \"$($env:IMAGE):$($env:VERSION)\"</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> latest\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> github.ref == 'refs/heads/master'\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          docker tag \"$($env:IMAGE)\" \"$($env:IMAGE):latest\"\n          docker push \"$($env:IMAGE):latest\"</span></code></pre></div></p>\n<p><strong>kube.yml</strong></p>\n<p>And here is our kubernetes manifest. There is nothing special inside, except node selectors asking to run this deploymen on windows nodes.</p>\n<p><div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> demo\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">rollingUpdate</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">maxSurge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> RollingUpdate\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> demo\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> demo\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> gcr.io/my/app<span class=\"token punctuation\">:</span>latest\n        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> Always\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> AUTHENTICATION_FORMS_DOMAIN\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\".mac-blog.org.ua\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> AUTHENTICATION_FORMS_NAME\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"FOO\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> DATABASE\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Server=localhost;Initial Catalog=Demo;User ID=foo\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ReleaseVersion\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"123\"</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 500m\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 500Mi\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 100Mi\n        <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n          <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">tcpSocket</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n        <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n          <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /login.aspx\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n            <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> HTTP\n          <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n          <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n        <span class=\"token key atrule\">startupProbe</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n          <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /login.ashx\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n            <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> HTTP\n          <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n          <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n      <span class=\"token key atrule\">affinity</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requiredDuringSchedulingIgnoredDuringExecution</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> agentpool\n                    <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\n                    <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n                      <span class=\"token punctuation\">-</span> win\n                  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kubernetes.io/os\n                    <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\n                    <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\n                      <span class=\"token punctuation\">-</span> windows\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> demo\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ingressClassName</span><span class=\"token punctuation\">:</span> external\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> demo.mac<span class=\"token punctuation\">-</span>blog.org.ua\n    <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> demo\n            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n        <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> ImplementationSpecific</code></pre></div></p>\n<p>It was running in production more than month at moment of writing this, and the only one complain was when app was OOM killed so just added more resources, in all other aspects its seems to be working solution</p>\n<h2>Notes</h2>\n<ul>\n<li>Thanks to ingress we got some basic metrics for this app even so it does not have prometheus</li>\n<li>To get metrics about resources <a href=\"/windows-exporter\">windows exporter</a> daemon set should be deployed</li>\n<li>Thanks to kubernetes we have warmup with startup probe, rolling update and autoscale</li>\n</ul>"}},"pageContext":{"id":"8f8b8097-25cb-5c5b-b080-ee13acc7c79c"}},"staticQueryHashes":[]}
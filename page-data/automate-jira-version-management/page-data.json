{"componentChunkName":"component---src-templates-note-js","path":"/automate-jira-version-management","result":{"data":{"remark":{"fields":{"path":"automate-jira-version-management"},"meta":{"title":""},"headings":[{"value":"Automate JIRA version management"}],"html":"<h1>Automate JIRA version management</h1>\n<p>In our workflow we do use versions in Jira, but there is never ending story, we are forgetting to add new versions, release old and so on.</p>\n<p>What do we have is knowledge which version is current.</p>\n<p>So here are some ththoughts about automating that.</p>\n<h2>Example of REST API request from PowerShell</h2>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$username</span> = <span class=\"token string\">'your_user_name'</span>\n<span class=\"token variable\">$password</span> = <span class=\"token string\">'********************************'</span>\n<span class=\"token variable\">$authorization</span> = <span class=\"token namespace\">[System.Convert]</span>::ToBase64String<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Text.Encoding]</span>::ASCII<span class=\"token punctuation\">.</span>GetBytes<span class=\"token punctuation\">(</span><span class=\"token string\">\"${username}:${password}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$headers</span> = @<span class=\"token punctuation\">{</span> Authorization = <span class=\"token string\">\"Basic <span class=\"token variable\">$authorization</span>\"</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>jira<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com:85/rest/api/2/project/RUA/versions <span class=\"token operator\">-</span>Headers <span class=\"token variable\">$headers</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Format-Table</span> projectId<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> archived<span class=\"token punctuation\">,</span> released<span class=\"token punctuation\">,</span> releaseDate <span class=\"token operator\">-</span>AutoSize</code></pre></div>\n<h2>Retrieve versions</h2>\n<p><a href=\"https://docs.atlassian.com/jira/REST/6.1.7/#d2e231\">https://docs.atlassian.com/jira/REST/6.1.7/#d2e231</a></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>jira<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com:85/rest/api/2/project/RUA/versions <span class=\"token operator\">-</span>Headers <span class=\"token variable\">$headers</span></code></pre></div>\n<h2>Create version</h2>\n<p><a href=\"https://docs.atlassian.com/jira/REST/6.1.7/#d2e537\">https://docs.atlassian.com/jira/REST/6.1.7/#d2e537</a></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$body</span> = @<span class=\"token punctuation\">{</span>\n\tname = <span class=\"token string\">'73.8'</span>\n\tprojectId = 10040\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>jira<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com:85/rest/api/2/version <span class=\"token operator\">-</span>Headers <span class=\"token variable\">$headers</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>ContentType <span class=\"token string\">'application/json'</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token variable\">$body</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Release version</h2>\n<p><a href=\"https://docs.atlassian.com/jira/REST/6.1.7/#d2e607\">https://docs.atlassian.com/jira/REST/6.1.7/#d2e607</a></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$versionId</span> = 13710\n<span class=\"token variable\">$body</span> = @<span class=\"token punctuation\">{</span>\n\tarchived = <span class=\"token boolean\">$false</span>\n\treleased = <span class=\"token boolean\">$true</span>\n\treleaseDate = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span> <span class=\"token operator\">-</span>Format <span class=\"token string\">'yyyy-MM-dd'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"http://jira.example.com:85/rest/api/2/version/<span class=\"token variable\">$versionId</span>\"</span> <span class=\"token operator\">-</span>Headers <span class=\"token variable\">$headers</span><span class=\"token operator\">-</span>Method Put <span class=\"token operator\">-</span>ContentType <span class=\"token string\">'application/json'</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token variable\">$body</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Version comprasion</h2>\n<p>Powershell actually have special type for versions and can compare them</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token namespace\">[version]</span><span class=\"token string\">'71.3'</span> <span class=\"token operator\">-lt</span> <span class=\"token namespace\">[version]</span><span class=\"token string\">'71.5'</span></code></pre></div>\n<h2>Create new version if required</h2>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$ErrorActionPreference</span> = <span class=\"token string\">'Stop'</span>\n<span class=\"token variable\">$CurrentVersion</span> = <span class=\"token namespace\">[version]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Invoke-WebRequest</span> http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>test<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com/version<span class=\"token punctuation\">.</span>aspx <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty AllElements <span class=\"token punctuation\">|</span> <span class=\"token function\">Where-Object</span> id <span class=\"token operator\">-EQ</span> <span class=\"token keyword\">data</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty innerHTML<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>split <span class=\"token string\">' '</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>First 1<span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$NextVersionsCount</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>jira<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com:85/rest/api/2/project/RUA/versions <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span> Authorization = <span class=\"token string\">\"Basic ***************************==\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty SyncRoot <span class=\"token punctuation\">|</span> <span class=\"token function\">Where-Object</span> name <span class=\"token operator\">-Like</span> <span class=\"token string\">\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$CurrentVersion</span><span class=\"token punctuation\">.</span>Major<span class=\"token punctuation\">)</span></span>.*\"</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> @<span class=\"token punctuation\">{</span>n=<span class=\"token string\">'version'</span><span class=\"token punctuation\">;</span>e=<span class=\"token punctuation\">{</span> <span class=\"token namespace\">[version]</span><span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Where-Object</span> version <span class=\"token operator\">-gt</span> <span class=\"token variable\">$CurrentVersion</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Measure-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty Count\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$NextVersionsCount</span> <span class=\"token operator\">-eq</span> 0<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$Body</span> = @<span class=\"token punctuation\">{</span>\n\t\tname = <span class=\"token string\">\"<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$CurrentVersion</span><span class=\"token punctuation\">.</span>Major<span class=\"token punctuation\">)</span></span>.<span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$CurrentVersion</span><span class=\"token punctuation\">.</span>Minor <span class=\"token operator\">+</span> 1<span class=\"token punctuation\">)</span></span>\"</span>\n\t\tprojectId = 10040\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Uri http:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>jira<span class=\"token punctuation\">.</span>rabota<span class=\"token punctuation\">.</span>ua:85/rest/api/2/version <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span> Authorization = <span class=\"token string\">\"Basic ***************************==\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>ContentType <span class=\"token string\">'application/json'</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token variable\">$Body</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So, from now on responsibility to create new versions in jira is on your machine not by you.</p>"}},"pageContext":{"id":"3f114d1f-71e8-5ebf-acb2-a71f921c70e1"}},"staticQueryHashes":[]}
{"componentChunkName":"component---src-templates-note-js","path":"/swift-keychain/","result":{"data":{"remark":{"fields":{"path":"swift-keychain"},"meta":{"title":""},"headings":[{"value":"Swift Keychain"}],"html":"<h1>Swift Keychain</h1>\n<p>Small example of how to work with Keychin from Swift</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6657a3140d2f1e586defd8fec94e3cac/a4f52/screenshot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.640625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABIUlEQVR42qWQz0vDMBTHMxQEQWHbf9OL1/4DPazQU0+uoNfd9uf4d+iw1LZQukOhKrXUpZut1rn+WJrZxiRMqLv6yCcvee/Ly5eA6cX0GHr3oyB5vsrSbLxcLrQuURRppmlqtm3z82E/jhfj1QpeQwhHkiQdgcnlpJ/Er0GJClIWRdO2LekGu2O84xy0fqNhW1mWgSzLfaBp2tD3/SfPD4kXvKF0jXDy2aXG71+Yk6xrnFL+9hHKioaE8OOROhwARVGGeZ6H7BW8+27oYpk7Qqgm1RaRqtpSBxXPqK5JzRxTzV7LHW42xYuqqgMgiuK5ZVk387lrOI5zR5nRP5sZus7R95ljMAxeYxqmpdy6rvvAZgiCcAZo9CgnlNN/wmb0fgBIu0t475kFYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/6657a3140d2f1e586defd8fec94e3cac/2bef9/screenshot.png\"\n        srcset=\"/static/6657a3140d2f1e586defd8fec94e3cac/6f3f2/screenshot.png 256w,\n/static/6657a3140d2f1e586defd8fec94e3cac/01e7c/screenshot.png 512w,\n/static/6657a3140d2f1e586defd8fec94e3cac/2bef9/screenshot.png 1024w,\n/static/6657a3140d2f1e586defd8fec94e3cac/71c1d/screenshot.png 1536w,\n/static/6657a3140d2f1e586defd8fec94e3cac/a4f52/screenshot.png 2024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">import</span> <span class=\"token class-name\">SwiftUI</span>\n\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">ContentView</span><span class=\"token punctuation\">:</span> <span class=\"token class-name\">View</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token attribute atrule\">@State</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span>\n    <span class=\"token attribute atrule\">@State</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span>\n    <span class=\"token attribute atrule\">@State</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> secret<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span>\n    \n    <span class=\"token attribute atrule\">@State</span> <span class=\"token keyword\">var</span> message<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span>\n    <span class=\"token attribute atrule\">@State</span> <span class=\"token keyword\">var</span> show<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n    \n    <span class=\"token keyword\">var</span> body<span class=\"token punctuation\">:</span> <span class=\"token keyword\">some</span> <span class=\"token class-name\">View</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Grid</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">GridRow</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"service\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"service, e.g. https://github.com\"</span></span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> $service<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token class-name\">GridRow</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"account\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token class-name\">TextField</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"account, e.g. john\"</span></span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> $account<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token class-name\">GridRow</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"secret\"</span></span><span class=\"token punctuation\">)</span>\n                <span class=\"token class-name\">SecureField</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"secret, e.g. P@ssword!\"</span></span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">:</span> $secret<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">padding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token class-name\">VStack</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">HStack</span> <span class=\"token punctuation\">{</span>\n                \n                <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"get\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">KeychainManager</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">)</span>\n                    message <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecCopyErrorMessageString</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"unknown\"</span></span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFString</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>secret <span class=\"token operator\">=</span> secret <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"\"</span></span>\n                    <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecSuccess <span class=\"token punctuation\">{</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Success\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\\n\\nSecret: </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\"><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>secret</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Failure\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                    <span class=\"token punctuation\">}</span>\n                    show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> isPresented<span class=\"token punctuation\">:</span> $show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"OK\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                \n                <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"insert\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Task</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token class-name\">KeychainManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">)</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecCopyErrorMessageString</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"unknown\"</span></span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFString</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecSuccess <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Success\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Failure\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span>\n                        show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> isPresented<span class=\"token punctuation\">:</span> $show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"OK\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                \n                <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"update\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Task</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token class-name\">KeychainManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">)</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecCopyErrorMessageString</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"unknown\"</span></span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFString</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecSuccess <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Success\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Failure\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span>\n                        show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> isPresented<span class=\"token punctuation\">:</span> $show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"OK\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                \n                <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"delete\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Task</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token class-name\">KeychainManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">)</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecCopyErrorMessageString</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"unknown\"</span></span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFString</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecSuccess <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Success\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Failure\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span>\n                        show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> isPresented<span class=\"token punctuation\">:</span> $show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"OK\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                \n                <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"save\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Task</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token class-name\">KeychainManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">)</span>\n                        message <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecCopyErrorMessageString</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string-literal\"><span class=\"token string\">\"unknown\"</span></span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFString</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecSuccess <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Success\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                            message <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"Failure\\n\\n</span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">message</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\">\"</span></span>\n                        <span class=\"token punctuation\">}</span>\n                        show <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> isPresented<span class=\"token punctuation\">:</span> $show<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Button</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"OK\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                \n            <span class=\"token punctuation\">}</span>\n            <span class=\"token class-name\">Text</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Secrets saved to iCloud Keychain, try fill form, then save, get, update, delete\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">foregroundStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span>secondary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// https://www.youtube.com/watch?v=cQjgBIJtMbw</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">KeychainManager</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/// Retrieve secret for given `account` in `service`.</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">/// let (status, secret) = KeychainManager.get(service: \"https://github.com\", account: \"john\")</span>\n    <span class=\"token comment\">/// if status == errSecSuccess &amp;&amp; secret != nil {</span>\n    <span class=\"token comment\">///     print(\"secret: \\(secret)\")</span>\n    <span class=\"token comment\">/// }</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// - Parameters:</span>\n    <span class=\"token comment\">///     - service: can by any string, but usually is an url, e.g.: https://github.com/</span>\n    <span class=\"token comment\">///     - account: our username, e.g.: john</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// - Returns: tuple with `status` and `secret`.</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">get</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">:</span> <span class=\"token class-name\">OSStatus</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> result<span class=\"token punctuation\">:</span> <span class=\"token class-name\">CFTypeRef</span><span class=\"token operator\">?</span>\n        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token class-name\">SecItemCopyMatching</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">kSecClass</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kSecClassGenericPassword</span><span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrService</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrAccount</span><span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecReturnData</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kCFBooleanTrue</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">Any</span><span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecMatchLimit</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kSecMatchLimitOne</span>\n        <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFDictionary</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>result<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> result <span class=\"token keyword\">as</span><span class=\"token operator\">?</span> <span class=\"token class-name\">Data</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> secret <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>decoding<span class=\"token punctuation\">:</span> data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">as</span><span class=\"token punctuation\">:</span> UTF8<span class=\"token punctuation\">.</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">insert</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">OSStatus</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> secret<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>using<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> errSecBadReq\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SecItemAdd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">kSecClass</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kSecClassGenericPassword</span><span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrService</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrAccount</span><span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecValueData</span><span class=\"token punctuation\">:</span> data\n        <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFDictionary</span><span class=\"token punctuation\">,</span> <span class=\"token nil constant\">nil</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">update</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">OSStatus</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> secret<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>using<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">.</span>utf8<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> errSecBadReq\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SecItemUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">kSecClass</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kSecClassGenericPassword</span><span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrService</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrAccount</span><span class=\"token punctuation\">:</span> account\n        <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFDictionary</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">kSecValueData</span><span class=\"token punctuation\">:</span> data\n        <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFDictionary</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">/// Deletes secret from keychain</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">///  Task {</span>\n    <span class=\"token comment\">///     let status = await Keychain.delete(service: \"https://github.com/\", \"john\")</span>\n    <span class=\"token comment\">///     if status != errSecSuccess {</span>\n    <span class=\"token comment\">///         message = String(SecCopyErrorMessageString(status, nil) ?? \"unknown error\" as CFString)</span>\n    <span class=\"token comment\">///         print(\"unable delete secret because of \\(message)\")</span>\n    <span class=\"token comment\">///     }</span>\n    <span class=\"token comment\">/// }</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// - Parameters:</span>\n    <span class=\"token comment\">///     - service: can by any string, but usually is an url, e.g.: https://github.com/</span>\n    <span class=\"token comment\">///     - account: our username, e.g.: john</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">delete</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">OSStatus</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SecItemDelete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">kSecClass</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">kSecClassGenericPassword</span><span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrService</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">kSecAttrAccount</span><span class=\"token punctuation\">:</span> account\n        <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token class-name\">CFDictionary</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">/// Saves secret to keychain</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">///  Task {</span>\n    <span class=\"token comment\">///     let status = await Keychain.save(service: \"https://github.com/\", \"john\", secret: \"P@ssword!\")</span>\n    <span class=\"token comment\">///     if status != errSecSuccess {</span>\n    <span class=\"token comment\">///         message = String(SecCopyErrorMessageString(status, nil) ?? \"unknown error\" as CFString)</span>\n    <span class=\"token comment\">///         print(\"failure: \\(message)\")</span>\n    <span class=\"token comment\">///     }</span>\n    <span class=\"token comment\">/// }</span>\n    <span class=\"token comment\">/// ```</span>\n    <span class=\"token comment\">///</span>\n    <span class=\"token comment\">/// - Parameters:</span>\n    <span class=\"token comment\">///     - service: can by any string, but usually is an url, e.g.: https://github.com/</span>\n    <span class=\"token comment\">///     - account: our username, e.g.: john</span>\n    <span class=\"token comment\">///     - secret: password to be saved</span>\n    <span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">save</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">async</span> <span class=\"token operator\">-></span> <span class=\"token class-name\">OSStatus</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> status <span class=\"token operator\">=</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> status <span class=\"token operator\">==</span> errSecItemNotFound <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">:</span> account<span class=\"token punctuation\">,</span> secret<span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> status\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token other-directive property\">#Preview</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">ContentView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>Notes: strange thing here, somehow Swift complains that <code class=\"language-text\">SecItemAdd</code> is an operation that may block main thread and should be done in background to not block UI, but at the same time <code class=\"language-text\">SecItemUpdate</code> does not</p>"}},"pageContext":{"id":"7d40e924-80bb-52e9-a029-5f0226b09ed2"}},"staticQueryHashes":[],"slicesMap":{}}
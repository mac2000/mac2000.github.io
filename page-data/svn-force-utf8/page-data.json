{"componentChunkName":"component---src-templates-note-js","path":"/svn-force-utf8/","result":{"data":{"remark":{"fields":{"path":"svn-force-utf8"},"meta":{"title":""},"headings":[{"value":"TortoiseSVN Force UTF-8"}],"html":"<h1>TortoiseSVN Force UTF-8</h1>\n<p>To prevent commits with not valid UTF-8 files in it you may create <code class=\"language-text\">pre_commit_hook</code> in your TortoiseSVN and from now on do not worry about encodings.</p>\n<p>The trick is to check is file is valid utf8 one. In linux there is <a href=\"https://github.com/madx/moreutils/blob/master/isutf8.c\">isutf8</a> utility which checks file in pretty nice way - it compares raw bytes in file with bytes its retrieve while reading file as utf8 one - if they are same - then file is valid.</p>\n<h2>Setup pre commit hook</h2>\n<p>Right click on your repository, navigate to TortoiseSVN \\ Settings \\ Hook Scripts and press Add...</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 695px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB0klEQVR42qWU2W7bQAxF/f+/1Zc+BnAbJ5ajzatsaVaNdukUM4kNNOhDkRC4oAQSl7wUqZVUmvP5TFVWVFVF23aM44RrWiqpKIVCGUvdtNSuxTUdTevR0/UDvccwMAwDTdOwalxNkl9IkhxRVfR9z7IsXMuK520ckOQnzlfJVWhKaRHaokyNVAalbSjedT3OEw59S3ToeHmJ0Vpzt7p2KKVo25ZxHIN/t+UBow1CiBD3Fgj7riM7K7bbHXVd/0V4T1wW/suCZFs78n1OGscopT8RTl8gtJLjYcfbLkYI+X1C7TS/k59kcUxZVg/ZXyZUVrOJY3b/nOFXOlQlafJKtN0hhQwr8y1Co0r22x88/1qTJhlSKqZpel8brcPq+I/luzfGYqxlGseQM89z8Ms8s8wTzjlW/gLy6JX10xNp6gkltq5xrsUYg9aGoriy2byEeJKmpFkWrsr7oih4zS+sd3sKYVjJSpBFCYf9HlGJD4kLTdM+5PuzKssSa22AJ/PyytstdL2/aeJThTB+hqIm2R64lTemaQ4kHs414X2el4B7oc92z/fW9T0rbTRay1DVz8ufn/6Y3f3Zw8ezNA0/kiA9STgej0RRxOVS8PYWczyd+ANhoTirMlZ4FwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Settings\"\n        title=\"\"\n        src=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png\"\n        srcset=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/6f3f2/force_utf8_tortoisesvn_settings.png 256w,\n/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/01e7c/force_utf8_tortoisesvn_settings.png 512w,\n/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png 695w\"\n        sizes=\"(max-width: 695px) 100vw, 695px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hook Type: <strong>Pre-Commit Hook</strong></p>\n<p>Working Copy Path: Path to your repository, e.g.: <code class=\"language-text\">C:\\Users\\Alexandr\\Desktop\\Sample</code></p>\n<p>Command Line To Execute: <code class=\"language-text\">powershell -executionpolicy bypass -file C:\\Users\\Alexandr\\Desktop\\ForceUTF8.ps1</code></p>\n<p>Check <em>Wait for the script to finish</em> and <em>Hide the script while running</em> checkboxes</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 595px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWUlEQVR42m2R207jMBRF8/8fRkXfKJfQpLnbcWInzh0VtWiNbApiZnhYsnWOvM8+28G8bBhtaFVLpw261ZzPZz4+rlyvv3O5XH5l2zaCuq7JsozBWpZlYZ5nzziODMPwF66mtebp6ZmHhwNhGCKE+KZtW4I8L3zz8XAgjk8opXyz73svPE3Tf3yJ/8QNcm8CpWrSJCVNEpIk8W7LssJay7qurOtyY/1k+bz/O6RpGi8a5FXNY3giTkteohNRWqB0j1CGsm4ppKKUDblQnkK25LJB2wkzzHQ3tOmwzmFW1URZSVJI4rwiSktcrVKastY3EUVWubNBNAahNHZ5Y357Z9rODNs7je4wzmF4jLi727G/33t2u3uKovxe6+uTlnnG2MkLSt17R1JIv6YTctm7LAPVjVSV8E2HENKH68R+hj5PI7Hs2D3n7I81lVREr68IKZFScjxGGGP4AwgBVVRY+2XKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Adding Pre Commit Hook\"\n        title=\"\"\n        src=\"/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png\"\n        srcset=\"/static/72352d34a49c0370e9654cab0c34d44c/6f3f2/force_utf8_tortoisesvn_add_hook.png 256w,\n/static/72352d34a49c0370e9654cab0c34d44c/01e7c/force_utf8_tortoisesvn_add_hook.png 512w,\n/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png 595w\"\n        sizes=\"(max-width: 595px) 100vw, 595px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Force UTF8</h2>\n<p>Here is <code class=\"language-text\">ForceUTF8.ps1</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$errors</span> = 0\n\n<span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$bytes1</span> = <span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span> <span class=\"token operator\">-</span>Encoding Byte <span class=\"token operator\">-</span>Raw\n\t\t<span class=\"token variable\">$bytes2</span> = <span class=\"token namespace\">[System.Text.Encoding]</span>::UTF8<span class=\"token punctuation\">.</span>GetBytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span> <span class=\"token operator\">-</span>Encoding UTF8 <span class=\"token operator\">-</span>Raw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Compare-Object</span> <span class=\"token variable\">$bytes1</span> <span class=\"token variable\">$bytes2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">Write-Error</span> <span class=\"token variable\">$_</span>\n\t\t\t<span class=\"token variable\">$errors</span> <span class=\"token operator\">+=</span> 1\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">exit</span> <span class=\"token variable\">$errors</span></code></pre></div>\n<p>As first argument <code class=\"language-text\">$args[0]</code> to our script we retrieve path to temporary file that contains file paths that are going to be commited.</p>\n<p>We are checking each file to be valid UTF-8, and if its not, we are writing then to stderr and returning non zero exit code.</p>\n<p>From now one if you will try to commit non utf8 files you will get something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.09375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeElEQVR42pWS2Y6bQBBF+f9PizKxBme8xI5hbLN2g6GBphfwiRhHGWVTlJKO6tZ9qHq4FbSqR8qKoijp+h4/TTjncd4/unO/Y9+7tQ6tR8bRMI4jgSwKVNPQK0UrJbMxuGHA6wFv7duBH8wP3IL3eOeYvKeuKioh6PueID++kqUNWdlRPu8RzzvE5yNifUBsTohzSZlUyDhDxBkySpFRhlz8oiHvHJdac20MNzUQqEuKvSkGP6O/xuhViI7O6PiCXm/Q2y8MLzv09oDe7NHh5sE5Qaclokg56IRjm6AHS6CynEFKpnmGycM4grXgHbjvLPObtj971mKNIp0ypJU44wjarnuE4Sf+t+b7TDYJzvrKNE8YYwj6fuA+398TtX9O89ekrTU4Y0j6K+vbBjV0LLuCqqqQUiKkZNF1Xf+T260my0s+rbd8eFqzWoWEYUiSpgR5nnM6RURRTFmWqOV92vavNG1Lp1qKquHj/sLTISG+JOx3W5Ik5RtrHa9B6dvOJQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Pre Commit Hook Error Message\"\n        title=\"\"\n        src=\"/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png\"\n        srcset=\"/static/6995469d09042c8a72159617737adf16/6f3f2/force_utf8_tortoisesvn_error.png 256w,\n/static/6995469d09042c8a72159617737adf16/01e7c/force_utf8_tortoisesvn_error.png 512w,\n/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png 653w\"\n        sizes=\"(max-width: 653px) 100vw, 653px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Powershell check is there non UTF-8 files</h2>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Get-ChildItem</span> <span class=\"token operator\">-</span>Path C:\\Rabota<span class=\"token punctuation\">.</span>UA\\trunk\\Proj1<span class=\"token punctuation\">,</span> C:\\Rabota<span class=\"token punctuation\">.</span>UA\\trunk\\Proj2 <span class=\"token operator\">-</span>Recurse <span class=\"token operator\">-</span>Include <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>master<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>ascx<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>aspx<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>cs<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>ashx <span class=\"token operator\">-</span>ErrorAction SilentlyContinue <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$Bytes1</span> = <span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>FullName <span class=\"token operator\">-</span>Encoding Byte <span class=\"token operator\">-</span>Raw\n\t<span class=\"token variable\">$Bytes2</span> = <span class=\"token namespace\">[System.Text.Encoding]</span>::UTF8<span class=\"token punctuation\">.</span>GetBytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>FullName <span class=\"token operator\">-</span>Encoding UTF8 <span class=\"token operator\">-</span>Raw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># UTF-8 with BOM</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 239 <span class=\"token operator\">-and</span> <span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>1<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 187 <span class=\"token operator\">-and</span> <span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>2<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 191<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$Bytes1</span> = <span class=\"token variable\">$Bytes1</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">select</span> <span class=\"token operator\">-</span>Skip 3\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\"># No valid UTF-8</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Compare-Object</span> <span class=\"token variable\">$Bytes1</span> <span class=\"token variable\">$Bytes2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">Write-Host</span> <span class=\"token variable\">$Path</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"id":"df5b8a18-7d61-52e7-bb05-9d18d2bad5ed"}},"staticQueryHashes":[],"slicesMap":{}}
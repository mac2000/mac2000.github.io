{"componentChunkName":"component---src-templates-note-js","path":"/svn-force-utf8/","result":{"data":{"remark":{"fields":{"path":"svn-force-utf8"},"meta":{"title":""},"headings":[{"value":"TortoiseSVN Force UTF-8"}],"html":"<h1>TortoiseSVN Force UTF-8</h1>\n<p>To prevent commits with not valid UTF-8 files in it you may create <code class=\"language-text\">pre_commit_hook</code> in your TortoiseSVN and from now on do not worry about encodings.</p>\n<p>The trick is to check is file is valid utf8 one. In linux there is <a href=\"https://github.com/madx/moreutils/blob/master/isutf8.c\">isutf8</a> utility which checks file in pretty nice way - it compares raw bytes in file with bytes its retrieve while reading file as utf8 one - if they are same - then file is valid.</p>\n<h2>Setup pre commit hook</h2>\n<p>Right click on your repository, navigate to TortoiseSVN \\ Settings \\ Hook Scripts and press Add...</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 695px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6klEQVR42p1Ty5KbMBDk/z8rp9z24Gy8tnnbBmP0BElgXp3SOCaOa7OHTFWXGAQ93aNRIKRGWZbgjINzDuc6jOMIax24UGBCQekWxnZobQfjOljXw3U9+v6G/jbg5jEMcM4hsNYgzkskSU6E/qNlWXCtGd53ESHOC5yvAhXXqEUDrlpIbSBUA6kaGOvQ9TcSEYxDh/DcY/sRQWuFR/hNpRT6rsM0TVTdhy/2gNYanAty5HMi7PseeaGw34UwxqyErTFEdCe5v1vwJ5bn5CHCW/Y/5sccaRxDKb1uGmOp8qsqD7zky2/2O2EjcTqGiMIIQsgvCR/Pf797IVRW4z3+TgoZ42jbdrX8X4SyUdjGMQ4vPXxWOH9i8Z+WtWTIkh0O+xBSyHXTE87zjK9ieVlXwnz/DT9/bJAmKaSUdLresh+bOzSpb5qG4JWP00QFaRLmO6y1CIxzyA4f2Ly9rYRta2imdNPQrFVVhe12izTLkKQprf4S+LWqrthlF2zCIw1+ILlAdkhxOh4huFgb7q/gI6ZpBGM1qfSHxjmjQa/rmvK81ogKDtH4U+Ytkt0JdX3FNM1rk421ZMfbWj6b4k9iGG4IlPaXX5IFufZMkfXnHjLGkKYpiqKk1sRxgtPpjP3+gPJyQRhGOBcFfgEZJTfB33+ZrQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Settings\"\n        title=\"\"\n        src=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png\"\n        srcset=\"/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/6f3f2/force_utf8_tortoisesvn_settings.png 256w,\n/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/01e7c/force_utf8_tortoisesvn_settings.png 512w,\n/static/03f68991b1b9ee1c4c1efe9ec9bfc59e/83b75/force_utf8_tortoisesvn_settings.png 695w\"\n        sizes=\"(max-width: 695px) 100vw, 695px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Hook Type: <strong>Pre-Commit Hook</strong></p>\n<p>Working Copy Path: Path to your repository, e.g.: <code class=\"language-text\">C:\\Users\\Alexandr\\Desktop\\Sample</code></p>\n<p>Command Line To Execute: <code class=\"language-text\">powershell -executionpolicy bypass -file C:\\Users\\Alexandr\\Desktop\\ForceUTF8.ps1</code></p>\n<p>Check <em>Wait for the script to finish</em> and <em>Hide the script while running</em> checkboxes</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 595px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZ0lEQVR42l2SbW+DIBSF/f//a+vcN+dibZ2iiCDXN0S7uLbJWaBb0+3DE8gNnHs4l8AuK4g6tKpFRwTShG3bcL1ecblc/PqIqz1yPp/vnE4nBE0jwQqGcRyxLAvmeYa1FsYYTNP0B1cjIsTxO6IoQpIkEEJ46rpG27YIyrJEFL0hfouRZR9QSvkDwzB4YdfgESfqmo/j32Zaa/R9j0BJiSIvPHmegzEGzrkXXNfFu/6Pq9t/jZwR5z5gvEG8z5AVHMnhA8e8gqQBtSLwRqMUCpVQKGt12zctKtGCxhn9ZNF5Fuiu9ya84CHnyEuBjHEc8gpFLcEloWo02I9QwaUXFopQS43RfsJ+fsGsG6Z1g9LdzWGSHvH0vEMYviIMQ+x2Lygr7p9m3HN8jtbn2Y0GoiU0eoCmzmet3c8ggovOZRmo3oDz+j6t34HMxvgB3KZtYGeDo+jx/M4Qpg0qIZHu9/c7aXrwDr8BGN1UehuNxv8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Adding Pre Commit Hook\"\n        title=\"\"\n        src=\"/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png\"\n        srcset=\"/static/72352d34a49c0370e9654cab0c34d44c/6f3f2/force_utf8_tortoisesvn_add_hook.png 256w,\n/static/72352d34a49c0370e9654cab0c34d44c/01e7c/force_utf8_tortoisesvn_add_hook.png 512w,\n/static/72352d34a49c0370e9654cab0c34d44c/3dd3e/force_utf8_tortoisesvn_add_hook.png 595w\"\n        sizes=\"(max-width: 595px) 100vw, 595px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Force UTF8</h2>\n<p>Here is <code class=\"language-text\">ForceUTF8.ps1</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$errors</span> = 0\n\n<span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$args</span><span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$bytes1</span> = <span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span> <span class=\"token operator\">-</span>Encoding Byte <span class=\"token operator\">-</span>Raw\n\t\t<span class=\"token variable\">$bytes2</span> = <span class=\"token namespace\">[System.Text.Encoding]</span>::UTF8<span class=\"token punctuation\">.</span>GetBytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span> <span class=\"token operator\">-</span>Encoding UTF8 <span class=\"token operator\">-</span>Raw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Compare-Object</span> <span class=\"token variable\">$bytes1</span> <span class=\"token variable\">$bytes2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">Write-Error</span> <span class=\"token variable\">$_</span>\n\t\t\t<span class=\"token variable\">$errors</span> <span class=\"token operator\">+=</span> 1\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">exit</span> <span class=\"token variable\">$errors</span></code></pre></div>\n<p>As first argument <code class=\"language-text\">$args[0]</code> to our script we retrieve path to temporary file that contains file paths that are going to be commited.</p>\n<p>We are checking each file to be valid UTF-8, and if its not, we are writing then to stderr and returning non zero exit code.</p>\n<p>From now one if you will try to commit non utf8 files you will get something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 653px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.09375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABcUlEQVR42pXS227bMAyAYb//mw1LtzRdkjZLncbzWXJSyZItS47/wXWBYbsoOgIfQPKCvCAjpQ1SNlRlRWssYRzxISz8zP9teOc9wzAbsF1H3/d0XU8kyhL9esUohZKS0fV4axfO4cfwj3ERlmVj8FxkgxQCYwxReUwo8it53VKtHxGzH0fE5kC9faY+V1SpRJxyxKlAxNmSnyvq8pVCB5JLR3rtuWhLpJIMd20xYcI+v2C/P2BPCfblF3azw+4P2O0Tdv8Tu3vCbrZL/5zR5TWiyjnYlKPKsNYR6aLECsF4u0EI0HcwOAge/LAYhj+590v9xuF6RTYWSCfxzhMprWnblhBG/jduQDEJzl3Kbbrh3EBkjGWapverDZ/m5oP1jtSkbJot2rTMs6KmaRBSIoRASslcf0Q2DZdLQ1aUrO63fFlt+Ha3Zr2+J8syoqIoiOOYOD5R1zVaa9T8Qh9otaJsFF8fE1aHjFOSst/v3gb+BldVrmFxNTTqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"TortoiseSVN Pre Commit Hook Error Message\"\n        title=\"\"\n        src=\"/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png\"\n        srcset=\"/static/6995469d09042c8a72159617737adf16/6f3f2/force_utf8_tortoisesvn_error.png 256w,\n/static/6995469d09042c8a72159617737adf16/01e7c/force_utf8_tortoisesvn_error.png 512w,\n/static/6995469d09042c8a72159617737adf16/e7dce/force_utf8_tortoisesvn_error.png 653w\"\n        sizes=\"(max-width: 653px) 100vw, 653px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Powershell check is there non UTF-8 files</h2>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Get-ChildItem</span> <span class=\"token operator\">-</span>Path C:\\Rabota<span class=\"token punctuation\">.</span>UA\\trunk\\Proj1<span class=\"token punctuation\">,</span> C:\\Rabota<span class=\"token punctuation\">.</span>UA\\trunk\\Proj2 <span class=\"token operator\">-</span>Recurse <span class=\"token operator\">-</span>Include <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>master<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>ascx<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>aspx<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>cs<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>ashx <span class=\"token operator\">-</span>ErrorAction SilentlyContinue <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$Bytes1</span> = <span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>FullName <span class=\"token operator\">-</span>Encoding Byte <span class=\"token operator\">-</span>Raw\n\t<span class=\"token variable\">$Bytes2</span> = <span class=\"token namespace\">[System.Text.Encoding]</span>::UTF8<span class=\"token punctuation\">.</span>GetBytes<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>FullName <span class=\"token operator\">-</span>Encoding UTF8 <span class=\"token operator\">-</span>Raw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># UTF-8 with BOM</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 239 <span class=\"token operator\">-and</span> <span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>1<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 187 <span class=\"token operator\">-and</span> <span class=\"token variable\">$Bytes1</span><span class=\"token punctuation\">[</span>2<span class=\"token punctuation\">]</span> <span class=\"token operator\">-eq</span> 191<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$Bytes1</span> = <span class=\"token variable\">$Bytes1</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">select</span> <span class=\"token operator\">-</span>Skip 3\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\"># No valid UTF-8</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Compare-Object</span> <span class=\"token variable\">$Bytes1</span> <span class=\"token variable\">$Bytes2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function\">Write-Host</span> <span class=\"token variable\">$Path</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"id":"df5b8a18-7d61-52e7-bb05-9d18d2bad5ed"}},"staticQueryHashes":[],"slicesMap":{}}
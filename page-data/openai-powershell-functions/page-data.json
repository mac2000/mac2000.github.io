{"componentChunkName":"component---src-templates-note-js","path":"/openai-powershell-functions/","result":{"data":{"remark":{"fields":{"path":"openai-powershell-functions"},"meta":{"title":""},"headings":[{"value":"OpenAI PowerShell Function Calls"}],"html":"<h1>OpenAI PowerShell Function Calls</h1>\n<p>Short note of how OpenAI can be used with Tools (similar to Llama tools)</p>\n<h2>How it works</h2>\n<p>Side by side with prompt, we are going to pass tools definition in jsonschema format</p>\n<p>So if usual request looks like this:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n    model             = <span class=\"token string\">\"gpt-4o\"</span>\n    input             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"system\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"You are assistant\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"user\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"Hello\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    text              = @<span class=\"token punctuation\">{</span>\n      format = @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    temperature       = 1\n    max_output_tokens = 2048\n    top_p             = 1\n    store             = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100</code></pre></div></p>\n<p>and response is:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"msg_67dd6e5b3bc08192ae7416b7916c587a034d4d1feea88755\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completed\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"assistant\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"output_text\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hi there! How can I assist you today?\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"annotations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All we need to do is to pass tools definitions like so:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n    model             = <span class=\"token string\">\"gpt-4o\"</span>\n    input             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"system\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"You are weather assistant\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"user\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"What is the weather in Kiev?\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    text              = @<span class=\"token punctuation\">{</span>\n      format = @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    tools             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_weather\"</span>\n        description = <span class=\"token string\">\"Determine weather in my location\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span>\n            location = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span>        = <span class=\"token string\">\"string\"</span>\n              description = <span class=\"token string\">\"The city and state e.g. San Francisco, CA\"</span>\n            <span class=\"token punctuation\">}</span>\n            unit     = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span> = <span class=\"token string\">\"string\"</span>\n              enum = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"f\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"location\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"unit\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        strict      = <span class=\"token boolean\">$true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    temperature       = 1\n    max_output_tokens = 2048\n    top_p             = 1\n    store             = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100</code></pre></div></p>\n<p>and output will be:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"function_call\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fc_67dd6eeb077c8192ae4b5cb3ea34879e0c5ae11b9c2089fb\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"call_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"call_M6vaQLRWeHenyuvLtsTgZhOK\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"get_weather\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"arguments\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{\\\"unit\\\":\\\"c\\\",\\\"location\\\":\\\"Kiev, Ukraine\\\"}\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completed\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note how different it is, it is not an text message anymore, but rather function fall</p>\n<p>It is our job to perform this call and pass result back to the model, so it can form the response</p>\n<p>Lets pretend that weather api give us response:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token property\">\"temperature\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>We pass this back to the model so it can form human readable response like so:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n    model             = <span class=\"token string\">\"gpt-4o\"</span>\n    input             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"system\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"You are weather assistant\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"user\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"What is the weather in Kiev?\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\"># append previous response as is</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>      = <span class=\"token string\">\"function_call\"</span>\n        id        = <span class=\"token string\">\"fc_67dd6eeb077c8192ae4b5cb3ea34879e0c5ae11b9c2089fb\"</span>\n        call_id   = <span class=\"token string\">\"call_M6vaQLRWeHenyuvLtsTgZhOK\"</span>\n        name      = <span class=\"token string\">\"get_weather\"</span>\n        arguments = <span class=\"token string\">\"{`\"unit`\":`\"c`\",`\"location`\":`\"Kiev, Ukraine`\"}\"</span>\n        status    = <span class=\"token string\">\"completed\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\"># as well as function call response</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n        call_id = <span class=\"token string\">\"call_M6vaQLRWeHenyuvLtsTgZhOK\"</span> <span class=\"token comment\"># keep track of the call_id</span>\n        output  = <span class=\"token string\">\"{`\"temperature`\":5}\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    text              = @<span class=\"token punctuation\">{</span>\n      format = @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    tools             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_weather\"</span>\n        description = <span class=\"token string\">\"Determine weather in my location\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span>\n            location = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span>        = <span class=\"token string\">\"string\"</span>\n              description = <span class=\"token string\">\"The city and state e.g. San Francisco, CA\"</span>\n            <span class=\"token punctuation\">}</span>\n            unit     = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span> = <span class=\"token string\">\"string\"</span>\n              enum = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"c\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"f\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"location\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"unit\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        strict      = <span class=\"token boolean\">$true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    temperature       = 1\n    max_output_tokens = 2048\n    top_p             = 1\n    store             = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100</code></pre></div></p>\n<p>model will recognize conversation history, function call and its response, and form following:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"msg_67dd705b92ec8192a1f0149080dda4e50c5ae11b9c2089fb\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completed\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"assistant\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"output_text\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The current temperature in Kiev, Ukraine is 5Â°C.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"annotations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>MacOS manage Music and Volume with OpenAI via PowerShell</h2>\n<p>As example, lets built an bot that will manage MacOS Music and Volue</p>\n<p>Our functions are:</p>\n<p><strong>get current volume level</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"output volume of (get volume settings)\"</span></code></pre></div>\n<p><strong>set volume level</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"set volume output volume 50\"</span></code></pre></div>\n<p><strong>mute</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"set volume with output muted\"</span></code></pre></div>\n<p><strong>unmute</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"set volume without output muted\"</span></code></pre></div>\n<p><strong>player state</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to player state'</span></code></pre></div>\n<p><strong>next song</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to next track'</span></code></pre></div>\n<p><strong>previous song</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to previous track'</span></code></pre></div>\n<p><strong>play/pause</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to playpause'</span></code></pre></div>\n<p><strong>stop</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to stop'</span></code></pre></div>\n<p><strong>get current song name</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">osascript <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'tell application \"Music\" to name of current track'</span></code></pre></div>\n<p>Here is an example with tool definitions:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n    model             = <span class=\"token string\">\"gpt-4o\"</span>\n    input             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"system\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"You are home assistant capable of changing volume level and control music player\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"user\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"What song is playing now?\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    text              = @<span class=\"token punctuation\">{</span>\n      format = @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    tools             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"mute_volume\"</span>\n        description = <span class=\"token string\">\"Mute volume\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"unmute_volume\"</span>\n        description = <span class=\"token string\">\"Unmute volume\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_volume_level\"</span>\n        description = <span class=\"token string\">\"Retrieve current volume level\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"set_volume_level\"</span>\n        description = <span class=\"token string\">\"Set volume level\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span>\n            level = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span>    = <span class=\"token string\">\"number\"</span>\n              minimum = 0\n              maximum = 100\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"level\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_player_state\"</span>\n        description = <span class=\"token string\">\"Retrieve state of the player, e.g. playing, paused, stopped\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"play_next_song\"</span>\n        description = <span class=\"token string\">\"Play next song\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"play_previous_song\"</span>\n        description = <span class=\"token string\">\"Play previous song\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"player_toggle_play_pause\"</span>\n        description = <span class=\"token string\">\"Play/pause toggler\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"player_stop\"</span>\n        description = <span class=\"token string\">\"Stop player\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_current_song_name\"</span>\n        description = <span class=\"token string\">\"Get current song name\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    temperature       = 1\n    max_output_tokens = 2048\n    top_p             = 1\n    store             = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100</code></pre></div></p>\n<p>it will respond with:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"function_call\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fc_67dd7920cf2c819298b39b3ff3e79c6d002defc744541390\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"call_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"call_52fbENg733i3fGx3x0hmirnn\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"get_current_song_name\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"arguments\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completed\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>our job now is to call script:</p>\n<div class=\"gatsby-highlight\" data-language=\"pwsh\"><pre class=\"language-pwsh\"><code class=\"language-pwsh\">$result = osascript -e &#39;tell application &quot;Music&quot; to name of current track&#39;</code></pre></div>\n<p>and pass it back to the model</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n    model             = <span class=\"token string\">\"gpt-4o\"</span>\n    input             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"system\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"You are home assistant capable of changing volume level and control music player\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        role    = <span class=\"token string\">\"user\"</span>\n        content = @<span class=\"token punctuation\">(</span>\n          @<span class=\"token punctuation\">{</span>\n            <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n            text = <span class=\"token string\">\"What song is playing now?\"</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\"># pass previous response as is</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>      = <span class=\"token string\">\"function_call\"</span>\n        id        = <span class=\"token string\">\"fc_67dd7920cf2c819298b39b3ff3e79c6d002defc744541390\"</span>\n        call_id   = <span class=\"token string\">\"call_52fbENg733i3fGx3x0hmirnn\"</span>\n        name      = <span class=\"token string\">\"get_current_song_name\"</span>\n        arguments = <span class=\"token string\">\"{}\"</span>\n        status    = <span class=\"token string\">\"completed\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\"># as well as function call response</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n        call_id = <span class=\"token string\">\"call_52fbENg733i3fGx3x0hmirnn\"</span> <span class=\"token comment\"># keep track of the call_id</span>\n        output  = <span class=\"token string\">\"{`\"song_name`\":`\"Maria (I Like It Loud)`\"}\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    text              = @<span class=\"token punctuation\">{</span>\n      format = @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    tools             = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"mute_volume\"</span>\n        description = <span class=\"token string\">\"Mute volume\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"unmute_volume\"</span>\n        description = <span class=\"token string\">\"Unmute volume\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_volume_level\"</span>\n        description = <span class=\"token string\">\"Retrieve current volume level\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"set_volume_level\"</span>\n        description = <span class=\"token string\">\"Set volume level\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span>\n            level = @<span class=\"token punctuation\">{</span>\n              <span class=\"token function\">type</span>    = <span class=\"token string\">\"number\"</span>\n              minimum = 0\n              maximum = 100\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"level\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_player_state\"</span>\n        description = <span class=\"token string\">\"Retrieve state of the player, e.g. playing, paused, stopped\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"play_next_song\"</span>\n        description = <span class=\"token string\">\"Play next song\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"play_previous_song\"</span>\n        description = <span class=\"token string\">\"Play previous song\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"player_toggle_play_pause\"</span>\n        description = <span class=\"token string\">\"Play/pause toggler\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"player_stop\"</span>\n        description = <span class=\"token string\">\"Stop player\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n        name        = <span class=\"token string\">\"get_current_song_name\"</span>\n        description = <span class=\"token string\">\"Get current song name\"</span>\n        parameters  = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n          properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n          required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          additionalProperties = <span class=\"token boolean\">$false</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n    temperature       = 1\n    max_output_tokens = 2048\n    top_p             = 1\n    store             = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100</code></pre></div></p>\n<p>response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"msg_67dd79c35a24819298f019f942b5c1ce002defc744541390\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"completed\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"role\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"assistant\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"output_text\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"text\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The current song playing is \\\"Maria (I Like It Loud).\\\"\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"annotations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>and now it is time to combine everything together</p>\n<p><div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$tools</span> = @<span class=\"token punctuation\">(</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"mute_volume\"</span>\n    description = <span class=\"token string\">\"Mute volume\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"unmute_volume\"</span>\n    description = <span class=\"token string\">\"Unmute volume\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"get_volume_level\"</span>\n    description = <span class=\"token string\">\"Retrieve current volume level\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"set_volume_level\"</span>\n    description = <span class=\"token string\">\"Set volume level\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span>\n        level = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span>    = <span class=\"token string\">\"number\"</span>\n          minimum = 0\n          maximum = 100\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token string\">\"level\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"get_player_state\"</span>\n    description = <span class=\"token string\">\"Retrieve state of the player, e.g. playing, paused, stopped\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"play_next_song\"</span>\n    description = <span class=\"token string\">\"Play next song\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"play_previous_song\"</span>\n    description = <span class=\"token string\">\"Play previous song\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"player_toggle_play_pause\"</span>\n    description = <span class=\"token string\">\"Play/pause toggler\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"player_stop\"</span>\n    description = <span class=\"token string\">\"Stop player\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  @<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">type</span>        = <span class=\"token string\">\"function\"</span>\n    name        = <span class=\"token string\">\"get_current_song_name\"</span>\n    description = <span class=\"token string\">\"Get current song name\"</span>\n    parameters  = @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>                 = <span class=\"token string\">\"object\"</span>\n      properties           = @<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      required             = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      additionalProperties = <span class=\"token boolean\">$false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$conversation</span> = @<span class=\"token punctuation\">(</span>\n  @<span class=\"token punctuation\">{</span>\n    role    = <span class=\"token string\">\"system\"</span>\n    content = @<span class=\"token punctuation\">(</span>\n      @<span class=\"token punctuation\">{</span>\n        <span class=\"token function\">type</span> = <span class=\"token string\">\"input_text\"</span>\n        text = <span class=\"token string\">\"You are home assistant capable of changing volume level and control music player\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token variable\">$prompt</span> = <span class=\"token boolean\">$true</span>\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">$true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$prompt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$message</span> = <span class=\"token function\">Read-Host</span> <span class=\"token string\">\"Enter message\"</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$message</span> <span class=\"token operator\">-or</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">.</span>ToLower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"exit\"</span> <span class=\"token operator\">-or</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">.</span>ToLower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"quit\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Bye!\"</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      role    = <span class=\"token string\">\"user\"</span>\n      content = <span class=\"token variable\">$message</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$prompt</span> = <span class=\"token boolean\">$false</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token variable\">$res</span> = <span class=\"token function\">Invoke-RestMethod</span> <span class=\"token operator\">-</span>Method Post <span class=\"token operator\">-</span>Uri <span class=\"token string\">\"https://api.openai.com/v1/responses\"</span> <span class=\"token operator\">-</span>Headers @<span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> = <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">;</span> <span class=\"token string\">\"Authorization\"</span> = <span class=\"token string\">\"Bearer <span class=\"token function\">$<span class=\"token punctuation\">(</span><span class=\"token variable\">$env</span>:OPENAI_API_KEY<span class=\"token punctuation\">)</span></span>\"</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">-</span>Body <span class=\"token punctuation\">(</span><span class=\"token function\">ConvertTo-Json</span> <span class=\"token operator\">-</span>Depth 100 <span class=\"token operator\">-</span>InputObject @<span class=\"token punctuation\">{</span>\n      model             = <span class=\"token string\">\"gpt-4o\"</span>\n      input             = <span class=\"token variable\">$conversation</span>\n      text              = @<span class=\"token punctuation\">{</span>\n        format = @<span class=\"token punctuation\">{</span>\n          <span class=\"token function\">type</span> = <span class=\"token string\">\"text\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      tools             = <span class=\"token variable\">$tools</span>\n      temperature       = 1\n      max_output_tokens = 2048\n      top_p             = 1\n      store             = <span class=\"token boolean\">$true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"message\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text\n    <span class=\"token variable\">$prompt</span> = <span class=\"token boolean\">$true</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"mute_volume\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">\"set volume with output muted\"</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"unmute_volume\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">\"set volume without output muted\"</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"get_volume_level\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> = <span class=\"token namespace\">[int]</span><span class=\"token punctuation\">(</span>osascript <span class=\"token operator\">-</span>e <span class=\"token string\">\"output volume of (get volume settings)\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"level`\":<span class=\"token variable\">$result</span>}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"set_volume_level\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$level</span> = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>arguments <span class=\"token punctuation\">|</span> <span class=\"token function\">ConvertFrom-Json</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select-Object</span> <span class=\"token operator\">-</span>ExpandProperty level\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">\"set volume output volume <span class=\"token variable\">$level</span>\"</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"get_player_state\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> = osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to player state'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"state`\":`\"<span class=\"token variable\">$result</span>`\"}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"play_next_song\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to next track'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"play_previous_song\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to previous track'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"player_toggle_play_pause\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to playpause'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"player_stop\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to stop'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token string\">\"{`\"success`\":true}\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">type</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">\"function_call\"</span> <span class=\"token operator\">-and</span> <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>name <span class=\"token operator\">-eq</span> <span class=\"token string\">\"get_current_song_name\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$result</span> = osascript <span class=\"token operator\">-</span>e <span class=\"token string\">'tell application \"Music\" to name of current track'</span>\n    <span class=\"token variable\">$conversation</span> <span class=\"token operator\">+=</span> @<span class=\"token punctuation\">{</span>\n      <span class=\"token function\">type</span>    = <span class=\"token string\">\"function_call_output\"</span>\n      call_id = <span class=\"token variable\">$res</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span>call_id\n      output  = <span class=\"token variable\">$result</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>And here is transcript:</p>\n<div class=\"gatsby-highlight\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\"><span class=\"token property\">Enter message:</span> is music playing<span class=\"token operator\">?</span>\nNo<span class=\"token punctuation\">,</span> the music is currently stopped<span class=\"token punctuation\">.</span>\n<span class=\"token property\">Enter message:</span> start it\nThe music has been started<span class=\"token punctuation\">.</span>\n<span class=\"token property\">Enter message:</span> make it louder\nI've increased the volume to <span class=\"token number\">35</span><span class=\"token operator\">%</span><span class=\"token punctuation\">.</span>\n<span class=\"token property\">Enter message:</span> play next song\nThe next song is now playing<span class=\"token punctuation\">.</span>\n<span class=\"token property\">Enter message:</span> what song is that<span class=\"token operator\">?</span>\nThe current song playing is <span class=\"token string\">\"Statement.\"</span></code></pre></div>\n<p>And technically you can do almost anything with such approach, and imagine what can be done if you add text to speech on top</p>\n<p>To see, what other osascript script available open <code class=\"language-text\">Script Editor.app</code> and from <code class=\"language-text\">File</code> menu choose <code class=\"language-text\">Open Dictionary...</code> - popup with all possible and impossible applications will be shown, just choose one you want to play with and scrip editor will show you what's available.</p>"}},"pageContext":{"id":"64b85e52-75e0-5781-a5cc-971430e6ac22"}},"staticQueryHashes":[],"slicesMap":{}}
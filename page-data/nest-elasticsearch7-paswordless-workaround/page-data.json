{"componentChunkName":"component---src-templates-note-js","path":"/nest-elasticsearch7-paswordless-workaround/","result":{"data":{"remark":{"fields":{"path":"nest-elasticsearch7-paswordless-workaround"},"meta":{"title":""},"headings":[{"value":"NEST, Elasticsearch.Net v7 workaround for passwordless"},{"value":"Baseline"},{"value":"How it works?"},{"value":"Passwordless"},{"value":"Show me the code"}],"html":"<h1>NEST, Elasticsearch.Net v7 workaround for passwordless</h1>\n<p>Версия 7 не умеет кастомные авторизации, доступны только Basic и ApiKey</p>\n<p>Апдейт на 8 версию, может быть сложным, а может и нет, зависит от конретно взятого случая</p>\n<p>Ниже, пример, как выкрутиться и прикрутить это дело к v7</p>\n<h1>Baseline</h1>\n<p>Демо пример делаем на консольном приложении, аля</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> es7\n<span class=\"token builtin class-name\">cd</span> es7\ndotnet new console\ndotnet <span class=\"token function\">add</span> package NEST\ndotnet <span class=\"token function\">add</span> package Azure.Identity</code></pre></div>\n<p>За основу берем следующий пример, вокруг которого будем плясать</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Elasticsearch<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Nest</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> cloudId <span class=\"token operator\">=</span> <span class=\"token string\">\"dev:ZXVyb3BlLXdlc3QzLmdjcC5jbG91ZC5lcy5pbzo0NDMkY2IwM2Q1ZDkzMGU5NDFmMWI0MzFjY2I2NjU0MjkwMWMkNjhhOGMxNDFjNmExNDk2NWEyMTI2YWUxOTM1MzkwMGU=\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ElasticClient</span><span class=\"token punctuation\">(</span>cloudId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BasicAuthenticationCredentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"elastic\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"xxxxxxxx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// request example to prove it works</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">SearchAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> s\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vacancysearch\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Query</span><span class=\"token punctuation\">(</span>q <span class=\"token operator\">=></span> q\n    <span class=\"token punctuation\">.</span><span class=\"token function\">MatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> hit <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">.</span>Hits<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>hit<span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Запустив это дело, получим пару id вакансий - значит все ок, все работает</p>\n<blockquote>\n<p>Примечание: по сути мы могли бы пользовать <code class=\"language-text\">Uri</code>, за вместо <code class=\"language-text\">cloudId</code>, но поскольку он, все равно будет из коробки пользоваться в v8, то сразу пользуем его</p>\n</blockquote>\n<h1>How it works?</h1>\n<p>Выкручиваться будем за счет проперти <code class=\"language-text\">OnRequestDataCreated</code> позволяющей модифицировать запрос перед тем как он будет отправлен в эластик</p>\n<p>Выглядит это дело вот так</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Elasticsearch<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Nest</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> cloudId <span class=\"token operator\">=</span> <span class=\"token string\">\"dev:ZXVyb3BlLXdlc3QzLmdjcC5jbG91ZC5lcy5pbzo0NDMkY2IwM2Q1ZDkzMGU5NDFmMWI0MzFjY2I2NjU0MjkwMWMkNjhhOGMxNDFjNmExNDk2NWEyMTI2YWUxOTM1MzkwMGU=\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> settings <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ConnectionSettings</span><span class=\"token punctuation\">(</span>cloudId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BasicAuthenticationCredentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doesnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"matter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsettings<span class=\"token punctuation\">.</span><span class=\"token function\">OnRequestDataCreated</span><span class=\"token punctuation\">(</span>request <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n  request<span class=\"token punctuation\">.</span>Headers<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Basic xxxxxxxxx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// echo -n 'elastic:xxxxxx' | base64</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ElasticClient</span><span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">SearchAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> s\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vacancysearch\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Query</span><span class=\"token punctuation\">(</span>q <span class=\"token operator\">=></span> q\n        <span class=\"token punctuation\">.</span><span class=\"token function\">MatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> hit <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">.</span>Hits<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>hit<span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Примечания:</p>\n<ul>\n<li>что важно, в <code class=\"language-text\">BasicAuthenticationCredentials</code> я вбил какую то абра кадабру, она не важна, т.к. мы будем переопределять ее дальше</li>\n<li>в <code class=\"language-text\">OnRequestDataCreated</code> мы подсовываем в заголовок <code class=\"language-text\">Authentication</code> заранее подготовленую <code class=\"language-text\">base64</code> строку с кредами</li>\n<li>на выходе имеем рабочий сетап, по сути делающий то же самое, что происходило в базовом сетапе</li>\n</ul>\n<h1>Passwordless</h1>\n<p>Теперь пазл начал складываться и по сути все что осталось, это за вместо basic, подсунуть bearer, а как его получать мы уже разобрались</p>\n<p>На выходе получаем вот такое</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Azure<span class=\"token punctuation\">.</span>Core</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Azure<span class=\"token punctuation\">.</span>Identity</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Elasticsearch<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Nest</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> cloudId <span class=\"token operator\">=</span> <span class=\"token string\">\"dev:ZXVyb3BlLXdlc3QzLmdjcC5jbG91ZC5lcy5pbzo0NDMkY2IwM2Q1ZDkzMGU5NDFmMWI0MzFjY2I2NjU0MjkwMWMkNjhhOGMxNDFjNmExNDk2NWEyMTI2YWUxOTM1MzkwMGU=\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> scope <span class=\"token operator\">=</span> <span class=\"token string\">\"api://elastic-dev/.default\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> credentials <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DefaultAzureCredential</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> settings <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ConnectionSettings</span><span class=\"token punctuation\">(</span>cloudId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BasicAuthenticationCredentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doesnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"matter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsettings<span class=\"token punctuation\">.</span><span class=\"token function\">OnRequestDataCreated</span><span class=\"token punctuation\">(</span>request <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> token <span class=\"token operator\">=</span> credentials<span class=\"token punctuation\">.</span><span class=\"token function\">GetToken</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TokenRequestContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">scope</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TBD: AuthenticationFailedException</span>\n    request<span class=\"token punctuation\">.</span>Headers<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">.</span>Token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TBD: null</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ElasticClient</span><span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">SearchAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> s\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vacancysearch\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">Query</span><span class=\"token punctuation\">(</span>q <span class=\"token operator\">=></span> q\n        <span class=\"token punctuation\">.</span><span class=\"token function\">MatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> hit <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">.</span>Hits<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>hit<span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Примечания:</p>\n<ul>\n<li>по сути тут меняется только внутрянка <code class=\"language-text\">OnRequestDataCreated</code></li>\n<li>вероятно там еще стоит учесть потенциальное исключение и сдлеать проверку на null, но это out of scope этой заметки</li>\n<li>в остальном вот так просто можно прикрутить passwordless к старому эластику, даже если нет возомжонсти его обновить</li>\n</ul>\n<h1>Show me the code</h1>\n<p>За для истории, содержимое <code class=\"language-text\">Program.cs</code> целиком</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Azure<span class=\"token punctuation\">.</span>Core</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Azure<span class=\"token punctuation\">.</span>Identity</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Elasticsearch<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Nest</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// dotnet add package NEST</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> cloudId <span class=\"token operator\">=</span> <span class=\"token string\">\"dev:ZXVyb3BlLXdlc3QzLmdjcC5jbG91ZC5lcy5pbzo0NDMkY2IwM2Q1ZDkzMGU5NDFmMWI0MzFjY2I2NjU0MjkwMWMkNjhhOGMxNDFjNmExNDk2NWEyMTI2YWUxOTM1MzkwMGU=\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// BEFORE:</span>\n<span class=\"token comment\">// var client = new ElasticClient(cloudId, new BasicAuthenticationCredentials(\"elastic\", \"xxxxx\"));</span>\n\n<span class=\"token comment\">// HOW IT WORKS:</span>\n<span class=\"token comment\">// - there is OnRequestDataCreated that allows modify request before it is sent to elastic</span>\n<span class=\"token comment\">// - we will set authorization header there</span>\n<span class=\"token comment\">// - as a proof of concept - showing basic auth example</span>\n<span class=\"token comment\">// var settings = new ConnectionSettings(cloudId, new BasicAuthenticationCredentials(\"doesnt\", \"matter\"));</span>\n<span class=\"token comment\">// settings.OnRequestDataCreated(request =></span>\n<span class=\"token comment\">// {</span>\n<span class=\"token comment\">//   request.Headers.Set(\"Authorization\", \"Basic ZWxhc3RpYzpaSjlRdXBndHY0cVphaU15cTZqeFYzT2M=\"); // echo -n 'elastic:xxxxx' | base64</span>\n<span class=\"token comment\">// });</span>\n<span class=\"token comment\">// var client = new ElasticClient(settings);</span>\n\n<span class=\"token comment\">// AFTER:</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> scope <span class=\"token operator\">=</span> <span class=\"token string\">\"api://elastic-dev/.default\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> credentials <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DefaultAzureCredential</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> settings <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ConnectionSettings</span><span class=\"token punctuation\">(</span>cloudId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">BasicAuthenticationCredentials</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"doesnt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"matter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// note - here, instead of cloudId we may pass Uri, but at the very end in v8 we will use cloudId, that's why we using it</span>\nsettings<span class=\"token punctuation\">.</span><span class=\"token function\">OnRequestDataCreated</span><span class=\"token punctuation\">(</span>request <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> token <span class=\"token operator\">=</span> credentials<span class=\"token punctuation\">.</span><span class=\"token function\">GetToken</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">TokenRequestContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">scope</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TBD: AuthenticationFailedException</span>\n  request<span class=\"token punctuation\">.</span>Headers<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">.</span>Token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// TBD: null</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ElasticClient</span><span class=\"token punctuation\">(</span>settings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// request example to prove it works</span>\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">SearchAsync</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">object</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> s\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Index</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vacancysearch\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">Query</span><span class=\"token punctuation\">(</span>q <span class=\"token operator\">=></span> q\n    <span class=\"token punctuation\">.</span><span class=\"token function\">MatchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> hit <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">.</span>Hits<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>hit<span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"id":"0bf35dda-d190-5f62-8f06-2df0f798e4cf"}},"staticQueryHashes":[],"slicesMap":{}}
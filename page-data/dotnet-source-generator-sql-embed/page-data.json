{"componentChunkName":"component---src-templates-note-js","path":"/dotnet-source-generator-sql-embed/","result":{"data":{"remark":{"fields":{"path":"dotnet-source-generator-sql-embed"},"meta":{"title":""},"headings":[{"value":"dotnet source generator embed sql"}],"html":"<h1>dotnet source generator embed sql</h1>\n<p>Did you ever saw code like this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">con<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Query</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>Whatever<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"\nSELECT\n  a,\n  b,\n  c,\n  ...\nFROM table\nJOIN quadrillion_more_tables\nWHERE quadrillion_more_considtions\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There is few bad things:</p>\n<ul>\n<li>we do not have code highlight and analysis</li>\n<li>it formats and looks ugly</li>\n<li>it is simple to make mistake</li>\n<li>it is hard to run query</li>\n</ul>\n<p>Imagine how much easier it will be read such code instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">con<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Query</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>Whatever<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>Sql<span class=\"token punctuation\">.</span>SelectAllWhatever<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To do so we gonna need some static class like this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Sql</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> SelectAllWhatever <span class=\"token operator\">=</span> <span class=\"token string\">\"SELECT ... FROM ....\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>But problem still remains</p>\n<p>To deal with this we are going to introduce code generator which only purpose will be to inject found sql file contents into this static class</p>\n<p>So technically we may have empty <code class=\"language-text\">Sql</code> class but make it partial in our project, ok, maybe with some other helpers, aka:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">Demo</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">partial</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Sql</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> <span class=\"token function\">Exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token class-name\">IDbConnection</span> connection<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> sql<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> command <span class=\"token operator\">=</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCommand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    command<span class=\"token punctuation\">.</span>CommandText <span class=\"token operator\">=</span> sql<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">.</span>State <span class=\"token operator\">!=</span> ConnectionState<span class=\"token punctuation\">.</span>Open<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      connection<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> affected <span class=\"token operator\">=</span> command<span class=\"token punctuation\">.</span><span class=\"token function\">ExecuteNonQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">.</span>State <span class=\"token operator\">==</span> ConnectionState<span class=\"token punctuation\">.</span>Open<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      connection<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> affected<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>Next we are going to create class library in our solution with single file:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>CodeAnalysis</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>CodeAnalysis<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">SqlConstants</span>\n<span class=\"token punctuation\">{</span>\n\n  <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Generator</span></span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Generator</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">ISourceGenerator</span></span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Initialize</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GeneratorInitializationContext</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// throw new NotImplementedException();</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GeneratorExecutionContext</span> context<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> sb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"\nnamespace Demo\n{\n    public static partial class Sql\n    {\n        public static void World() => System.Console.WriteLine(\"\"ACME\"\");\n\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> file <span class=\"token keyword\">in</span> context<span class=\"token punctuation\">.</span>AdditionalFiles<span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>file <span class=\"token operator\">=></span> file<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">.</span><span class=\"token function\">EndsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".sql\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> name <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetFileNameWithoutExtension</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>Path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> content <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">GetText</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>CancellationToken<span class=\"token punctuation\">)</span><span class=\"token punctuation\">?.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\"\\\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// if (!content.Contains(\"SELECT * \")) throw new Exception(\"QUERIES MUST BE WILDCARDED\");</span>\n\n        sb<span class=\"token punctuation\">.</span><span class=\"token function\">AppendLine</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"public const string </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">name</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> = @\\\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">content</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\\\";\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// sb.AppendLine($\"public static CompaniesByNameContains(this IDbConnection con, {content} + \" WHERE name Container(name) \", string name ) {}\");</span>\n      <span class=\"token punctuation\">}</span>\n\n      sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"\n    }\n}\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      context<span class=\"token punctuation\">.</span><span class=\"token function\">AddSource</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sql.g.cs\"</span><span class=\"token punctuation\">,</span> sb<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>Inside nothing special, we are traversing all files, looking for <code class=\"language-text\">.sql</code> ones, and grabing their content into our string builder.</p>\n<p>The result is stored as so called <code class=\"language-text\">Sql.g.cs</code> it will live in</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 594px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70768d069579f79af8a21fc770128b29/5fd3e/gen.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.390625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACtUlEQVR42oWUWXPiOBRG8/9/0bzNW2cmmUAAG+82mwN2jHfAeDtTEnEXAbpbVbdsS/LRXT7dpziOeX9/Z5/u2QYB2yDkfTIlyXIWqxVpllMeTxTCDsfLszxc3sXzeJLrWZ6TpilPZVmSJCnjv6cct0sia0bmu6Qbl2zjEC8MIndOoI3YuxqhMSHdeHxailwL9DGf1pQi2ZMIYHWuaJuWT2/PdPIfO1ulWNuUwYYqi6nLnCqNpJ2LlFMa0RxLTklEfSzkd5Xtac4VWZbxVFUV0NO0Nbpv43saoT6hiHaI0XQdndzx+9H3PXmeD0Doup6+7VhvfGxvwWg8xjB0ptMJqqLw9vZGmiZfP3cSMBh9T9d1F2AURT9PEJNN02CaBs/Pz3ieh67rrNdruSZs2CtBX+8Xh76AQRB8A4rx+vrKvy8vKKrGfD7HcRyGSK5hD4FhGN5tFDJ6+ecHjqGw2+1wXZckSb4d+ksPHwHFyA4l66WOZeiYpoWqqoxGI1ar1e+B1yH/XGwaPuIUy1axdA3dMLBtG6HZb8V4BBTqvgO2LWEcs3JnuLaFpgkvTR5Fcwc8n893m+q2p459QmeMbpjSOwFcLpdSBdf774C31ZPLbc06P/OXl6FrGpZlSR0K+dzC/ggcQt4nMQtvjm2aUjqiKIZh4Pv+3Q35BjydTncedm1DkJWYzhzPNnEcl8XiInIhIXFni6JgSNcAFHMPPRTNoihLdr6LMpvgep70brFYoCiK1OlkMpEavfb0UEQPcvgFbeqa5nxCV0YoszmapsmrOBRI5FWkYTabyfyKuePhBvhoNE2NvbVQdRVDN2TIm82Guq7ldRxMhC9u01W36WjalrqMKdJPDqIj5zkix8kxZhfuZJU/Pj4YtHtbHNmxr4G1yN1Wx1ZemCmqzJfQ3q/6322axGH/A/dr9110jLoxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/70768d069579f79af8a21fc770128b29/5fd3e/gen.png\"\n        srcset=\"/static/70768d069579f79af8a21fc770128b29/6f3f2/gen.png 256w,\n/static/70768d069579f79af8a21fc770128b29/01e7c/gen.png 512w,\n/static/70768d069579f79af8a21fc770128b29/5fd3e/gen.png 594w\"\n        sizes=\"(max-width: 594px) 100vw, 594px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>For this to work you gonna need following dependencies:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Project</span> <span class=\"token attr-name\">Sdk</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.NET.Sdk<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TargetFramework</span><span class=\"token punctuation\">></span></span>netstandard2.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TargetFramework</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Microsoft.CodeAnalysis.CSharp - 4.0.1 - works fine --></span>\n    <span class=\"token comment\">&lt;!-- Microsoft.CodeAnalysis.CSharp - 4.3.0 - brokes build --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PackageReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.CodeAnalysis.CSharp<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4.0.1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">PrivateAssets</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>all<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PackageReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.CodeAnalysis.Analyzers<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3.3.3<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PrivateAssets</span><span class=\"token punctuation\">></span></span>all<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PrivateAssets</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>IncludeAssets</span><span class=\"token punctuation\">></span></span>runtime; build; native; contentfiles; analyzers; buildtransitive<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>IncludeAssets</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PackageReference</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Project</span><span class=\"token punctuation\">></span></span></code></pre></div></p>\n<p>Now to wire everything up you gonna need to add reference to this generator into main project</p>\n<p><div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Project</span> <span class=\"token attr-name\">Sdk</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.NET.Sdk<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>OutputType</span><span class=\"token punctuation\">></span></span>Exe<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>OutputType</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>TargetFramework</span><span class=\"token punctuation\">></span></span>net6.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>TargetFramework</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ImplicitUsings</span><span class=\"token punctuation\">></span></span>enable<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ImplicitUsings</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Nullable</span><span class=\"token punctuation\">></span></span>enable<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Nullable</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LangVersion</span><span class=\"token punctuation\">></span></span>default<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>LangVersion</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>PropertyGroup</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PackageReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Dapper<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2.0.123<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>PackageReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.Data.Sqlite<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Version</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>6.0.8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- note OutputItemType=\"Analyzer\" ReferenceOutputAssembly=\"false\" that is required for source generators to work --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ProjectReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>..\\SqlConstants\\SqlConstants.csproj<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">OutputItemType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Analyzer<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ReferenceOutputAssembly</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- note that we are going to catch all sql files --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>AdditionalFiles</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>**/*.sql<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Project</span><span class=\"token punctuation\">></span></span></code></pre></div></p>\n<p>With this in place after compilation suddenly you <code class=\"language-text\">Sql</code> class has everytthing you need, and your program become clean:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Dapper</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Demo</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>Sqlite</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> connection <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SqliteConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Data Source=:memory:\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">OpenAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">await</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">ExecuteAsync</span><span class=\"token punctuation\">(</span>Sql<span class=\"token punctuation\">.</span>CreateTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> connection<span class=\"token punctuation\">.</span><span class=\"token function\">ExecuteAsync</span><span class=\"token punctuation\">(</span>Sql<span class=\"token punctuation\">.</span>Insert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> player <span class=\"token keyword\">in</span> connection<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Query</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>Player<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span>Sql<span class=\"token punctuation\">.</span>SelectAllPlayers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n  Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span>player<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">record</span> <span class=\"token class-name\">Player</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> Id <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> Name <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> Age <span class=\"token punctuation\">{</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">init</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>Also thing about following, imagine that we are working with SQL Server and want to enforce <code class=\"language-text\">WITH (NOLOCK)</code> to be present - we may parse content of sql file and throw exceptions from generator if we found something.</p>"}},"pageContext":{"id":"758c737d-705d-59d6-8a4e-4da2dc65945c"}},"staticQueryHashes":[],"slicesMap":{}}
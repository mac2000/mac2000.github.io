{"componentChunkName":"component---src-templates-note-js","path":"/elasticsearch-unassigned-nodes/","result":{"data":{"remark":{"fields":{"path":"elasticsearch-unassigned-nodes"},"meta":{"title":""},"headings":[{"value":"ElasticSearc unassigned nodes"}],"html":"<h1>ElasticSearc unassigned nodes</h1>\n<p>Посмотреть что происходит можно вот этой командой</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /_cluster/allocation/explain?pretty</code></pre></div>\n<p><a href=\"http://www.elastichq.org/app/index.php#nodediagnostics\">http://www.elastichq.org/app/index.php#nodediagnostics</a> - не плохой тул, через vpn, без установки можно подключиться к кластеру и снять общую статистику</p>\n<p><a href=\"https://t37.net/how-to-fix-your-elasticsearch-cluster-stuck-in-initializing-shards-mode.html\">https://t37.net/how-to-fix-your-elasticsearch-cluster-stuck-in-initializing-shards-mode.html</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-XGET</span> http://192.168.0.11:9200/<span class=\"token punctuation\">\\</span>_cat/shards <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> UNASSIGNED\n\nresumelist4 <span class=\"token number\">4</span> r UNASSIGNED\nresumelist4 <span class=\"token number\">0</span> r UNASSIGNED\nresumelist4 <span class=\"token number\">3</span> r UNASSIGNED\nresumelist4 <span class=\"token number\">1</span> r UNASSIGNED\nresumelist4 <span class=\"token number\">2</span> r UNASSIGNED</code></pre></div>\n<p>В этой штуке нас интересует второй столбец, это те самые шарды что в <a href=\"http://192.168.0.15:9200/_plugin/head/\">http://192.168.0.15:9200/_plugin/head/</a> обозначаются серыми квадратиками</p>\n<p>Дальше самое интересное, при попытке выполнить комманду:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /_cluster/reroute\n{\n  \"commands\": [\n    {\n      \"allocate\": {\n        \"index\": \"resumelist4\",\n        \"shard\": 0,\n        \"node\": \"SRV11\",\n        \"allow_primary\": true\n      }\n    }\n  ]\n}</code></pre></div>\n<p>Получил киллометровую ошибку с перечислением Yes/No почему комманда не может быть выполнено - в самом конце списка - было сообщение о том что мы уперлись в свободное место на диске.</p>\n<p>Полечил</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PUT /_cluster/settings?flat_settings=true\n{\n  \"transient\": {\n    \"cluster.routing.allocation.disk.watermark.low\": \"95%\",\n    \"cluster.routing.allocation.disk.watermark.high\": \"99%\"\n  }\n}</code></pre></div>\n<p>В такой ситуации переключение количества реплик:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PUT /resumelist4/_settings\n{\n    \"index\" : {\n        \"number_of_replicas\": 2\n    }\n}</code></pre></div>\n<p>В один и затем назад в два ничего не дает</p>"}},"pageContext":{"id":"a303fc7e-3c77-5ff7-9c1e-64601ba3b72c"}},"staticQueryHashes":[],"slicesMap":{}}
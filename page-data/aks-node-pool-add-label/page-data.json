{"componentChunkName":"component---src-templates-note-js","path":"/aks-node-pool-add-label","result":{"data":{"remark":{"fields":{"path":"aks-node-pool-add-label"},"meta":{"title":""},"headings":[{"value":"Azure Kubernetes (AKS) - add label to existing node pool"}],"html":"<h1>Azure Kubernetes (AKS) - add label to existing node pool</h1>\n<p>In our cluster we have custom admission webhoot that performs certain number of checks one of which is requirement for deployments to define node selector</p>\n<p>And for very old project to experiment we have added windows node pool but forget to add node label</p>\n<p>Here is how it can be fixed:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># STEP 0: AZ CLI</span>\n<span class=\"token comment\"># current</span>\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># available</span>\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># change</span>\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubscription\"</span>\n\n<span class=\"token comment\"># STEP 1: Add label to existing AKS node pool</span>\n\n<span class=\"token comment\"># list clusters</span>\naz aks list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{Name:name,ResourceGroup:resourceGroup}\"</span> <span class=\"token parameter variable\">--output</span> table\n<span class=\"token assign-left variable\">CLUSTER_NAME</span><span class=\"token operator\">=</span>mycluster\n<span class=\"token assign-left variable\">RESOURCE_GROUP</span><span class=\"token operator\">=</span>myrg\n\n<span class=\"token comment\"># list node pools</span>\naz aks nodepool list --cluster-name <span class=\"token variable\">$CLUSTER_NAME</span> --resource-group <span class=\"token variable\">$RESOURCE_GROUP</span> <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token assign-left variable\">POOL_NAME</span><span class=\"token operator\">=</span>win\n\n<span class=\"token comment\"># update labels - note old labels will be overwritten</span>\naz aks nodepool update --resource-group <span class=\"token variable\">$RESOURCE_GROUP</span> --cluster-name <span class=\"token variable\">$CLUSTER_NAME</span> <span class=\"token parameter variable\">--name</span> <span class=\"token variable\">$POOL_NAME</span> <span class=\"token parameter variable\">--labels</span> <span class=\"token assign-left variable\">poolDestination</span><span class=\"token operator\">=</span>win</code></pre></div>\n<p>From what I see it seems that this operation is quite fast and does not require any downtime</p>"}},"pageContext":{"id":"2c7ef99f-2965-5402-9cba-8dbf4807366f"}},"staticQueryHashes":[]}
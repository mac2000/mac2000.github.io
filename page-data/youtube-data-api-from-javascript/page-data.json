{"componentChunkName":"component---src-templates-note-js","path":"/youtube-data-api-from-javascript/","result":{"data":{"remark":{"fields":{"path":"youtube-data-api-from-javascript"},"meta":{"title":""},"headings":[{"value":"YouTube Data API from browser"}],"html":"<h1>YouTube Data API from browser</h1>\n<p>I was thinking about some kind of small web page to manage YouTube list of videos I wish to watch</p>\n<p>Here is an starting point of how this may be done without 3rd party dependencies</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// https://console.cloud.google.com/apis/credentials</span>\n<span class=\"token keyword\">var</span> api_key <span class=\"token operator\">=</span> <span class=\"token string\">\"AIzaSy.....\"</span>\n<span class=\"token keyword\">var</span> client_id <span class=\"token operator\">=</span> <span class=\"token string\">\"9844.....apps.googleusercontent.com\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hash <span class=\"token operator\">&amp;&amp;</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hash<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&amp;&amp;</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hash<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hash<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> state <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> access_token <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"access_token\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> token_type <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token_type\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> expires_in <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"expires_in\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> scope <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scope\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> authuser <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authuser\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> prompt <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prompt\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> session_state <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"session_state\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> error <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> error_description <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error_description\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> error_uri <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error_uri\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> id_token <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id_token\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> scopes <span class=\"token operator\">=</span> scope<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// TODO: check state, error, scopes</span>\n    <span class=\"token comment\">// console.log({ state, access_token, token_type, expires_in, scopes, authuser, prompt, session_state, error, error_description, error_uri, id_token })</span>\n    sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span> access_token<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// http://localhost:3000/#state=003cceac&amp;access_token=ya29&amp;token_type=Bearer&amp;expires_in=3599&amp;scope=email%20profile%20https://www.googleapis.com/auth/userinfo.email%20https://www.googleapis.com/auth/youtube.force-ssl%20https://www.googleapis.com/auth/youtubepartner%20openid%20https://www.googleapis.com/auth/userinfo.profile%20https://www.googleapis.com/auth/youtube%20https://www.googleapis.com/auth/youtube.readonly&amp;authuser=0&amp;prompt=consent</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'state'</span><span class=\"token punctuation\">,</span> crypto<span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://accounts.google.com/o/oauth2/v2/auth\"</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"client_id\"</span><span class=\"token punctuation\">,</span> client_id<span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redirect_uri\"</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response_type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"scope\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"openid\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"profile\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://www.googleapis.com/auth/youtube.readonly\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"access_type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"online\"</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'state'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    url<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"include_granted_scopes\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// url.searchParams.set(\"login_hint\", \"email_or_sub\") // TODO: save to localStorage use here</span>\n    <span class=\"token comment\">// url.searchParams.set(\"nonce\", crypto.randomUUID())</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'url'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span>location <span class=\"token operator\">=</span> url\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// if success - we are logged in, returns email, name, picture, sub</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://openidconnect.googleapis.com/v1/userinfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> r<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// https://www.youtube.com/playlist?list=PL2jJW0z9auIfNcigq0-yVYVLiD--febPX</span>\n<span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://youtube.googleapis.com/youtube/v3/playlistItems\"</span><span class=\"token punctuation\">)</span>\nurl<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"part\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"snippet\"</span><span class=\"token punctuation\">)</span>\nurl<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"playlistId\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PL2jJW0z9auIfNcigq0-yVYVLiD--febPX\"</span><span class=\"token punctuation\">)</span>\nurl<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> api_key<span class=\"token punctuation\">)</span>\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> r<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> r<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">video</span><span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>snippet<span class=\"token punctuation\">.</span>resourceId<span class=\"token punctuation\">.</span>videoId<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>snippet<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// https://developers.google.com/youtube/v3/docs/playlistItems/insert</span>\n\nurl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://youtube.googleapis.com/youtube/v3/playlistItems\"</span><span class=\"token punctuation\">)</span>\nurl<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"part\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"snippet\"</span><span class=\"token punctuation\">)</span>\nurl<span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> api_key<span class=\"token punctuation\">)</span>\n<span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">Authorization</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Bearer \"</span> <span class=\"token operator\">+</span> sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">snippet</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">playlistId</span><span class=\"token operator\">:</span> <span class=\"token string\">\"PL2jJW0z9auIfNcigq0-yVYVLiD--febPX\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">resourceId</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">kind</span><span class=\"token operator\">:</span> <span class=\"token string\">\"youtube#video\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">videoId</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NiDGTprVJu4\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> r<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Adding this for my self because figuring out oauth each time hurts</p>\n<p>Api reference can be found <a href=\"https://developers.google.com/youtube/v3/docs\">here</a></p>\n<p>But at the very end I ended up with <a href=\"/google-sheets-youtube-playlist\">syncing Youtube playlist right inside Google sheets</a></p>"}},"pageContext":{"id":"72ca0655-bafc-5d69-bb1f-d7964a2fc1dd"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/kubernetes-initcontainers-prepopulate-file/","result":{"data":{"remark":{"fields":{"path":"kubernetes-initcontainers-prepopulate-file"},"meta":{"title":""},"headings":[{"value":"kubernetes initcontainers prepopulate file"}],"html":"<h1>kubernetes initcontainers prepopulate file</h1>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># step 1: define directory on a host node as volume, which will be used by init container to populate file and then by app to read prepopulated file</span>\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> html\n      <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\"># step 2: before starting app, prepare file</span>\n  <span class=\"token key atrule\">initContainers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> init\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alpine\n\n      <span class=\"token comment\"># mount given volume to `/data`</span>\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> html\n          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data\n\n      <span class=\"token comment\"># write to mounted volume</span>\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> sh\n        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>c\n        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          echo '&lt;h1>HELLO WORLD&lt;/h1>' > /data/index.html</span>\n\n  <span class=\"token comment\"># step 3: app</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine\n\n      <span class=\"token comment\"># mount prepopulated volume</span>\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> html\n          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /usr/share/nginx/html</code></pre></div>\n<p>To run this example</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> nginx.yml\nkubectl <span class=\"token function\">wait</span> <span class=\"token parameter variable\">--for</span><span class=\"token operator\">=</span>condition<span class=\"token operator\">=</span>ready pod nginx\nkubectl <span class=\"token builtin class-name\">exec</span> nginx <span class=\"token function\">cat</span> /usr/share/nginx/html/index.html\nkubectl delete <span class=\"token parameter variable\">-f</span> nginx.yml</code></pre></div>"}},"pageContext":{"id":"37cf0f24-6e68-5eab-8163-696d0cebd461"}},"staticQueryHashes":[],"slicesMap":{}}
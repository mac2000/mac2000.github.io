{"componentChunkName":"component---src-templates-note-js","path":"/mysql-triggers-example","result":{"data":{"remark":{"fields":{"path":"mysql-triggers-example"},"meta":{"title":""},"headings":[{"value":"MySQL triggers example"}],"html":"<h1>MySQL triggers example</h1>\n<p>Simple example showing how to use triggers in mysql.</p>\n<h2>Init</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> content<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> content<span class=\"token punctuation\">(</span>\n\tid <span class=\"token keyword\">INT</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n\tcontent <span class=\"token keyword\">TEXT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">INNODB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token keyword\">backup</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">-- Will store previous version of content</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token keyword\">backup</span><span class=\"token punctuation\">(</span>\n\tid <span class=\"token keyword\">INT</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n\tcontent <span class=\"token keyword\">TEXT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">INNODB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> log<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> log<span class=\"token punctuation\">(</span>\n\tid <span class=\"token keyword\">INT</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n\tmessage <span class=\"token keyword\">TEXT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n\tcreated <span class=\"token keyword\">TIMESTAMP</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">INNODB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8 <span class=\"token keyword\">COLLATE</span> <span class=\"token operator\">=</span> utf8_general_ci<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TRIGGER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> log_content_added<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DELIMITER</span> $$\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TRIGGER</span> log_content_added <span class=\"token keyword\">AFTER</span> <span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">ON</span> content\n<span class=\"token keyword\">FOR EACH ROW</span>\n<span class=\"token keyword\">BEGIN</span>\n\t<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> log <span class=\"token keyword\">SET</span> message <span class=\"token operator\">=</span> concat<span class=\"token punctuation\">(</span>new<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">' added'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span>$$\n<span class=\"token keyword\">DELIMITER</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TRIGGER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> log_content_updated<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DELIMITER</span> $$\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TRIGGER</span> log_content_updated <span class=\"token keyword\">AFTER</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">ON</span> content\n<span class=\"token keyword\">FOR EACH ROW</span>\n<span class=\"token keyword\">BEGIN</span>\n\t<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> log <span class=\"token keyword\">SET</span> message <span class=\"token operator\">=</span> concat<span class=\"token punctuation\">(</span>new<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">' updated'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span>$$\n<span class=\"token keyword\">DELIMITER</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TRIGGER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> log_content_deleted<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DELIMITER</span> $$\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TRIGGER</span> log_content_deleted <span class=\"token keyword\">AFTER</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">ON</span> content\n<span class=\"token keyword\">FOR EACH ROW</span>\n<span class=\"token keyword\">BEGIN</span>\n\t<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> log <span class=\"token keyword\">SET</span> message <span class=\"token operator\">=</span> concat<span class=\"token punctuation\">(</span>old<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token string\">' deleted'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">-- Cleanup backups</span>\n\t<span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">backup</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> old<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span>$$\n<span class=\"token keyword\">DELIMITER</span> <span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TRIGGER</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> backup_content<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">DELIMITER</span> $$\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TRIGGER</span> backup_content BEFORE <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">ON</span> content\n<span class=\"token keyword\">FOR EACH ROW</span>\n<span class=\"token keyword\">BEGIN</span>\n\t<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">backup</span> <span class=\"token keyword\">SET</span> content <span class=\"token operator\">=</span> old<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">END</span>$$\n<span class=\"token keyword\">DELIMITER</span> <span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Tests</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">\t<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> content <span class=\"token keyword\">SET</span> content <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">;</span>\n\tELECT <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> content<span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\t<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> content      <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Hello World<span class=\"token operator\">!</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\n\t<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> log<span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+---------+---------------------+</span>\n\t<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> message <span class=\"token operator\">|</span> created             <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+---------+---------------------+</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> added <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">19</span>:<span class=\"token number\">25</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+---------+---------------------+</span>\n\n\t<span class=\"token keyword\">UPDATE</span> content <span class=\"token keyword\">SET</span> content <span class=\"token operator\">=</span> <span class=\"token string\">'Lorem ipsum'</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> log<span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span>\n\t<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> message   <span class=\"token operator\">|</span> created             <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> added   <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">44</span>:<span class=\"token number\">47</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> updated <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">45</span>:<span class=\"token number\">21</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span>\n\n\t<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token keyword\">backup</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\t<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> content      <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> Hello World<span class=\"token operator\">!</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+</span>\n\n\t<span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">FROM</span> content <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> log<span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span>\n\t<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> message   <span class=\"token operator\">|</span> created             <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> added   <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">44</span>:<span class=\"token number\">47</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> updated <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">45</span>:<span class=\"token number\">21</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span> deleted <span class=\"token operator\">|</span> <span class=\"token number\">2013</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">25</span> <span class=\"token number\">11</span>:<span class=\"token number\">46</span>:<span class=\"token number\">02</span> <span class=\"token operator\">|</span>\n\t<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------+---------------------+</span></code></pre></div>"}},"pageContext":{"id":"371c877d-8e40-5a5f-af75-ba2a05fb44d3"}},"staticQueryHashes":[]}
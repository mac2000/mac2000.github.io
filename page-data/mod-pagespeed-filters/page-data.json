{"componentChunkName":"component---src-templates-note-js","path":"/mod-pagespeed-filters/","result":{"data":{"remark":{"fields":{"path":"mod-pagespeed-filters"},"meta":{"title":""},"headings":[{"value":"mod_pagespeed filters"}],"html":"<h1>mod_pagespeed filters</h1>\n<p>Google has developed mod_pagespeed module that is very easy to use and that acomplishes many Google Page Speed Insight recommendations.</p>\n<p>Here is simple example how could you use it</p>\n<h2>Vagrantfile</h2>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">Vagrant<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"2\"</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n    config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>box <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"ubuntu/trusty64\"</span></span>\n    config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>network <span class=\"token string-literal\"><span class=\"token string\">\"public_network\"</span></span>\n    config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>provision <span class=\"token symbol\">:shell</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">path</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"Provision.sh\"</span></span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<h2>Provision</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token comment\"># Use closest mirrors available</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb mirror://mirrors.ubuntu.com/mirrors.txt trusty main restricted universe multiverse\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">--append</span> /etc/apt/sources.list\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb mirror://mirrors.ubuntu.com/mirrors.txt trusty-updates main restricted universe multiverse\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">--append</span> /etc/apt/sources.list\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb mirror://mirrors.ubuntu.com/mirrors.txt trusty-backports main restricted universe multiverse\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">--append</span> /etc/apt/sources.list\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb mirror://mirrors.ubuntu.com/mirrors.txt trusty-security main restricted universe multiverse\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> <span class=\"token parameter variable\">--append</span> /etc/apt/sources.list\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> apache2\n\n<span class=\"token comment\"># https://developers.google.com/speed/pagespeed/module/download</span>\n<span class=\"token function\">wget</span> https://dl-ssl.google.com/dl/linux/direct/mod-pagespeed-stable_current_amd64.deb\n<span class=\"token function\">sudo</span> dpkg <span class=\"token parameter variable\">-i</span> mod-pagespeed-*.deb\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-f</span> <span class=\"token function\">install</span>\n<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> mod-pagespeed-*.deb\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">rm</span> /etc/apache2/sites-enabled/000-default.conf\n<span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> <span class=\"token parameter variable\">-s</span> /vagrant/Site.conf /etc/apache2/sites-enabled\n<span class=\"token function\">sudo</span> a2enmod headers setenvif mime rewrite authz_core deflate filter expires include\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> apache2 restart</code></pre></div>\n<h2>Site config</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;VirtualHost *:80>\n    DocumentRoot /vagrant\n\n    &lt;Directory /vagrant>\n        Options All\n        AllowOverride All\n        Require all granted\n    &lt;/Directory>\n\n    &lt;Location /pagespeed>\n        Order allow,deny\n        #Allow from localhost\n        #Allow from 127.0.0.1\n        Allow from all #WARNING: this SHOULD be removed\n        SetHandler pagespeed_admin\n    &lt;/Location>\n&lt;/VirtualHost></code></pre></div>\n<h2>Filter enabled by default</h2>\n<p><strong>General</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-head-add\">add_head</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-cache-extend\">extend_cache</a></p>\n<p><strong>Images</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-image-optimize\">rewrite_images</a></p>\n<p><strong>Styles</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-css-combine\">combine_css</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-css-rewrite\">rewrite_css</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-flatten-css-imports\">flatten_css_imports</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-flatten-css-imports\">inline_css</a></p>\n<p><strong>Javascript</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-js-minify\">rewrite_javascript</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-js-inline\">inline_javascript</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-js-combine\">combine_javascript</a></p>\n<h2>Suggested (safe to use) filters</h2>\n<p><strong>General</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-whitespace-collapse\">collapse_whitespace</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-insert-dns-prefetch\">insert_dns_prefetch</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-comment-remove\">remove_comments</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-quote-remove\">remove_quotes</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-trim-urls\">trim_urls</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-attribute-elide\">elide_attributes</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-head-combine\">combine_heads</a></p>\n<p><strong>Images</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-lazyload-images\">lazyload_images</a></p>\n<p><strong>Styles</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-css-inline-google-fonts\">inline_google_font_css</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-css-to-head\">move_css_to_head</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-css-above_scripts\">move_css_above_scripts</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-prioritize-critical-css\">prioritize_critical_css</a></p>\n<p><strong>Scripts</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-insert-ga\">insert_ga</a></p>\n<h2>Project specific filters</h2>\n<p><strong>Images</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-image-optimize#resize_images\">resize_images</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-image-optimize.html#resize_rendered_image_dimensions\">resize_rendered_image_dimensions</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-image-sprite\">sprite_images</a>, <a href=\"https://developers.google.com/speed/pagespeed/module/filter-inline-preview-images.html\">inline_preview_images</a></p>\n<h2>Magic (danger) filters</h2>\n<p><strong>General</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-local-storage-cache\">local_storage_cache</a></p>\n<p><strong>Javascript</strong>: <a href=\"https://developers.google.com/speed/pagespeed/module/filter-js-defer\">defer_javascript</a></p>\n<p>Ended up with following addition to <a href=\"https://raw.githubusercontent.com/h5bp/html5-boilerplate/master/dist/.htaccess\">HTML 5 boilerplate .htaccess</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;IfModule pagespeed_module>\n    ModPagespeedEnableFilters collapse_whitespace,insert_dns_prefetch,remove_comments,remove_quotes,trim_urls,elide_attributes,combine_heads,lazyload_images,inline_google_font_css,move_css_to_head,move_css_above_scripts\n\n    # prioritize_critical_css - only for big styles\n    # insert_ga - only if you use Google Analytics\n    # resize_images - project dependet, resizes: &lt;img src=\"photo-1024x768.jpg\" width=\"648\" height=\"480\">\n    # resize_rendered_image_dimensions - project dependet, resize: &lt;img src=\"photo-1024x768.jpg\" style=\"max-width: 20em\">\n    # inline_preview_images - project dependet, inlines lowres images\n    # sprite_images - project dependet, generates sprite map from css backgrounds\n    # defer_javascript - magic\n    # local_storage_cache - magic\n\n    # ModPagespeedAnalyticsID UA-799647-3\n&lt;/IfModule></code></pre></div>\n<p>Here is all code: <a href=\"/2f4ab78a8659d2c4837581121ec0568f/mod_pagespeed.zip\">mod_pagespeed.zip</a></p>\n<h2>Clear (flush) mod_pagespeed cache</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">touch</span> /var/cache/mod_pagespeed/cache.flush</code></pre></div>\n<p>After opening pages you can delete if</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo rm -rf /var/cache/mod_pagespeed/cache.flush</code></pre></div>"}},"pageContext":{"id":"b3a66b58-1507-5f24-a3bc-483e1acde1d0"}},"staticQueryHashes":[],"slicesMap":{}}
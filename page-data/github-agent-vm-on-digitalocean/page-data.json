{"componentChunkName":"component---src-templates-note-js","path":"/github-agent-vm-on-digitalocean/","result":{"data":{"remark":{"fields":{"path":"github-agent-vm-on-digitalocean"},"meta":{"title":""},"headings":[{"value":"Github Actions Agent VM on DigitalOcean"}],"html":"<h1>Github Actions Agent VM on DigitalOcean</h1>\n<p>While we are investigating, agreed to spinup VM on DigitalOcean to see how it goes</p>\n<p>In DO create new droplet</p>\n<p><strong>Distribution</strong>: Ubuntu 20.04\n<strong>Plan</strong>: Basic\n<strong>CPU Options</strong>: Regular Intel with SSD\n<strong>VM</strong>: $40/mo 4cpu, 8ram, 160ssd\n<strong>Region</strong>: Frankfurt\n<strong>SSH keys</strong>: check\n<strong>Hostname</strong>: gha-do-1</p>\n<p>Create droplet, wait for it to spin up and connect</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> root@167.71.38.43</code></pre></div>\n<p>First of all we need user, because agent can not be run under root</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">adduser github</code></pre></div>\n<p>Note: password set to github (we are logging in by ssh keys, and after all that's temporary server), everything else - next, next, finish</p>\n<p>Install software</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token parameter variable\">-qq</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> build-essential python</code></pre></div>\n<p>Install docker</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://get.docker.com <span class=\"token parameter variable\">-o</span> get-docker.sh\n<span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> get-docker.sh\n<span class=\"token function\">rm</span> get-docker.sh\n<span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-aG</span> <span class=\"token function\">docker</span> <span class=\"token environment constant\">$USER</span></code></pre></div>\n<p>Grant permissions</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> github <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span>NOPASSWD: ALL <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/sudoers.d/github\n<span class=\"token function\">sudo</span> <span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-aG</span> <span class=\"token function\">docker</span> github</code></pre></div>\n<p>Switch to github user</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">su</span> - github</code></pre></div>\n<p>Download agent</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> actions-runner <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> actions-runner\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-o</span> actions-runner-linux-x64-2.280.1.tar.gz <span class=\"token parameter variable\">-L</span> https://github.com/actions/runner/releases/download/v2.280.1/actions-runner-linux-x64-2.280.1.tar.gz\n<span class=\"token function\">tar</span> xzf ./actions-runner-linux-x64-2.280.1.tar.gz\n<span class=\"token function\">rm</span> actions-runner-linux-x64-2.280.1.tar.gz\n./config.sh <span class=\"token parameter variable\">--url</span> https://github.com/rabotaua/alliance <span class=\"token parameter variable\">--token</span> xxxxxxxxx</code></pre></div>\n<p>Note: last string can be found here <a href=\"https://github.com/rabotaua/alliance/settings/actions/runners/new?arch=x64&#x26;os=linu\">https://github.com/rabotaua/alliance/settings/actions/runners/new?arch=x64&#x26;os=linu</a> open it, then next, next, finish</p>\n<p>Register and start service</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ./svc.sh <span class=\"token function\">install</span>\n<span class=\"token function\">sudo</span> ./svc.sh start</code></pre></div>\n<p>Add to .path <code class=\"language-text\">:/home/github/.yarn/bin</code></p>"}},"pageContext":{"id":"b9b5d585-9c92-5519-8a55-da78b75f0fab"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/automating-iis-develpment-environment-setup","result":{"data":{"remark":{"fields":{"path":"automating-iis-develpment-environment-setup"},"meta":{"title":""},"headings":[{"value":"Automating IIS develpment environment setup"}],"html":"<h1>Automating IIS develpment environment setup</h1>\n<p>We're working on few ASP.NET projects, so have need in some automatization.</p>\n<p>Here is some brief notes and links:</p>\n<p><strong>Run powershell script by pass execution policy from cmd file</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">isadmin.cmd\nPowerShell.exe <span class=\"token parameter variable\">-executionpolicy</span> bypass <span class=\"token parameter variable\">-File</span> c:<span class=\"token punctuation\">\\</span>users<span class=\"token punctuation\">\\</span>alexandrm<span class=\"token punctuation\">\\</span>desktop<span class=\"token punctuation\">\\</span>isadmin.ps1</code></pre></div>\n<p><strong>Make symlink to folder (on left - link, on right - directory)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mklink /D C:<span class=\"token punctuation\">\\</span>inetpub<span class=\"token punctuation\">\\</span>wwwroot<span class=\"token punctuation\">\\</span>CvPhotos D:<span class=\"token punctuation\">\\</span>CvPhotos</code></pre></div>\n<p><strong>To setup all needed components run this command:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">start /w pkgmgr /iu:IIS-WebServerRole<span class=\"token punctuation\">;</span>IIS-WebServer<span class=\"token punctuation\">;</span>IIS-ApplicationDevelopment<span class=\"token punctuation\">;</span>IIS-CommonHttpFeatures<span class=\"token punctuation\">;</span>IIS-HealthAndDiagnostics<span class=\"token punctuation\">;</span>IIS-Performance<span class=\"token punctuation\">;</span>IIS-Security<span class=\"token punctuation\">;</span>IIS-WebServerManagementTools<span class=\"token punctuation\">;</span>IIS-RequestFiltering<span class=\"token punctuation\">;</span>IIS-HttpCompressionStatic<span class=\"token punctuation\">;</span>IIS-HttpLogging<span class=\"token punctuation\">;</span>IIS-RequestMonitor<span class=\"token punctuation\">;</span>IIS-LoggingLibraries<span class=\"token punctuation\">;</span>IIS-HttpTracing<span class=\"token punctuation\">;</span>IIS-DefaultDocument<span class=\"token punctuation\">;</span>IIS-DirectoryBrowsing<span class=\"token punctuation\">;</span>IIS-HttpErrors<span class=\"token punctuation\">;</span>IIS-HttpRedirect<span class=\"token punctuation\">;</span>IIS-StaticContent<span class=\"token punctuation\">;</span>IIS-NetFxExtensibility<span class=\"token punctuation\">;</span>IIS-ASPNET<span class=\"token punctuation\">;</span>IIS-ISAPIExtensions<span class=\"token punctuation\">;</span>IIS-ISAPIFilter<span class=\"token punctuation\">;</span>IIS-ManagementConsole<span class=\"token punctuation\">;</span>IIS-ManagementScriptingTools</code></pre></div>\n<p>Links:</p>\n<p><a href=\"http://samag.ru/archive/article/1072\">http://samag.ru/archive/article/1072</a></p>\n<p><a href=\"http://technet.microsoft.com/en-us/library/ff716257%28v=ws.10%29.aspx\">http://technet.microsoft.com/en-us/library/ff716257%28v=ws.10%29.aspx</a></p>\n<p><strong>Setup all via Web Platform Installer</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$source</span> = <span class=\"token string\">\"http://www.iis.net/community/files/webpi/webpicmd_x86.zip\"</span>\n<span class=\"token variable\">$destination</span> = <span class=\"token string\">\"C:\\Users\\AlexandrM\\Desktop\\webpicmd_x86.zip\"</span>\n<span class=\"token variable\">$wc</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>WebClient\n<span class=\"token variable\">$wc</span><span class=\"token punctuation\">.</span>DownloadFile<span class=\"token punctuation\">(</span><span class=\"token variable\">$source</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$destination</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$shell_app</span>=<span class=\"token function\">New-Object</span> <span class=\"token operator\">-</span>com shell<span class=\"token punctuation\">.</span>application\n<span class=\"token variable\">$filename</span> = <span class=\"token string\">\"C:\\Users\\AlexandrM\\Desktop\\webpicmd_x86.zip\"</span>\n<span class=\"token variable\">$zip_file</span> = <span class=\"token variable\">$shell_app</span><span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">New-Item</span> <span class=\"token string\">\"C:\\Users\\AlexandrM\\Desktop\\webpicmd\"</span> <span class=\"token operator\">-</span><span class=\"token function\">type</span> directory\n<span class=\"token variable\">$destination</span> = <span class=\"token variable\">$shell_app</span><span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\Users\\AlexandrM\\Desktop\\webpicmd\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$destination</span><span class=\"token punctuation\">.</span>Copyhere<span class=\"token punctuation\">(</span><span class=\"token variable\">$zip_file</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nC:\\Users\\user\\Desktop\\webpicmd\\WebpiCmdLine<span class=\"token punctuation\">.</span>exe <span class=\"token operator\">/</span>Products: NETFramework4<span class=\"token punctuation\">,</span> KB980423-Win7<span class=\"token punctuation\">,</span> KB983484-Win7<span class=\"token punctuation\">,</span> ASPNET<span class=\"token punctuation\">,</span> DefaultDocument<span class=\"token punctuation\">,</span> DirectoryBrowse<span class=\"token punctuation\">,</span> HTTPErrors<span class=\"token punctuation\">,</span> HTTPLogging<span class=\"token punctuation\">,</span> IIS7<span class=\"token punctuation\">,</span> IISManagementConsole<span class=\"token punctuation\">,</span> ISAPIExtensions<span class=\"token punctuation\">,</span> ISAPIFilters<span class=\"token punctuation\">,</span> LoggingTools<span class=\"token punctuation\">,</span> MVC<span class=\"token punctuation\">,</span> MVC2<span class=\"token punctuation\">,</span> MVC3<span class=\"token punctuation\">,</span> MVC3Loc<span class=\"token punctuation\">,</span> MVC3Runtime<span class=\"token punctuation\">,</span> NETExtensibility<span class=\"token punctuation\">,</span> NETFramework20SP2<span class=\"token punctuation\">,</span> NETFramework35<span class=\"token punctuation\">,</span> Plan9<span class=\"token punctuation\">,</span> Plan9Loc<span class=\"token punctuation\">,</span> PowerShell<span class=\"token punctuation\">,</span> PowerShell2<span class=\"token punctuation\">,</span> RequestFiltering<span class=\"token punctuation\">,</span> RequestMonitor<span class=\"token punctuation\">,</span> StaticContent<span class=\"token punctuation\">,</span> StaticContentCompression<span class=\"token punctuation\">,</span> IISManagementScriptsAndTools <span class=\"token operator\">/</span>SuppressReboot <span class=\"token operator\">/</span>AcceptEula</code></pre></div>\n<p>Links:</p>\n<p><a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/gg433092.aspx\">http://msdn.microsoft.com/en-us/library/windowsazure/gg433092.aspx</a></p>\n<p><a href=\"http://blogs.iis.net/satishl/archive/2011/01/26/webpi-command-line.aspx\">http://blogs.iis.net/satishl/archive/2011/01/26/webpi-command-line.aspx</a></p>\n<h3>Powershell tips</h3>\n<p><strong>Check is admin</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$principal</span> = <span class=\"token function\">new-object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>Principal<span class=\"token punctuation\">.</span>WindowsPrincipal<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$isAdmin</span> = <span class=\"token variable\">$principal</span><span class=\"token punctuation\">.</span>IsInRole<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$isAdmin</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"You are NOT admin\"</span> <span class=\"token operator\">-</span>ForegroundColor Red\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"You are admin\"</span> <span class=\"token operator\">-</span>ForegroundColor Green\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Retrieve environment variables</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Get-ChildItem</span> Env:\n<span class=\"token function\">Get-ChildItem</span> Env:SystemRoot <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>expand Value</code></pre></div>\n<p><em>Some variables</em></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">COMPUTERNAME                   MAC-PC\nSystemDrive                    C:\nSystemRoot                     C:\\Windows\nTEMP                           C:\\Users\\ALEXAN~1\\AppData\\Local\\Temp\nTMP                            C:\\Users\\ALEXAN~1\\AppData\\Local\\Temp\nUSERDNSDOMAIN                  RABOTA.LOCAL\nUSERDOMAIN                     RABOTA\nUSERNAME                       AlexandrM\nUSERPROFILE                    C:\\Users\\AlexandrM</code></pre></div>\n<p><strong>Include powershell file</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">    <span class=\"token builtin class-name\">.</span> C:<span class=\"token punctuation\">\\</span>Users<span class=\"token punctuation\">\\</span>user<span class=\"token punctuation\">\\</span>Desktop<span class=\"token punctuation\">\\</span>hosts.ps1</code></pre></div>\n<p><em>Helper</em></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$currentDirectory</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$MyInvocation</span><span class=\"token punctuation\">.</span>MyCommand<span class=\"token punctuation\">.</span>Definition <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"inc.ps1\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Check that .NET 4.0 installed</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Test-Path</span> <span class=\"token string\">\"${Env:ProgramFiles(x86)}\\Microsoft ASP.NET\\ASP.NET MVC 3\"</span></code></pre></div>\n<p><strong>Press any key to continue</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Press any key to continue ...\"</span>\n<span class=\"token variable\">$x</span> = <span class=\"token variable\">$host</span><span class=\"token punctuation\">.</span>UI<span class=\"token punctuation\">.</span>RawUI<span class=\"token punctuation\">.</span>ReadKey<span class=\"token punctuation\">(</span><span class=\"token string\">\"NoEcho,IncludeKeyDown\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Login info</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get-ChildItem</span> Env:USERDOMAIN <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-ne</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Get-ChildItem</span> Env:COMPUTERNAME <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$logonServer</span> = <span class=\"token function\">Get-ChildItem</span> Env:USERDOMAIN <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Value\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$logonServer</span> = <span class=\"token function\">Get-ChildItem</span> Env:COMPUTERNAME <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Value\n<span class=\"token punctuation\">}</span>\n<span class=\"token variable\">$userName</span> = <span class=\"token function\">Get-ChildItem</span> Env:USERNAME <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Value</code></pre></div>\n<h3>Scheduled tasks</h3>\n<p><a href=\"http://poshtips.com/2011/04/07/use-powershell-to-create-a-scheduled-task/\">http://poshtips.com/2011/04/07/use-powershell-to-create-a-scheduled-task/</a></p>\n<p><a href=\"http://technet.microsoft.com/en-us/library/cc725744(v=ws.10).aspx\">http://technet.microsoft.com/en-us/library/cc725744(v=ws.10).aspx</a></p>\n<p><strong>Creating tasks examples</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">schtasks.exe /Create /TN UpdateLocalAssets /RU user-PC<span class=\"token punctuation\">\\</span>user /SC DAILY /ST 09:00 /TR <span class=\"token string\">\"C:\\Users\\user\\Desktop\\schedule.cmd\"</span>\nschtasks.exe /Create /TN UpdateLocalAssets /RU system /SC DAILY /ST 09:00 /TR <span class=\"token string\">\"C:\\Users\\user\\Desktop\\schedule.cmd\"</span></code></pre></div>\n<h2>Automating</h2>\n<p>Main idea is to have some scripts that will install all needed sites on local machine and make changes to hosts file.</p>\n<p>We have config.xml file, like this one:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>config</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>users</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sv<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ip</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>192.168.5.51<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mac<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ip</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>192.168.5.52<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>user</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>beta<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ip</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>192.168.5.53<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>users</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sites</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token comment\">&lt;!-- Admin sites --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>admin.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token comment\">&lt;!-- Micro sites --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-kiev.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-dp.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-kharkov.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-lviv.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-odessa.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>job-in-donetsk.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gojobs.ru<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token comment\">&lt;!-- Channels --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>finance.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pharma.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>student.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>marketing.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>it.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>top.rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token comment\">&lt;!-- Channels for partners --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.investgazeta.net<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.itc.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.delo.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.reklamaster.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>site</span> <span class=\"token attr-name\">domain</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.ko.com.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sites</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>projects</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!--\n        Each project may have its own setup script in scripts/projects folder\n        --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rabota.ua<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>micro<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>gojobs<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>channels<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>project</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>admin<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>projects</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>config</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>In config, we have section with users and their ip addresses (will be used to create hosts file records).</p>\n<p>Also there is sites section that also will be used for creating hosts files.</p>\n<p>Projects section contains project names that will be added as sites to IIS, each project has its own setup script.</p>\n<h2>Hosts</h2>\n<p>SetupHosts.cmd will setup all needed hosts on your machine, so you will be able to work with local sites and check sites on other developer machines.</p>\n<p><strong>SetupHosts.cmd</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">@ECHO OFF\nREM http://stackoverflow.com/questions/659647/how-to-get-folder-path-from-file-path-with-cmd\nPowerShell.exe <span class=\"token parameter variable\">-executionpolicy</span> bypass <span class=\"token parameter variable\">-File</span> %~dp0<span class=\"token punctuation\">\\</span>scripts<span class=\"token punctuation\">\\</span>hosts.ps1 %*\nPAUSE</code></pre></div>\n<p><strong>hosts.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Get current directory</span>\n<span class=\"token variable\">$currentDirectory</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$MyInvocation</span><span class=\"token punctuation\">.</span>MyCommand<span class=\"token punctuation\">.</span>Definition <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n<span class=\"token comment\"># Include inc.ps1 file</span>\n<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"inc.ps1\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Check that we have apropriate privilegies</span>\n<span class=\"token variable\">$principal</span> = <span class=\"token function\">new-object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>Principal<span class=\"token punctuation\">.</span>WindowsPrincipal<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$isAdmin</span> = <span class=\"token variable\">$principal</span><span class=\"token punctuation\">.</span>IsInRole<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$isHostsWriteable</span> = <span class=\"token function\">Test-IsWritable</span> <span class=\"token operator\">-</span>Path <span class=\"token string\">\"C:\\Windows\\System32\\drivers\\etc\\hosts\"</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$isAdmin</span> <span class=\"token operator\">-And</span> <span class=\"token operator\">-not</span> <span class=\"token variable\">$isHostsWriteable</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Can not modify hosts file, run me as admin or give permission to file\"</span> <span class=\"token operator\">-</span>ForegroundColor red\n    <span class=\"token keyword\">Exit</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Read config.xml</span>\n<span class=\"token namespace\">[xml]</span><span class=\"token variable\">$xml</span> = <span class=\"token function\">Get-Content</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Join-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>ChildPath <span class=\"token string\">\"config.xml\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">#http://technet.microsoft.com/en-us/library/ff730939.aspx</span>\n<span class=\"token variable\">$title</span> = <span class=\"token string\">\"Host types to write\"</span>\n<span class=\"token variable\">$message</span> = <span class=\"token string\">\"What do you want to write to hosts file?\"</span>\n<span class=\"token variable\">$all</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;All\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Writes all possible hosts.\"</span>\n<span class=\"token variable\">$local</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;Local\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Writes local only hosts, like: local.rabota.ua.\"</span>\n<span class=\"token variable\">$remote</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;Remote\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Writes remote only hosts, like: beta.rabota.ua.\"</span>\n<span class=\"token variable\">$nothing</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;Nothing\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Nothing will be written.\"</span>\n<span class=\"token variable\">$options</span> = <span class=\"token namespace\">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$all</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$local</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$remote</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$nothing</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$hostsTypeToWrite</span> = <span class=\"token variable\">$host</span><span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>PromptForChoice<span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$options</span><span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$hostsTypeToWrite</span> <span class=\"token operator\">-ne</span> 3<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$hostsFilePath</span> = <span class=\"token function\">Get-HostsFilePath</span>\n\n    <span class=\"token comment\"># Remove old entries (entries that has \"# IIS\" at end of line)</span>\n    <span class=\"token variable\">$hosts</span> = <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$hostsFilePath</span>\n    <span class=\"token variable\">$hosts</span> = <span class=\"token variable\">$hosts</span> <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span><span class=\"token variable\">$_</span> <span class=\"token operator\">-notmatch</span> <span class=\"token string\">'^[^#].*?# IIS'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$hosts</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-File</span> <span class=\"token variable\">$hostsFilePath</span> <span class=\"token operator\">-</span>Encoding ASCII\n\n    <span class=\"token variable\">$hosts</span> = <span class=\"token string\">\"\"</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$hostsTypeToWrite</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        0 <span class=\"token punctuation\">{</span> <span class=\"token variable\">$hosts</span> = <span class=\"token function\">Get-AllProjectHosts</span> <span class=\"token punctuation\">}</span>\n        1 <span class=\"token punctuation\">{</span> <span class=\"token variable\">$hosts</span> = <span class=\"token function\">Get-LocalProjectHosts</span> <span class=\"token punctuation\">}</span>\n        2 <span class=\"token punctuation\">{</span> <span class=\"token variable\">$hosts</span> = <span class=\"token function\">Get-RemoteProjectHosts</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token variable\">$hosts</span> <span class=\"token operator\">-</span>ForegroundColor DarkGray\n    <span class=\"token function\">Add-Content</span> <span class=\"token variable\">$hostsFilePath</span> <span class=\"token variable\">$hosts</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Hosts file successfully updated\"</span> <span class=\"token operator\">-</span>ForegroundColor green\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Nothing to do...\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">#Write-Host \"Press any key to continue ...\"</span>\n<span class=\"token comment\">#$x = $host.UI.RawUI.ReadKey(\"NoEcho,IncludeKeyDown\")</span></code></pre></div>\n<h2>IIS</h2>\n<p>SetupIISComponents.cmd - will install all needed iis componenets</p>\n<p><strong>SetupIISComponents.cmd</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">@ECHO OFF\nPowerShell.exe <span class=\"token parameter variable\">-executionpolicy</span> bypass <span class=\"token parameter variable\">-File</span> %~dp0<span class=\"token punctuation\">\\</span>scripts<span class=\"token punctuation\">\\</span>iis.ps1 %*\nPAUSE</code></pre></div>\n<p><strong>iis.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Get current directory</span>\n<span class=\"token variable\">$currentDirectory</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$MyInvocation</span><span class=\"token punctuation\">.</span>MyCommand<span class=\"token punctuation\">.</span>Definition <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n<span class=\"token comment\"># Include inc.ps1 file</span>\n<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"inc.ps1\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Check that we have .net 4 installed</span>\n<span class=\"token variable\">$_DOT_NET_VERSION</span> = <span class=\"token string\">\"v4\"</span>\n<span class=\"token variable\">$dotNet4Installed</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-ChildItem</span> <span class=\"token string\">\"HKLM:\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\"</span> <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>PSChildName <span class=\"token operator\">-eq</span> <span class=\"token variable\">$_DOT_NET_VERSION</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Measure-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>expand Count<span class=\"token punctuation\">)</span> <span class=\"token operator\">-eq</span> 1\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$dotNet4Installed</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\".Net <span class=\"token variable\">$_DOT_NET_VERSION</span> is not installed run Windows Update or instal it manualy before proceed\"</span> <span class=\"token operator\">-</span>ForegroundColor red\n    <span class=\"token keyword\">Exit</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Installing IIS Components\"</span> <span class=\"token operator\">-</span>ForegroundColor Blue\n<span class=\"token function\">Invoke-Expression</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"pkgmgr.cmd\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">Write-Host</span>\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Done\"</span> <span class=\"token operator\">-</span>ForegroundColor Green</code></pre></div>\n<p><strong>pkgmgr.cmd</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">start /w pkgmgr /iu:IIS-WebServerRole<span class=\"token punctuation\">;</span>IIS-WebServer<span class=\"token punctuation\">;</span>IIS-ApplicationDevelopment<span class=\"token punctuation\">;</span>IIS-CommonHttpFeatures<span class=\"token punctuation\">;</span>IIS-HealthAndDiagnostics<span class=\"token punctuation\">;</span>IIS-Performance<span class=\"token punctuation\">;</span>IIS-Security<span class=\"token punctuation\">;</span>IIS-WebServerManagementTools<span class=\"token punctuation\">;</span>IIS-RequestFiltering<span class=\"token punctuation\">;</span>IIS-HttpCompressionStatic<span class=\"token punctuation\">;</span>IIS-HttpLogging<span class=\"token punctuation\">;</span>IIS-RequestMonitor<span class=\"token punctuation\">;</span>IIS-LoggingLibraries<span class=\"token punctuation\">;</span>IIS-HttpTracing<span class=\"token punctuation\">;</span>IIS-DefaultDocument<span class=\"token punctuation\">;</span>IIS-DirectoryBrowsing<span class=\"token punctuation\">;</span>IIS-HttpErrors<span class=\"token punctuation\">;</span>IIS-HttpRedirect<span class=\"token punctuation\">;</span>IIS-StaticContent<span class=\"token punctuation\">;</span>IIS-NetFxExtensibility<span class=\"token punctuation\">;</span>IIS-ASPNET<span class=\"token punctuation\">;</span>IIS-ISAPIExtensions<span class=\"token punctuation\">;</span>IIS-ISAPIFilter<span class=\"token punctuation\">;</span>IIS-ManagementConsole<span class=\"token punctuation\">;</span>IIS-ManagementScriptingTools</code></pre></div>\n<h2>Sites</h2>\n<p>Notice: Do not delete default site (at least one site must be present in IIS, otherwise scripts can not work - this is known problem, will hope will be fixed in next versions of IIS Web Management Scripts And Tools and\\or Powershell)</p>\n<p><strong>SetupSites.cmd</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">@ECHO OFF\nPowerShell.exe <span class=\"token parameter variable\">-executionpolicy</span> bypass <span class=\"token parameter variable\">-File</span> %~dp0<span class=\"token punctuation\">\\</span>scripts<span class=\"token punctuation\">\\</span>sites.ps1 %*\nPAUSE</code></pre></div>\n<p><strong>sites.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$currentDirectory</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$MyInvocation</span><span class=\"token punctuation\">.</span>MyCommand<span class=\"token punctuation\">.</span>Definition <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"inc.ps1\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Check that we have .net 4 installed</span>\n<span class=\"token variable\">$_DOT_NET_VERSION</span> = <span class=\"token string\">\"v4\"</span>\n<span class=\"token variable\">$dotNet4Installed</span> = <span class=\"token punctuation\">(</span><span class=\"token function\">Get-ChildItem</span> <span class=\"token string\">\"HKLM:\\SOFTWARE\\Microsoft\\NET Framework Setup\\NDP\"</span> <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>PSChildName <span class=\"token operator\">-eq</span> <span class=\"token variable\">$_DOT_NET_VERSION</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Measure-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>expand Count<span class=\"token punctuation\">)</span> <span class=\"token operator\">-eq</span> 1\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$dotNet4Installed</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\".Net <span class=\"token variable\">$_DOT_NET_VERSION</span> is not installed run Windows Update or instal it manualy before proceed\"</span> <span class=\"token operator\">-</span>ForegroundColor red\n    <span class=\"token keyword\">Exit</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Check that we have apropriate privilegies</span>\n<span class=\"token variable\">$principal</span> = <span class=\"token function\">new-object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>Principal<span class=\"token punctuation\">.</span>WindowsPrincipal<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsIdentity]</span>::GetCurrent<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$isAdmin</span> = <span class=\"token variable\">$principal</span><span class=\"token punctuation\">.</span>IsInRole<span class=\"token punctuation\">(</span><span class=\"token namespace\">[System.Security.Principal.WindowsBuiltInRole]</span>::Administrator<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$isAdmin</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Run me as admin\"</span> <span class=\"token operator\">-</span>ForegroundColor red\n    <span class=\"token keyword\">Exit</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"NOTICE: Run me after IIS Components are installed\"</span> <span class=\"token operator\">-</span>ForegroundColor Yellow\n\n<span class=\"token comment\"># Include Powershell IIS snap in</span>\n<span class=\"token function\">Import-Module</span> WebAdministration\n\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Stopping IIS and sites...\"</span> <span class=\"token operator\">-</span>ForegroundColor Green\n<span class=\"token function\">Get-Website</span> <span class=\"token punctuation\">|</span> <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">Stop-Website</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>name <span class=\"token punctuation\">}</span>\nnet stop w3svc\n\n<span class=\"token comment\"># Read config.xml</span>\n<span class=\"token namespace\">[xml]</span><span class=\"token variable\">$xml</span> = <span class=\"token function\">Get-Content</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Join-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>ChildPath <span class=\"token string\">\"config.xml\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Retrieve current user</span>\n<span class=\"token variable\">$title</span> = <span class=\"token string\">\"Who are u?\"</span>\n<span class=\"token variable\">$message</span> = <span class=\"token string\">\"Chose your user name from list\"</span>\n<span class=\"token variable\">$choices</span> = @<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$userNames</span> = <span class=\"token variable\">$xml</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span>user <span class=\"token punctuation\">|</span> <span class=\"token function\">sort</span> name\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span> in <span class=\"token variable\">$userNames</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$userVariables</span> = <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"users\\\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\".ps1\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$userVariables</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\"># Show only users that have config files</span>\n        <span class=\"token variable\">$choices</span> <span class=\"token operator\">+=</span> <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"Will be used in bindings like: \"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\".rabota.ua\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token variable\">$options</span> = <span class=\"token namespace\">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$choices</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$choice</span> = <span class=\"token variable\">$host</span><span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>PromptForChoice<span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$options</span><span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$user</span> = <span class=\"token variable\">$options</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$choice</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Label <span class=\"token comment\"># user will contain selected user name</span>\n\n<span class=\"token comment\"># Load user specific variables</span>\n<span class=\"token variable\">$userVariables</span> = <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"users\\\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$user</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".ps1\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$userVariables</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span> <span class=\"token variable\">$userVariables</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Check that $base path exists</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$base</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Can not access base path: <span class=\"token variable\">$base</span>\"</span> <span class=\"token operator\">-</span>ForegroundColor Red\n    <span class=\"token keyword\">Exit</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Check that $temp path exists</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$temp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># If not try to create it</span>\n    <span class=\"token function\">New-Item</span> <span class=\"token variable\">$temp</span> <span class=\"token operator\">-</span><span class=\"token function\">type</span> directory\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Give IIS full access to temp directory</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$temp</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$acl</span> = <span class=\"token function\">Get-Acl</span> <span class=\"token variable\">$temp</span>\n    <span class=\"token variable\">$rule</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>AccessControl<span class=\"token punctuation\">.</span>FileSystemAccessRule<span class=\"token punctuation\">(</span><span class=\"token string\">\"IIS_IUSRS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FullControl\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ContainerInherit, ObjectInherit\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"None\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$acl</span><span class=\"token punctuation\">.</span>AddAccessRule<span class=\"token punctuation\">(</span><span class=\"token variable\">$rule</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">Set-Acl</span> <span class=\"token variable\">$temp</span> <span class=\"token variable\">$acl</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$base</span> = <span class=\"token variable\">$base</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n<span class=\"token variable\">$temp</span> = <span class=\"token variable\">$temp</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"</span>\n\n<span class=\"token comment\">#if((Get-ChildItem Env:USERDOMAIN | Select -Expand Value) -ne (Get-ChildItem Env:COMPUTERNAME | Select -Expand Value)) {</span>\n<span class=\"token comment\">#   $logonServer = Get-ChildItem Env:USERDOMAIN | Select -Expand Value</span>\n<span class=\"token comment\">#} else {</span>\n<span class=\"token comment\">#   $logonServer = Get-ChildItem Env:COMPUTERNAME | Select -Expand Value</span>\n<span class=\"token comment\">#}</span>\n<span class=\"token comment\">#$userName = Get-ChildItem Env:USERNAME | Select -Expand Value</span>\n<span class=\"token comment\">#TODO: ask user for password to create Admin pool if it is not created</span>\n\n<span class=\"token comment\"># For each project run its setup script if exists</span>\n<span class=\"token function\">Write-Host</span>\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$project</span> in <span class=\"token variable\">$xml</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>projects<span class=\"token punctuation\">.</span>project<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$setupScript</span> = <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"projects\\\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$project</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\".ps1\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$setupScript</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$site</span> = <span class=\"token variable\">$project</span><span class=\"token punctuation\">.</span>name\n        <span class=\"token punctuation\">.</span> <span class=\"token variable\">$setupScript</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Starting IIS and sites...\"</span> <span class=\"token operator\">-</span>ForegroundColor Green\nnet <span class=\"token function\">start</span> w3svc\n<span class=\"token function\">Get-Website</span> <span class=\"token punctuation\">|</span> <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">{</span> <span class=\"token function\">Start-Website</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>name <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Example of user config file: mac.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># This file contains user specific variables</span>\n\n<span class=\"token comment\"># VARIABLES:</span>\n<span class=\"token comment\"># ------------------------------------------------------------------------------</span>\n<span class=\"token comment\"># $base     base path for projects, like: C:\\Rabota.UA\\trunk\\Version\\</span>\n<span class=\"token comment\"># $temp     temp directory path for project, like: D:\\Temp\\</span>\n\n<span class=\"token variable\">$base</span> = <span class=\"token string\">\"C:\\Rabota.UA\\trunk\\Version\\\"</span>\n<span class=\"token variable\">$temp</span> = <span class=\"token string\">\"C:\\Temp\"</span></code></pre></div>\n<p><strong>Example of rabota.ua.ps1 setup script</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$todo</span> = Check-Site <span class=\"token comment\"># 0 - create, 1 - delete and create, 2 - skip</span>\n\n<span class=\"token comment\"># $site - contains project name, eg: rabota.ua, channel.rabota.ua</span>\n<span class=\"token comment\"># $user - contains current user name, eg: mac, sv, beta</span>\n\n<span class=\"token comment\"># and all variables from user file</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$todo</span> <span class=\"token operator\">-eq</span> 1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Deleting <span class=\"token variable\">$site</span>\"</span> <span class=\"token operator\">-</span>ForegroundColor Blue\n\n    <span class=\"token function\">Remove-Website</span> <span class=\"token operator\">-</span>Name <span class=\"token variable\">$site</span>\n\n    <span class=\"token comment\">#TODO: Delete $site additional tasks here</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$todo</span> <span class=\"token operator\">-eq</span> 0 <span class=\"token operator\">-Or</span> <span class=\"token variable\">$todo</span> <span class=\"token operator\">-eq</span> 1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Creating <span class=\"token variable\">$site</span>\"</span> <span class=\"token operator\">-</span>ForegroundColor Blue\n\n    <span class=\"token function\">New-WebSite</span> <span class=\"token operator\">-</span>Name <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Port 80 <span class=\"token operator\">-</span>HostHeader <span class=\"token string\">\"local.rabota.ua\"</span> <span class=\"token operator\">-</span>PhysicalPath <span class=\"token punctuation\">(</span><span class=\"token variable\">$base</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Rabota2.WebUI\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># External bindings</span>\n    <span class=\"token function\">New-WebBinding</span> <span class=\"token operator\">-</span>Name <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>IPAddress <span class=\"token string\">\"*\"</span> <span class=\"token operator\">-</span>Port 80 <span class=\"token operator\">-</span>HostHeader <span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".rabota.ua\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Make temporary folders</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"info\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># will be used to create info section apps</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"HtmlTemplates\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># will be used to rewrite counters</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"CvPhotos\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"CvPhotos\\Temp\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Storage\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Storage\\Attaches\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"images\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Data\"</span><span class=\"token punctuation\">)</span>\n    Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Make symlinks</span>\n    Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token string\">\"CvPhotos\"</span><span class=\"token punctuation\">)</span>\n    Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token string\">\"Storage\"</span><span class=\"token punctuation\">)</span>\n    Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token string\">\"images\"</span><span class=\"token punctuation\">)</span>\n    Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token string\">\"Data\"</span><span class=\"token punctuation\">)</span>\n    Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token string\">\"img\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Create virtual directories for assets</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name CvPhotos <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\CvPhotos\"</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name Storage <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\Storage\"</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name images <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\images\"</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name <span class=\"token keyword\">Data</span> <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\Data\"</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name img <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\img\"</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name HtmlTemplates <span class=\"token operator\">-</span>PhysicalPath <span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"HtmlTemplates\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name Info <span class=\"token operator\">-</span>PhysicalPath <span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"info\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Create Virtual apps</span>\n    <span class=\"token function\">New-WebApplication</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Info/Jobsearcher\"</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>PhysicalPath <span class=\"token punctuation\">(</span><span class=\"token variable\">$base</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Rabota2.CMS\\BlogEngine.Web\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">New-WebApplication</span> <span class=\"token operator\">-</span>Name <span class=\"token string\">\"Info/Employer\"</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>PhysicalPath <span class=\"token punctuation\">(</span><span class=\"token variable\">$base</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Rabota2.CMS\\BlogEngine.Web\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Create empty copies of HtmlTemplates files</span>\n    <span class=\"token function\">Get-ChildItem</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$base</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Rabota2.WebUI\\HtmlTemplates\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> Name <span class=\"token punctuation\">|</span> <span class=\"token keyword\">Foreach</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"HtmlTemplates\\\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>path <span class=\"token punctuation\">(</span><span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"HtmlTemplates\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>name <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Name <span class=\"token operator\">-</span><span class=\"token function\">type</span> <span class=\"token string\">\"file\"</span> <span class=\"token operator\">-</span>value <span class=\"token string\">\"\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># Move libs</span>\n    <span class=\"token variable\">$shell_app</span>=<span class=\"token function\">New-Object</span> <span class=\"token operator\">-</span>com shell<span class=\"token punctuation\">.</span>application\n    <span class=\"token variable\">$filename</span> = <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"libs\\ext.zip\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$zip_file</span> = <span class=\"token variable\">$shell_app</span><span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$destination</span> = <span class=\"token variable\">$shell_app</span><span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">(</span><span class=\"token string\">\"C:\\inetpub\\wwwroot\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token variable\">$destination</span><span class=\"token punctuation\">.</span>Copyhere<span class=\"token punctuation\">(</span><span class=\"token variable\">$zip_file</span><span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">New-WebVirtualDirectory</span> <span class=\"token operator\">-</span>Site <span class=\"token variable\">$site</span> <span class=\"token operator\">-</span>Name ext <span class=\"token operator\">-</span>PhysicalPath <span class=\"token string\">\"C:\\inetpub\\wwwroot\\ext\"</span>\n\n    <span class=\"token comment\">#TODO: Create $site additional tasks here</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Helpers</h2>\n<p><strong>inc.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$_HOSTS_FORMAT</span> = <span class=\"token string\">\"{0,-16}{1,-57}# IIS`n\"</span>\n\n<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"Test-IsWritable.ps1\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Get-HostsFilePath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">Join-Path</span> <span class=\"token operator\">-</span>path <span class=\"token punctuation\">(</span><span class=\"token function\">Get-ChildItem</span> Env:SystemRoot <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>expand Value<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>childpath <span class=\"token string\">\"system32\\drivers\\etc\\hosts\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Get-Config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token namespace\">[xml]</span><span class=\"token variable\">$xml</span> = <span class=\"token function\">Get-Content</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Join-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token punctuation\">(</span><span class=\"token function\">Split-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$currentDirectory</span> <span class=\"token operator\">-</span>Parent<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span>ChildPath <span class=\"token string\">\"config.xml\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$xml</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Get-LocalProjectHosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$xml</span> = <span class=\"token function\">Get-Config</span>\n    <span class=\"token variable\">$hosts</span> = <span class=\"token string\">\"\"</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$site</span> in <span class=\"token variable\">$xml</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>sites<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$_HOSTS_FORMAT</span> <span class=\"token operator\">-</span>f <span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"local.\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$site</span><span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$hosts</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Get-RemoteProjectHosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$xml</span> = <span class=\"token function\">Get-Config</span>\n    <span class=\"token variable\">$hosts</span> = <span class=\"token string\">\"\"</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span> in <span class=\"token variable\">$xml</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>users<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$site</span> in <span class=\"token variable\">$xml</span><span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>sites<span class=\"token punctuation\">.</span>site<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$_HOSTS_FORMAT</span> <span class=\"token operator\">-</span>f <span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>ip<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">+</span> <span class=\"token string\">\".\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$site</span><span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token string\">\"`n\"</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$hosts</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Get-AllProjectHosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$hosts</span> = <span class=\"token string\">\"\"</span>\n    <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token function\">Get-LocalProjectHosts</span>\n    <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token string\">\"`n\"</span>\n    <span class=\"token variable\">$hosts</span> <span class=\"token operator\">+=</span> <span class=\"token function\">Get-RemoteProjectHosts</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$hosts</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> Check-Site<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">#$siteInfo = Get-WebSite -Name $site</span>\n    <span class=\"token variable\">$siteExists</span> = <span class=\"token punctuation\">(</span>1 <span class=\"token operator\">-eq</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Get-WebSite</span> <span class=\"token punctuation\">|</span> Where <span class=\"token punctuation\">{</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Name <span class=\"token operator\">-eq</span> <span class=\"token variable\">$site</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Measure-Object</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Select</span> <span class=\"token operator\">-</span>Expand Count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token variable\">$overwriteSite</span> = <span class=\"token boolean\">$False</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$siteExists</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$title</span> = <span class=\"token string\">\"Site <span class=\"token variable\">$site</span> already exists\"</span>\n        <span class=\"token variable\">$message</span> = <span class=\"token string\">\"What do you want to do?\"</span>\n        <span class=\"token variable\">$overwrite</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;Overwrite\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Site will be deleted and created again.\"</span>\n        <span class=\"token variable\">$skip</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Management<span class=\"token punctuation\">.</span>Automation<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">.</span>ChoiceDescription <span class=\"token string\">\"&amp;Skip\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Leave al as is.\"</span>\n        <span class=\"token variable\">$options</span> = <span class=\"token namespace\">[System.Management.Automation.Host.ChoiceDescription[]]</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$overwrite</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$skip</span><span class=\"token punctuation\">)</span>\n        <span class=\"token variable\">$chosen</span> = <span class=\"token variable\">$host</span><span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>PromptForChoice<span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$message</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$options</span><span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$chosen</span> <span class=\"token operator\">-eq</span> 0<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> 1\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token variable\">$siteExists</span> <span class=\"token operator\">-Or</span> <span class=\"token variable\">$overwriteSite</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> 0\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"Site <span class=\"token variable\">$site</span> skipped\"</span>\n        <span class=\"token keyword\">return</span> 2\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> Create-TempDir<span class=\"token punctuation\">(</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$dir</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># If path not exists - create it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$dir</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">New-Item</span> <span class=\"token variable\">$dir</span> <span class=\"token operator\">-</span><span class=\"token function\">type</span> directory\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\"># Give IIS full access to it</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>path <span class=\"token variable\">$dir</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$acl</span> = <span class=\"token function\">Get-Acl</span> <span class=\"token variable\">$dir</span>\n        <span class=\"token variable\">$rule</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>AccessControl<span class=\"token punctuation\">.</span>FileSystemAccessRule<span class=\"token punctuation\">(</span><span class=\"token string\">\"IIS_IUSRS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FullControl\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ContainerInherit, ObjectInherit\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"None\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token variable\">$acl</span><span class=\"token punctuation\">.</span>AddAccessRule<span class=\"token punctuation\">(</span><span class=\"token variable\">$rule</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">Set-Acl</span> <span class=\"token variable\">$dir</span> <span class=\"token variable\">$acl</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> Create-SymLink<span class=\"token punctuation\">(</span><span class=\"token namespace\">[string]</span><span class=\"token variable\">$dirName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Invoke-Expression</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"cmd /c mklink /D C:\\inetpub\\wwwroot\\\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$dirName</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$temp</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$dirName</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Test-IsWritable.ps1</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">function</span> <span class=\"token function\">Test-IsWritable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token comment\">&lt;#\n    .Synopsis\n        Command tests if a file is present and writable.\n    .Description\n        Command to test if a file is writeable. Returns true if file can be opened for write access.\n    .Example\n        Test-IsWritable -path $foo\n                Test if file $foo is accesible for write access.\n        .Example\n        $bar | Test-IsWriteable\n                Test if each file object in $bar is accesible for write access.\n        .Parameter Path\n        Psobject containing the path or object of the file to test for write access.\n#></span>\n        <span class=\"token namespace\">[CmdletBinding()]</span>\n        <span class=\"token keyword\">param</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">[Parameter(Mandatory=$true,ValueFromPipeline=$true)]</span><span class=\"token namespace\">[psobject]</span><span class=\"token variable\">$path</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">process</span><span class=\"token punctuation\">{</span>\n                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Test if file <span class=\"token variable\">$path</span> is writeable\"</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$path</span> <span class=\"token operator\">-</span>PathType Leaf<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"File is present\"</span>\n                        <span class=\"token variable\">$target</span> = <span class=\"token function\">Get-Item</span> <span class=\"token variable\">$path</span> <span class=\"token operator\">-</span>Force\n                        <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"File is readable\"</span>\n                        <span class=\"token keyword\">try</span><span class=\"token punctuation\">{</span>\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Trying to openwrite\"</span>\n                                <span class=\"token variable\">$writestream</span> = <span class=\"token variable\">$target</span><span class=\"token punctuation\">.</span>Openwrite<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Openwrite succeded\"</span>\n                                <span class=\"token variable\">$writestream</span><span class=\"token punctuation\">.</span>Close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Closing file\"</span>\n                                <span class=\"token function\">Remove-Variable</span> <span class=\"token operator\">-</span>Name writestream\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"File is writable\"</span>\n                                <span class=\"token function\">Write-Output</span> <span class=\"token boolean\">$true</span>\n                                <span class=\"token punctuation\">}</span>\n                        <span class=\"token keyword\">catch</span><span class=\"token punctuation\">{</span>\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Openwrite failed\"</span>\n                                <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"File is not writable\"</span>\n                                <span class=\"token function\">Write-Output</span> <span class=\"token boolean\">$false</span>\n                                <span class=\"token punctuation\">}</span>\n                        <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"Tidying up\"</span>\n                        <span class=\"token function\">Remove-Variable</span> <span class=\"token operator\">-</span>Name target\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token function\">Write-Verbose</span> <span class=\"token string\">\"File <span class=\"token variable\">$path</span> does not exist or is a directory\"</span>\n                        <span class=\"token function\">Write-Output</span> <span class=\"token boolean\">$false</span>\n                <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>TODO</h2>\n<ul>\n<li>Fill C:\\inetpub\\wwwroot\\iisstart.htm with all sites</li>\n<li>Create bach file for non developers to access sites on dev machines</li>\n<li>Scheduled task for syncing assets</li>\n<li>Scheduled task for checking building results and sites availability</li>\n</ul>"}},"pageContext":{"id":"b8e4c4f4-a074-5c9b-946d-db2291d2acf7"}},"staticQueryHashes":[]}
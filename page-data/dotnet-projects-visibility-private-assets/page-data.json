{"componentChunkName":"component---src-templates-note-js","path":"/dotnet-projects-visibility-private-assets/","result":{"data":{"remark":{"fields":{"path":"dotnet-projects-visibility-private-assets"},"meta":{"title":""},"headings":[{"value":"dotnet package visibility"},{"value":"Custom rules or avoid warnings"}],"html":"<h1>dotnet package visibility</h1>\n<p>Suppose we are building new project.</p>\n<p>The simplest starting point will be just to create an web project and put everything inside.</p>\n<p>But sooner or later we will realize that we also need some kafka consumers, cron jobs etc so we gonna need to have some kind of shared library.</p>\n<p>In other words appearance of packages is just a matter of time.</p>\n<p>Packages has few additional offside effects.</p>\n<p>Package may be used to hide actual implementations and give only interfaces to outside users by marking implementations as <code class=\"language-text\">internal</code>, and because of that we are enforcing usage of interfaces, which dramatically simplifies creating of unit tests and future changes of implementations.</p>\n<p>And if we are started to use packages why not split them even more, to hide some low level stuff from high level components, e.g. imagine you have <code class=\"language-text\">OrdersRepository</code> and <code class=\"language-text\">OrdersService</code> in such case we do not want <code class=\"language-text\">OrdersController</code> to know about low level repository stuff, thats why we may want to split them even further.</p>\n<p>Probably the simples and more famous way will be something like:</p>\n<ul>\n<li>Consumer</li>\n<li>Web</li>\n<li>Services</li>\n<li>Repositories</li>\n</ul>\n<p>In reality if we will change Services to Domain, and Repositroies to Infrastructure nothing really wont be changed it is more about starting point and naming preferences.</p>\n<p>In example I am using Services and Repositories by intent, because in dotnet we have <code class=\"language-text\">ServiceProvider</code> which responsibility is to provide services to us and that sound pretty clear and straight forward to me.</p>\n<p>The next step and question is how to organize everything to be \"pretty\"</p>\n<p>Here are sample classes:</p>\n<ul>\n<li>Repositories\n<ul>\n<li>public record Order</li>\n<li>public interface IOrdersRepository</li>\n<li>internal class SqlOrdersRepository</li>\n</ul>\n</li>\n<li>Services\n<ul>\n<li>public record Order</li>\n<li>public interface IOrdersService</li>\n<li>internal class OrdersService</li>\n</ul>\n</li>\n<li>Web\n<ul>\n<li>public class OrdersController</li>\n</ul>\n</li>\n</ul>\n<p>So our dependency graph is: Web &#x3C;- Services &#x3C;- Repositories</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 640px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/672a91bb0ab1af1ff864dcf4a7ba90bb/6af66/graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzUlEQVR42u3SOw+CMBAAYP//rymPBEhkwSiQFAotDfIQVsMOMtCeYUCJg4BuxpvaS77mHt3BF7EDgEtdkSSJCEnTlDFGKY3juKqqYRiWcVZnLvE0VUOKgpBqWRZCyPd9IcQylmOMl6bpML5OmSn7HgNAXhYkYWEQYRxxnuR53vf9qp5BAi/5EZ8MwzRNS9d1x3FWYwAh5LxsIZZrfmKQ8lxkQcwOjss577rb2lWNVkiaUTf0NFXd23bbthvwY8Lzwwb88sQnePP3/OPfx3ckQ5MYYBoW1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"graph\"\n        title=\"\"\n        src=\"/static/672a91bb0ab1af1ff864dcf4a7ba90bb/6af66/graph.png\"\n        srcset=\"/static/672a91bb0ab1af1ff864dcf4a7ba90bb/6f3f2/graph.png 256w,\n/static/672a91bb0ab1af1ff864dcf4a7ba90bb/01e7c/graph.png 512w,\n/static/672a91bb0ab1af1ff864dcf4a7ba90bb/6af66/graph.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Sounds really cool on paper</p>\n<p>From <strong>Web</strong> project I have only <code class=\"language-text\">IOrdersService</code> and do not know nothing about actual implementations and can not inject it directly.</p>\n<p>From a <strong>Services</strong> project I do not know nothing about <strong>Web</strong>, and in the same way know only about <code class=\"language-text\">IOrdersRepository</code> and not about its implementations.</p>\n<p>With such setup following code wont even compile:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrdersController</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">OrdersService</span> _service<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">public</span> <span class=\"token function\">OrdersController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrdersService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    _service <span class=\"token operator\">=</span> service<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Because actual implementation is marked as <code class=\"language-text\">internal</code> and I can not use it outside, so I am forced to use interface instead.</p>\n<p>But there is still one more problem, technically I still may do something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrdersController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> <span class=\"token class-name\">IOrdersRepository</span> _repository<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token function\">OrdersController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IOrdersRepository</span> repository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        _repository <span class=\"token operator\">=</span> repository<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Which is exactly the problem we wish to get rid off, imagine that in few years some new comer will decide that it is much easier for him to just inject orders repository and write something to storage, but he will bypass all rules in corresponding service which will lead to possible errors and makes mess.</p>\n<p>To do this impossible in our <strong>Servicess</strong> project we should mark repositories as an private assets by adding <code class=\"language-text\">PrivateAssets=\"All\"</code> attribute, so they wont be visible to anyone outside</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ItemGroup</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ProjectReference</span> <span class=\"token attr-name\">Include</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>..\\Repositories\\Repositories.csproj<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">PrivateAssets</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>all<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ItemGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Now from <strong>Web</strong> layer, I technically can not talk directly to <strong>Repositories</strong> bypassing <strong>Services</strong> - profit</p>\n<p><strong>Note about service provider</strong></p>\n<p>Projects are using <code class=\"language-text\">Microsoft.Extensions.DependencyInjection.Abstractions</code> and extension class to register them selves in service provider</p>\n<p>From Web we have:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">builder<span class=\"token punctuation\">.</span>Services<span class=\"token punctuation\">.</span><span class=\"token function\">AddOrdersService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>From Services:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceCollectionExtensions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">AddOrdersService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token class-name\">IServiceCollection</span> services<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        services<span class=\"token punctuation\">.</span><span class=\"token function\">AddOrdersRepository</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IOrdersService<span class=\"token punctuation\">,</span> OrderService<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And from Repositories:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ServiceCollectionExtensions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">AddOrdersRepository</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token class-name\">IServiceCollection</span> services<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSingleton</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IOrdersRepository<span class=\"token punctuation\">,</span> SqlOrdersRepository<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Thanks for that in Web we have:</p>\n<ul>\n<li><code class=\"language-text\">IOrdersRepository</code> - invisible</li>\n<li><code class=\"language-text\">IOrdersService</code> - visible</li>\n<li><code class=\"language-text\">new SqlOrdersRepository()</code> - Can not resolve symbol</li>\n<li><code class=\"language-text\">new OrderServiceImpl()</code> - Can not access internal class here</li>\n</ul>\n<p>If you will try to visualize your current projects graph you may see something like: Web &#x3C;- Infrastructure &#x3C;- Domain, which looks weird and seems like it is not only has wrong direction but shuffled</p>\n<p>Note about unit tests: to make internal classes withible to test projects you may want to add following in your project <code class=\"language-text\">&lt;ItemGroup>&lt;InternalsVisibleTo Include=\"Repositories.Tests\" />&lt;/ItemGroup></code></p>\n<h2>Prevent csproj reference</h2>\n<p>For now we have desired: Web &#x3C;- Services &#x3C;- Repositories</p>\n<p>But nothing wont prevent me to reference Repositories in Web and use it directly</p>\n<p>To avoid that we may add something like this in Web csproj:</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Target</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PreBuild<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">BeforeTargets</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PreBuildEvent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Error</span> <span class=\"token attr-name\">Text</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">'</span>Repositories' are not allowed to be referenced by 'Web'<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Condition</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>$([System.IO.File]::ReadAllText('Web.csproj').Contains('<span class=\"token entity named-entity\" title=\"&lt;\">&amp;lt;</span>ProjectReference Include=<span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span>..\\Repositories\\Repositories.csproj<span class=\"token entity named-entity\" title=\"&quot;\">&amp;quot;</span>'))<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Target</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>And from now on if someone by mistake will decide to reference it - project wont even build and hopefully it will be a signal for engineer that he is doing something wrong.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1016px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/09afaee63bf0cb92c9bd707adef69481/f4281/build.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.28125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAkklEQVR42m2KOw6CQBiE94oWJoo38Q4axSt4AWKvlQsF0XKDsPvvA3TV2nqMf8RYUEzm8Y3I9iV2hxNKFVC5JxTdoegBZf80uA13Md+eMV4eMVpIJGmOJC1Y07X8abYpvizn3v963rPJSkK8YkStCcYGVA3BuBa+i5wv2qIhD9feYMMV2gbePh/yHbPaOHbtAvsbi/TGELxvYSwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/09afaee63bf0cb92c9bd707adef69481/f4281/build.png\"\n        srcset=\"/static/09afaee63bf0cb92c9bd707adef69481/6f3f2/build.png 256w,\n/static/09afaee63bf0cb92c9bd707adef69481/01e7c/build.png 512w,\n/static/09afaee63bf0cb92c9bd707adef69481/f4281/build.png 1016w\"\n        sizes=\"(max-width: 1016px) 100vw, 1016px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>Custom rules or avoid warnings</h1>\n<p>Adding <code class=\"language-text\">&lt;WarningsAsErrors>true&lt;/WarningsAsErrors></code> to <code class=\"language-text\">PropertyGroup</code> will broke build for all possible warning (aka it will be like golang which does compile if you have unused variable)</p>\n<p>More gentle way might be creating custom rulesets</p>\n<p><strong>analysis.ruleset</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>RuleSet</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Rules for Web<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Description</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Code analysis rules for Web.csproj.<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">ToolsVersion</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Rules</span> <span class=\"token attr-name\">AnalyzerId</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.Analyzers.ManagedCodeAnalysis<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">RuleNamespace</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Microsoft.Rules.Managed<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Rule</span> <span class=\"token attr-name\">Id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>CS0219<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">Action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Error<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span> <span class=\"token comment\">&lt;!-- disallow unused variables --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Rules</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>RuleSet</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>And adding it as <code class=\"language-text\">&lt;CodeAnalysisRuleSet>analysis.ruleset&lt;/CodeAnalysisRuleSet></code> in <code class=\"language-text\">PropertyGroup</code></p>\n<p>Dotnet CLI has build it editorconfig <code class=\"language-text\">dotnet new editorconfig</code> which creates some configuration with default values</p>\n<p>So I did tried to create dedicated editorconfig for repositories with contents like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token key attr-name\">dotnet_naming_symbols.types_and_namespaces.applicable_kinds</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">class</span>\n<span class=\"token key attr-name\">dotnet_naming_symbols.types_and_namespaces.applicable_accessibilities</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">internal</span>\n<span class=\"token key attr-name\">dotnet_naming_symbols.types_and_namespaces.required_modifiers</span> <span class=\"token punctuation\">=</span> </code></pre></div>\n<p>But have no luck</p>\n<p>TODO: is there an rule or another way to enforce internal classes in project?</p>\n<h2>Project Resistance (stability)</h2>\n<p>Ask yourself: If I will modify this class in this project - how many changes in other projects it will require?</p>\n<p>If the answer is 0 - then this project is unstable, you are free to change it as much as you want</p>\n<p>If the answer is quadrillion - then this project is stable, so probably no one want to touch it because it will require to rewrite the world</p>\n<p>Project is resistant (stable) if it has no dependencies, but other projects depends on him (aka: it is hard to make changes inside, they will propagate)</p>\n<p>Project is non resistant (unstable) if it depends on other projects but no one is depend on him (aka: it is easy to make changes inside, nothing will be propagated)</p>\n<p>Usually projects will be somewhere in between (flexible), except the edges of project (storage, web, ...)</p>\n<p>The rule of thumb is that <strong>stable project should not depend on unstable</strong></p>\n<p>In our case:</p>\n<ul>\n<li>Repositories is stable - it has no dependencies, but Services depends on it</li>\n<li>Services is flexible - it depends on Repositories, and Web depends on it</li>\n<li>Web is unstable - it depends on Services, and no one depends on it</li>\n</ul>\n<p>So we are in rule: less stable projects are depending on more stable ones.</p>\n<p>Note that neither stable and/or unstable are not good not bad, at the very end we want everything to be flexible enough to evolve</p>\n<h2>CCP: Common Closure Principle</h2>\n<p>Classes that are changed together at same time should live inside dedicated project. Classes that are changed independently or in different times should live in separate projects.</p>\n<p>Is is something like single responsibility principle but on upper level for projects.</p>\n<p>Having that the answer to question: Should Sql/Elastic/Redis implementations live inside Repositories project should be obvious.</p>\n<h2>Stable Abstractions Principle</h2>\n<p>How can we add some flexibility to a very stable project? The answer is to use abstraction classes.</p>\n<p>Stable project should be also abstract (consist of interface and/or abstract classes), so its stability does not prevent extensions and evolution.</p>\n<p>Unstable project should be concrete, so it is easy to make changes.</p>\n<p>AKA: it is fine to have single project consist of single interface, it is like inversion of dependencies, imagine that you have situation when for some reason your stable project becomes dependant on unstable, how to fix that? Just create yet another project with single interface - it will be very very stable, so from now on, your stable project depends on even more stable which is good, and your unstable project just adds implementation and continues to be as unstable as he want.</p>\n<p>Also it is related to Common Reuse Principle (CRP) - which asks you to not make more publicly available stuff to outside users than really needed</p>\n<h2>Package Resistance and Abstraction Metrics</h2>\n<p>SDP: I should decrease from top to bottom</p>\n<p>Web (I = 1) &#x3C;- Services (I = 0.5) &#x3C;- Repositories (I = 0)</p>\n<ul>\n<li>Repositories (stable, pain):\n<ul>\n<li>I = 0, I = Fan-out / (Fan-in + Fan-out), Fan-in = 2 (OrdersService depends on IOrdersRepository, Orders service registration depends on Repository), Fan-out = 0 (Repositories does not depend on anything)</li>\n<li>A = 0.25, A = Na / Nc, Na = 1 (only one interface IOrdersRepository), Nc = 4 (four classes in total)</li>\n</ul>\n</li>\n<li>Services (flexible):\n<ul>\n<li>I = 0.5, Fan-in = 2 (OrdersController depends on IOrdersService, service registration), Fan-out = 2 (OrdersService implementation depends on IOrdersRepository, service registration)</li>\n<li>A = 0.25</li>\n</ul>\n</li>\n<li>Web (unstable):\n<ul>\n<li>I = 1, Fan-in = 0 (No one depends on Web), Fan-out = 1 (OrdersController depends on IOrdersService)</li>\n<li>A = 0</li>\n</ul>\n</li>\n</ul>\n<p>Notes:</p>\n<ul>\n<li>I = 1 - unstable, can be changed often</li>\n<li>I = 0 - stable, changes are hard</li>\n<li>I = 0, A = 0 - pain, everything is concrete rather than abstract, and changes will propagate</li>\n<li>I = 1, A = 1 - useless, everything is abstract and not used, dead code</li>\n<li>stdvar(D) > X - requires attention something wrong</li>\n<li>projectA (I = 0, stable) depends on projectB (I = 1, unstable) - broken SDP principle</li>\n</ul>\n<p>NDepend in its reports for assemblies has all this and may be used in CI pipeline</p>\n<p>with trial I was able to analyse all this</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet ./net6.0/NDepend.Console.MultiOS.dll RegEval\ndotnet ./net6.0/NDepend.Console.MultiOS.dll <span class=\"token parameter variable\">-cp</span> solution.ndproj /path/to/solution.sln\ndotnet ./net6.0/NDepend.Console.MultiOS.dll solution.ndproj</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb285087c5779ff75c71357fe606a16e/9b1e2/report.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.390625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+klEQVR42k2OS0+EMBRG+f//x52LidERHCDuNUZkCowudIDSd49pSYyL5vS7j9xTxEtLvNTEz5Y41cRLgzsfsf09YTwRpgbT3eFFmelEiX4/YLsD6uUGL474oSJMJ/z4RKH6CtU94sYGe67Q3QNuaLDihBU1bmwx5yrXdF9mmr7EfBzZXm/3uaHGT8/YoaXo3gaG/guzevTiMDKg14DO9BgZ/+XANjvk7Fh/NGrZmWa22bJeDYUQA+siiRG8j8QAznm8D5khxD27gDH2r6aUxhqXmfZSL/2LZLd871fUshupZLsG5NVms5TTk7NlWxzyanZjGXI2W8xMO7+gIHu2yJmi1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"report\"\n        title=\"\"\n        src=\"/static/eb285087c5779ff75c71357fe606a16e/2bef9/report.png\"\n        srcset=\"/static/eb285087c5779ff75c71357fe606a16e/6f3f2/report.png 256w,\n/static/eb285087c5779ff75c71357fe606a16e/01e7c/report.png 512w,\n/static/eb285087c5779ff75c71357fe606a16e/2bef9/report.png 1024w,\n/static/eb285087c5779ff75c71357fe606a16e/71c1d/report.png 1536w,\n/static/eb285087c5779ff75c71357fe606a16e/9b1e2/report.png 1880w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Note: NDepend calculates internal classes as well that's why numbers are different but overall the shape is same</p>"}},"pageContext":{"id":"58ebe6bd-6e26-5c77-ab39-f03ac4d0cab1"}},"staticQueryHashes":[],"slicesMap":{}}
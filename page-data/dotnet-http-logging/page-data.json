{"componentChunkName":"component---src-templates-note-js","path":"/dotnet-http-logging/","result":{"data":{"remark":{"fields":{"path":"dotnet-http-logging"},"meta":{"title":""},"headings":[{"value":"dotnet http logging"}],"html":"<h1>dotnet http logging</h1>\n<p>out of the box we can have detailed logs for each and every http request</p>\n<p><div class=\"gatsby-highlight\" data-language=\"cs\"><pre class=\"language-cs\"><code class=\"language-cs\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>Http<span class=\"token punctuation\">.</span>Headers</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>Http<span class=\"token punctuation\">.</span>Headers</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> builder <span class=\"token operator\">=</span> WebApplication<span class=\"token punctuation\">.</span><span class=\"token function\">CreateBuilder</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nbuilder<span class=\"token punctuation\">.</span>Services<span class=\"token punctuation\">.</span><span class=\"token function\">AddHttpLogging</span><span class=\"token punctuation\">(</span>options <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    options<span class=\"token punctuation\">.</span>LoggingFields <span class=\"token operator\">=</span> Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>HttpLogging<span class=\"token punctuation\">.</span>HttpLoggingFields<span class=\"token punctuation\">.</span>All<span class=\"token punctuation\">;</span>\n    options<span class=\"token punctuation\">.</span>RequestHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>HeaderNames<span class=\"token punctuation\">.</span>Authorization<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">var</span></span> app <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">Build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">UseHttpLogging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">MapGet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div></p>\n<p>but make sure that your appsettings files has something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Logging\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"LogLevel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Microsoft.AspNetCore\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>or you can be more concrete and leave everything as is but define log level for http logs like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Logging\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"LogLevel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Microsoft.AspNetCore\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Warning\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Microsoft.AspNetCore.HttpLogging\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Information\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>if everything is done right you will see following for requests:</p>\n<div class=\"gatsby-highlight\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\"><span class=\"token property\">info:</span> Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>HttpLogging<span class=\"token punctuation\">.</span>HttpLoggingMiddleware<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token property\">Request:</span>\n      <span class=\"token property\">Protocol:</span> HTTP<span class=\"token operator\">/</span><span class=\"token number\">1.1</span>\n      <span class=\"token property\">Method:</span> GET\n      <span class=\"token property\">Scheme:</span> http\n      <span class=\"token property\">PathBase:</span> \n      <span class=\"token property\">Path:</span> <span class=\"token operator\">/</span>\n      <span class=\"token property\">Accept:</span> <span class=\"token operator\">*</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span>\n      <span class=\"token property\">Host:</span> localhost<span class=\"token operator\">:</span><span class=\"token number\">5000</span>\n      <span class=\"token property\">User-Agent:</span> curl<span class=\"token operator\">/</span><span class=\"token number\">7.84.0</span></code></pre></div>\n<p>and this one for responses:</p>\n<div class=\"gatsby-highlight\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\"><span class=\"token property\">info:</span> Microsoft<span class=\"token punctuation\">.</span>AspNetCore<span class=\"token punctuation\">.</span>HttpLogging<span class=\"token punctuation\">.</span>HttpLoggingMiddleware<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n      <span class=\"token property\">Response:</span>\n      <span class=\"token property\">StatusCode:</span> <span class=\"token number\">200</span>\n      <span class=\"token property\">Content-Type:</span> text<span class=\"token operator\">/</span>plain<span class=\"token operator\">;</span> charset<span class=\"token operator\">=</span>utf<span class=\"token operator\">-</span><span class=\"token number\">8</span></code></pre></div>\n<p>also consider that library by default does not pring all header and perform some kind of anonymisation, so you may see <code class=\"language-text\">[Redacted]</code> use something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">options<span class=\"token punctuation\">.</span>RequestHeaders<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>HeaderNames<span class=\"token punctuation\">.</span>Authorization<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>"}},"pageContext":{"id":"e41e7afe-6794-5a54-8c85-c86d07de6b89"}},"staticQueryHashes":[],"slicesMap":{}}
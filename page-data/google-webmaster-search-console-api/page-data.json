{"componentChunkName":"component---src-templates-note-js","path":"/google-webmaster-search-console-api/","result":{"data":{"remark":{"fields":{"path":"google-webmaster-search-console-api"},"meta":{"title":""},"headings":[{"value":"Google Webmaster Search Console API"}],"html":"<h1>Google Webmaster Search Console API</h1>\n<p>Suppose we have web site, and want to grab its page stats via webmaster api</p>\n<p>There is dedicated <a href=\"https://developers.google.com/webmaster-tools/search-console-api-original/v3/how-tos/search_analytics#top-10-pages,-sorted-by-click-count,-descending\">search analytics query</a> which will return top 10 pages sorted by click count</p>\n<p>To do so we gonna need to enable <a href=\"https://console.cloud.google.com/marketplace/product/google/searchconsole.googleapis.com\">Google Search Console API</a> in our project</p>\n<p>Then we gonna need to <a href=\"https://console.cloud.google.com/apis/api/searchconsole.googleapis.com/credentials\">create service account</a> and grab its json key</p>\n<p>Put this key somewhere and point <code class=\"language-text\">GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to its path</p>\n<p>Now go to <a href=\"https://search.google.com/search-console/users\">Google Search Console</a> and add email of added service account to your site</p>\n<p>After all this steps done we might query our stats:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> google <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'googleapis'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">main</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> webmasters <span class=\"token operator\">=</span> google<span class=\"token punctuation\">.</span><span class=\"token function\">webmasters</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v3'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> auth <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>auth<span class=\"token punctuation\">.</span>GoogleAuth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">scopes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'https://www.googleapis.com/auth/webmasters.readonly'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  google<span class=\"token punctuation\">.</span><span class=\"token function\">options</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">auth</span><span class=\"token operator\">:</span> <span class=\"token keyword\">await</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">getClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> rows <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> webmasters<span class=\"token punctuation\">.</span>searchanalytics<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">siteUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://mac-blog.org.ua'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">requestBody</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">startDate</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">8</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'T'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">endDate</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'T'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">dimensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'page'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">rowLimit</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> rows\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>console<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">)</span></code></pre></div></p>\n<p>And if everything fine will retrieve our results:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"keys\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://mac-blog.org.ua/kafka-command-line-tools/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clicks\"</span><span class=\"token operator\">:</span> <span class=\"token number\">44</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"impressions\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1607</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ctr\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.027380211574362167</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"position\"</span><span class=\"token operator\">:</span> <span class=\"token number\">25.266957062850032</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"keys\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://mac-blog.org.ua/wordpress-custom-database-table-example-full/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clicks\"</span><span class=\"token operator\">:</span> <span class=\"token number\">37</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"impressions\"</span><span class=\"token operator\">:</span> <span class=\"token number\">958</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ctr\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.038622129436325675</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"position\"</span><span class=\"token operator\">:</span> <span class=\"token number\">19.04801670146138</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"keys\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://mac-blog.org.ua/c-custom-app-config-sections/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clicks\"</span><span class=\"token operator\">:</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"impressions\"</span><span class=\"token operator\">:</span> <span class=\"token number\">804</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ctr\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.041044776119402986</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"position\"</span><span class=\"token operator\">:</span> <span class=\"token number\">13.894278606965175</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"keys\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://mac-blog.org.ua/rabbitmq-python-example/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clicks\"</span><span class=\"token operator\">:</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"impressions\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1121</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ctr\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.029438001784121322</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"position\"</span><span class=\"token operator\">:</span> <span class=\"token number\">11.581623550401428</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"keys\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"https://mac-blog.org.ua/docker-localhost-ssl/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"clicks\"</span><span class=\"token operator\">:</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"impressions\"</span><span class=\"token operator\">:</span> <span class=\"token number\">643</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ctr\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.049766718506998445</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"position\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20.94090202177294</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div></p>"}},"pageContext":{"id":"04df100f-5305-5123-b842-28b59d64e0b1"}},"staticQueryHashes":[],"slicesMap":{}}
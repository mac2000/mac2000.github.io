{"componentChunkName":"component---src-templates-note-js","path":"/security-auditing/","result":{"data":{"remark":{"fields":{"path":"security-auditing"},"meta":{"title":""},"headings":[{"value":"Security Auditing"}],"html":"<h1>Security Auditing</h1>\n<p>Did you know that you can monitor file changes without installing any additional software?</p>\n<h2>Watching for changes inside folder with Security Audition</h2>\n<p>Most sync software relaying on watching filesystem for changes to do the work.</p>\n<p>In C# there is <code class=\"language-text\">FileSystemWatcher</code> for this kind of applications, which has <code class=\"language-text\">IncludeSubdirectories</code> property that will automatically catch changes from underlying folders.</p>\n<p>But there is a way to monitor changes <strong>without</strong> any additional software written/installed on your machine.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4801fb99622d7a2121b017e7569c2bd0/3faba/SecurityAuditing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.296875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACe0lEQVR42l2RPW8UVxiF7xoHIZoobboU+QcoPaLgF+QPUCBEmS5d0lNFMrYAGREISKSjiBLij4RgKQkCYRCwsLbX4112dj7vvTN3ZufjzjzRjIkU5UhHR+8tzj3veUU4eoDnPGO2v4NydwnHG6jIQYVTdPyeyD8kmB8Qeof9nOn3SKlQL7+m2RTY7RPYrQF2c4D9dYBwRk+YupKitNgWjJwQhRFpmhHHCq1TyrLGNtACbdvQoRxfoe4Mfz+J/e3EsfHGMsI9+IujqUuSKLIsRwcjZtMJQRCQJAlSSowxxHGMVooo9FnUUIy+xT4U1FsCuyV68/qhQLj7T1A6w9qKxaIgng9ZLHKqquoTafc5+mgbefQHyfQx8eE2ofMnwatV0mcXMLuXMM8vku5eRm5/iXDfPUWbBVVZkOcFsTskSyXFIqMqc4w8QoYuYeAhZYBJIqoixdqmr6hp6bX7vFR7iNh5RWJKtNJIpVHBmJlvmPk5KgMZeXie3/dpTNZ323ValiVFkfdByiLDFJCGu4jZN2eYrZ1D/3IW8/MXmK3zJK9XSN9cRb+8Qu7/TWoKfG9OXdf8C9/zCIOQpmloW0t3qlIPEZNLgmD1NMU9QXFXHGvHHz/o3io6h4kz7hO2bdubdEfrturRNv3KhRoi3O8+Qd75lOz7Aeb2MubOMtm9ZfL7p8jvCrK3a1QtlAtDWRbUddXTWkvb2N6M1lJbMMELhLf+GerGx+hrAn196ZjrSyS3TvZv2dub/Bft/9h8YIfaTBD++ufIlSXk1QFqdYDsuLaEvPYRckUQPfqKaH+H+YufmB88RXl7yPkIOd9DOjsoZ4PY2cQbPyIc/sA/LkEAffOoJWsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Security Auditing\"\n        title=\"\"\n        src=\"/static/4801fb99622d7a2121b017e7569c2bd0/2bef9/SecurityAuditing.png\"\n        srcset=\"/static/4801fb99622d7a2121b017e7569c2bd0/6f3f2/SecurityAuditing.png 256w,\n/static/4801fb99622d7a2121b017e7569c2bd0/01e7c/SecurityAuditing.png 512w,\n/static/4801fb99622d7a2121b017e7569c2bd0/2bef9/SecurityAuditing.png 1024w,\n/static/4801fb99622d7a2121b017e7569c2bd0/71c1d/SecurityAuditing.png 1536w,\n/static/4801fb99622d7a2121b017e7569c2bd0/3faba/SecurityAuditing.png 1625w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>So what we are going to do is to enable Security Auditing for changes made to any of children inside our object.</p>\n<p>You can enable auditing any events you want, in our example we are looking just for file changes.</p>\n<p>Here is powershell snippet to enable auditing changes:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$Path</span> = <span class=\"token string\">'C:\\Projects'</span>\n<span class=\"token variable\">$AuditChangesRules</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Security<span class=\"token punctuation\">.</span>AccessControl<span class=\"token punctuation\">.</span>FileSystemAuditRule<span class=\"token punctuation\">(</span><span class=\"token string\">'Everyone'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Delete,DeleteSubdirectoriesAndFiles,CreateFiles,AppendData'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Success'</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$Acl</span> = <span class=\"token function\">Get-Acl</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$Path</span>\n<span class=\"token variable\">$Acl</span><span class=\"token punctuation\">.</span>AddAuditRule<span class=\"token punctuation\">(</span><span class=\"token variable\">$AuditChangesRules</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">Set-Acl</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$Path</span> <span class=\"token operator\">-</span>AclObject <span class=\"token variable\">$Acl</span></code></pre></div>\n<p>Aaron Giuoco has written good article describing this process in more details: <a href=\"http://giuoco.org/security/configure-file-and-registry-auditing-with-powershell/\">http://giuoco.org/security/configure-file-and-registry-auditing-with-powershell/</a></p>\n<h2>Manage Audit Policies</h2>\n<p>Ok, so now when we have enabled auditing where can we see logged changes?</p>\n<p>The answer is - in Event logs, but there is one more thing you should do before you will see your logs.</p>\n<p>By default - logging of security auditing is turned off, you can enable it with <code class=\"language-text\">secpol.msc</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 793px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eca21fa8f0ad5223332cec7a8d00bbd2/73fd0/secpol.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.09375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACWElEQVR42n2U3W6bQBSEef836F1711RRpbRVr/oCvUhix0kM9noxZrEBG/Bi/IP5+SrWTpO2SY80Wq3QzJkzZ4U1Vx5RvCKKl4RhyGqVkGUZaZoazOdzfBUwHXxF9T6wtC+Z338i6DC4QHW4+4h7856HH++wHC9CSIfb4YTRWOCqBdKP0XmOzgs2xY5NUZCIb0TDzwT3l0yuLxDXFwSPX1APV/j3V2TudzLnO5YYD5BiiO0IMp1zOFbsDiWLMCZeJeTFnnWWkMUT/GhDlpeEyw26qGiB5oyqhQqw1itFPOszckbkWtM23WdIVglSCGYzn8nYJp712O13ht42NW1bQ9s8g9NpaZ2RhY9MhMCbeia3qqqYhzHDR5uRM8b3JEUi2O9L4jhmvda0bfsqrDSW+O4DYixxpUT5ivV6zWIRYQ9tHHtE4E856CnZOicIAuq65q2y4oVAjvrYwxFjpyMrqromSVJmnodSc8JgZhzWTWsi6Zw0zWn0ujpS15WZquNZgT9mKh286ewkMPOZup0bbTo2LTR1SbGyKfIIx3bo9+9MHAPbRQYJahEb7m63x8rzM/Hc2XSvG/b7w+8xmvrANp2YrR6PJWVZcjwe2R4qdseWqj45NiN3762rTuhlnQTbPwRfr2eeWYrWz4Iv8a+gMLe2bd7csBHM882rfTvBJ9dN9T+Hf205zTKzoS6XJ3T3lxnSlGziR7bbgm2h2RWazUYTLZd0/GihyNIluU6xhBC47hQpJVK65lRKmQd8+kl0SAi9GxZej/CMwO0hxzd4k1u80U/U5NrgF5DDJa1JKFd/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Audit Object Access\"\n        title=\"\"\n        src=\"/static/eca21fa8f0ad5223332cec7a8d00bbd2/73fd0/secpol.png\"\n        srcset=\"/static/eca21fa8f0ad5223332cec7a8d00bbd2/6f3f2/secpol.png 256w,\n/static/eca21fa8f0ad5223332cec7a8d00bbd2/01e7c/secpol.png 512w,\n/static/eca21fa8f0ad5223332cec7a8d00bbd2/73fd0/secpol.png 793w\"\n        sizes=\"(max-width: 793px) 100vw, 793px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>But here is what you should be aware of - if you are on Windows 8.1 (not Pro) you have no secpol snapin available :(</p>\n<p>But there is still way to accomplish this, and it is even better: <code class=\"language-text\">AuditPol.exe</code></p>\n<p>Try run: <code class=\"language-text\">AuditPol /get /category:\"Object Access\"</code></p>\n<p>And you will see:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">System audit policy\nCategory/Subcategory                      Setting\nObject Access\n    File System                             No Auditing\n    Registry                                No Auditing\n    Kernel Object                           No Auditing\n    SAM                                     No Auditing\n    Certification Services                  No Auditing\n    Application Generated                   No Auditing\n    Handle Manipulation                     No Auditing\n    File Share                              No Auditing\n    Filtering Platform Packet Drop          No Auditing\n    Filtering Platform Connection           No Auditing\n    Other Object Access Events              No Auditing\n    Detailed File Share                     No Auditing\n    Removable Storage                       No Auditing\n    Central Policy Staging                  No Auditing</code></pre></div>\n<p>You can enable only desired auditing rather than all with command like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\">AuditPol <span class=\"token operator\">/</span><span class=\"token function\">set</span> <span class=\"token operator\">/</span>Subcategory:<span class=\"token string\">\"File System\"</span> <span class=\"token operator\">/</span>success:enable</code></pre></div>\n<p>From now on, you will see your security audit logs in event logs viewer.</p>\n<h2>Security log</h2>\n<p>Desired events will have <strong>4663</strong> EventID</p>\n<p>Each event describes which object (file, folder) was modified in <code class=\"language-text\">ObjectName</code> and what operation was performed in <code class=\"language-text\">AccessMask</code></p>\n<p>To see template for event you can use following powershell snippet:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token punctuation\">(</span><span class=\"token function\">Get-WinEvent</span> <span class=\"token operator\">-</span>ListProvider Microsoft-Windows-Security-Auditing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Events <span class=\"token punctuation\">|</span> where id <span class=\"token operator\">-eq</span> 4663</code></pre></div>\n<p>Which will show you what data passed to event and what is importang which index of event data is associated with which event detail</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Id          : 4663\nVersion     : 1\nLogLink     : System.Diagnostics.Eventing.Reader.EventLogLink\nLevel       : System.Diagnostics.Eventing.Reader.EventLevel\nOpcode      : System.Diagnostics.Eventing.Reader.EventOpcode\nTask        : System.Diagnostics.Eventing.Reader.EventTask\nKeywords    : {}\nTemplate    : &lt;template xmlns=\"http://schemas.microsoft.com/win/2004/08/events\">\n                &lt;data name=\"SubjectUserSid\" inType=\"win:SID\" outType=\"xs:string\"/>\n                &lt;data name=\"SubjectUserName\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"SubjectDomainName\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"SubjectLogonId\" inType=\"win:HexInt64\" outType=\"win:HexInt64\"/>\n                &lt;data name=\"ObjectServer\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"ObjectType\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"ObjectName\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"HandleId\" inType=\"win:Pointer\" outType=\"win:HexInt64\"/>\n                &lt;data name=\"AccessList\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"AccessMask\" inType=\"win:HexInt32\" outType=\"win:HexInt32\"/>\n                &lt;data name=\"ProcessId\" inType=\"win:Pointer\" outType=\"win:HexInt64\"/>\n                &lt;data name=\"ProcessName\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;data name=\"ResourceAttributes\" inType=\"win:UnicodeString\" outType=\"xs:string\"/>\n                &lt;/template>\n\nDescription : An attempt was made to access an object.\n\n                Subject:\n                    Security ID:        %1\n                    Account Name:        %2\n                    Account Domain:        %3\n                    Logon ID:        %4\n\n                Object:\n                    Object Server:        %5\n                    Object Type:        %6\n                    Object Name:        %7\n                    Handle ID:        %8\n                    Resource Attributes:    %13\n\n                Process Information:\n                    Process ID:        %11\n                    Process Name:        %12\n\n                Access Request Information:\n                    Accesses:        %9\n                    Access Mask:        %10</code></pre></div>\n<p>Ashley McGlone has written goot article describing this things in more details: <a href=\"http://blogs.technet.com/b/ashleymcglone/archive/2013/08/28/powershell-get-winevent-xml-madness-getting-details-from-event-logs.aspx\">http://blogs.technet.com/b/ashleymcglone/archive/2013/08/28/powershell-get-winevent-xml-madness-getting-details-from-event-logs.aspx</a></p>\n<p>So, now we can query our log to see what happens like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$Target</span> = <span class=\"token string\">'C:\\Projects'</span>\n\n<span class=\"token variable\">$EVENT_DATA_OBJECT_NAME_INDEX</span> = 6\n<span class=\"token variable\">$EVENT_DATA_ACCESS_MASK_INDEX</span> = 9\n<span class=\"token variable\">$EVENT_DATA_PROCESS_NAME_INDEX</span> = 11\n\n<span class=\"token variable\">$ObjectNameExpression</span> = @<span class=\"token punctuation\">{</span>\n    Name = <span class=\"token string\">'ObjectName'</span>\n    Expression = <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>ReplacementStrings<span class=\"token punctuation\">[</span><span class=\"token variable\">$EVENT_DATA_OBJECT_NAME_INDEX</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$AccessMaskExpression</span> = @<span class=\"token punctuation\">{</span>\n    Name = <span class=\"token string\">'AccessMask'</span>\n    Expression = <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>ReplacementStrings<span class=\"token punctuation\">[</span><span class=\"token variable\">$EVENT_DATA_ACCESS_MASK_INDEX</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$ActionExpression</span> = @<span class=\"token punctuation\">{</span>\n    Name = <span class=\"token string\">'Action'</span>\n    Expression = <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$AccessMask</span> = <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>ReplacementStrings<span class=\"token punctuation\">[</span><span class=\"token variable\">$EVENT_DATA_ACCESS_MASK_INDEX</span><span class=\"token punctuation\">]</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$AccessMask</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">'0x10000'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'DELETE'</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">elseif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$AccessMask</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">'0x2'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'WRITE'</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">elseif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$AccessMask</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">'0x4'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'APPEND'</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">elseif</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$AccessMask</span> <span class=\"token operator\">-eq</span> <span class=\"token string\">'0x6'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'WRITE|APPEND'</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token string\">'Unknown '</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$AccessMask</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$ProcessNameExpression</span> = @<span class=\"token punctuation\">{</span>\n    Name = <span class=\"token string\">'ProcessName'</span>\n    Expression = <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>ReplacementStrings<span class=\"token punctuation\">[</span><span class=\"token variable\">$EVENT_DATA_PROCESS_NAME_INDEX</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">#Get-EventLog -LogName Security -InstanceId 4663 -After (Get-Date).AddHours(-2) | select TimeWritten, $ObjectNameExpression, $AccessMaskExpression, $ProcessNameExpression | where ObjectName -Like ($Target + '*') | where AccessMask -in '0x10000', '0x2', '0x4', '0x6' | ft -AutoSize</span>\n\n<span class=\"token variable\">$PastHourFileSystemSecurityLogEvents</span> = <span class=\"token function\">Get-EventLog</span> <span class=\"token operator\">-</span>LogName Security <span class=\"token operator\">-</span>InstanceId 4663 <span class=\"token operator\">-</span>After <span class=\"token punctuation\">(</span><span class=\"token function\">Get-Date</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>AddHours<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>3<span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$Projection</span> = <span class=\"token variable\">$PastHourFileSystemSecurityLogEvents</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">select</span> TimeWritten<span class=\"token punctuation\">,</span> <span class=\"token variable\">$ObjectNameExpression</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$AccessMaskExpression</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ActionExpression</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ProcessNameExpression</span>\n<span class=\"token variable\">$FilterDesiredObject</span> = <span class=\"token variable\">$Projection</span> <span class=\"token punctuation\">|</span> where ObjectName <span class=\"token operator\">-Like</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$Target</span> <span class=\"token operator\">+</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span>\n<span class=\"token variable\">$FilterDesiredActions</span> = <span class=\"token variable\">$FilterDesiredObject</span> <span class=\"token punctuation\">|</span> where AccessMask <span class=\"token operator\">-in</span> <span class=\"token string\">'0x10000'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0x2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0x4'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0x6'</span>\n<span class=\"token variable\">$FilterDesiredActions</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">ft</span> <span class=\"token operator\">-</span>AutoSize</code></pre></div>\n<p>Which will give you:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">TimeWritten         ObjectName                        AccessMask Action ProcessName\n-----------         ----------                        ---------- ------ -----------\n09.05.2015 13:32:39 C:\\Projects                       0x2        WRITE  C:\\Windows\\explorer.exe\n09.05.2015 13:32:39 C:\\Projects\\foo.txt               0x10000    DELETE C:\\Windows\\explorer.exe\n09.05.2015 12:43:23 C:\\Projects                       0x2        WRITE  C:\\Windows\\explorer.exe\n09.05.2015 12:43:23 C:\\Projects\\New Text Document.txt 0x10000    DELETE C:\\Windows\\explorer.exe</code></pre></div>\n<p>Take a note here, all this can be written in one line, it is just a note for me to remember how this is done.</p>\n<p>As about event viewer you can use something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$xml</span> = @<span class=\"token string\">\"\n&lt;QueryList>\n&lt;Query Id=\"</span>0<span class=\"token string\">\" Path=\"</span>Security<span class=\"token string\">\">\n&lt;Select Path=\"</span>Security<span class=\"token string\">\">\n*[EventData[Data[@Name='ObjectServer'] and (Data='Security')]]\nand\n*[EventData[Data[@Name='ObjectType'] and (Data='File')]]\nand\n*[EventData[Data[@Name='AccessMask'] and (Data='0x10000' or Data='0x2' or Data='0x4' or Data='0x6')]]\nand\n*[System[(EventID=4663)]]\n&lt;/Select>\n&lt;/Query>\n&lt;/QueryList>\n\"</span>@\n<span class=\"token function\">Get-WinEvent</span> <span class=\"token operator\">-</span>FilterXml <span class=\"token variable\">$xml</span></code></pre></div>\n<p>But unfortunatelly <code class=\"language-text\">starts-with</code> is not supported, so you can only see all security events.</p>\n<h2>What next?</h2>\n<p>Imagine you have two machines: <em>MachineA</em>, <em>MachineB</em> each of them have <em>Projects</em> folder which you want to sync.</p>\n<p>You can not use <em>Dropbox</em>, <em>OneDrive</em> etc just because they <strong>do not allow</strong> to ignore specific folders.</p>\n<p>You do not want use <em>BitTorrent Sync</em> just because you do not like it.</p>\n<p>You can: Configure watching for changes in desired folders on each machine.</p>\n<p>Then by event or schedule check which machine has latest changes and run <em>robocopy</em> to sync them. With robocopy you will be able to exclude folders like <em>node_modules</em> from being synced - profit.</p>\n<p>Note: To not get into infinite loop - while checking last changes you should filter changes made by robocopy itself, this is why we are looking at <code class=\"language-text\">ProcessName</code> in logs.</p>"}},"pageContext":{"id":"ae16f496-87dd-59f0-a4c5-035f4939d53b"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/c-convert-rtf-to-txt-using-word","result":{"data":{"remark":{"fields":{"path":"c-convert-rtf-to-txt-using-word"},"meta":{"title":""},"headings":[{"value":"C# convert rtf to txt using word"}],"html":"<h1>C# convert rtf to txt using word</h1>\n<p>Необходимо было сконвертировать порядка 20 тыс. файлов.</p>\n<p>Либы конвертеры - дают плохой результат.</p>\n<p>Единственным нормальным решением оказалось: програмно открывать в Word'е документ и сохранять его как текстовый файл.</p>\n<p>Далее вырезки кода:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">List<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span> file_pathes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">List<span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> total_files <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> path<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> pathes <span class=\"token operator\">=</span> Directory<span class=\"token punctuation\">.</span><span class=\"token function\">GetFiles</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> p <span class=\"token keyword\">in</span> pathes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        file_pathes<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    pathes <span class=\"token operator\">=</span> Directory<span class=\"token punctuation\">.</span><span class=\"token function\">GetDirectories</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> p <span class=\"token keyword\">in</span> pathes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">r</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">button1_Click</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">r</span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"C:\\Users\\mac\\Desktop\\2convert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    total_files <span class=\"token operator\">=</span> file_pathes<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//OBJECT OF MISSING \"NULL VALUE\"</span>\n    <span class=\"token class-name\">Object</span> oMissing <span class=\"token operator\">=</span> System<span class=\"token punctuation\">.</span>Reflection<span class=\"token punctuation\">.</span>Missing<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//OBJECTS OF FALSE AND TRUE</span>\n    <span class=\"token class-name\">Object</span> oTrue <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Object</span> oFalse <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//CREATING OBJECTS OF WORD AND DOCUMENT</span>\n    <span class=\"token class-name\">Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>Application</span> oWord <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>Application</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>Document</span> oWordDoc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>Document</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//SETTING THE VISIBILITY TO TRUE</span>\n    oWord<span class=\"token punctuation\">.</span>Visible <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> c <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">DateTime</span> dts <span class=\"token operator\">=</span> DateTime<span class=\"token punctuation\">.</span>Now<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> f <span class=\"token keyword\">in</span> file_pathes<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> dir <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetDirectoryName</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> n <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetFileNameWithoutExtension</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> ext <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetExtension</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> np <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">Combine</span><span class=\"token punctuation\">(</span>dir<span class=\"token punctuation\">,</span> n <span class=\"token operator\">+</span> <span class=\"token string\">\".txt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">==</span> <span class=\"token string\">\"Business Growth Hypothesis\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ext <span class=\"token operator\">!=</span> <span class=\"token string\">\"txt\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">long</span></span> size <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>File<span class=\"token punctuation\">.</span><span class=\"token function\">Exists</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token class-name\">FileInfo</span> fInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">FileInfo</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                size <span class=\"token operator\">=</span> fInfo<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>File<span class=\"token punctuation\">.</span><span class=\"token function\">Exists</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> size <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token class-name\">Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>Document</span> oDoc <span class=\"token operator\">=</span> oWord<span class=\"token punctuation\">.</span>Documents<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    oDoc<span class=\"token punctuation\">.</span><span class=\"token function\">SaveAs2</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">,</span> Microsoft<span class=\"token punctuation\">.</span>Office<span class=\"token punctuation\">.</span>Interop<span class=\"token punctuation\">.</span>Word<span class=\"token punctuation\">.</span>WdSaveFormat<span class=\"token punctuation\">.</span>wdFormatText<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    oDoc<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span>oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">,</span> oMissing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{</span>\n                    textBox2<span class=\"token punctuation\">.</span>Text <span class=\"token operator\">+=</span> f <span class=\"token operator\">+</span> Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">;</span>\n                    <span class=\"token comment\">//MessageBox.Show(f, \"ERROR\");</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        c<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">DateTime</span> dtc <span class=\"token operator\">=</span> DateTime<span class=\"token punctuation\">.</span>Now<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> p <span class=\"token operator\">=</span> c <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>total_files <span class=\"token operator\">/</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">TimeSpan</span> dtts <span class=\"token operator\">=</span> dtc<span class=\"token punctuation\">.</span><span class=\"token function\">Subtract</span><span class=\"token punctuation\">(</span>dts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">double</span></span> s <span class=\"token operator\">=</span> dtts<span class=\"token punctuation\">.</span>Seconds<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> s <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">double</span></span> sr <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>total_files <span class=\"token operator\">-</span> c<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">/</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">TimeSpan</span> ddd <span class=\"token operator\">=</span> DateTime<span class=\"token punctuation\">.</span>Now<span class=\"token punctuation\">.</span><span class=\"token function\">AddSeconds</span><span class=\"token punctuation\">(</span>sr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Subtract</span><span class=\"token punctuation\">(</span>DateTime<span class=\"token punctuation\">.</span>Now<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> m <span class=\"token operator\">=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{1}/{0} ({2}%)\"</span><span class=\"token punctuation\">,</span> total_files<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"time elapsed: {0}\"</span><span class=\"token punctuation\">,</span> dtts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> <span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"time remaining: {0}\"</span><span class=\"token punctuation\">,</span> ddd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">;</span>\n        m <span class=\"token operator\">+=</span> f<span class=\"token punctuation\">;</span>\n\n        textBox1<span class=\"token punctuation\">.</span>Text <span class=\"token operator\">=</span> m<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//Microsoft.Office.Interop.Word.Document oDoc = oWord.Documents.Open(@\"C:\\Users\\mac\\Desktop\\2convert\\12000termpapers\\Educational Studies (224)\\acid rain.rtf\", oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing);</span>\n    <span class=\"token comment\">//oDoc.SaveAs2(@\"C:\\Users\\mac\\Desktop\\xxx.txt\", Microsoft.Office.Interop.Word.WdSaveFormat.wdFormatText, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing);</span>\n    <span class=\"token comment\">//oDoc.Close();</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Для работы необходимо добавить референсы на: <code class=\"language-text\">Microsoft.Office.Core</code> и <code class=\"language-text\">Microsoft.Office.Interop.Word</code></p>"}},"pageContext":{"id":"a14fbbd0-89c8-5b63-98a5-0a6526008abd"}},"staticQueryHashes":[]}
{"componentChunkName":"component---src-templates-note-js","path":"/kubernetes-single-node-elasticsearch/","result":{"data":{"remark":{"fields":{"path":"kubernetes-single-node-elasticsearch"},"meta":{"title":""},"headings":[{"value":"kubernetes single node elasticsearch"},{"value":"Step 4: Elastic"},{"value":"Step 5: Test for persistence"},{"value":"Notes"},{"value":"TODO"}],"html":"<h1>kubernetes single node elasticsearch</h1>\n<h2>Step 1: Disk</h2>\n<p><strong>Note:</strong> this step is only for cloud, for local can be skipped, idea here to be able to control disk name and type, otherwise kubernetes will create disk with uuid name which is hard to manage in future</p>\n<p>Go to <a href=\"https://console.cloud.google.com/compute/disks?project=majestic-cairn-171208\">disks management</a> and create one</p>\n<ul>\n<li>Name: es1</li>\n<li>Description: disk for \"es1\" pod in kubernetes</li>\n<li>Type: SSD persistent disk</li>\n<li>Zone: europe-west1-b</li>\n<li>Size (GB): 10</li>\n</ul>\n<h2>Step 2: Password</h2>\n<p><strong>create password secret</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret generic es1 --from-literal<span class=\"token operator\">=</span>password<span class=\"token operator\">=</span><span class=\"token string\">'xxxxxxx'</span></code></pre></div>\n<p>Notes:</p>\n<ul>\n<li><strong>es1</strong> is the name of secret at will be used later, keep eye on it and do not forget to rename it</li>\n<li>on the other hand it can be optional and you can reuse already created secret</li>\n</ul>\n<h2>Step 3: Persistent Volume</h2>\n<p>For local kubernetes use:</p>\n<p><strong>local.yml</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pv\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> manual\n  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Note: do not forget to change me</span>\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/Users/mac/Desktop/k8s-nginx-pvc/elastic/data\"</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pvc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> manual\n  <span class=\"token key atrule\">volumeName</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pv\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10G</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> local.yml\nkubectl get <span class=\"token function\">pv</span>\nkubectl get pvc</code></pre></div>\n<p>For cloud kubernetes:</p>\n<p><strong>cloud.yml</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pv\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10G\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">gcePersistentDisk</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># https://console.cloud.google.com/compute/disksDetail/zones/europe-west1-b/disks/es1?project=majestic-cairn-171208</span>\n    <span class=\"token key atrule\">pdName</span><span class=\"token punctuation\">:</span> es1\n    <span class=\"token key atrule\">fsType</span><span class=\"token punctuation\">:</span> ext4\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pvc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token key atrule\">volumeName</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pv\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10G</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> cloud.yml\nkubectl get <span class=\"token function\">pv</span>\nkubectl get pvc</code></pre></div>\n<p>Notes:</p>\n<ul>\n<li>use same <strong>metadata.name</strong>Â for both local and cloud persisten volumes to prevent misunderstunding</li>\n<li><strong>gcePersistentDisk.pdName</strong> is a disk name you have created in step 1</li>\n<li><strong>capacity.storage</strong> can not be bigger than a disk space</li>\n<li><a href=\"https://www.youtube.com/watch?v=VB7vI9OT-WQ\">kubernetes persistent volume 5 minutes video</a></li>\n</ul>\n<h1>Step 4: Elastic</h1>\n<p><strong>elastic.yml</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> es1\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">prometheus.io/scrape</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n    <span class=\"token key atrule\">prometheus.io/port</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"9114\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runAsUser</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n    <span class=\"token key atrule\">runAsGroup</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n    <span class=\"token key atrule\">fsGroup</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n      <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> es1<span class=\"token punctuation\">-</span>pvc\n  <span class=\"token key atrule\">initContainers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> init<span class=\"token punctuation\">-</span>sysctl\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n      <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> sysctl\n        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>w\n        <span class=\"token punctuation\">-</span> vm.max_map_count=262144\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.elastic.co/elasticsearch/elasticsearch<span class=\"token punctuation\">:</span>7.5.0\n      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9200</span>\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># The heap size should be half the size of RAM allocated to the Pod - https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-managing-compute-resources.html#k8s-compute-resources-elasticsearch</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ES_JAVA_OPTS\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span>Xms1g <span class=\"token punctuation\">-</span>Xmx1g\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ELASTIC_PASSWORD\n          <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n              <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> password\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> node.name\n          <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> metadata.name\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cluster.name\n          <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> metadata.name\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> xpack.security.enabled\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> discovery.type\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> single<span class=\"token punctuation\">-</span>node\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> bootstrap.memory_lock\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 2G\n        <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 2G\n      <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> bash\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>c\n            <span class=\"token punctuation\">-</span> curl <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fail <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>silent <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>output /dev/null <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>user elastic<span class=\"token punctuation\">:</span>$ELASTIC_PASSWORD localhost<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span>\n        <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n        <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n        <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n        <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n      <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> bash\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>c\n            <span class=\"token punctuation\">-</span> curl <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>fail <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>silent <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>output /dev/null <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>user elastic<span class=\"token punctuation\">:</span>$ELASTIC_PASSWORD localhost<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span>\n        <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n        <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n        <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n        <span class=\"token key atrule\">capabilities</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> IPC_LOCK\n            <span class=\"token punctuation\">-</span> SYS_RESOURCE\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /usr/share/elasticsearch/data\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> exporter\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> justwatch/elasticsearch_exporter\n      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9114</span>\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ELASTIC_PASSWORD\n          <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n              <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> password\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ES_URI\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//elastic<span class=\"token punctuation\">:</span>$(ELASTIC_PASSWORD)@localhost<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ES_INDICES\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ES_SHARDS\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kibana1\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kibana1\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">initContainers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> init<span class=\"token punctuation\">-</span>myservice\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> sh\n        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>c\n        <span class=\"token punctuation\">-</span> until nslookup es1; do echo waiting for es1; sleep 2; done;\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kibana1\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.elastic.co/kibana/kibana<span class=\"token punctuation\">:</span>7.5.0\n      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5601</span>\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ES_JAVA_OPTS\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span>Xms512m <span class=\"token punctuation\">-</span>Xmx512m\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ELASTICSEARCH_HOSTS\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//es1<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ELASTICSEARCH_USERNAME\n          <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> elastic\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ELASTICSEARCH_PASSWORD\n          <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n              <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> password\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Default limits applied by the operator</span>\n        <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1G\n        <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1G\n      <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">tcpSocket</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5601</span>\n        <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n        <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n        <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n        <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n      <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">tcpSocket</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5601</span>\n        <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n        <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n        <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> es1\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9200</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> es1\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kibana1\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5601</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kibana1</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token parameter variable\">-f</span> elastic.yml</code></pre></div>\n<h1>Step 5: Test for persistence</h1>\n<p><strong>save document</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token builtin class-name\">exec</span> es1 -- <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'curl -s -u elastic:$ELASTIC_PASSWORD -H \"Content-Type: application/json\" localhost:9200/test/doc/1 -d \"{\\\\\"foo\\\\\": \\\\\"bar\\\\\"}\"'</span></code></pre></div>\n<p><strong>retrieve document</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token builtin class-name\">exec</span> es1 -- <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'curl -s -u elastic:$ELASTIC_PASSWORD -H \"Content-Type: application/json\" localhost:9200/test/doc/1'</span></code></pre></div>\n<p><strong>kill elastic</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token builtin class-name\">exec</span> es1 -- <span class=\"token function\">kill</span> <span class=\"token number\">1</span></code></pre></div>\n<p>Wait for elastic to be up and running again</p>\n<p><strong>retrieve document</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token builtin class-name\">exec</span> es1 -- <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'curl -s -u elastic:$ELASTIC_PASSWORD -H \"Content-Type: application/json\" localhost:9200/test/doc/1'</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># Cleanup</span>\n\nkubectl delete <span class=\"token parameter variable\">-f</span> elastic.yml\nkubectl delete pvc es1-pvc\nkubectl delete <span class=\"token function\">pv</span> es1-pv</code></pre></div>\n<h1>Notes</h1>\n<p>Persistent volumes - are reservations for disks, persisten volume claims - are reservations on top of PV</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get <span class=\"token function\">pv</span>\nkubectl get pvc\nkubectl delete pvc es1-pvc\nkubectl delete <span class=\"token function\">pv</span> es1-pv</code></pre></div>\n<h1>TODO</h1>\n<p>https/ssl</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--rm</span> <span class=\"token parameter variable\">-v</span> <span class=\"token environment constant\">$PWD</span>/certs:/certs <span class=\"token parameter variable\">-w</span> /certs docker.elastic.co/elasticsearch/elasticsearch:7.5.0 elasticsearch-certutil ca <span class=\"token parameter variable\">--days</span> <span class=\"token number\">9999</span> <span class=\"token parameter variable\">--out</span> /certs/elastic-stack-ca.p12 <span class=\"token parameter variable\">--pass</span> <span class=\"token string\">\"\"</span> <span class=\"token parameter variable\">--silent</span>\n\n<span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-it</span> <span class=\"token parameter variable\">--rm</span> <span class=\"token parameter variable\">-v</span> <span class=\"token environment constant\">$PWD</span>/certs:/certs <span class=\"token parameter variable\">-w</span> /certs docker.elastic.co/elasticsearch/elasticsearch:7.5.0 elasticsearch-certutil cert <span class=\"token parameter variable\">--ca</span> /certs/elastic-stack-ca.p12 --ca-pass <span class=\"token string\">\"\"</span> <span class=\"token parameter variable\">--days</span> <span class=\"token number\">9999</span> <span class=\"token parameter variable\">--out</span> /certs/elastic-certificates.p12 <span class=\"token parameter variable\">--pass</span> <span class=\"token string\">\"\"</span> <span class=\"token parameter variable\">--silent</span></code></pre></div>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls-docker.html\">https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls-docker.html</a></p>\n<p><a href=\"http://codingfundas.com/setting-up-elasticsearch-6-8-with-kibana-and-x-pack-security-enabled/index.html\">http://codingfundas.com/setting-up-elasticsearch-6-8-with-kibana-and-x-pack-security-enabled/index.html</a></p>\n<p><a href=\"https://alexmarquardt.com/2018/11/05/security-tls-ssl-pki-authentication-in-elasticsearch/\">https://alexmarquardt.com/2018/11/05/security-tls-ssl-pki-authentication-in-elasticsearch/</a></p>\n<p><a href=\"https://www.elastic.co/blog/configuring-ssl-tls-and-https-to-secure-elasticsearch-kibana-beats-and-logstash\">https://www.elastic.co/blog/configuring-ssl-tls-and-https-to-secure-elasticsearch-kibana-beats-and-logstash</a></p>\n<p>oidc auth via identity server?</p>"}},"pageContext":{"id":"b862a2b8-c55a-516b-845e-5d559ef2f792"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/modx-anithing-rating-menuindex/","result":{"data":{"remark":{"fields":{"path":"modx-anithing-rating-menuindex"},"meta":{"title":""},"headings":[{"value":"Modx Anithing rating & menuindex"}],"html":"<h1>Modx Anithing rating &#x26; menuindex</h1>\n<p>В моем случае необходимо подправлять menuindex в зависимости от того какой рейтинг стоит у документа:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> modx_site_content <span class=\"token keyword\">AS</span> cnt\n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">SELECT</span>\n        t1<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">IF</span><span class=\"token punctuation\">(</span>CAST<span class=\"token punctuation\">(</span>IFNULL<span class=\"token punctuation\">(</span>t2<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> SIGNED<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n            ABS<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>CAST<span class=\"token punctuation\">(</span>IFNULL<span class=\"token punctuation\">(</span>t3<span class=\"token punctuation\">.</span>rating<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> SIGNED<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">99</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> menuindex\n        <span class=\"token keyword\">FROM</span> modx_site_content <span class=\"token keyword\">as</span> t1\n        <span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> modx_site_tmplvar_contentvalues <span class=\"token keyword\">as</span> t2\n        <span class=\"token keyword\">ON</span> t1<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> t2<span class=\"token punctuation\">.</span>contentid <span class=\"token operator\">AND</span> t2<span class=\"token punctuation\">.</span>tmplvarid <span class=\"token operator\">=</span> <span class=\"token number\">31</span>\n        <span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> modx_atRating_grpsalon <span class=\"token keyword\">as</span> t3\n        <span class=\"token keyword\">ON</span> t3<span class=\"token punctuation\">.</span>rating_id <span class=\"token operator\">=</span> t1<span class=\"token punctuation\">.</span>id\n        <span class=\"token keyword\">WHERE</span> t1<span class=\"token punctuation\">.</span>template <span class=\"token operator\">=</span> <span class=\"token number\">7</span>\n        <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> menuindex <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">,</span> id <span class=\"token keyword\">ASC</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> val\n<span class=\"token keyword\">ON</span> cnt<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> val<span class=\"token punctuation\">.</span>id\n<span class=\"token keyword\">SET</span> cnt<span class=\"token punctuation\">.</span>menuindex <span class=\"token operator\">=</span> val<span class=\"token punctuation\">.</span>menuindex</code></pre></div>"}},"pageContext":{"id":"1865fea1-ab20-5ff2-b7d4-e74c450de438"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/confluence-cloud-api/","result":{"data":{"remark":{"fields":{"path":"confluence-cloud-api"},"meta":{"title":""},"headings":[{"value":"Confluence Cloud API"}],"html":"<h1>Confluence Cloud API</h1>\n<p><a href=\"https://confluence.atlassian.com/doc/confluence-storage-format-790796544.html\">Formatting</a></p>\n<p>Update confluence doc</p>\n<div class=\"gatsby-highlight\" data-language=\"ps1\"><pre class=\"language-ps1\"><code class=\"language-ps1\">$headers = @{\n    &#39;Accept&#39; = &#39;application/json&#39;\n    &#39;Content-Type&#39; = &#39;application/json&#39;\n    &#39;Authorization&#39; = (&quot;Basic {0}&quot; -f ([Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes((&quot;{0}:{1}&quot; -f &#39;alexandrm@rabota.ua&#39;, &#39;**************&#39;)))))\n}\n$document = Invoke-RestMethod -Uri &#39;https://rabota.atlassian.net/wiki/rest/api/content/35291510?expand=body.storage,version.number&#39; -Headers $headers\n$document.version.number = $document.version.number + 1\n$document.body.storage.value = &#39;Hello World from PowerShell&#39;\ntry {\nInvoke-RestMethod -Method Put -Uri &#39;https://rabota.atlassian.net/wiki/rest/api/content/35291510&#39; -Headers $headers -Body ([System.Text.Encoding]::UTf8.GetBytes(($document | ConvertTo-Json -Depth 100 -Compress)))\nWrite-Host &quot;Success&quot; -ForegroundColor Green\n} catch {\n    $result = $_.Exception.Response.GetResponseStream()\n    $reader = New-Object System.IO.StreamReader($result)\n    $reader.BaseStream.Position = 0\n    $reader.DiscardBufferedData()\n    $body = $reader.ReadToEnd()\n    Write-Host $body -ForegroundColor Red\n}\n</code></pre></div>\n<p>Note: confluence will fail with error like <code class=\"language-text\">Content body cannot be converted to new editor format</code></p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> http<span class=\"token punctuation\">.</span>client <span class=\"token keyword\">import</span> HTTPSConnection\n<span class=\"token keyword\">from</span> base64 <span class=\"token keyword\">import</span> b64encode\n<span class=\"token keyword\">import</span> json\n\n<span class=\"token comment\"># Step 0 - preparations, instead of password API token should be used, can be retrieved here: https://id.atlassian.com/manage/api-tokens</span>\ncon <span class=\"token operator\">=</span> HTTPSConnection<span class=\"token punctuation\">(</span><span class=\"token string\">\"rabota.atlassian.net\"</span><span class=\"token punctuation\">)</span>\nheaders <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'Accept'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Authorization'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'Basic %s'</span> <span class=\"token operator\">%</span>  b64encode<span class=\"token punctuation\">(</span><span class=\"token string\">b\"alexandrm@rabota.ua:************\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"ascii\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Step 1 - retrieve document</span>\ncon<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/wiki/rest/api/content/35520689?expand=body.storage,version.number'</span><span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span>\ndata <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>con<span class=\"token punctuation\">.</span>getresponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Current version number:'</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'number'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Current body storage value:'</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'storage'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Step 2 - change it, note that document should be formatted as described here https://confluence.atlassian.com/doc/confluence-storage-format-790796544.html</span>\ndata<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'number'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'number'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\ndata<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'storage'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World from Python'</span>\n\n<span class=\"token comment\"># Step 3 - save it</span>\ncon<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">'PUT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'/wiki/rest/api/content/35520689'</span><span class=\"token punctuation\">,</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> con<span class=\"token punctuation\">.</span>getresponse<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span>reason<span class=\"token punctuation\">)</span></code></pre></div>"}},"pageContext":{"id":"aa101b9c-4d0b-587f-a177-bf2c4ae33808"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/pre-commit-hook-to-prevent-non-utf8-files/","result":{"data":{"remark":{"fields":{"path":"pre-commit-hook-to-prevent-non-utf8-files"},"meta":{"title":""},"headings":[{"value":"git pre commit hook to prevent non utf8 files"}],"html":"<h1>git pre commit hook to prevent non utf8 files</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token comment\"># Redirect output to stderr.</span>\n<span class=\"token builtin class-name\">exec</span> <span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span><span class=\"token file-descriptor important\">&amp;2</span>\n\n<span class=\"token assign-left variable\">result</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">f</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> <span class=\"token parameter variable\">--cached</span> --name-only<span class=\"token variable\">`</span></span>\n<span class=\"token keyword\">do</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token environment constant\">$OSTYPE</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"darwin16\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">output</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">file</span> <span class=\"token parameter variable\">-I</span> $f<span class=\"token variable\">)</span></span>\"</span>\n    <span class=\"token keyword\">else</span>\n    <span class=\"token assign-left variable\">output</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">file</span> <span class=\"token parameter variable\">-i</span> $f<span class=\"token variable\">)</span></span>\"</span>\n    <span class=\"token keyword\">fi</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$output</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-E</span> <span class=\"token string\">\"charset=(utf-8|us-ascii)\"</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token variable\">$output</span> - should be utf8\"</span>\n        <span class=\"token assign-left variable\">result</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span>\n\n<span class=\"token builtin class-name\">exit</span> <span class=\"token variable\">$result</span></code></pre></div>\n<p>Example of pre commit hook that will prevent commits with non utf8 files</p>\n<p>Notes:</p>\n<ul>\n<li><code class=\"language-text\">git diff --cached --name-only</code> - check only staged files</li>\n<li><code class=\"language-text\">file -I</code> and <code class=\"language-text\">file -I</code> - in macos file utility has different flag</li>\n<li><code class=\"language-text\">us-ascii</code> - file in ascii and containing only english letters is valid utf8 file</li>\n</ul>"}},"pageContext":{"id":"145e3156-554c-5920-9dfb-233c45a59888"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/zend-gdata-analytics-get-next-results-set","result":{"data":{"remark":{"fields":{"path":"zend-gdata-analytics-get-next-results-set"},"meta":{"title":""},"headings":[{"value":"Zend gdata analytics get next results set"}],"html":"<h1>Zend gdata analytics get next results set</h1>\n<p>gdata возвращает по умолчанию до 1000 результатов, можно выставить максимум 10 тыс. но если и этого мало - то надо делать серию запросов с использованием max-results и start-index.</p>\n<p>Благо в либе Zend Gdata уже предусмотрели все это дело и добавили метод getNextFeed</p>\n<p>Пример:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$email</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"LOGIN@gmail.com\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"PASSWORD\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$siteId</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"ga:2266524\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Y-m-01\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$startDate</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Y-m-d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Y-m-d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDate</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\" -6 month\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$endDate</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Y-m-d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Y-m-d\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$currentDate</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\" -0 month\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Zend/Loader.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name static-context\">Zend_Loader</span><span class=\"token operator\">::</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Zend_Gdata'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name static-context\">Zend_Loader</span><span class=\"token operator\">::</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Zend_Gdata_Query'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name static-context\">Zend_Loader</span><span class=\"token operator\">::</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Zend_Gdata_ClientLogin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$client</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">Zend_Gdata_ClientLogin</span><span class=\"token operator\">::</span><span class=\"token function\">getHttpClient</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$email</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pass</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"analytics\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$gdClient</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Zend_Gdata</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$client</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$reportURL</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"https://www.google.com/analytics/feeds/data\"</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"?start-date=\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$startDate</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"&amp;end-date=\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$endDate</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"&amp;dimensions=ga:month,ga:browser,ga:browserVersion\"</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"&amp;metrics=ga:pageviews\"</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"&amp;sort=ga:month\"</span> <span class=\"token operator\">.</span>\n    <span class=\"token comment\">//\"&amp;max-results=8\" .</span>\n    <span class=\"token string double-quoted-string\">\"&amp;filters=ga:browser%3D%3DFirefox,ga:browser%3D%3DOpera,ga:browser%3D%3DChrome,ga:browser%3D%3DInternet%20Explorer\"</span> <span class=\"token operator\">.</span>\n    <span class=\"token string double-quoted-string\">\"&amp;ids=\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$siteId</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$gdClient</span><span class=\"token operator\">-></span><span class=\"token function\">getFeed</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$reportURL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$results</span> <span class=\"token operator\">!=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$results</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&lt;br />'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$results</span><span class=\"token operator\">-></span><span class=\"token function\">getNextFeed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token variable\">$results</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"id":"535287e9-1508-565e-9d4b-a03092a7a561"}},"staticQueryHashes":[]}
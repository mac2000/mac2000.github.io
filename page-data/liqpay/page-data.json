{"componentChunkName":"component---src-templates-note-js","path":"/liqpay/","result":{"data":{"remark":{"fields":{"path":"liqpay"},"meta":{"title":""},"headings":[{"value":"liqpay"}],"html":"<h1>liqpay</h1>\n<p>Для приема платежей через liqpay нужно зарегистрироваться и получить <code class=\"language-text\">merchant_id</code> и <code class=\"language-text\">merchant_signature</code>, которые далее будут использованы для подписи запросов и проверки ответов.</p>\n<p>Собственно пример отправки на liqpay:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">require_once</span> <span class=\"token string single-quoted-string\">'config.php'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$xml</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'&lt;request>\n\t&lt;version>1.2&lt;/version>\n\t&lt;merchant_id>'</span> <span class=\"token operator\">.</span> <span class=\"token constant\">MERCHANT_ID</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/merchant_id>\n\t&lt;result_url>http://example.com/process.php&lt;/result_url>\n\t&lt;server_url>http://example.com/process.php&lt;/server_url>\n\t&lt;order_id>'</span> <span class=\"token operator\">.</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/order_id>\n\t&lt;amount>0.03&lt;/amount>\n\t&lt;currency>UAH&lt;/currency>\n\t&lt;description>test&lt;/description>\n\t&lt;default_phone>&lt;/default_phone>\n\t&lt;pay_way>&lt;/pay_way>\n\t&lt;goods_id>1234&lt;/goods_id>\n&lt;/request>'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$sign</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">sha1</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MERCHANT_SIGNATURE</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$xml</span> <span class=\"token operator\">.</span> <span class=\"token constant\">MERCHANT_SIGNATURE</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xml_encoded</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xml</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">doctype</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>liqpay<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.liqpay.com/?do=clickNbuy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>operation_xml<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?=</span> <span class=\"token variable\">$xml_encoded</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>signature<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?=</span> <span class=\"token variable\">$sign</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Информацию по полям xml можно подсмотреть в их доке <a href=\"https://liqpay.com/?do=pages&#x26;p=cnb12\">https://liqpay.com/?do=pages&#x26;p=cnb12</a></p>\n<p><code class=\"language-text\">result_url</code> - страница куда будет перенаправлен пользователь после проплаты в liqpay.</p>\n<p><code class=\"language-text\">server_url</code> - url который будет дергать liqpay после проплаты.</p>\n<p>Их можно указать одинаковыми - соотв. там же и проверяем и пишем в базу и показываем пользователю сообщение о том что все прошло успешно.</p>\n<p>Обработка ответа liqpay:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">require_once</span> <span class=\"token string single-quoted-string\">'config.php'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'REQUEST_METHOD'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'POST'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$xml_decoded</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'operation_xml'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token variable\">$xml</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleXMLElement</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xml_decoded</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">sha1</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MERCHANT_SIGNATURE</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$xml_decoded</span> <span class=\"token operator\">.</span> <span class=\"token constant\">MERCHANT_SIGNATURE</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'signature'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token comment\">// success, failure, wait_secure</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$xml</span><span class=\"token operator\">-></span><span class=\"token property\">status</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'success'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'&lt;h1>Success&lt;/h1>'</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'&lt;h1>Wrong Signature&lt;/h1>'</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'&lt;h1>Wrong Method&lt;/h1>'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Вот дамп того что происходит на этой страничке:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Success\n\n$_POST\n------\n\nArray\n(\n\t[operation_xml] => PHJlc3BvbnNlPgogIDxhY3Rpb24+cmVzdWx0X3VybDwvYWN0aW9uPgogIDxhbW91bnQ+MC4wMzwv\nYW1vdW50PgogIDxjdXJyZW5jeT5VQUg8L2N1cnJlbmN5PgogIDxkZXNjcmlwdGlvbj50ZXN0PC9k\nZXNjcmlwdGlvbj4KICA8Z29vZHNfaWQ+MTIzNDwvZ29vZHNfaWQ+CiAgPG1lcmNoYW50X2lkPmk1\nMTg1NTQ5NDUxPC9tZXJjaGFudF9pZD4KICA8b3kZXJfaWQ+MTM4ODI3MDM2NTwvb3JkZXJfaWQ+\nCiAgPHBheV93YXk+bGlxcGF5PC9wYXlfd2F5PgogIDxwYXlzX2NvdW50Pjg8L3BheXNfY291bnQ+\nCiAgPHNlbmRlcl9waG9uZT4rMzgwOTQ5MjU0ODg1PC9zZW5kZXJfcGhvbmU+CiAgPHN0YXR1cz5z\ndWNjZXNzPC9zdGF0dXM+CiAgPHRyYW5zYWN0aW9uX2lkPjMzMDk3NzQyPC90cmFuc2FjdGlvbl9p\nZD4KICA8dmVyc2lvbj4xLjI8L3ZlcnNpb24+CjwvcmVzcG9uc2U+Cg==\n\n\t[signature] => 3PT3CmSld9MLD8qlmZtUZg8V28=\n)\n\n\n$xml_decoded\n------------\n\n&lt;response>\n\t&lt;action>result_url&lt;/action>\n\t&lt;amount>0.03&lt;/amount>\n\t&lt;currency>UAH&lt;/currency>\n\t&lt;description>test&lt;/description>\n\t&lt;goods_id>1234&lt;/goods_id>\n\t&lt;merchant_id>i3000545000&lt;/merchant_id>\n\t&lt;order_id>1388270365&lt;/order_id>\n\t&lt;pay_way>liqpay&lt;/pay_way>\n\t&lt;pays_count>8&lt;/pays_count>\n\t&lt;sender_phone>+380949250000&lt;/sender_phone>\n\t&lt;status>success&lt;/status>\n\t&lt;transaction_id>33097000&lt;/transaction_id>\n\t&lt;version>1.2&lt;/version>\n&lt;/response>\n\n\n$xml\n----\n\nSimpleXMLElement Object\n(\n\t[action] => result_url\n\t[amount] => 0.03\n\t[currency] => UAH\n\t[description] => test\n\t[goods_id] => 1234\n\t[merchant_id] => i3000545000\n\t[order_id] => 1388270365\n\t[pay_way] => liqpay\n\t[pays_count] => 8\n\t[sender_phone] => +380949250000\n\t[status] => success\n\t[transaction_id] => 33097000\n\t[version] => 1.2\n)\n\n\n$signature\n----------\n\n3PT3CmSld9MLD8qlmZtUZg8V28=</code></pre></div>\n<p>И еще один пример, проверки проплаты по id транзакции или заказа:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">require_once</span> <span class=\"token string single-quoted-string\">'config.php'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$request_xml</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleXMLElement</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;request>&lt;/request>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'version'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'action'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'view_transaction'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'merchant_id'</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MERCHANT_ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'transaction_id'</span> <span class=\"token comment\">/*, 33096903*/</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'transaction_order_id'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1388267638</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$request_xml</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">asXML</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$operation_xml</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$request_xml</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">sha1</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MERCHANT_SIGNATURE</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$request_xml</span> <span class=\"token operator\">.</span> <span class=\"token constant\">MERCHANT_SIGNATURE</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$request_xml</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleXMLElement</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;request>&lt;/request>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$operation_envelope</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'liqpay'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'operation_envelope'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$operation_envelope</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'operation_xml'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$operation_xml</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$operation_envelope</span><span class=\"token operator\">-></span><span class=\"token function\">addChild</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'signature'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$ch</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_init</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'https://www.liqpay.com/?do=api_xml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_HTTPHEADER</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Content-type: text/xml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_RETURNTRANSFER</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_SSL_VERIFYPEER</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_TIMEOUT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_POST</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_POSTFIELDS</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$request_xml</span><span class=\"token operator\">-></span><span class=\"token function\">asXML</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">curl_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$response_xml</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleXMLElement</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$xml_decoded</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$response_xml</span><span class=\"token operator\">-></span><span class=\"token property\">liqpay</span><span class=\"token operator\">-></span><span class=\"token property\">operation_envelope</span><span class=\"token operator\">-></span><span class=\"token property\">operation_xml</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$xml</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleXMLElement</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xml_decoded</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">sha1</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MERCHANT_SIGNATURE</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$xml_decoded</span> <span class=\"token operator\">.</span> <span class=\"token constant\">MERCHANT_SIGNATURE</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$response_xml</span><span class=\"token operator\">-></span><span class=\"token property\">liqpay</span><span class=\"token operator\">-></span><span class=\"token property\">operation_envelope</span><span class=\"token operator\">-></span><span class=\"token property\">signature</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$xml</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>Ответ будет приблизительно таким:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SimpleXMLElement Object\n(\n\t[action] => view_transaction\n\t[merchant_id] => i3000545000\n\t[status] => success\n\t[transaction] => SimpleXMLElement Object\n\t\t(\n\t\t\t[id] => 33096000\n\t\t\t[amount] => 0.03\n\t\t\t[currency] => UAH\n\t\t\t[description] => test\n\t\t\t[from] => +380949000000\n\t\t\t[order_id] => 1388000638\n\t\t\t[pay_way] => liqpay\n\t\t\t[referer_url] => http://example.com/\n\t\t\t[status] => success\n\t\t\t[to] => +8200027866718\n\t\t)\n\n\t[transaction_id] => SimpleXMLElement Object\n\t\t(\n\t\t)\n\n\t[transaction_order_id] => 1388267000\n\t[version] => 1.2\n)</code></pre></div>"}},"pageContext":{"id":"eac33a13-50f1-5f7c-8c48-e4eb5c0a30ff"}},"staticQueryHashes":[],"slicesMap":{}}
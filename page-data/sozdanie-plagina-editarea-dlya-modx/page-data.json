{"componentChunkName":"component---src-templates-note-js","path":"/sozdanie-plagina-editarea-dlya-modx/","result":{"data":{"remark":{"fields":{"path":"sozdanie-plagina-editarea-dlya-modx"},"meta":{"title":""},"headings":[{"value":"Создание плагина EditArea для ModX"}],"html":"<h1>Создание плагина EditArea для ModX</h1>\n<h2>Аннотация</h2>\n<p>В ModX очень не удобное редактирование чанков и сниппетов. Админка этого движка предлагает заниматься этим в обычном текстовом поле еще и с совсем мелким шрифтом – что очень сильно напрягает.</p>\n<h2>Задача</h2>\n<p>Необходимо сделать так чтобы выполнять все эти работы можно было без бинокля</p>\n<h2>Решение</h2>\n<p>Для решения этой задачи будем использовать бесплатный редактор <a href=\"http://www.cdolivet.com/index.php?page=editArea\">EditArea</a>, который покрывает все пожелания которые только можно придумать.</p>\n<p>О том как прикрутить куда либо EditArea, я уже успел написать. Плагин уже тоже готов, и лежит <a href=\"http://code.google.com/p/modxeditarea/\">здесь</a>.</p>\n<p>Итак как и любой плагин, этот должен вешаться на события, естественно события связанные с рендером форм для чанков и сниппетов, а заодно и плагинов <code class=\"language-text\">OnChunkFormPreRender</code>, <code class=\"language-text\">OnSnipFormRender</code>, <code class=\"language-text\">OnPluginFormRender</code> (почему для чанков выбрано событие PreRender раскажу чуть позже).</p>\n<p>Естественно что писать с нуля никто ничего не собирался и первое что было сделано, это изучение встроенного плагина tinyMCE, по результатам которого выяснилось что можно еще и зарегистрировать сам редактор в системе, для этого надо повеситься на события <code class=\"language-text\">OnRichTextEditorRegister</code>, <code class=\"language-text\">OnRichTextEditorInit</code>.</p>\n<p>Не долго думая, код был скопирован, получилось вот такое:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$e</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">Event</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token property\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnRichTextEditorRegister\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"EditArea\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnRichTextEditorInit\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$editor</span><span class=\"token operator\">==</span><span class=\"token string double-quoted-string\">\"EditArea\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/edit_area/edit_area_full.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/ea_functions.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$elements</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\">initEditArea(\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$element</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'manager_language'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"html\")&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">default</span> <span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Что мы делаем:</p>\n<p><code class=\"language-text\">OnRichTextEditorRegister</code> – это событие вызывается когда система запрашивает список установленных редакторов, собственно тут наша задача, просто обозначить что мы существуем.</p>\n<p><code class=\"language-text\">OnRichTextEditorInit</code> – а вот тут уже по интереснее, это событие наступает когда юзер выбирает редактор, мы робко проверяем что выбрали именно нас и лепим необходимые яваскрипты в вывод. Так же нам передают массив элементов на которые нужно повесить редактор, мы для каждого из них вызываем функцию инициализации редактора, в которую передаем имя элемента, язык админки (это я уже потом добавил, для красоты пущей) и синтаксис подсветки по умолчанию (это нам надо потому что по умолчанию у чанков будет html, а вот у сниппетов и плагинов – php).</p>\n<p>Собственно содержимое файла <code class=\"language-text\">ea-functions.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">onEditAreaChanged</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> editAreaLoader<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getLangName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">lang</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>lang<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'english'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'en'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'russian'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'ru'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'russian-UTF8'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'ru'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'en'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">initEditArea</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el_name<span class=\"token punctuation\">,</span> lang<span class=\"token punctuation\">,</span> syntax</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> elements <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span>el_name<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>elements<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n  <span class=\"token keyword\">var</span> el <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">item</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> el<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>name\n\n  editAreaLoader<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">change_callback</span><span class=\"token operator\">:</span> <span class=\"token string\">'onEditAreaChanged'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">language</span><span class=\"token operator\">:</span> <span class=\"token string\">'ru'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">start_highlight</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allow_resize</span><span class=\"token operator\">:</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allow_toggle</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">word_wrap</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">syntax</span><span class=\"token operator\">:</span> syntax<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">toolbar</span><span class=\"token operator\">:</span> <span class=\"token string\">'undo, redo, |, select_font, |, syntax_selection, |, change_smooth_selection, highlight, reset_highlight, word_wrap'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">syntax_selection_allow</span><span class=\"token operator\">:</span> <span class=\"token string\">'css,html,js,php,xml,sql'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Собственно основная функция <code class=\"language-text\">initEditArea</code> только тем и занимается что создает редактор (там в самом начале еще небольшой шахер махер делается, потому что по умолчанию у текстовых полей нет id’ек, а редактору они нужны). Описывать остальные функции по моему вообще нет никакого смысле так как они ну до безобразия простые.</p>\n<p>И все заработало, теперь на страницах где есть выбор редактора – можно выбрать EditArea и будет счастье, я уже думал радоваться но не тут то было, оказалось что на страницах снипетов и плагинов, редактор не предпологается, поетому пришлось воевать дальше.</p>\n<p>Но, для начала, нужно было решить еще одну вещь, на страницах чанков по умолчанию редактор не используется, а я хочу чтобы использовался, вот именно для этого мы и вешаемся на событие <code class=\"language-text\">OnChunkFormPrerender</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnChunkFormPrerender\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">global</span> <span class=\"token variable\">$which_editor</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$which_editor</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'EditArea'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Вот так все просто оказалось. Как нашел – в файле <code class=\"language-text\">manager/actions/mutate_htmlsnippet.dynamic.php</code> – там видно что при генерации выпадайки с выбором редактора используется переменная <code class=\"language-text\">$which_editor</code>.</p>\n<p>Для сниппетов и плагинов, код одинаковый и выглядит так:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnSnipFormRender\"</span><span class=\"token punctuation\">:</span>\n<span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnPluginFormRender\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/edit_area/edit_area_full.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/ea_functions.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\">initEditArea(\"post\", \"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'manager_language'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"php\")&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Мы просто добавляем наши скрипты, и вызываем инициализацию редактора.</p>\n<p>Вот собственно и все.</p>\n<h2>Исходник плагина</h2>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/*    EVENTS\n    OnRichTextEditorRegister\n    OnRichTextEditorInit\n    OnChunkFormPrerender\n    OnSnipFormRender\n    OnPluginFormRender\n*/</span>\n<span class=\"token variable\">$e</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">Event</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token property\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnRichTextEditorRegister\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"EditArea\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnRichTextEditorInit\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$editor</span><span class=\"token operator\">==</span><span class=\"token string double-quoted-string\">\"EditArea\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/edit_area/edit_area_full.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/ea_functions.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$elements</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\">initEditArea(\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$element</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'manager_language'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"html\")&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnChunkFormPrerender\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">global</span> <span class=\"token variable\">$which_editor</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$which_editor</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'EditArea'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnSnipFormRender\"</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string double-quoted-string\">\"OnPluginFormRender\"</span><span class=\"token punctuation\">:</span>\n        <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/edit_area/edit_area_full.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\" src=\"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'base_url'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'assets/plugins/editarea/ea_functions.js\">&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$e</span><span class=\"token operator\">-></span><span class=\"token function\">output</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;script type=\"text/javascript\">initEditArea(\"post\", \"'</span><span class=\"token operator\">.</span><span class=\"token variable\">$modx</span><span class=\"token operator\">-></span><span class=\"token property\">config</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'manager_language'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'\", \"php\")&lt;/script>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">default</span> <span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// stop here - this is very important.</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>JavaScript</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">onEditAreaChanged</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> editAreaLoader<span class=\"token punctuation\">.</span><span class=\"token function\">getValue</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getLangName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">lang</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> res <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>lang<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'english'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'en'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'russian'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'ru'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'russian-UTF8'</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'ru'</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n      res <span class=\"token operator\">=</span> <span class=\"token string\">'en'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">initEditArea</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el_name<span class=\"token punctuation\">,</span> lang<span class=\"token punctuation\">,</span> syntax</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> elements <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span>el_name<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>elements<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n  <span class=\"token keyword\">var</span> el <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span><span class=\"token function\">item</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span> el<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>name\n\n  editAreaLoader<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">change_callback</span><span class=\"token operator\">:</span> <span class=\"token string\">'onEditAreaChanged'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">language</span><span class=\"token operator\">:</span> <span class=\"token string\">'ru'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">start_highlight</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allow_resize</span><span class=\"token operator\">:</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">allow_toggle</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">word_wrap</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">syntax</span><span class=\"token operator\">:</span> syntax<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">toolbar</span><span class=\"token operator\">:</span> <span class=\"token string\">'undo, redo, |, select_font, |, syntax_selection, |, change_smooth_selection, highlight, reset_highlight, word_wrap'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">syntax_selection_allow</span><span class=\"token operator\">:</span> <span class=\"token string\">'css,html,js,php,xml,sql'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>"}},"pageContext":{"id":"4bd1859a-cb35-5c9a-bf4e-7b077051712d"}},"staticQueryHashes":[],"slicesMap":{}}
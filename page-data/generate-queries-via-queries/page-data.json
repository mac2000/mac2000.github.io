{"componentChunkName":"component---src-templates-note-js","path":"/generate-queries-via-queries","result":{"data":{"remark":{"fields":{"path":"generate-queries-via-queries"},"meta":{"title":""},"headings":[{"value":"generate queries via queries"}],"html":"<h1>generate queries via queries</h1>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@TableName</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@TableName</span> <span class=\"token operator\">=</span> <span class=\"token string\">'ChannelEvents'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@TableIdentity</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@TableIdentity</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> COLUMN_NAME <span class=\"token keyword\">FROM</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span><span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">WHERE</span> <span class=\"token punctuation\">(</span>COLUMNPROPERTY<span class=\"token punctuation\">(</span>OBJECT_ID<span class=\"token punctuation\">(</span>TABLE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> COLUMN_NAME<span class=\"token punctuation\">,</span> <span class=\"token string\">'IsRowGuidCol'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">OR</span> COLUMNPROPERTY<span class=\"token punctuation\">(</span>OBJECT_ID<span class=\"token punctuation\">(</span>TABLE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> COLUMN_NAME<span class=\"token punctuation\">,</span> <span class=\"token string\">'IsIdentity'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">AND</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'ChannelEvents'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Col1,Col2,...,ColN */</span>\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@tc1</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> CAST<span class=\"token punctuation\">(</span>COLUMN_NAME <span class=\"token operator\">+</span> <span class=\"token string\">','</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span><span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'ChannelEvents'</span> <span class=\"token operator\">AND</span> COLUMN_NAME <span class=\"token operator\">!=</span> <span class=\"token variable\">@TableIdentity</span> <span class=\"token keyword\">FOR</span> XML PATH <span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc1</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">LEFT</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc1</span><span class=\"token punctuation\">,</span> <span class=\"token function\">LEN</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* @Col1,@Col2,...,@ColN */</span>\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@tc2</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc2</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> CAST<span class=\"token punctuation\">(</span><span class=\"token string\">'@'</span> <span class=\"token operator\">+</span> COLUMN_NAME <span class=\"token operator\">+</span> <span class=\"token string\">','</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span><span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'ChannelEvents'</span> <span class=\"token operator\">AND</span> COLUMN_NAME <span class=\"token operator\">!=</span> <span class=\"token variable\">@TableIdentity</span> <span class=\"token keyword\">FOR</span> XML PATH <span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc2</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">LEFT</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc2</span><span class=\"token punctuation\">,</span> <span class=\"token function\">LEN</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Col1=@Col1,Col2=@Col2,...,ColN=@ColN */</span>\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@tc3</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc3</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> CAST<span class=\"token punctuation\">(</span>COLUMN_NAME<span class=\"token operator\">+</span><span class=\"token string\">'=@'</span> <span class=\"token operator\">+</span> COLUMN_NAME <span class=\"token operator\">+</span> <span class=\"token string\">','</span> <span class=\"token keyword\">AS</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> INFORMATION_SCHEMA<span class=\"token punctuation\">.</span><span class=\"token keyword\">COLUMNS</span> <span class=\"token keyword\">WHERE</span> TABLE_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'ChannelEvents'</span> <span class=\"token operator\">AND</span> COLUMN_NAME <span class=\"token operator\">!=</span> <span class=\"token variable\">@TableIdentity</span> <span class=\"token keyword\">FOR</span> XML PATH <span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@tc3</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">LEFT</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc3</span><span class=\"token punctuation\">,</span> <span class=\"token function\">LEN</span><span class=\"token punctuation\">(</span><span class=\"token variable\">@tc3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@CreateQuery</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@CreateQuery</span> <span class=\"token operator\">=</span> <span class=\"token string\">'SET NOCOUNT ON; INSERT INTO '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableName</span><span class=\"token operator\">+</span><span class=\"token string\">' ('</span><span class=\"token operator\">+</span><span class=\"token variable\">@tc1</span><span class=\"token operator\">+</span><span class=\"token string\">') VALUES ('</span><span class=\"token operator\">+</span><span class=\"token variable\">@tc2</span><span class=\"token operator\">+</span><span class=\"token string\">'); SELECT @@IDENTITY AS LAST_ID; SET NOCOUNT OFF;'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@ReadAllQuery</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@ReadAllQuery</span> <span class=\"token operator\">=</span> <span class=\"token string\">'SELECT * FROM '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableName</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@ReadOneQuery</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@ReadOneQuery</span> <span class=\"token operator\">=</span> <span class=\"token string\">'SELECT * FROM '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableName</span><span class=\"token operator\">+</span><span class=\"token string\">' WHERE '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token operator\">+</span><span class=\"token string\">' = @'</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@UpdateQuery</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@UpdateQuery</span> <span class=\"token operator\">=</span> <span class=\"token string\">'UPDATE '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableName</span><span class=\"token operator\">+</span><span class=\"token string\">' SET '</span><span class=\"token operator\">+</span><span class=\"token variable\">@tc3</span><span class=\"token operator\">+</span><span class=\"token string\">' WHERE '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token operator\">+</span><span class=\"token string\">' = @'</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@DeleteQuery</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@DeleteQuery</span> <span class=\"token operator\">=</span> <span class=\"token string\">'DELETE FROM '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableName</span><span class=\"token operator\">+</span><span class=\"token string\">' WHERE '</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token operator\">+</span><span class=\"token string\">' = @'</span><span class=\"token operator\">+</span><span class=\"token variable\">@TableIdentity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*SELECT @TableIdentity AS TableIdentity;*/</span>\n<span class=\"token comment\">/*SELECT @tc1;*/</span>\n<span class=\"token comment\">/*SELECT @tc2;*/</span>\n<span class=\"token comment\">/*SELECT @tc3;*/</span>\n<span class=\"token comment\">/*SELECT @CreateQuery;*/</span>\n<span class=\"token comment\">/*SELECT @ReadAllQuery;*/</span>\n<span class=\"token comment\">/*SELECT @ReadOneQuery;*/</span>\n<span class=\"token comment\">/*SELECT @UpdateQuery;*/</span>\n<span class=\"token comment\">/*SELECT @DeleteQuery;*/</span></code></pre></div>"}},"pageContext":{"id":"dcd6415f-9180-50e1-94fa-0067408bf9b4"}},"staticQueryHashes":[]}
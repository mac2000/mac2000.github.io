{"componentChunkName":"component---src-templates-note-js","path":"/migrate-npx-apollo-to-rover/","result":{"data":{"remark":{"fields":{"path":"migrate-npx-apollo-to-rover"},"meta":{"title":""},"headings":[{"value":"Migrate from npx apollo to rover"}],"html":"<h1>Migrate from npx apollo to rover</h1>\n<p><code class=\"language-text\">apollo service:check</code> and <code class=\"language-text\">apollo service:push</code> utils are <strong>deprecated</strong></p>\n<p>Alternative is <a href=\"https://www.apollographql.com/docs/rover/\">rover</a></p>\n<p>Install for windows</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">iwr <span class=\"token string\">'https://rover.apollo.dev/win/latest'</span> <span class=\"token operator\">|</span> iex</code></pre></div>\n<p>Install for linux/mac</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sSL</span> https://rover.apollo.dev/nix/latest <span class=\"token operator\">|</span> <span class=\"token function\">sh</span></code></pre></div>\n<p><strong>Note:</strong> for rover to work you need <code class=\"language-text\">APOLLO_KEY</code> environment variable (we were passing it as argument before, now it is env variable)</p>\n<h2>apollo service:check</h2>\n<p>before</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx apollo service:check <span class=\"token parameter variable\">--graph</span><span class=\"token operator\">=</span>dracula <span class=\"token parameter variable\">--key</span><span class=\"token operator\">=</span><span class=\"token variable\">$APOLLO_KEY</span> <span class=\"token parameter variable\">--endpoint</span><span class=\"token operator\">=</span>http://localhost:5000/graphql <span class=\"token parameter variable\">--serviceName</span><span class=\"token operator\">=</span>FOO <span class=\"token parameter variable\">--variant</span><span class=\"token operator\">=</span>dev</code></pre></div>\n<p>after</p>\n<div class=\"gatsby-highlight\" data-language=\"bas\"><pre class=\"language-bas\"><code class=\"language-bas\">rover subgraph introspect http://localhost:5000/graphql | rover subgraph check dracula@dev --name FOO --schema -</code></pre></div>\n<h2>apollo service:push</h2>\n<p>before</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx apollo service:push <span class=\"token parameter variable\">--graph</span><span class=\"token operator\">=</span>dracula <span class=\"token parameter variable\">--key</span><span class=\"token operator\">=</span><span class=\"token variable\">$APOLLO_KEY</span> <span class=\"token parameter variable\">--endpoint</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://foo.dev.rabota.ua/graphql\"</span> <span class=\"token parameter variable\">--serviceName</span><span class=\"token operator\">=</span>Foo <span class=\"token parameter variable\">--serviceURL</span><span class=\"token operator\">=</span><span class=\"token string\">\"http://foo/graphql\"</span> <span class=\"token parameter variable\">--variant</span><span class=\"token operator\">=</span>dev</code></pre></div>\n<p>after</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">rover subgraph introspect https://foo.dev.rabota.ua/graphql <span class=\"token operator\">|</span> rover subgraph publish dracula@dev <span class=\"token parameter variable\">--name</span> Foo --routing-url<span class=\"token operator\">=</span>http://foo/graphql <span class=\"token parameter variable\">--schema</span> -</code></pre></div>\n<h2>Примечания</h2>\n<p><code class=\"language-text\">rover subgraph introspect https://whatever.com/graphql</code> under the hood does something like <code class=\"language-text\">curl -X POST https://whatever.com/graphql -H \"Content-Type: application/json\" -d '{\"query\":\"{_service{sdl}}\"}'</code></p>\n<p>this is required because both <code class=\"language-text\">check</code> and <code class=\"language-text\">publish</code> expects <code class=\"language-text\">--schema</code> input service definition and can not retrieve it from url</p>\n<p>that's why we are doing such trick <code class=\"language-text\">rover subgraph introspect ... | rover subgraph check --schema -</code>, where <code class=\"language-text\">--schema -</code> takes schema from stdin, aka previous command</p>"}},"pageContext":{"id":"17e7a360-1bc4-55f6-97ba-baca6eefd439"}},"staticQueryHashes":[],"slicesMap":{}}
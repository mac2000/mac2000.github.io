{"componentChunkName":"component---src-templates-note-js","path":"/dokuwiki-youtube-plugin/","result":{"data":{"remark":{"fields":{"path":"dokuwiki-youtube-plugin"},"meta":{"title":""},"headings":[{"value":"DokuWiki YouTube plugin"}],"html":"<h1>DokuWiki YouTube plugin</h1>\n<p>Плагин подменяющий ссылки на ютуб на собственно ролики</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">/**\n    * YouTubeLink Plugin: Converts youtube links\n    *\n    * @license    GPL 2 (http://www.gnu.org/licenses/gpl.html)\n    * @author     Marchenko Alexandr &lt;marchenko.alexandr@gmail.com>\n    */</span>\n\n<span class=\"token comment\">// must be run within Dokuwiki</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'DOKU_INC'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">defined</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'DOKU_PLUGIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'DOKU_PLUGIN'</span><span class=\"token punctuation\">,</span><span class=\"token constant\">DOKU_INC</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'lib/plugins/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DOKU_PLUGIN</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'syntax.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n    * All DokuWiki plugins to extend the parser/rendering mechanism\n    * need to inherit from this class\n    */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">syntax_plugin_my</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">DokuWiki_Syntax_Plugin</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n        * return some info\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string single-quoted-string\">'author'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'Marchenko Alexandr'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'email'</span>  <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'marchenko.alexandr@gmail.com'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'date'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'2010-04-16'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'name'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'YouTubeLink Plugin'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'desc'</span>   <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'Converts youtube links'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'url'</span>    <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'http://dokuwiki.org/plugin:info'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * What kind of syntax are we?\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'substition'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * What about paragraphs?\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getPType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string single-quoted-string\">'block'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * Where to sort in?\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getSort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">285</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * Connect pattern to lexer\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">connectTo</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$mode</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">Lexer</span><span class=\"token operator\">-></span><span class=\"token function\">addSpecialPattern</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'\\[\\[http:\\/\\/www\\.youtube\\.com\\/watch\\?v=[^\\]]+\\]\\]'</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$mode</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'plugin_my'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * Handle the match\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$match</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$state</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pos</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$handler</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$match</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$state</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pos</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n        * Create output\n        */</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">render</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$format</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$renderer</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$format</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'xhtml'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$v</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$data</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$v</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'http://www.youtube.com/watch?v='</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'[]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$v</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'&lt;object width=\"560\" height=\"340\">&lt;param name=\"movie\" value=\"http://www.youtube.com/v/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$v</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&amp;hl=ru_RU&amp;fs=1&amp;\">&lt;/param>&lt;param name=\"allowFullScreen\" value=\"true\">&lt;/param>&lt;param name=\"allowscriptaccess\" value=\"always\">&lt;/param>&lt;embed src=\"http://www.youtube.com/v/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$v</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&amp;hl=ru_RU&amp;fs=1&amp;\" type=\"application/x-shockwave-flash\" allowscriptaccess=\"always\" allowfullscreen=\"true\" width=\"560\" height=\"340\">&lt;/embed>&lt;/object>'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$renderer</span><span class=\"token operator\">-></span><span class=\"token property\">doc</span> <span class=\"token operator\">.=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'r'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&lt;br />'</span><span class=\"token operator\">.</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>"}},"pageContext":{"id":"250eb226-6dbc-587e-9ea0-d408152262e8"}},"staticQueryHashes":[],"slicesMap":{}}
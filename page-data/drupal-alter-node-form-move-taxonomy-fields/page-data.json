{"componentChunkName":"component---src-templates-note-js","path":"/drupal-alter-node-form-move-taxonomy-fields/","result":{"data":{"remark":{"fields":{"path":"drupal-alter-node-form-move-taxonomy-fields"},"meta":{"title":""},"headings":[{"value":"Drupal alter node form - move taxonomy fields"}],"html":"<h1>Drupal alter node form - move taxonomy fields</h1>\n<p><strong>product_form_move_fields.info</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token key attr-name\">version</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">6.x-1.0</span>\"</span>\n<span class=\"token key attr-name\">name</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">Product form - move fields</span>\"</span>\n<span class=\"token key attr-name\">description</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">Moves fields on product add/edit page.</span>\"</span>\n<span class=\"token key attr-name\">core</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"<span class=\"token inner-value\">6.x</span>\"</span>\n<span class=\"token key attr-name\">package</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">custom</span></code></pre></div>\n<p><strong>product_form_move_fields.module</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">product_form_move_fields_form_alter</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$form_state</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$form_id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form_id</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'product_node_form'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// dump field names and ther weights</span>\n        <span class=\"token function\">_product_form_move_fields_dump_field_weights</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// move taxonomy fields outside fieldset to other fields</span>\n        <span class=\"token function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// move other fields</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'field_width'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span>   <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'field_height'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span>  <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'field_depth'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span>   <span class=\"token operator\">=</span> <span class=\"token number\">9</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'field_gallery'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// add submit handler</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#submit'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'product_form_move_fields_submit'</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// hide taxonomy block</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'taxonomy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#prefix'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'&lt;div style=\"display:none\">'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'taxonomy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#suffix'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'&lt;/div>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">product_form_move_fields_submit</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$form_state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">_product_form_move_fields_dump_field_weights</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$m</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'&lt;table border=\"1\">&lt;tr>&lt;th>weight&lt;/th>&lt;th>name&lt;/th>&lt;th>key&lt;/th>&lt;/tr>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$k</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$v</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$title</span> <span class=\"token operator\">=</span> <span class=\"token function\">strip_tags</span><span class=\"token punctuation\">(</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword type-casting\">string</span><span class=\"token punctuation\">)</span><span class=\"token variable\">$element</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#title'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$weight</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$element</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$element</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token variable\">$m</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$m</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;tr>&lt;td>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$weight</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/td>&lt;td>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$title</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&lt;/td>&lt;td>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$k</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/td>&lt;/tr>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$m</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$m</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/table>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">drupal_set_message</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$m</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">_product_form_move_fields_move_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$weight</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tax'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'taxonomy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tax'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'#weight'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$weight</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'taxonomy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">_product_form_move_fields_reset_taxonomy_field</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$form</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$form_state</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'values'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'taxonomy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$form_state</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'values'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tax'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$form_state</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tax'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$vid</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>"}},"pageContext":{"id":"4d35f05a-1344-5945-a8c2-cde3d98216a5"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/microk8s-cleanup-unused-images/","result":{"data":{"remark":{"fields":{"path":"microk8s-cleanup-unused-images"},"meta":{"title":""},"headings":[{"value":"MicroK8S cleanup unused images"}],"html":"<h1>MicroK8S cleanup unused images</h1>\n<p>Problem: docker on its own does not clear images that were downloaded, and, as a result, sooner or later you will be out of disk space</p>\n<p>To clean up unused images you may want to run something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token assign-left variable\">all_images</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>microk8s ctr images list <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'print $1'</span><span class=\"token punctuation\">}</span><span class=\"token variable\">)</span></span>\n<span class=\"token assign-left variable\">running_images</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>microk8s ctr containers list <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'print $2'</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> <span class=\"token parameter variable\">-n</span> +1 <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> <span class=\"token operator\">|</span> <span class=\"token function\">uniq</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">image</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">$all_images</span>\n<span class=\"token keyword\">do</span>\n        <span class=\"token assign-left variable\">can_be_removed</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n        <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">running_image</span> <span class=\"token keyword\">in</span> <span class=\"token variable\">$running_images</span>\n        <span class=\"token keyword\">do</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$image</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">$running_image</span>\"</span> <span class=\"token punctuation\">]</span>\n                <span class=\"token keyword\">then</span>\n                        <span class=\"token assign-left variable\">can_be_removed</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n                        <span class=\"token builtin class-name\">break</span>\n                <span class=\"token keyword\">fi</span>\n        <span class=\"token keyword\">done</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">$can_be_removed</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"1\"</span> <span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">then</span>\n                microk8s ctr images remove <span class=\"token parameter variable\">--sync</span> <span class=\"token variable\">$image</span>\n        <span class=\"token keyword\">fi</span>\n<span class=\"token keyword\">done</span></code></pre></div>"}},"pageContext":{"id":"b84ba1b6-98dd-5227-8b2b-f97ea0507c3a"}},"staticQueryHashes":[],"slicesMap":{}}
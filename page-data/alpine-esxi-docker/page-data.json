{"componentChunkName":"component---src-templates-note-js","path":"/alpine-esxi-docker/","result":{"data":{"remark":{"fields":{"path":"alpine-esxi-docker"},"meta":{"title":""},"headings":[{"value":"Alpine Linux as a ESXi Docker host"}],"html":"<h1>Alpine Linux as a ESXi Docker host</h1>\n<p>Once again realized that Rancher OS is not supported anymore</p>\n<p>After quick \"googling\" it seems that there is no so much alternatives right now</p>\n<p>Photon OS from VMWare is almost same as Ubuntu and from <a href=\"https://mac-blog.org.ua/esxi-cloud-init-ubuntu\">previous experiments</a> I'm already able to have really small footprint docker host but wondering how much further can it go</p>\n<h2>Alpine Images</h2>\n<p>Alpine images can be downloaded <a href=\"https://alpinelinux.org/downloads/\">here</a></p>\n<p>One we are looking for is under \"Virtual\"</p>\n<p><a href=\"https://dl-cdn.alpinelinux.org/alpine/v3.15/releases/x86_64/alpine-virt-3.15.0-x86_64.iso\">https://dl-cdn.alpinelinux.org/alpine/v3.15/releases/x86_64/alpine-virt-3.15.0-x86_64.iso</a></p>\n<p>ISO size is only 55mb in size which is really promising</p>\n<blockquote>\n<p>Unfortunatelly there is no something like cloud ready vmdk with build in cloud init at moment, but there are already AWS ready images, so hopefully it will be available in future, so unfortunately setup is manual, but because of how simple and small Alpine is it wont take more than few minutes</p>\n</blockquote>\n<h2>ESXi</h2>\n<p>From ESXi perspective nothing fancy, we are going to create simple virtual machine as usual, as a guest system \"Other 5.x or later Linux (64-bit)\"</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f23bebecefed56f8a289612ff9712c3f/17009/guest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.5625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACCklEQVR42o2SS2sTURiG82/ElehCQYsYlGIF125cCP4ItaBFpZqFQtGNuAjStDZiFSRpE3Ntmjr3JJgWFUQQaaJJmsw1mUnm8vacE6NUFPzg4bvMmXe+8zKhZ8srSKUzSCSSyGYyKBXySK6lkEiuYT31FvnCBrK5IspbHDhe/CvvOAGyUsVibAmhZCaPWKKMeGIDz9d5zK3I+PLtOzqtH2g0m2i3W9A0DaPRCP8K3/dZliQJoQz5+sedbaymyzgfKeDQ9RJ22yoQePDIQXo4CAJ4nseg9Z/QOQ1BFBASBBHRwiecmc/h8GwRJ+d5tqGmdrHXpeyhSzJFVVXous42pjWF1rZt/97w8r04js3lcDqyiaO3yzhxl8Pnrw30iJBl9WGaJskWDMOATl7WNBUGETVNg9Gnz0hPQ6SC4WuLmLpfQjhSwpFbmzh+h8Nuq4dB3zzgk04ENX2M1R/AGQ5hO2No/2vD6dkYpiJbCD/g2IZnH0podshV1B5cd+yNH4D52iA0Oxqja9iMHqGjWhh6PwXP3YhhekHAzAKPU0T4wqMK9IHLhKjhk3BGPvqOR3BZtkcBw3ED1rMriyJCMzeXcSVawdWojEtPFFx8rEC3J4L4r5j8NszDp0uv8SonI57m8DIr4k1RASfXIVa2D8CTGa/UIZBaUmpQqu9RqdUhV8lcqqG+8wHxF6vYB7eovJKQKKI8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Other Linux 64 bit Guest OS\"\n        title=\"\"\n        src=\"/static/f23bebecefed56f8a289612ff9712c3f/2bef9/guest.png\"\n        srcset=\"/static/f23bebecefed56f8a289612ff9712c3f/6f3f2/guest.png 256w,\n/static/f23bebecefed56f8a289612ff9712c3f/01e7c/guest.png 512w,\n/static/f23bebecefed56f8a289612ff9712c3f/2bef9/guest.png 1024w,\n/static/f23bebecefed56f8a289612ff9712c3f/71c1d/guest.png 1536w,\n/static/f23bebecefed56f8a289612ff9712c3f/17009/guest.png 1932w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Also make sure that BIOS is used to boot</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b3ddd11af09931fc4be9afb791982881/093ec/bios.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.953125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACV0lEQVR42lWS20tUURSH59+pl8CgIqTQhIKiP6Aee+i1pygqJJFMSCKIHgpSQcVLOeWYk5cUnZkzMzq3HNNwvI1zv5yZM5cz95mvfU4oteFjrfPy7d9aZxsGR8aY+76A0fiVObOZ5cUFZkzfmJ7+wszsHCurFhzOjX9w6dXuWD9Fsjtxub2Mjo1jMC/N493cwr+5ydavHV7PbrN7nEBOJYjFoigZmVq1SqlcplQqoaoqZdH/e5rNpl4lScIw+snIpOkH/R9N3Ho2xZkHJvYiaZLxCPvhFFZ/lHAyD60m9XpDUNfRJCfUajVdaNOENsnOh+VdrvatcPbJCpd7JQIxhcNoioAQbwcTBJM55EwGRVFOU2oUi0Ud7YJWq/U34d3eUc53L3Ll5Sptzy1c7JHYjeWELMlBQiGaKxPJlkjLMnI6TVogi75ardFoNPTUWj0Vdjwcor1vjQ4hPNe9ygUh3AnJ+PeC/A7GCclFIhmVgkiiFgsU8nkKhbwQVv7foRDqI19/PEx7v5XOAYm2HitdAxscJAsEwkmOUnk9XVgIY+kcaaUoUEllCzrJTIGEnBe1SLXexG63Y+h6NETnKxvXBmxcemHhxhsXhymVPbHD/XhWF4ZklUAwxpFYg0YwmuY4LhOKZ/Q+lMhSEyGdDgeGm09HuDfo5f6wmzvvPdx+6yYol4goIpkglq8IylRrVSqVsj7yyc5a4s+3xLjat3Z8Ph+Gd4MTTC44GDfbmJi3M73kZM3hwer0YnFoeHSkdZ+O0+0Xj9iH2+PDJVgXvWPDg/enn6nPRv4AEEi0nw1eHAoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"BIOS boot options\"\n        title=\"\"\n        src=\"/static/b3ddd11af09931fc4be9afb791982881/2bef9/bios.png\"\n        srcset=\"/static/b3ddd11af09931fc4be9afb791982881/6f3f2/bios.png 256w,\n/static/b3ddd11af09931fc4be9afb791982881/01e7c/bios.png 512w,\n/static/b3ddd11af09931fc4be9afb791982881/2bef9/bios.png 1024w,\n/static/b3ddd11af09931fc4be9afb791982881/71c1d/bios.png 1536w,\n/static/b3ddd11af09931fc4be9afb791982881/093ec/bios.png 1930w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>If everything fine, after power on you will be almost immediatelly boot and promted to login (still can not belive how fast it is)</p>\n<p>Default username is \"root\" with empty password</p>\n<h2>Alpine Setup</h2>\n<p>From a welcome message you cann see that you may use <code class=\"language-text\">setup-alpine</code> script to actually install OS</p>\n<p>So I give it a go and run <code class=\"language-text\">setup-alping</code>, and here are answers:</p>\n<ul>\n<li>Select keyboard layout: none</li>\n<li>Enter system hostname: demo.mac-blog.org.ua</li>\n<li>Which one do you want ot initialize?: eth0</li>\n<li>Ip address for eth0: 192.168.106.23</li>\n<li>Netmask: 255.255.255.0</li>\n<li>Gateway: 192.168.106.1</li>\n<li>Do you want to do any manual network configuration: n</li>\n<li>DNS domain name: empty string</li>\n<li>DNS nameservers: 1.1.1.1,8.8.8.8</li>\n<li>New password: HelloWorld</li>\n<li>Retryp password: HelloWorld</li>\n<li>Which timezone are you in: Europe/Kiev</li>\n<li>HTTP proxy URL: none</li>\n<li>Which NTP client to run: chrony</li>\n<li>Enter mirror number: 1</li>\n<li>Which SSH server: openssh</li>\n<li>Which disk(s) would you like to use: sda</li>\n<li>How wold you like to use it: sys</li>\n<li>WARNING: Erase the above disk(s) and continue: y</li>\n</ul>\n<p>Actually it is so straight forward that even does not require any notes</p>\n<p>After setup which happens really really fast, Alpine will ask you to reboot, so run <code class=\"language-text\">reboot</code> and you are done</p>\n<p>After booting up, it is good time to install open vm tools</p>\n<p>To do this uncomment community link at <code class=\"language-text\">/etc/apk/repositories</code> so it looks like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#/media/cdrom/apks\nhttp://dl-cdn.alpinelinux.org/alpine/v3.15/main\nhttp://dl-cdn.alpinelinux.org/alpine/v3.15/community\n#http://dl-cdn.alpinelinux.org/alpine/edge/main\n#http://dl-cdn.alpinelinux.org/alpine/edge/community\n#http://dl-cdn.alpinelinux.org/alpine/edge/testing</code></pre></div>\n<p>Then open vm tools can be installed</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk <span class=\"token function\">add</span> <span class=\"token parameter variable\">--update</span> open-vm-tools\n/etc/init.d/open-vm-tools start\nrc-update <span class=\"token function\">add</span> open-vm-tools</code></pre></div>\n<p>After this ESXi should recognize vm tools are installed</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 992px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/610df280d5b5006616a33153908e4fe8/91f10/vmtools.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcElEQVR42pWS6W6DMBCEef+nqvqrqnoQQDnanA7hMmAwNySZrh01ClGltpY+eS20450xhmVZmFg2LMfBuznRdRBG/8YPQgiRwXh0GF7sGZ5MB/bnFms/BuMZkWMX5eBZiaZpUP9CVdca48FZw14xYg9nc4ArGqLWsLRCVvf46xqGAcaUxRextYsPl4PFBVwSUuyJRNbo+043nM/na/N9rej7HgZLCrxOl3BWLry81SJXaMoglYg5R9d1qMmS2lUEOgY6K47HI06nk/5mbLnE22yF+T6EmzVgSXkjSoJCIgwDpGmKKIqQZZneOV0SBIFGCakJteCGgld25yzUIt/5XWgQ0aOURTGydr9Gls3ZEuZio0WVyK1lllRIywa+72mLypZCWdRQfXuBnnDKOJ7tBRb0IK5or1YVOxIUVU/Nw4+TnYYOUnDEcULEaNsWxiGR2HMBj8L3RTHCSwuIkkKn30HZGTOgbWqKI4eUEjLPteAXf+35VRADBzQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vmtools\"\n        title=\"\"\n        src=\"/static/610df280d5b5006616a33153908e4fe8/91f10/vmtools.png\"\n        srcset=\"/static/610df280d5b5006616a33153908e4fe8/6f3f2/vmtools.png 256w,\n/static/610df280d5b5006616a33153908e4fe8/01e7c/vmtools.png 512w,\n/static/610df280d5b5006616a33153908e4fe8/91f10/vmtools.png 992w\"\n        sizes=\"(max-width: 992px) 100vw, 992px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>But still wont show ip addresses</p>\n<p><a href=\"https://wiki.alpinelinux.org/wiki/Install_Alpine_on_VMware_ESXi\">Install Alpine on VMware ESXi</a> - wiki page I started from</p>\n<h2>Alpine SSH</h2>\n<p>After fresh install for remote connections to work make sure to tune <code class=\"language-text\">/etc/ssh/sshd_config</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PermitRootLogin yes\nPasswordAuthentication yes</code></pre></div>\n<p>And restart ssh by running <code class=\"language-text\">/etc/init.d/sshd restart</code></p>\n<p><a href=\"https://wiki.alpinelinux.org/wiki/Setting_up_a_SSH_server\">Setting up a SSH server</a></p>\n<h2>Docker</h2>\n<p>Once again make sure that community packages are uncommented in <code class=\"language-text\">/etc/apk/repositories</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk <span class=\"token function\">add</span> <span class=\"token function\">docker</span>\nrc-update <span class=\"token function\">add</span> <span class=\"token function\">docker</span> boot\n<span class=\"token function\">service</span> <span class=\"token function\">docker</span> start</code></pre></div>\n<p>Optionally <code class=\"language-text\">apk add docker-compose</code> (is not needed, in fresh releases docker compose v2 is single binary - <a href=\"https://docs.docker.com/compose/cli-command/#install-on-linux\">docs</a>)</p>\n<p><a href=\"https://wiki.alpinelinux.org/wiki/Docker\">Docker</a></p>\n<h2>Resize disk</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk <span class=\"token function\">add</span> <span class=\"token function\">cfdisk</span></code></pre></div>\n<p>Choose desired disk, resize, and press enter</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ccee3a22ae9d586b65b86bee1676c9d/05244/cfdisk.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.703125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbElEQVR42uVT22qDQBA1VzWSq+h6QeNmLdKH5mGtFSUhpiTQQsn//81pZkFJSqEP7VsfhnN0zszODDNar9eDpmkgbLlpmpjP51gul0iSBJxzXC4X7HY7BEGg/huGcRfXxZuGqQTkJNFkMlGckLlMccd2YOgGPOapx0hPfsd1MB6PlaYz+Sxxej+hrEtIKZHnObZPW+RljubcIH+ROL4dUZQFzh9nyFyieW1Q1RUOzQH7/R5VVanqi6KAthZrhA8B4izGhm/ANxyCC0RZhDALsc7W8B99JCIBy5jCmMeIk1i1TyNJ0xQiFRBCUJUa/tS+DvW39vcV/sOEw+EQo9EIg8EAxNvv7wZOmp9Mo10Kw+u+XfeJeBRFYIxhNpt157darRRSQL/fvzN6iLC9NG06napEtJye58H3fZVwsVioMyMRma7rXSe3Hd1ylZBu0rZtWFekiizLUhtf1zVc11VJ28Tkp9ulItq7b3nr+wSlTzwWcI7VRAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cfdisk\"\n        title=\"\"\n        src=\"/static/6ccee3a22ae9d586b65b86bee1676c9d/2bef9/cfdisk.png\"\n        srcset=\"/static/6ccee3a22ae9d586b65b86bee1676c9d/6f3f2/cfdisk.png 256w,\n/static/6ccee3a22ae9d586b65b86bee1676c9d/01e7c/cfdisk.png 512w,\n/static/6ccee3a22ae9d586b65b86bee1676c9d/2bef9/cfdisk.png 1024w,\n/static/6ccee3a22ae9d586b65b86bee1676c9d/71c1d/cfdisk.png 1536w,\n/static/6ccee3a22ae9d586b65b86bee1676c9d/05244/cfdisk.png 1752w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After that green line with free space should dissapear</p>\n<p>Write changes and quit</p>\n<p>Now we need to resize filesystem</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk <span class=\"token function\">add</span> e2fsprogs-extra\nresize2fs /dev/sda3</code></pre></div>\n<p>Make sure to change <code class=\"language-text\">sda3</code> to appropriate number</p>\n<p>And check what you have now</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">df</span> <span class=\"token parameter variable\">-h</span> /dev/sda3</code></pre></div>\n<p><a href=\"https://www.reddit.com/r/linuxquestions/comments/ayzdpr/expanding_disk_in_alpine_linux/\">Expanding Disk in Alpine Linux</a></p>\n<h2>Alpine install on a single partition without swap</h2>\n<ul>\n<li><a href=\"https://www.alextsang.net/articles/20200921-032859/index.html\">Alpine Linux with custom partitions</a></li>\n<li><a href=\"https://wiki.alpinelinux.org/wiki/Setting_up_disks_manually\">Setting up disks manually</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk <span class=\"token function\">add</span> e2fsprogs\nmkfs.ext4 <span class=\"token parameter variable\">-O</span> ^has_journal /dev/sdXY   <span class=\"token comment\"># the \"-O ^has_journal\" DISABLES journaling (\"^\" means \"not\")</span>\n<span class=\"token function\">mount</span> /dev/sda1 /mnt\nsetup-disk /mnt</code></pre></div>\n<p>TODO: wish to have single partition without swap</p>\n<h2>Upgrading Alpine</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">apk update\napk upgrade</code></pre></div>\n<p><a href=\"https://wiki.alpinelinux.org/wiki/Tutorials_and_Howtos\">Tutorials and Howtos</a></p>"}},"pageContext":{"id":"c8677f3b-8f83-5934-b881-574b90c5e464"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/docker-compose-nginx-proxy-scaled-services","result":{"data":{"remark":{"fields":{"path":"docker-compose-nginx-proxy-scaled-services"},"meta":{"title":""},"headings":[{"value":"Nginx Proxy saceld docker-compose services"}],"html":"<h1>Nginx Proxy saceld docker-compose services</h1>\n<p>Easiest way to proxy scaled containers</p>\n<p><strong>docker-compose.yml</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/nginx<span class=\"token punctuation\">-</span>proxy<span class=\"token punctuation\">:</span>alpine\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> proxy\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token datetime number\">80:80</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/tmp/docker.sock<span class=\"token punctuation\">:</span>ro\n    <span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> none\n\n  <span class=\"token key atrule\">whoami</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/whoami\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token number\">8000</span>\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VIRTUAL_HOST</span><span class=\"token punctuation\">:</span> localhost</code></pre></div>\n<p>Now if you run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker-compose</span> up\n<span class=\"token function\">docker-compose</span> scale <span class=\"token assign-left variable\">whoami</span><span class=\"token operator\">=</span><span class=\"token number\">5</span></code></pre></div>\n<p>And open localhost in browser, each time you refresh the page you will see different container, and you can still access concrete containers by their own ports</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> http://localhost\nI<span class=\"token string\">'m a9998f9cefbd\n\n$ curl http://localhost\nI'</span>m 66d5e9d72b61\n\n$ <span class=\"token function\">curl</span> http://localhost\nI<span class=\"token string\">'m 6bab17a8d614\n\n$ curl http://localhost\nI'</span>m 103bac359b56\n\n$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span> <span class=\"token parameter variable\">--format</span> <span class=\"token string\">\"{{.ID}}: {{.Ports}}\"</span> <span class=\"token parameter variable\">--filter</span> <span class=\"token assign-left variable\">ancestor</span><span class=\"token operator\">=</span>jwilder/whoami\na9998f9cefbd: <span class=\"token number\">0.0</span>.0.0:32791-<span class=\"token operator\">></span><span class=\"token number\">8000</span>/tcp\n66d5e9d72b61: <span class=\"token number\">0.0</span>.0.0:32790-<span class=\"token operator\">></span><span class=\"token number\">8000</span>/tcp\n6bab17a8d614: <span class=\"token number\">0.0</span>.0.0:32789-<span class=\"token operator\">></span><span class=\"token number\">8000</span>/tcp\n103bac359b56: <span class=\"token number\">0.0</span>.0.0:32788-<span class=\"token operator\">></span><span class=\"token number\">8000</span>/tcp\nde52272cac61: <span class=\"token number\">0.0</span>.0.0:32787-<span class=\"token operator\">></span><span class=\"token number\">8000</span>/tcp\n\n$ <span class=\"token function\">curl</span> http://localhost:32790\nI'm 66d5e9d72b61</code></pre></div>"}},"pageContext":{"id":"30b08cec-70af-534c-a77b-bcd7e40d7d2b"}},"staticQueryHashes":[]}
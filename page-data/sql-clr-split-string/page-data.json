{"componentChunkName":"component---src-templates-note-js","path":"/sql-clr-split-string","result":{"data":{"remark":{"fields":{"path":"sql-clr-split-string"},"meta":{"title":""},"headings":[{"value":"SQL CLR Safe split string sample"}],"html":"<h1>SQL CLR Safe split string sample</h1>\n<p>In Visual Studio create SQL Database Project, add New Item \\ SQL CLR C# User Defined Function with follofing code:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Requires System.Core to be added to references</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>SqlTypes</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>SqlServer<span class=\"token punctuation\">.</span>Server</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">partial</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserDefinedFunctions</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">SqlFunction</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>\n        FillRowMethodName <span class=\"token operator\">=</span> <span class=\"token string\">\"FillRow\"</span><span class=\"token punctuation\">,</span>\n        TableDefinition <span class=\"token operator\">=</span> <span class=\"token string\">\"item INT\"</span>\n    <span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">IEnumerable</span> <span class=\"token function\">SafeSplitCommaSeparatedIntegers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SqlString</span> text<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> result<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span>IsNull <span class=\"token punctuation\">?</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">:</span> text<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span><span class=\"token char\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">.</span>TryParse<span class=\"token class-name\"><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>Trim<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">?</span></span> result <span class=\"token punctuation\">:</span> SqlInt32<span class=\"token punctuation\">.</span>MinValue<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">Where</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=></span> i <span class=\"token operator\">!=</span> SqlInt32<span class=\"token punctuation\">.</span>MinValue<span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">FillRow</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> input<span class=\"token punctuation\">,</span> <span class=\"token keyword\">out</span> <span class=\"token class-name\">SqlInt32</span> output<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SqlInt32</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Notice</strong> System.Code should be added to project references for Linq.</p>\n<p>Build and publish solution to database and try it:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">[</span>dbo<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span>SafeSplitCommaSeparatedIntegers<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token string\">' 1 ,2, 3,a,'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">WHERE</span> item <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Will return:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+------+\n| item |\n+------+\n| 2    |\n| 3    |\n+------+</code></pre></div>\n<p>More info can be found here: <a href=\"http://msdn.microsoft.com/en-us/library/w2kae45k(v=vs.90).aspx\">http://msdn.microsoft.com/en-us/library/w2kae45k(v=vs.90).aspx</a></p>"}},"pageContext":{"id":"82a223ab-6219-5114-95e7-4c13c7aca43d"}},"staticQueryHashes":[]}
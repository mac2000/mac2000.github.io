{"componentChunkName":"component---src-templates-note-js","path":"/git-commit-gpt-util/","result":{"data":{"remark":{"fields":{"path":"git-commit-gpt-util"},"meta":{"title":""},"headings":[{"value":"automated git commit message"}],"html":"<h1>automated git commit message</h1>\n<p>Recently discovered pretty nice project - <a href=\"https://github.com/di-sukharev/opencommit\">opencommit</a></p>\n<p>Idea is great, we are doing something similar for GitHub pull request description</p>\n<p>But indeed, nice to have git commit automated as well</p>\n<p>What I did not like about the tool is that it asks too much questions and there is no way to run it in quiet mode, at least until this <a href=\"https://github.com/di-sukharev/opencommit/issues/122\">issue</a> not fixed</p>\n<p>My very first though was - it is really cool idea for small go lang util but after almost fully complete it realized that it is so simple that even go not needed, everything can be done as simple bash script instead</p>\n<p>Here is what I have ended up with:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token function\">git</span> status <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-q</span> <span class=\"token string\">\"nothing to commit, working tree clean\"</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token function\">git</span> status\n    <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token function\">git</span> <span class=\"token function\">diff</span> <span class=\"token parameter variable\">--cached</span> <span class=\"token parameter variable\">--quiet</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token assign-left variable\">diff</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> <span class=\"token function\">diff</span> <span class=\"token parameter variable\">--staged</span> -- <span class=\"token punctuation\">$(</span>git <span class=\"token function\">diff</span> <span class=\"token parameter variable\">--staged</span> --name-only --diff-filter<span class=\"token operator\">=</span>ACMRTU <span class=\"token operator\">|</span> <span class=\"token function\">egrep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token string\">'go.sum|package-lock.json|.terraform.lock.hcl|assets/.*\\.(png|jpg)$|src/.*\\.js$'</span><span class=\"token variable\">)</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token assign-left variable\">body</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>jq --null-input <span class=\"token parameter variable\">--arg</span> system <span class=\"token string\">\"<span class=\"token variable\">$system</span>\"</span> <span class=\"token parameter variable\">--arg</span> <span class=\"token function\">diff</span> <span class=\"token string\">\"<span class=\"token variable\">$diff</span>\"</span> <span class=\"token string\">'{\n    \"model\": \"gpt-3.5-turbo\",\n    \"temperature\": 0.7,\n    \"max_tokens\": 320,\n    \"messages\": [\n        {\n            \"role\": \"system\",\n            \"content\": \"Given \\\"git diff --staged\\\" command output your goal is to propose short single line commit title no longer than 80 chars\"\n        },\n        {\n            \"role\": \"user\",\n            \"content\": $diff\n        }\n    ]\n}'</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token assign-left variable\">summary</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://api.openai.com/v1/chat/completions <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/json\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$OPENAI_API_KEY</span>\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$body</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".choices[0].message.content\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'\"'</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># echo $summary</span>\n\n<span class=\"token assign-left variable\">body</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>jq --null-input <span class=\"token parameter variable\">--arg</span> system <span class=\"token string\">\"<span class=\"token variable\">$system</span>\"</span> <span class=\"token parameter variable\">--arg</span> <span class=\"token function\">diff</span> <span class=\"token string\">\"<span class=\"token variable\">$diff</span>\"</span> <span class=\"token string\">'{\n    \"model\": \"gpt-3.5-turbo\",\n    \"temperature\": 0.7,\n    \"messages\": [\n        {\n            \"role\": \"system\",\n            \"content\": \"Given \\\"git diff --staged\\\" command output your goal is to write an commit description\"\n        },\n        {\n            \"role\": \"user\",\n            \"content\": $diff\n        }\n    ]\n}'</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token assign-left variable\">description</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://api.openai.com/v1/chat/completions <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/json\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$OPENAI_API_KEY</span>\"</span> <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"<span class=\"token variable\">$body</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".choices[0].message.content\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># echo $description</span>\n\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"<span class=\"token variable\">$summary</span>\"</span> <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"<span class=\"token variable\">$description</span>\"</span></code></pre></div></p>\n<p>Notes:</p>\n<ul>\n<li>it won't handle huge pull requests and will require you to filter files before sending them to GPT</li>\n<li>it has some issues with tools where you commit changes programmatically</li>\n</ul>"}},"pageContext":{"id":"664adbc2-afdc-5d99-b64e-814aa659fa89"}},"staticQueryHashes":[],"slicesMap":{}}
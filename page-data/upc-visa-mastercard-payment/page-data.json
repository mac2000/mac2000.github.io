{"componentChunkName":"component---src-templates-note-js","path":"/upc-visa-mastercard-payment","result":{"data":{"remark":{"fields":{"path":"upc-visa-mastercard-payment"},"meta":{"title":""},"headings":[{"value":"UPC - visa/mastercard payment"}],"html":"<h1>UPC - visa/mastercard payment</h1>\n<p>Номер тестовой карточки: 4999999999990011</p>\n<p><a href=\"https://secure.upc.ua/ecgtest/merchant\">https://secure.upc.ua/ecgtest/merchant</a></p>\n<h2>Задача</h2>\n<p>Реализовать оплату кредиткой</p>\n<h2>Шаг 1. Регистрация</h2>\n<p>Скачиваем и заполняем заявку на регистрацию <a href=\"http://ecommerce.upc.ua/site/docs.html\">http://ecommerce.upc.ua/site/docs.html</a>, после чего отправляем заявку на <a href=\"mailto:ec@upc.ua\">ec@upc.ua</a></p>\n<p>Через некоторое время получаем письмо с логином\\паролем приблизительно следующего вида:</p>\n<blockquote>\n<p>Добрый день</p>\n</blockquote>\n<p>Тестовые данные:</p>\n<p>Адрес шлюза :<a href=\"https://secure.upc.ua/ecgtest/enter\">https://secure.upc.ua/ecgtest/enter</a></p>\n<p>MerchantID=1753019</p>\n<p>TerminalID=E7881019</p>\n<p>Интерфейс торговца :<a href=\"https://secure.upc.ua/ecgtest/merchant\">https://secure.upc.ua/ecgtest/merchant</a></p>\n<p>Логин / Пароль : 1753019 / 1753019</p>\n<p>Сертификат сервера - в аттаче</p>\n<p>Также необходимо, чтобы Вы выслали сертификат торговца (файл с именем 1753019.crt) на адрес <a href=\"mailto:ec@upc.ua\">ec@upc.ua</a></p>\n<p>Вся необходимая документация: здесь: <a href=\"http://ecommerce.upc.ua/site/docs.html\">http://ecommerce.upc.ua/site/docs.html</a></p>\n<p>Тестовые карты здесь: <a href=\"http://ecommerce.upc.ua/docs/Testing.pdf\">http://ecommerce.upc.ua/docs/Testing.pdf</a></p>\n<p>(See attached file: test-server.cert)</p>\n<p>В архиве batch.rar документация и примеры по формированию подписи.</p>\n<p>(See attached file: batch.rar)</p>\n<p>В архиве image.rar логотипы.</p>\n<p>(See attached file: image.rar)</p>\n<p>Переходим на страницу <a href=\"https://secure.upc.ua/ecgtest/merchant/\">https://secure.upc.ua/ecgtest/merchant/</a> и меняем пароль на странице профиля.</p>\n<p><img src=\"http://mac-blog.org.ua/images/wp/image3.png\" alt=\"screenshot\"></p>\n<p>На странице \"Терминалы\" выбираем наш сайт и указываем URL, для страниц успешной и неудачных транзакций.</p>\n<p><img src=\"http://mac-blog.org.ua/images/wp/image2.png\" alt=\"screenshot\"></p>\n<p>Так же необходимо сгенерировать и выслать им сертификат, для этого качаем openssl <a href=\"http://www.slproweb.com/products/Win32OpenSSL.html\">http://www.slproweb.com/products/Win32OpenSSL.html</a> и прописываем путь к папке bin в PATH, далее в консоли переходим к папке batch (приатаченой к письму) и запускаем run.bat <code class=\"language-text\">#MERCHANT_ID#</code> (с правами администратора)</p>\n<p><img src=\"http://mac-blog.org.ua/images/wp/image0.png\" alt=\"screenshot\"></p>\n<p>Теперь необходимо выслать файл 1753019.crt на <a href=\"mailto:ec@upc.ua\">ec@upc.ua</a> и дождаться ответа от них (пока не будет ответа, ничего работать не будет).</p>\n<p>В ответ они присылают простой ответ, типа \"Сертификат подгружен\" и все.</p>\n<p>На сервере нам понадобятся как минимум:</p>\n<p>test-server.cert - файл который они выслали в письме подтверждении регистрации (используется для проверки ответа)</p>\n<p>1753019.pem - файл (приватный ключ) который мы сгенерировали (используется для создания сигнатуры отправляемых данных)</p>\n<h2>Шаг 2. Страница заказа</h2>\n<p>Код страницы заказа:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span> <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//W3C//DTD XHTML 1.0 Transitional//EN\"</span> <span class=\"token string\">\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xhtml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Buy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$MerchantID</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'1753019'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TerminalID</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'E7881019'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$OrderID</span> <span class=\"token operator\">=</span> <span class=\"token number\">19</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$PurchaseTime</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"ymdHis\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TotalAmount</span> <span class=\"token operator\">=</span> <span class=\"token number\">242</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$CurrencyID</span> <span class=\"token operator\">=</span> <span class=\"token number\">980</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TerminalID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$PurchaseTime</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$OrderID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$CurrencyID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TotalAmount</span></span>;;\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$fp</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>.pem\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$priv_key</span> <span class=\"token operator\">=</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pkeyid</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_get_privatekey</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$priv_key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">openssl_sign</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$data</span> <span class=\"token punctuation\">,</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">openssl_free_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$b64sign</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://secure.upc.ua/ecgtest/enter<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Version<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>MerchantID<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$MerchantID</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TerminalID<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$TerminalID</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TotalAmount<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$TotalAmount</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Currency<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$CurrencyID</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>locale<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>RU<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PurchaseTime<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$PurchaseTime</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>OrderID<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$OrderID</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Signature<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$b64sign</span></span>\"</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n    Sum: <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$TotalAmount</span><span class=\"token delimiter important\">?></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Примечание:</p>\n<p><code class=\"language-text\">$data</code> генериться следующим образом</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MerchantId;TerminalId;PurchaseTime;OrderId,Delay;CurrencyId,AltCurrencyId;Amount,AltAmount;SessionData(SD);</code></pre></div>\n<p>Количество знаков <code class=\"language-text\">;</code> должно оставаться постоянным. Если какое то поле отсутствует, то ставится <code class=\"language-text\">;;</code>. Например, если отсутствует <code class=\"language-text\">SessionData(SD)</code>, то datafile будет выглядеть следующим образом:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MerchantId;TerminalId;PurchaseTime;OrderId,Delay;CurrencyId,AltCurrencyId;Amount,AltAmount;;</code></pre></div>\n<p>Если отсутствуют поля <code class=\"language-text\">Delay</code> или <code class=\"language-text\">AltCurrency</code>, <code class=\"language-text\">AltAmount</code> то запятая перед этими полями опускается. Например:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MerchantId;TerminalId;PurchaseTime;OrderId;CurrencyId,AltCurrencyId;Amount,AltAmount;;\n\nMerchantId;TerminalId;PurchaseTime;OrderId,Delay;CurrencyId;Amount;;\n\nMerchantId;TerminalId;PurchaseTime;OrderId;CurrencyId;Amount;;</code></pre></div>\n<p>в нашем случае использовался последний пример. Важно соблюдать порядок иначе ничего работать не будет, в коде использован самый простой рабочий пример.</p>\n<h2>Шаг 3. Страница удачной авторизации</h2>\n<p>Код страницы:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span> <span class=\"token name\">PUBLIC</span> <span class=\"token string\">\"-//W3C//DTD XHTML 1.0 Transitional//EN\"</span> <span class=\"token string\">\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xhtml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Type<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/html; charset=utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Buy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>SUCCESS<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>$_POST<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pre</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>code</span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>code</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pre</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Proccessing<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token variable\">$MerchantID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'MerchantID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TerminalID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TerminalID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$OrderID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'OrderID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$PurchaseTime</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'PurchaseTime'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TotalAmount</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TotalAmount'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$CurrencyID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'Currency'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$XID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'XID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$SD</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SD'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TranCode</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TranCode'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$ApprovalCode</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'ApprovalCode'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TerminalID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$PurchaseTime</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$OrderID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$XID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$CurrencyID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TotalAmount</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$SD</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TranCode</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$ApprovalCode</span></span>;\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'data: '</span><span class=\"token operator\">.</span><span class=\"token variable\">$data</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&lt;br />'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$HTTP_POST_VARS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"Signature\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$fp</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"test-server.cert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$cert</span> <span class=\"token operator\">=</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pubkeyid</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_get_publickey</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cert</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$ok</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_verify</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pubkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$ok</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"good\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$ok</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"bad\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"ugly, error checking signature\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">openssl_free_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pubkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Если все прошло успешно скрипт вернет good что говорит о том что проплата прошла успешно.</p>\n<p>Примечание:</p>\n<p>Тут тоже очень важно не напортачить с переменной $data, которая генериться следующим образом:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MerchantId;TerminalId;PurchaseTime;OrderId,Delay;Xid;CurrencyId,AltCurrencyId;Amount,AltAmount;SessionData;TranCode;ApprovalCode;</code></pre></div>\n<p>Правила те же самые если полей типа <code class=\"language-text\">Delay</code>, <code class=\"language-text\">AltCurrencyId</code>, <code class=\"language-text\">AltAmount</code> нет - запятая перед ними удаляется</p>\n<p>В идеале на странице <code class=\"language-text\">success.php</code> должна будет выглядеть так:</p>\n<p><img src=\"http://mac-blog.org.ua/images/wp/image1.png\" alt=\"screenshot\"></p>\n<h2>Шаг 4. Страница ошибки</h2>\n<p>Собственно здесь и делать нечего, из полученных данных отменяем заказ по <code class=\"language-text\">OrderID</code> и в зависимости от кода ответа показываем соотв. сообщение.</p>\n<h2>Тестовые карточки</h2>\n<p>Для тестирования можно использовать тестовые кредитки из документации <a href=\"http://ecommerce.upc.ua/site/docs.html\">http://ecommerce.upc.ua/site/docs.html</a></p>\n<p>На момент моих экспериментов они были следующими:</p>\n<table>\n<thead>\n<tr>\n<th>Обобщенные коды ответа для магазина</th>\n<th>Примерная интерпретация ответа на странице возврата электронного магазина</th>\n<th>Номер карты (срок действия 12/2012; CVV2 – 999)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>000</td>\n<td>Сделка авторизована</td>\n<td>4999999999990011</td>\n</tr>\n<tr>\n<td>105</td>\n<td>Тразакция не разрешена банком-эмитентом</td>\n<td>4999999999990029</td>\n</tr>\n<tr>\n<td>116</td>\n<td>Недостаточно средств</td>\n<td>4999999999990037</td>\n</tr>\n<tr>\n<td>111</td>\n<td>Несуществующая карта</td>\n<td>4999999999990045</td>\n</tr>\n<tr>\n<td>108</td>\n<td>Карта утеряна или украдена</td>\n<td>4999999999990052</td>\n</tr>\n<tr>\n<td>101</td>\n<td>Неверный срок действия карты</td>\n<td>4999999999990060</td>\n</tr>\n<tr>\n<td>130</td>\n<td>Превышен допустимый лимит расходов</td>\n<td>4999999999990078</td>\n</tr>\n<tr>\n<td>290</td>\n<td>Банк-издатель недоступен</td>\n<td>4999999999990086</td>\n</tr>\n<tr>\n<td>291</td>\n<td>Техническая или коммуникационная проблема</td>\n<td>4999999999990094</td>\n</tr>\n<tr>\n<td>401</td>\n<td>Ошибка формата</td>\n<td></td>\n</tr>\n<tr>\n<td>402</td>\n<td>Ошибки в параметрах Acquirer/Merchant</td>\n<td></td>\n</tr>\n<tr>\n<td>403</td>\n<td>Ошибки при соединении с ресурсом платежной системы (DS)</td>\n<td>4999999999990102</td>\n</tr>\n<tr>\n<td>404</td>\n<td>Ошибка аутентификации покупателя</td>\n<td>4999999999990110</td>\n</tr>\n<tr>\n<td>405</td>\n<td>Ошибка подписи</td>\n<td></td>\n</tr>\n<tr>\n<td>501</td>\n<td>Транзакция отменена пользователем</td>\n<td></td>\n</tr>\n<tr>\n<td>502</td>\n<td>Сессия браузера устарела</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h2>Данне которые мы передаем</h2>\n<p>Все данные передаются POST запросом на адрес <a href=\"https://secure.upc.ua/ecgtest/enter\">https://secure.upc.ua/ecgtest/enter</a></p>\n<table>\n<thead>\n<tr>\n<th>Параметр</th>\n<th>Название (назначение)</th>\n<th>Комментарий</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Version</td>\n<td>Значение версии интерфейса SG</td>\n<td>Версия протокола взаимодействия. Действующая версия в данный момент – 1v. Этот параметр является справочным для обработчика взодных данных шлюза.</td>\n</tr>\n<tr>\n<td>MerchantID</td>\n<td>Идентификатор торговца</td>\n<td>Выдается при регистрации</td>\n</tr>\n<tr>\n<td>TerminalID</td>\n<td>Идентификатор терминала</td>\n<td>Выдается при регистрации, завязан на кокнретный сайт</td>\n</tr>\n<tr>\n<td>TotalAmount</td>\n<td>Сумма заказа</td>\n<td>В мелких единицах валюты (копейки, центы)</td>\n</tr>\n<tr>\n<td>Currency</td>\n<td>Валюта</td>\n<td>Определяется договором с обслуживающим банком 643 руб. 840 у.е. 978 eur. 980 грн.</td>\n</tr>\n<tr>\n<td>AltTotalAmount (опционально)</td>\n<td>Сумма заказа (альтернативная валюта)</td>\n<td></td>\n</tr>\n<tr>\n<td>AltCurrency (опционально)</td>\n<td>Альтернативная Валюта</td>\n<td></td>\n</tr>\n<tr>\n<td>PurchaseTime</td>\n<td>Время запроса в формате yyMMddHHmmss или yyMMddHHmmssZ</td>\n<td>100921113510 Или 100921113510+0300 Если зона не указана используется та же что и у шлюза</td>\n</tr>\n<tr>\n<td>locale</td>\n<td>Язык интерфейса (en, ru, uk)</td>\n<td>Язык страницы шлюза</td>\n</tr>\n<tr>\n<td>OrderID</td>\n<td>Номер заказа длиной до 20 байт</td>\n<td></td>\n</tr>\n<tr>\n<td>SD (опционально)</td>\n<td>Session Data – данные сессии</td>\n<td></td>\n</tr>\n<tr>\n<td>PurchaseDesc (опционально)</td>\n<td>Краткое описание покупки товара (utf-8)</td>\n<td></td>\n</tr>\n<tr>\n<td>Signature</td>\n<td>Значение сгенерированной сигнатуры</td>\n<td>См. примечание</td>\n</tr>\n<tr>\n<td>Delay</td>\n<td>Идентификатор платежа пре-авторизация</td>\n<td>Для преавторизации, значение должно быть равно 1, иначе 0 или пусто. Хз, что это за хрень для работы не нужно</td>\n</tr>\n</tbody>\n</table>\n<p>Примечание: Генерация сигнатуры</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token variable\">$MerchantID</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'1753019'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TerminalID</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'E7881019'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$OrderID</span> <span class=\"token operator\">=</span> <span class=\"token number\">19</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$PurchaseTime</span> <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"ymdHis\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TotalAmount</span> <span class=\"token operator\">=</span> <span class=\"token number\">242</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$CurrencyID</span> <span class=\"token operator\">=</span> <span class=\"token number\">980</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TerminalID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$PurchaseTime</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$OrderID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$CurrencyID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TotalAmount</span></span>;;\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$fp</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>.pem\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$priv_key</span> <span class=\"token operator\">=</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pkeyid</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_get_privatekey</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$priv_key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">openssl_sign</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$data</span> <span class=\"token punctuation\">,</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">openssl_free_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$b64sign</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>Данные которые получаем в ответ</p>\n<p>Все данные передаются POST на страницу <code class=\"language-text\">success.php</code> (указаную в шаге 1)</p>\n<table>\n<thead>\n<tr>\n<th>Параметр</th>\n<th>Название (назначение)</th>\n<th>Комментарий</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MerchantID</td>\n<td>Идентификатор торговца</td>\n<td></td>\n</tr>\n<tr>\n<td>TerminalID</td>\n<td>Идентификатор терминала</td>\n<td></td>\n</tr>\n<tr>\n<td>TotalAmount</td>\n<td>Сумма заказа</td>\n<td></td>\n</tr>\n<tr>\n<td>Currency</td>\n<td>Валюта</td>\n<td></td>\n</tr>\n<tr>\n<td>AltTotalAmount (опционально)</td>\n<td>Сумма заказа (альтернативная валюта)</td>\n<td></td>\n</tr>\n<tr>\n<td>AltCurrency (опционально)</td>\n<td>Альтернативная Валюта</td>\n<td></td>\n</tr>\n<tr>\n<td>PurchaseTime</td>\n<td>Время запроса в формате yyMMddHHmmss</td>\n<td></td>\n</tr>\n<tr>\n<td>OrderID</td>\n<td>Номер заказа длиной до 20 байт</td>\n<td></td>\n</tr>\n<tr>\n<td>XID</td>\n<td>Идентификатор транзакции (номер заказа, дополненный до 20 символов)</td>\n<td></td>\n</tr>\n<tr>\n<td>SD</td>\n<td>Session Data – данные сессии</td>\n<td></td>\n</tr>\n<tr>\n<td>ApprovalCode</td>\n<td>Код авторизации хоста</td>\n<td></td>\n</tr>\n<tr>\n<td>Rrn</td>\n<td>Retrieval Reference Number</td>\n<td>Уникальный номер транзакции в системе авторизации и расчетов обслуживающего банка</td>\n</tr>\n<tr>\n<td>ProxyPan</td>\n<td>4 последние цифры номера карты.</td>\n<td>Пример: <code class=\"language-text\">499999******0011</code></td>\n</tr>\n<tr>\n<td>TranCode</td>\n<td>Код завершения тразакции</td>\n<td></td>\n</tr>\n<tr>\n<td>Signature</td>\n<td></td>\n<td>см. примечание</td>\n</tr>\n<tr>\n<td>Delay</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Email</td>\n<td></td>\n<td>Email – введенный пользователем на странице шлюза</td>\n</tr>\n</tbody>\n</table>\n<p>Примечание:</p>\n<p>Проверка данный ответа</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token variable\">$MerchantID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'MerchantID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TerminalID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TerminalID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$OrderID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'OrderID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$PurchaseTime</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'PurchaseTime'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TotalAmount</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TotalAmount'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$CurrencyID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'Currency'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$XID</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'XID'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$SD</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'SD'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$TranCode</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'TranCode'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$ApprovalCode</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'ApprovalCode'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"<span class=\"token interpolation\"><span class=\"token variable\">$MerchantID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TerminalID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$PurchaseTime</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$OrderID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$XID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$CurrencyID</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TotalAmount</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$SD</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$TranCode</span></span>;<span class=\"token interpolation\"><span class=\"token variable\">$ApprovalCode</span></span>;\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'data: '</span><span class=\"token operator\">.</span><span class=\"token variable\">$data</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'&lt;br />'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$HTTP_POST_VARS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"Signature\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$signature</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$signature</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$fp</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"test-server.cert\"</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$cert</span> <span class=\"token operator\">=</span> <span class=\"token function\">fread</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8192</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$fp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pubkeyid</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_get_publickey</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cert</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$ok</span> <span class=\"token operator\">=</span> <span class=\"token function\">openssl_verify</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$signature</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pubkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$ok</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"good\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$ok</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"bad\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"ugly, error checking signature\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">openssl_free_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pubkeyid</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span></code></pre></div>"}},"pageContext":{"id":"8e3915fa-feab-5198-a394-07a861929540"}},"staticQueryHashes":[]}
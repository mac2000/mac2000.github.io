{"componentChunkName":"component---src-templates-note-js","path":"/cloudelastic-restore-index-from-prod-to-dev/","result":{"data":{"remark":{"fields":{"path":"cloudelastic-restore-index-from-prod-to-dev"},"meta":{"title":""},"headings":[],"html":"<p>CloudElastic - restore index from prod to dev</p>\n<h2>Production Deployment</h2>\n<p>Get snapshot storage details</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /_snapshot/found-snapshots\n{\n  \"found-snapshots\": {\n    \"type\": \"gcs\",\n    \"uuid\": \"tVWAY9PxRiGvVueoQPJw5Q\",\n    \"settings\": {\n      \"bucket\": \"bucketname\",\n      \"aws_account\": \"operations-1-europe-west3\",\n      \"use_for_peer_recovery\": \"true\",\n      \"client\": \"elastic-internal-7547ec\",\n      \"base_path\": \"snapshots/7547ec6fc9394d3582bd1611ee7e953c\",\n      \"region\": \"europe-west3\",\n      \"email\": \"bucketname@cloud-production-storage.iam.gserviceaccount.com\"\n    }\n  }\n}</code></pre></div>\n<h2>Development Deployment</h2>\n<p>Attach production storage</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PUT /_snapshot/production\n{\n  \"type\": \"gcs\",\n  uuid\" : \"tVWAY9PxRiGvVueoQPJw5Q\",\n  \"settings\": {\n    \"bucket\": \"bucketname\",\n    \"aws_account\": \"operations-1-europe-west3\",\n    \"use_for_peer_recovery\": \"true\",\n    \"client\": \"elastic-internal-cb03d5\",\n    \"base_path\": \"snapshots/7547ec....\",\n    \"region\": \"europe-west3\",\n    \"email\": \"u358@cloud-production-storage.iam.gserviceaccount.com\"\n  }\n}</code></pre></div>\n<p>Notes:</p>\n<ul>\n<li>it should fail with error “Unknown client name [elastic-internal-7547ec]. Existing client configs: elastic-internal-167eab,default“ just replace client from <code class=\"language-text\">elastic-internal-cb03d5</code> to <code class=\"language-text\">elastic-internal-167eab</code>.</li>\n<li>just in case add <code class=\"language-text\">\"readonly\": true</code> to settings, even if forgotten just rerun command with this addition</li>\n</ul>\n<p>Now you should see available production snapshots</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /_snapshot/production\n\nGET /_snapshot/production/_all\n\nGET /_cat/snapshots/production</code></pre></div>\n<h2>Restore index</h2>\n<p>Details and docs can be found here: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.17/snapshots-restore-snapshot.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/snapshots-restore-snapshot.html</a></p>\n<p>In general there are two cases: restoring of existing and non existing index, second one requires additional steps.</p>\n<h2>Restore non existing index</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST _snapshot/production/cloud-snapshot-2023.08.22-59zqlj4fshogwahszpa5jg/_restore\n{\n  \"indices\": \"user_data_viewed_vacancy_09082023\"\n}</code></pre></div>\n<h2>restore existing index</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /user_data_viewed_vacancy_03032022/_search\n\n\nPOST _snapshot/production/cloud-snapshot-2023.08.22-59zqlj4fshogwahszpa5jg/_restore\n{\n  \"indices\": \"user_data_viewed_vacancy_03032022\",\n  \"rename_pattern\": \"(.+)\",\n  \"rename_replacement\": \"restored_$1\"\n}\n\nGET /user_data_viewed_vacancy_03032022/_search\nGET /restored_user_data_viewed_vacancy_03032022/_search\n\nDELETE /user_data_viewed_vacancy_03032022\n\nPOST _reindex\n{\n  \"source\": {\n    \"index\": \"restored_user_data_viewed_vacancy_03032022\"\n  },\n  \"dest\": {\n    \"index\": \"user_data_viewed_vacancy_03032022\",\n    \"op_type\": \"create\"\n  }\n}\n\nGET /user_data_viewed_vacancy_03032022/_search\nGET /restored_user_data_viewed_vacancy_03032022/_search\nDELETE /restored_user_data_viewed_vacancy_03032022</code></pre></div>\n<p>Notes:</p>\n<ul>\n<li>while restoring we can <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html#restore-different-cluster\">decrease number of replicas</a></li>\n<li>we can <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-restore-snapshot.html#monitor-restore\">monitor restore</a></li>\n</ul>"}},"pageContext":{"id":"ac93fafb-edba-5ea4-8788-285ab0490157"}},"staticQueryHashes":[],"slicesMap":{}}
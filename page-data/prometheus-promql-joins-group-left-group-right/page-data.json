{"componentChunkName":"component---src-templates-note-js","path":"/prometheus-promql-joins-group-left-group-right/","result":{"data":{"remark":{"fields":{"path":"prometheus-promql-joins-group-left-group-right"},"meta":{"title":""},"headings":[{"value":"How to: Prometheus PromQL joins, group_left, group_right"},{"value":"Intersections - aka left/right outer/inner joins"},{"value":"Практический пример: следим за временем ответа сервиса после релиза"}],"html":"<h1>How to: Prometheus PromQL joins, group_left, group_right</h1>\n<p>Заметка по горячим следам, т.к. оно нужно раз в пяти летку и каждый раз вызывает сложности что бы вспомнить с какого боку подойти</p>\n<p>Плюс бонусом - навороченный use case</p>\n<blockquote>\n<p>читать все это имеет смысл только после базового ознаномления с прометеем, в сети навалом материалов, есть <a href=\"https://www.youtube.com/watch?v=C6PBpajInvI\">запись видосика</a> где это делали мы</p>\n</blockquote>\n<h2>join left</h2>\n<p>наиболее часто пользуемый на практике пример - добавить лейбочку овнера к метрике</p>\n<p><strong>TLDR:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">метрика_которую_мы_крутим\n* on(пересекающиеся лейбочки...) group_left(лейбочка_которую_хотим_добавить) max(меткрика-мета-данных) by(пересекающиеся лейбочки...)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">container_memory_usage_bytes\n* on(namespace, pod) group_left(annotation_owner) max(kube_pod_annotations) by (namespace, pod, annotation_owner)</code></pre></div>\n<p>Посколку прометей работает с временными рядами и тут всегда все пляшек вокруг значения той или иной метрики, джойнов как таковых нет в принципе</p>\n<p>Но, при этом, фигачить в каждую метрику 100500 лейбочек нецелесообразно, т.к. раздует и замедлит базу</p>\n<p>Поэтому в прометее принято иметь эдакие метрики-мета-данные, у которых значение всегда равно единичке и на борту все искомые лейбочки</p>\n<p>На примере метрики потребления памяти контейнером имеем следующее:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0fb8c8b8b875f3f00349448043d0ec4d/60708/image-20230811-090304.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVR42o2QW26EMAxFs/81dA/dR3+6AiDkNQUSHjMJqBC4dZIZqVJ/GunIj9hXttndBzyINazYtg3Xdf2b44j43g+sjwXvn3e8fUQwtwRse8Q4z7BuQnoxnjjPxC+B869gqosxPmsLrG44pNKoao6KfK0NpNQFZfJf1/Vw1mEg+sGi7222luJxnDLD4OBpU1ZVNRreEhycbN00SDneCrREygkhi5Uyi391XcY6h3lZsNKpfAjY9x2sFYKmUWipKTVIpXKstIYxtzzxC3Oj2BQ/iU1Tmc57n8XSyj8wEntCcmZ5VwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/0fb8c8b8b875f3f00349448043d0ec4d/2bef9/image-20230811-090304.png\"\n        srcset=\"/static/0fb8c8b8b875f3f00349448043d0ec4d/6f3f2/image-20230811-090304.png 256w,\n/static/0fb8c8b8b875f3f00349448043d0ec4d/01e7c/image-20230811-090304.png 512w,\n/static/0fb8c8b8b875f3f00349448043d0ec4d/2bef9/image-20230811-090304.png 1024w,\n/static/0fb8c8b8b875f3f00349448043d0ec4d/71c1d/image-20230811-090304.png 1536w,\n/static/0fb8c8b8b875f3f00349448043d0ec4d/a878e/image-20230811-090304.png 2048w,\n/static/0fb8c8b8b875f3f00349448043d0ec4d/60708/image-20230811-090304.png 2872w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>У нас есть метрика, показывающая сколько памяти ест контейнер, у нее есть ряд лейбочек, среди которых есть лейбочка pod</p>\n<p>Вокруг подов есть целый ряд метрик <code class=\"language-text\">kube_pod_*</code>, среди которых есть вот такая:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13cd45790094c2928d1ea64c1316d2d8/0b569/image-20230811-092022.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.96875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAkElEQVR42pWOXQ4CIQyEuf+5vISv/kQMa6AtcTdKO3ZZsolv2mQyYQrfEDIJiAXzvMAAqNlfereGV1PMT8HhmBFkUQ8NhRgsFeuYGX4dVUNzYFPtHm4xIqUJp8sVMd5RawUz+68J1QvIi0Sk57kUL5UuGSLe9jw8nB00pUcP1kdEtAEHaD1/AX3XNcBlv7/5B7UwNlTLN1KDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/13cd45790094c2928d1ea64c1316d2d8/2bef9/image-20230811-092022.png\"\n        srcset=\"/static/13cd45790094c2928d1ea64c1316d2d8/6f3f2/image-20230811-092022.png 256w,\n/static/13cd45790094c2928d1ea64c1316d2d8/01e7c/image-20230811-092022.png 512w,\n/static/13cd45790094c2928d1ea64c1316d2d8/2bef9/image-20230811-092022.png 1024w,\n/static/13cd45790094c2928d1ea64c1316d2d8/71c1d/image-20230811-092022.png 1536w,\n/static/13cd45790094c2928d1ea64c1316d2d8/a878e/image-20230811-092022.png 2048w,\n/static/13cd45790094c2928d1ea64c1316d2d8/0b569/image-20230811-092022.png 2878w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>В чем идея (или как это работает):</p>\n<blockquote>\n<p>Поскольку значение метрики равно единичке, мы должны мочь перемножить <code class=\"language-text\">container_memory_usage_bytes</code> на <code class=\"language-text\">kube_pod_annotations</code>, значение потребления памяти останется неизменным, но при этом добавятся лейбочки</p>\n</blockquote>\n<p>Реалии: так не работает</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb829cd2d8beba30e6678b4f6a31af6e/93ba6/image-20230811-092107.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.84375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAgElEQVR42oXNTQrCMBCG4d5/553c9AwiItSoJGmsyeSnyeQzKV0KHXgYZvPOQD7AOgIRIYQA37h2W+uQc0afWutfzIw1F6ToMV4MTueC4Xq7Qy2ElFZM4okQ4xZhriilHOpPc9s9XrkFe2R6CEipIF5vSKWhZ7P7HJp3ShssX4sfVnXnN4YeLA8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/fb829cd2d8beba30e6678b4f6a31af6e/2bef9/image-20230811-092107.png\"\n        srcset=\"/static/fb829cd2d8beba30e6678b4f6a31af6e/6f3f2/image-20230811-092107.png 256w,\n/static/fb829cd2d8beba30e6678b4f6a31af6e/01e7c/image-20230811-092107.png 512w,\n/static/fb829cd2d8beba30e6678b4f6a31af6e/2bef9/image-20230811-092107.png 1024w,\n/static/fb829cd2d8beba30e6678b4f6a31af6e/71c1d/image-20230811-092107.png 1536w,\n/static/fb829cd2d8beba30e6678b4f6a31af6e/a878e/image-20230811-092107.png 2048w,\n/static/fb829cd2d8beba30e6678b4f6a31af6e/93ba6/image-20230811-092107.png 2874w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Не работает потому что прометей по умолчанию перемножает метрики у которых все все лейбочки совпали, а в нашем случае это не возможно, так как у метрик бонально разные наборы этих самых лейбочек</p>\n<p>Для этого у операции умножения, как в прочем и вообще всех остальных операций, есть воможность уточнить по какому набору лейбочек подбирать метрики</p>\n<p>Со стороны прометея это выглядит вот так:</p>\n<p>container_memory_usage_bytes * on(namespace, pod) kube_pod_annotations</p>\n<p>Думать про это есть смысл как о таком SQL запросе:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n  CMUB<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token punctuation\">,</span>\n  CMUB<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span> <span class=\"token operator\">*</span> KPA<span class=\"token punctuation\">.</span><span class=\"token keyword\">value</span>\n<span class=\"token keyword\">FROM</span> container_memory_usage_bytes <span class=\"token keyword\">AS</span> CMUB\n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> kube_pod_annotations <span class=\"token keyword\">AS</span> KPA <span class=\"token keyword\">ON</span> CMUB<span class=\"token punctuation\">.</span>namespace <span class=\"token operator\">=</span> KPA<span class=\"token punctuation\">.</span>namespace <span class=\"token operator\">AND</span> CMUB<span class=\"token punctuation\">.</span>pod <span class=\"token operator\">=</span> KPA<span class=\"token punctuation\">.</span>pod</code></pre></div>\n<p>Реалии:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/917192f0c2110521386ebbd36237943e/b8765/image-20230811-092304.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.96875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAl0lEQVR42p3NXQ6DIBAEYO5/qx6gR+iDgisIq9RK1aCOa9Kkv08l+cJmstlR0RA6waVBJItOGwyFRpT/yFpdoa8d5jaKDvl6+9YPmLzD6UxQfDFImjCZCqN+qOg5i3uppaREkqLceCw+/MDYmKFiGpGmGY5bkCwfL68rlm17s0p++MxfZaEKaaXawroGtXUIctgH/kvjA3YAxTBitT37ZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/917192f0c2110521386ebbd36237943e/2bef9/image-20230811-092304.png\"\n        srcset=\"/static/917192f0c2110521386ebbd36237943e/6f3f2/image-20230811-092304.png 256w,\n/static/917192f0c2110521386ebbd36237943e/01e7c/image-20230811-092304.png 512w,\n/static/917192f0c2110521386ebbd36237943e/2bef9/image-20230811-092304.png 1024w,\n/static/917192f0c2110521386ebbd36237943e/71c1d/image-20230811-092304.png 1536w,\n/static/917192f0c2110521386ebbd36237943e/a878e/image-20230811-092304.png 2048w,\n/static/917192f0c2110521386ebbd36237943e/b8765/image-20230811-092304.png 2868w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Запрос не отрабатывает потому что в одном из подмножеств (не важно левом или правом) нашлось больше одной записи с одинаковыми значениями для лейбочек namespace, pod</p>\n<p>Соотв нам нужно или больше лейбочек добавить что бы было четкое соотв, НО, это не всегда возможно</p>\n<p>Для подобного сценария, в разрезе метрик-метаданных, делается следующий трюк:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">max(kube_pod_annotations) by (namespace, pod, label_app)</code></pre></div>\n<blockquote>\n<p>Значение метрики то у нас всегда 1, мы по сути просто убираем все лишнее, группируем, схлопываем</p>\n</blockquote>\n<p>Реалии:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5df76b9eb2114e9b9eae26818c26b0ef/93ba6/image-20230811-092406.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.359375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAqUlEQVR42nWPCwrDIBBEvf81epPeoxDzNSYmJk2UUnU60tAfVHi8cRddViyqh1UKc9thZl57jWvdYKNN96xb2vYDlqqG1wMce45vvJkQtp04bFrhdDYQ9iKxyha+rEgNJ+mqwU7n/HJRwrF/58dBj2/y/eCuNISeFmz+hpWTZNMinxAjYkoICYhIzDjINRIP/5D7opAlGq6lOa3laoZrjOMn5tvmP8No8ACCLi/sRkHrigAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/5df76b9eb2114e9b9eae26818c26b0ef/2bef9/image-20230811-092406.png\"\n        srcset=\"/static/5df76b9eb2114e9b9eae26818c26b0ef/6f3f2/image-20230811-092406.png 256w,\n/static/5df76b9eb2114e9b9eae26818c26b0ef/01e7c/image-20230811-092406.png 512w,\n/static/5df76b9eb2114e9b9eae26818c26b0ef/2bef9/image-20230811-092406.png 1024w,\n/static/5df76b9eb2114e9b9eae26818c26b0ef/71c1d/image-20230811-092406.png 1536w,\n/static/5df76b9eb2114e9b9eae26818c26b0ef/a878e/image-20230811-092406.png 2048w,\n/static/5df76b9eb2114e9b9eae26818c26b0ef/93ba6/image-20230811-092406.png 2874w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Оно все так же не работает, но нам никто не запрещает сделать что то похожее с левой стороной, условно:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70f664df3bf4d7867f76d0b3981322c6/39148/image-20230811-092440.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.359375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoklEQVR42o2PSw4CIRBEubyX8iwaE8eJzF9o/jBTNixcqhXehhTNazGNI1Y5QCsFay2ICUSIjPcBTmlEY2CcA5FpWO/h+C7wmxwjygF4WnE6E4Q2ASFk5BRhnccnx8HnN7mURkoJk4oQkg2VJshhxOV6Q+Qfc84oXPpn4L7vMGzreIMace86TPMMyWvPy4KnlNi2VyvU8rdhNdXs0fcsNDSJN0qkNuE9zmi1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/70f664df3bf4d7867f76d0b3981322c6/2bef9/image-20230811-092440.png\"\n        srcset=\"/static/70f664df3bf4d7867f76d0b3981322c6/6f3f2/image-20230811-092440.png 256w,\n/static/70f664df3bf4d7867f76d0b3981322c6/01e7c/image-20230811-092440.png 512w,\n/static/70f664df3bf4d7867f76d0b3981322c6/2bef9/image-20230811-092440.png 1024w,\n/static/70f664df3bf4d7867f76d0b3981322c6/71c1d/image-20230811-092440.png 1536w,\n/static/70f664df3bf4d7867f76d0b3981322c6/a878e/image-20230811-092440.png 2048w,\n/static/70f664df3bf4d7867f76d0b3981322c6/39148/image-20230811-092440.png 2876w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>И наконец то запрос отработал, вот только толку от этого мало, так как лейбочки то не добавились</p>\n<p>Вот тут в игру и вступает <code class=\"language-text\">group_left</code>, просто добавляем его следом за on, причем уже не обязательно группировать левую часть</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">container_memory_usage_bytes * on(namespace, pod) group_left(annotation_owner) max(kube_pod_annotations) by (namespace, pod, annotation_owner)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e5068ee3e8fc79eebc0971c916aab401/1a466/image-20230811-092605.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.765625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPklEQVR42k2RSVLEMAxFc1bux5KDsKEois5gO+mkM3ecxBk/X+6GYvFKlmRL31LQDRblrUJ3K1E3LdphwGItHO0wjhiJJbNzjFms0+Tzix2x7zv2E9iXEW/vHV5eDwRlWWOYN5zHie5+h1sW4DzpHzjIyfPx5GQBif/B2MbYtm2Y3IZ+2hB8X0LEiYJOM3x8fkFpg4Jqs2uOq5AXyIsb2rZDQ+QXDamfSLzv77QtrB2osKogRaM4QRTFiGnDMMIlfDQSX3JKafrJXwNBGhe0A0cwzbMnqJsGmqr8Y5Io5R97tEaapjBEm9T7ojrlb+RcFAXqukbX93Cc8bquCCrOUFT8L5Q8iwveZ05i2hiPFPu9Lw1kcVJMbFCxgyRFhaEK6S6KlTJ+nr6IfiB30ix7qDapz+V5jomb37kk5xb8AF+FDX4+D5EEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/e5068ee3e8fc79eebc0971c916aab401/2bef9/image-20230811-092605.png\"\n        srcset=\"/static/e5068ee3e8fc79eebc0971c916aab401/6f3f2/image-20230811-092605.png 256w,\n/static/e5068ee3e8fc79eebc0971c916aab401/01e7c/image-20230811-092605.png 512w,\n/static/e5068ee3e8fc79eebc0971c916aab401/2bef9/image-20230811-092605.png 1024w,\n/static/e5068ee3e8fc79eebc0971c916aab401/71c1d/image-20230811-092605.png 1536w,\n/static/e5068ee3e8fc79eebc0971c916aab401/a878e/image-20230811-092605.png 2048w,\n/static/e5068ee3e8fc79eebc0971c916aab401/1a466/image-20230811-092605.png 2882w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Механика такова:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">метрика_которую_мы_крутим\n* on(пересекающиеся лейбочки...) group_left(лейбочка_которую_хотим_добавить) max(меткрика-мета-данных) by(пересекающиеся лейбочки...)</code></pre></div>\n<p>Примечание: если не делать группировки, запрос может отваливаться с ошибками о дубликатах записей с левой или правой стороны, собенно в момент релиза, когда метрики могут задваиваться, это особенно часто вылазит когда мы меряем rate за период в Х минут, и может так получиться что в промежутке этих Х минут еще была старая метрика и уже появилась новая</p>\n<h1>Intersections - aka left/right outer/inner joins</h1>\n<p>Просто замечательная статья еще и с картинками - must have к осознанию</p>\n<p><a href=\"https://iximiuz.com/en/posts/prometheus-vector-matching/\">https://iximiuz.com/en/posts/prometheus-vector-matching/</a></p>\n<p>Прометей все так же не имеет такого понятия кака join, НО, при этом очень даже хорошо работает с множествами</p>\n<p>Ключевые слова: <code class=\"language-text\">and</code>, <code class=\"language-text\">or</code>, <code class=\"language-text\">unless</code>, при этом у них все так же можно добавить <code class=\"language-text\">on</code>, как мы делали при умножении</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/677bb9807709f7dfb7ee752940f30907/37523/image-20230811-093359.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.46875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACIklEQVR42lVSa4+aUBD1//+KNk0/tNk22dYm3ceHxn7QNVXU9YWKIgICyhvh4gVOB1x1nYRw75mZc2fmTI3zAmma42xFATCWX84xu/reW3oswLOiiim/s9XmqwPuHy0MxRDNfy6G0xCNFwfCMIAoReQz0Rn4FaZoCVabGK2Oh790f+l6aNHX7LhVTBxnqB2pwr19hGExLOQD/VMwqlgzGMJDhgMFlb7yrpkMR6pMp3MQEb5LoW4Z/JCj3fMI46idS83zAvNVhPE8xHgWVq9GRKhuE/RGARotG23BqzooW50tIwzGAVQ9ueRXLZ9nVVoY5ZDV06tlu2V1ls1h7jgkmWG6iDGi0eztFDvCbZfTLG9nWxE6jou1ssZmo8AyNRKJVU7P86GpOnzPgWMbJNahwuMkhrLWocga+sIEa9lAXpzEq5mmBT/w8NqT8fCrS1XRHA2LSFM81UXU7yS0ml1EUQSVyKkfTMcK/jys8e2zgLtPfTzXZYiT1YlQ03QcOcNkpKL+XQDnKREapFiM3/czNB51SNKKZpSjfDzPs4rw6YeMLx8EfP34iuefCpaSdiLMsgy7/R66rmIqipRkIgiCyqkqtDLtFWYzCYa5he04l5b73QUGgoRBb4nZVCcd8usMU8ZhbWPYtDKhz942nPAkg+8ywhn5I4q7LnmW5XD3xzesuBWlBEsyZ8fAkmtSTGsT+hwuqVoml/f3a+Y5tLNJdqPyf9EWPOPREMQUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/677bb9807709f7dfb7ee752940f30907/37523/image-20230811-093359.png\"\n        srcset=\"/static/677bb9807709f7dfb7ee752940f30907/6f3f2/image-20230811-093359.png 256w,\n/static/677bb9807709f7dfb7ee752940f30907/01e7c/image-20230811-093359.png 512w,\n/static/677bb9807709f7dfb7ee752940f30907/37523/image-20230811-093359.png 720w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Примечание: ключевое отличие от привычного нам SQL - прометей возвращает левое подмножество которое подпадает под условия пересечения (то есть это не о том что бы добавлять лейбочки или перемножать значения, а о том что бы фильтровать (WHERE) результат)</p>\n<p>Что бы было совсем понятнее вот пример запроса который возвращает 274 метрики подов у которых в названии есть слово <code class=\"language-text\">vacancy</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/201b18f5169ce8e03a024cad9fc691f4/1a466/image-20230811-094509.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.65625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0klEQVR42o1QWW7DIBTk/ifqPfKXJnEUs9iAWxys1GabPLDSfFUq0oh527wB5u4ed79gWSo8frzHSoghIgNIOSOX8idiSggx4eEdPg4ObFkTYi7wJPrtZtRTqPG/p7zESSOlDCaEgFIK50vXME1f0FpjJBhroUdNsYExxM37tnb6zddeN88IIYAdP08kdMHt1kMNAzgtaOACQkj0PW+85nrOCbXGIaUkKDKzz0gy5emrWNdd29AwjrTJtK3VQeV7rKmmd25ejkxz1V5Tc3Z3vW0bnmLgfFpCbRq/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/201b18f5169ce8e03a024cad9fc691f4/2bef9/image-20230811-094509.png\"\n        srcset=\"/static/201b18f5169ce8e03a024cad9fc691f4/6f3f2/image-20230811-094509.png 256w,\n/static/201b18f5169ce8e03a024cad9fc691f4/01e7c/image-20230811-094509.png 512w,\n/static/201b18f5169ce8e03a024cad9fc691f4/2bef9/image-20230811-094509.png 1024w,\n/static/201b18f5169ce8e03a024cad9fc691f4/71c1d/image-20230811-094509.png 1536w,\n/static/201b18f5169ce8e03a024cad9fc691f4/a878e/image-20230811-094509.png 2048w,\n/static/201b18f5169ce8e03a024cad9fc691f4/1a466/image-20230811-094509.png 2882w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>И вот такой запрос к метаданным, для подов у которых овнером числиться Вадим или Аня</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8c61f9864e8f5ebcb6d9da05dee8f087/93ba6/image-20230811-094641.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAk0lEQVR42lWO/QrCMAzE9/5P5JuI/6/qhGnXZOtX0jMtQzDwI5fjSDL5LcBzQkwZcT9QUkLNGRIjpOsTFUGv1tqgl6oiF7F8wtUxLreKaXYPEB9IucDdn6B9hzZFrXVQDLFltQpKKX9+79m8kdF+UDEtywuzc/h4j3V9I4QAIhqdmX8zmfaWIeKhh2fwqdkeEVF8Aa0P6JN+APCLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/8c61f9864e8f5ebcb6d9da05dee8f087/2bef9/image-20230811-094641.png\"\n        srcset=\"/static/8c61f9864e8f5ebcb6d9da05dee8f087/6f3f2/image-20230811-094641.png 256w,\n/static/8c61f9864e8f5ebcb6d9da05dee8f087/01e7c/image-20230811-094641.png 512w,\n/static/8c61f9864e8f5ebcb6d9da05dee8f087/2bef9/image-20230811-094641.png 1024w,\n/static/8c61f9864e8f5ebcb6d9da05dee8f087/71c1d/image-20230811-094641.png 1536w,\n/static/8c61f9864e8f5ebcb6d9da05dee8f087/a878e/image-20230811-094641.png 2048w,\n/static/8c61f9864e8f5ebcb6d9da05dee8f087/93ba6/image-20230811-094641.png 2874w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Ну и собственно говоря их пересечение: запрос показывает потребление памяти подами у которых в названии есть искомое слово и овнер</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3d31bac8ebea27c9ac0c93f207e1c5cc/1a466/image-20230811-094901.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/0lEQVR42k1QR3LEIBDU9/xE3/wWP8E327XKJUCrgFAEIdqN9uKp6prAhKaTQRsIpSDLEkoITM8ntr7HPmq4ZYFbV7h5hjsO7NsGy/x0DgHAdV3wF/0x4/1zxNtHQDLqCXq1cNbdA/48gRAQ2By8f4G1mF//4miBfZ4b/elQDxZfwiNJ8xJt10NPBt+/D8YdlmWFIauZDI2ZMRlz+1iLiHnEHGPORTi787gjQ34tzwtUdQ3VtlCqhaQEQko0jYCUCg2lEEIS4lWnV+zpeHwYBvRRon2HpRRJHP4hs4xL0yy/fVFWyItX/kgzFEV51+83xjeBqobW1JlLop2UIi78A7biewwZKZF5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/3d31bac8ebea27c9ac0c93f207e1c5cc/2bef9/image-20230811-094901.png\"\n        srcset=\"/static/3d31bac8ebea27c9ac0c93f207e1c5cc/6f3f2/image-20230811-094901.png 256w,\n/static/3d31bac8ebea27c9ac0c93f207e1c5cc/01e7c/image-20230811-094901.png 512w,\n/static/3d31bac8ebea27c9ac0c93f207e1c5cc/2bef9/image-20230811-094901.png 1024w,\n/static/3d31bac8ebea27c9ac0c93f207e1c5cc/71c1d/image-20230811-094901.png 1536w,\n/static/3d31bac8ebea27c9ac0c93f207e1c5cc/a878e/image-20230811-094901.png 2048w,\n/static/3d31bac8ebea27c9ac0c93f207e1c5cc/1a466/image-20230811-094901.png 2882w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Примечание: тут, забегая на перед, я добавил on(namespace, pod) и группировку правой части - по сути тут все один в один то же самое что и в пред примере с джойном лейбочек</p>\n</blockquote>\n<p>В SQL это было бы что то типа:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> CMUB<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n<span class=\"token keyword\">FROM</span> container_memory_usage_bytes <span class=\"token keyword\">AS</span> CMUB\n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> kube_pod_annotations <span class=\"token keyword\">AS</span> KPA <span class=\"token keyword\">ON</span> CMUB<span class=\"token punctuation\">.</span>namespace <span class=\"token operator\">=</span> KPA<span class=\"token punctuation\">.</span>namespace <span class=\"token operator\">AND</span> CMUB<span class=\"token punctuation\">.</span>pod <span class=\"token operator\">=</span> KPA<span class=\"token punctuation\">.</span>pod\n<span class=\"token keyword\">WHERE</span> CMUB<span class=\"token punctuation\">.</span>pod <span class=\"token operator\">LIKE</span> <span class=\"token string\">'%vacanc%'</span> <span class=\"token operator\">AND</span> KPA<span class=\"token punctuation\">.</span>annotation_owner <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'annae@rabota.ua'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'VadimK@rabota.ua'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Точно таким же образом работают <code class=\"language-text\">or</code> и <code class=\"language-text\">unless</code></p>\n<blockquote>\n<p>Примечание: на первый взгляд кажеться дичью и мол типа привычнее в SQL, НО, это только на первый взгляд и если рассмотреть более заковыристые примеры как дальше, уже нифига не очевидно будет как написать такой SQL запрос в принципе, а в PromQL оно плюс минус остается удобоваримым</p>\n</blockquote>\n<h1>Практический пример: следим за временем ответа сервиса после релиза</h1>\n<p><strong>Вводные:</strong></p>\n<ul>\n<li>у нас есть метрики ингресса позволяющие ответить на вопрос какое время ответа у конретно взятого сервиса</li>\n<li>абсолютно все запросы идут через ингрес - потому метрика есть для всего</li>\n<li>мы технически можем и даже имели алерты с какими то порогами - типа если сервис начал тупить - булькает</li>\n<li>в тот момент времени для нас это было сильно рано, потому эти алерты выключили</li>\n</ul>\n<p><strong>Идея:</strong> что если бы алерт был “умным” и триггерился бы после релиза, если сервис начал тупить</p>\n<p><strong>Механика:</strong></p>\n<ul>\n<li>релиз</li>\n<li>пересоздаются поды</li>\n<li>как следствие их метрика kube_pod_created будет показывать свежую цифру</li>\n<li>смотрим поды у которых kube_pod_created меньше часа</li>\n<li>для этих подов смотрим время ответа ингресс</li>\n<li>если оно в полтора раза больше чем вчера в это же время</li>\n<li>если все это продолжается десять минут</li>\n<li>алерт</li>\n</ul>\n<p>Теперь вопрос как это все в кучу собрать</p>\n<p>Время ответа сервиса мы считам так (тут ничего особенного самый обычный запрос которые мы уже разобрали в доль и поперек <a href=\"https://www.youtube.com/watch?v=C6PBpajInvI\">тут</a>)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aac425a5879ba8107eae475c9e7f06ce/3162c/image-20230811-100734.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.34375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAz0lEQVR42n2QWW7DMAxEdcGeschdeoygSVDYieNFm63IEqUJJSOFP9oQeBA/qBlyhDQzOinRNQ3kNMHOM5RS0NpAGQNpDZzS8NwnSsgZv6SUEYl5GHx+jfg4ZIhhktAuYA0Rzjl4v/JgAhGB0kaijcwqe4gNQiDEENCbFceeII7fZ0xSw1iL0+UHIxuU2j5hR/6TGCP2JWQ5t7ujba/1XZaFXSMT6pb/Cb2wdq6iVK7iCMS979G0La63G4ZhrPl57ytl8J1YqZo1Z1wWKBs+Ad2zhHWaXtAjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/aac425a5879ba8107eae475c9e7f06ce/2bef9/image-20230811-100734.png\"\n        srcset=\"/static/aac425a5879ba8107eae475c9e7f06ce/6f3f2/image-20230811-100734.png 256w,\n/static/aac425a5879ba8107eae475c9e7f06ce/01e7c/image-20230811-100734.png 512w,\n/static/aac425a5879ba8107eae475c9e7f06ce/2bef9/image-20230811-100734.png 1024w,\n/static/aac425a5879ba8107eae475c9e7f06ce/71c1d/image-20230811-100734.png 1536w,\n/static/aac425a5879ba8107eae475c9e7f06ce/a878e/image-20230811-100734.png 2048w,\n/static/aac425a5879ba8107eae475c9e7f06ce/3162c/image-20230811-100734.png 2750w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Для красоты чиним NaN добавляя условие <code class=\"language-text\">> 0</code> в правую часть</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bcce1b0ed8e6c0920163be3433c4dc38/990be/image-20230811-100817.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.296875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7klEQVR42oWRXW7DIBCEuWhP0WPlqUfoW0/RqrXjxAYb82MMGJgs9kPbtFJW+oS0gtnZgQ1KgfdXiGGA0obQULOCor40BlIZuFkiOIdSyl8AeDPh+cXi6QQwoRdI7eCshV0WhBCwriu893CEDQmRzlgFc8bP2lKCjxu8W/D24fH6nsCUsQjU1OSmOXf7xTr5qN9O7t1lGlA57lcyWNuece17NG2LgXMkmvrvanfUqltoiijGiEy9lAvY51eDrrvsomIc93W3bXsovAtSPEKMMBRXKYdTxoXANElwLnYWytFRXjXLR4LVmZxnevP9YTeKQdJCSh0fAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/bcce1b0ed8e6c0920163be3433c4dc38/2bef9/image-20230811-100817.png\"\n        srcset=\"/static/bcce1b0ed8e6c0920163be3433c4dc38/6f3f2/image-20230811-100817.png 256w,\n/static/bcce1b0ed8e6c0920163be3433c4dc38/01e7c/image-20230811-100817.png 512w,\n/static/bcce1b0ed8e6c0920163be3433c4dc38/2bef9/image-20230811-100817.png 1024w,\n/static/bcce1b0ed8e6c0920163be3433c4dc38/71c1d/image-20230811-100817.png 1536w,\n/static/bcce1b0ed8e6c0920163be3433c4dc38/a878e/image-20230811-100817.png 2048w,\n/static/bcce1b0ed8e6c0920163be3433c4dc38/990be/image-20230811-100817.png 2748w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Пользуясь заметками о джойнах добавляем овнера</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06082bb029fc86c82901346ed08b76d4/8fc63/image-20230811-100918.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.609375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+UlEQVR42l2QW07EMAxFuyz2xILYBr/sgS8+kWaqmck0zbPNtE3bvC5JoAJh6VqOLR9fpZFmwo0JUNKBcgmpDaQcIPQIliXyfFAjzGCwrg77HrBtDiFElEgl+Q1vHxpPL0Az2g2fRON812jFBNIPuBKJcz/i1A1omam6dBpdb8DVAipm2AxNKWFzAX5f8X564PnVo2kvVzzsDh8COOeY5un7coolHR7+RPqZp6oYY3YbsnzuBjQ3cseNEPSModS0Z5BKgTGeDwhYu9Zjzrm6eIB+FTHPM5ZlgfMZKKRERym4EBUklc5/qKpKT+V3gS7WVuh/YHF4AEv9BYWwfpIXPM5LAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/06082bb029fc86c82901346ed08b76d4/2bef9/image-20230811-100918.png\"\n        srcset=\"/static/06082bb029fc86c82901346ed08b76d4/6f3f2/image-20230811-100918.png 256w,\n/static/06082bb029fc86c82901346ed08b76d4/01e7c/image-20230811-100918.png 512w,\n/static/06082bb029fc86c82901346ed08b76d4/2bef9/image-20230811-100918.png 1024w,\n/static/06082bb029fc86c82901346ed08b76d4/71c1d/image-20230811-100918.png 1536w,\n/static/06082bb029fc86c82901346ed08b76d4/a878e/image-20230811-100918.png 2048w,\n/static/06082bb029fc86c82901346ed08b76d4/8fc63/image-20230811-100918.png 2756w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Дальше все точно то же самое только за вчера (добавляем <code class=\"language-text\">offset 1d</code> в левую и правую часть)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21c38945cf8d46d88da523e357b0f578/9c507/image-20230811-101002.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.65625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyElEQVR42pWQ22rEMAxE8/P9qEL/o2+l9LbZJCS+ynYS51QOC0tfSjsghGxpNKNusJbh8sV0vWKNw3mPMRZrHYt3GBFcSgTnEGMoWtdaOY7jHkByMw+Pnm70wmwDUYlEB0UHQtA6RqJEQs7EkpFSSPqetW9dVxoa0bpt5LLpn+fpOdL5IKSyEpTg5fWN/6LW41TMbUV36Xt6tfv+8al5YN/3n3Z+iYaiyq2eTaKw7ZVuGEfGaTpJvVpqFs5dfyRs9udlwemNm9JvZNiFQG2KTxkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/21c38945cf8d46d88da523e357b0f578/2bef9/image-20230811-101002.png\"\n        srcset=\"/static/21c38945cf8d46d88da523e357b0f578/6f3f2/image-20230811-101002.png 256w,\n/static/21c38945cf8d46d88da523e357b0f578/01e7c/image-20230811-101002.png 512w,\n/static/21c38945cf8d46d88da523e357b0f578/2bef9/image-20230811-101002.png 1024w,\n/static/21c38945cf8d46d88da523e357b0f578/71c1d/image-20230811-101002.png 1536w,\n/static/21c38945cf8d46d88da523e357b0f578/a878e/image-20230811-101002.png 2048w,\n/static/21c38945cf8d46d88da523e357b0f578/9c507/image-20230811-101002.png 2768w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Просим прометей вернуть нам только те метрики где значение за сегодня больше чем вчера</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/91cf8ef8aeb69c42661afca09f52a993/38abd/image-20230811-101117.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.79687500000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42nWRTU7DMBSEcx5YsuZuqHskWLDhIBU7rsECoSZtaZzEie2XPztOhme3ohUqkSa2n+3PY0+iqEOhNSoh0NQ1iFpobY4iA+o79MZgbAmz9/j7zfHX4/G9w/0rkEilUSuFppKoeCM1DRpWrIU+Q1uuD1Ji5PYqcCI8rA1unxlY1rwxuGIAGULf92jb9qiuA40jOmcxcN0SwTv3C1tOgtVYrRXuXhgYrpyXJcRuB8EuNKvkcVlVqFiFVlBGw9QSxHU3DGfgssAHi77F6o1w88TA8Fbd4HligeXTp+CAF4bF8zxHLVH+2D/NRRjTrJu4nXBQDh9iQvL5tYFsdAwj2+6QiwIjX9NaF7hXdAaGz3NQ4WmstXGcKA4lzwVEUXCbM1Agy7ZQnPxy4fQSdAkMRr4PhwgNpSSA0m2G3X6PlEGbNGVgFg+Rso5JO+f+B3J4YQ9xYMHhDwpgZIw8n/91AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/91cf8ef8aeb69c42661afca09f52a993/2bef9/image-20230811-101117.png\"\n        srcset=\"/static/91cf8ef8aeb69c42661afca09f52a993/6f3f2/image-20230811-101117.png 256w,\n/static/91cf8ef8aeb69c42661afca09f52a993/01e7c/image-20230811-101117.png 512w,\n/static/91cf8ef8aeb69c42661afca09f52a993/2bef9/image-20230811-101117.png 1024w,\n/static/91cf8ef8aeb69c42661afca09f52a993/71c1d/image-20230811-101117.png 1536w,\n/static/91cf8ef8aeb69c42661afca09f52a993/a878e/image-20230811-101117.png 2048w,\n/static/91cf8ef8aeb69c42661afca09f52a993/38abd/image-20230811-101117.png 2766w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Дальше прелесть прометея - то же самое что и в предыдущем запросе, только просим вернуть только те результаты где значение в полтора раза больше</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5849a8910dd95e306be5b2fe00464364/00fb1/image-20230811-101211.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.23437500000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABYElEQVR42nVSy07DMBDstyDufALfx+PGCfEnhSvfgLhAVZomTZyHHTtve5hNCwogLI1219qMZ3azMtahsBZVUaLWGq5pYFkLamfhuhYd85733nssTwiEJL7F/bPD5QOwKnSNg1LI4hhpUUDnOXLWilEx5kbDVBVclqHlgz8Jw5FwsrhaG5zfkjAvDUzjZkXOOTRUIlFg5b7r0Aw9OuZ9XcOP41/C3uDmscTFHQnL2uF9nyDebpFQUSXKqCYT1SpDSlUlVeoih+X9wAeXhPMQfIPrpxpn1yTUpkZSdRgmj3GaMFFB4KwmyQmZmyCc4vJIPYzso4OXuMX6dcLqbbNFpQ0tNoj2MZKUKoZhJvu2NVsLxyV81aKO6DgSQQjymOcMaTGK9oiTBB+7HXZRhA3t51xQy0YhXpL8hvRlmcJIZz6IZapTKkfB3yalOmk4HFKknJcsarb7LyEg3yfsH0/L+gRnWGVpkZ30SwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/5849a8910dd95e306be5b2fe00464364/2bef9/image-20230811-101211.png\"\n        srcset=\"/static/5849a8910dd95e306be5b2fe00464364/6f3f2/image-20230811-101211.png 256w,\n/static/5849a8910dd95e306be5b2fe00464364/01e7c/image-20230811-101211.png 512w,\n/static/5849a8910dd95e306be5b2fe00464364/2bef9/image-20230811-101211.png 1024w,\n/static/5849a8910dd95e306be5b2fe00464364/71c1d/image-20230811-101211.png 1536w,\n/static/5849a8910dd95e306be5b2fe00464364/a878e/image-20230811-101211.png 2048w,\n/static/5849a8910dd95e306be5b2fe00464364/00fb1/image-20230811-101211.png 2762w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>примечание: на всех скринах, справа сверху, под синей кнопкой execute есть поле result series по которому видно как срезается результат</p>\n</blockquote>\n<p>На этом первая часть запроса готова</p>\n<p>Касаемо второй части, нам нужны свеже запущенные поды</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11c878f4d81118fca2746ed2d0b75813/318d8/image-20230811-101432.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.921875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwUlEQVR42o2Pi23DMAxEvWrnazbpCkU/SYq0cWJZX0uW5BfSyAAVQPBEHU93w2wd978r0zgSQqB4T04JlzMpRopze/fy5n0gCNZ7tpZVOK1v9BJ5fTO8HDaG230iLJXWOmlZyKXw39O3jdoata6isWJSY3j/+OR0/uE63lD89X0kRnEoTp24U2zFjZUkIcR9pknUsXIU996pa2FJkcGYmePpzOXyyzQZZln2SpTSniS+FZFdSKM/RXbRJ2eRZMrTzx+kMzOZ4+U2vgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/11c878f4d81118fca2746ed2d0b75813/2bef9/image-20230811-101432.png\"\n        srcset=\"/static/11c878f4d81118fca2746ed2d0b75813/6f3f2/image-20230811-101432.png 256w,\n/static/11c878f4d81118fca2746ed2d0b75813/01e7c/image-20230811-101432.png 512w,\n/static/11c878f4d81118fca2746ed2d0b75813/2bef9/image-20230811-101432.png 1024w,\n/static/11c878f4d81118fca2746ed2d0b75813/71c1d/image-20230811-101432.png 1536w,\n/static/11c878f4d81118fca2746ed2d0b75813/a878e/image-20230811-101432.png 2048w,\n/static/11c878f4d81118fca2746ed2d0b75813/318d8/image-20230811-101432.png 2758w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Я тут сразу приджойнил лейбочку овнера, по ней мы будем все в купу собирать</p>\n</blockquote>\n<p>Дальше нам надо бы как то это дело схлопнуть, ведь ингресс то у нас один, а подов много, по сути это то с чего начинается заметка про джойны</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/106d9a798cb97bcc1d175124fb88aa19/318d8/image-20230811-101605.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.828125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4ElEQVR42nVQW07EMAzMxTgcHIM78MsXd+AKiwqbUKeQNmmazWuwSxfEB5ZGY488ozjKjCOWaYL3HtE5pHmGTwmRkYNHXles3AdhhuiJOYeAWgo6gLo63D7OuLkH1Of0AacNtmXZlzYJZVPrHa1UtFpRW0MVPvomQdyXXHDJFZfo8fAccPdUoawLiLlh8QHDm4ZUY1MXI4d2gfSiXefef/Z+9SYK1OnlhJHP1vzKYXiFNgbWWtaIedpBPBvzDs8XSP0JPlj245agJEQMZGnn81kfgSPP32FE/wdeQUT7V30BhUKAN5imIywAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/106d9a798cb97bcc1d175124fb88aa19/2bef9/image-20230811-101605.png\"\n        srcset=\"/static/106d9a798cb97bcc1d175124fb88aa19/6f3f2/image-20230811-101605.png 256w,\n/static/106d9a798cb97bcc1d175124fb88aa19/01e7c/image-20230811-101605.png 512w,\n/static/106d9a798cb97bcc1d175124fb88aa19/2bef9/image-20230811-101605.png 1024w,\n/static/106d9a798cb97bcc1d175124fb88aa19/71c1d/image-20230811-101605.png 1536w,\n/static/106d9a798cb97bcc1d175124fb88aa19/a878e/image-20230811-101605.png 2048w,\n/static/106d9a798cb97bcc1d175124fb88aa19/318d8/image-20230811-101605.png 2758w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Значение метрики - кол-во секунд с unix эпохи, в фронте это было бы <code class=\"language-text\">new Date(1691748000 * 1000)</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e383516941857e236421c04220a30f3/35d5c/image-20230811-101722.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.71875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA70lEQVR42q2R607DMAyF8/6PCEiMdc2lXdrm0vS25mCnbIIJ8QtLn+zYip0TC920GOcNewZ8CIjjiL8s5/xg33ds20bcSnwjRFVLKKVhbYdaKkhiGByc8+QHOE/eOfR9TzlHg/OPpvjyfD+lBNHQC19e36iZLM3eT6dCTYOq6gKpFC4Un88VlNZHk1+MazFGCK0NNfgoCakOjGmgy/l4cRlGcdu2mOcZ87Ic/hvGmKJKsAyWFoOHvHpc+4A0xpJjWGqp0/SR/vcOn1kie65ba9F1HQT+2URIC6yfMISEaZoeEnh7902u61rgOD8t5ZlPFgAdj+fKKV8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/1e383516941857e236421c04220a30f3/2bef9/image-20230811-101722.png\"\n        srcset=\"/static/1e383516941857e236421c04220a30f3/6f3f2/image-20230811-101722.png 256w,\n/static/1e383516941857e236421c04220a30f3/01e7c/image-20230811-101722.png 512w,\n/static/1e383516941857e236421c04220a30f3/2bef9/image-20230811-101722.png 1024w,\n/static/1e383516941857e236421c04220a30f3/71c1d/image-20230811-101722.png 1536w,\n/static/1e383516941857e236421c04220a30f3/a878e/image-20230811-101722.png 2048w,\n/static/1e383516941857e236421c04220a30f3/35d5c/image-20230811-101722.png 2760w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Соотв если мы хотим забрать только “свежие” поды, делаем вот так:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3db6a6c53c522f24e060d4aefb48ad2/318d8/image-20230811-101827.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVR42oVQy07DMBDMN8Gv9sKBn0HiF+gBCSmt09RRRGLHr/Ujw9qk4sjKo+ys4/GMu+V7hlMrjDFw6wqvNXQIcN6Dtg1kLSzzjfeNsXDcB54R8xQjdgAlbHh913g6Ad3H54Dz+QuKRUmrJkr8Yy4FOaWGlDNi/VZe5/l3njP3rBidwsvbgufTjm7xBbYAvrkK+K/2A7WqOMXULnOUsdiMbp5ndqcgxA395QrLcWr8GrH1BzQ/BRGx2s7rD49yznGCiK7vL5BywsQY7xJXIRq/jSPkNDXcpYQYhibaXB5ihR0+UM9UIz9mWIBRnpi/SAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/c3db6a6c53c522f24e060d4aefb48ad2/2bef9/image-20230811-101827.png\"\n        srcset=\"/static/c3db6a6c53c522f24e060d4aefb48ad2/6f3f2/image-20230811-101827.png 256w,\n/static/c3db6a6c53c522f24e060d4aefb48ad2/01e7c/image-20230811-101827.png 512w,\n/static/c3db6a6c53c522f24e060d4aefb48ad2/2bef9/image-20230811-101827.png 1024w,\n/static/c3db6a6c53c522f24e060d4aefb48ad2/71c1d/image-20230811-101827.png 1536w,\n/static/c3db6a6c53c522f24e060d4aefb48ad2/a878e/image-20230811-101827.png 2048w,\n/static/c3db6a6c53c522f24e060d4aefb48ad2/318d8/image-20230811-101827.png 2758w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Все, на этом готова правая часть запроса</p>\n<p>Теперь нам нужно их пересекти, дальше мноструозный запрос, но если подумать он делает:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">текущее_время_ответа\n>\nвремя_ответа_вчера * 1.5\nand\nврем_жизни_пода &lt; 1ч</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/67affa6cc5ae87b77a1849c89060aed7/8fc63/image-20230811-102107.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.96875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVR42pVRS07sMBCc4yCxYMNpOAfSnAGJDU/AHVggBGzYI3GEt2GVgWQmTjL52Y4T2ynKZsQCkABL5bbarerq6kWjNfpeQvU9tB7eoTSUVlCjgeH/qBTcNOG7M4fLalw8Dji6AhapENisVkhzgaooUJclNowFIaoKddehZ40qBKZh+ELowzX1OL6R2DsloTEGlt0na+F2sM7BxhjgY86zxnv3rcLZdFjeSRz8I2HC7mmSIE0zFKJAFRTmOQQVbeotRN+hbht0rNNUHMg/E1pVY3nb4vCShK8ctSVJIxUGemWIjr5JKSGjrzrmNd/hz1G932Ge54+Rl/cK+2eBkOrWz8+oi+BTQRUlJL0yHNGSwAbCceSSNDTz4R2IJ8JTbVzK2OH4mh6ekLCVA1p2HydD/TPmXeffHOc9xuD1qPHwX+P8yWFRNRzLTKibFi/pOhZa6+JoPyEsLi4ziggLI2GSrJBla+T0Mss2qKoaZbn9M3JRYdv0eAMFZq2dAcU6mgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/67affa6cc5ae87b77a1849c89060aed7/2bef9/image-20230811-102107.png\"\n        srcset=\"/static/67affa6cc5ae87b77a1849c89060aed7/6f3f2/image-20230811-102107.png 256w,\n/static/67affa6cc5ae87b77a1849c89060aed7/01e7c/image-20230811-102107.png 512w,\n/static/67affa6cc5ae87b77a1849c89060aed7/2bef9/image-20230811-102107.png 1024w,\n/static/67affa6cc5ae87b77a1849c89060aed7/71c1d/image-20230811-102107.png 1536w,\n/static/67affa6cc5ae87b77a1849c89060aed7/a878e/image-20230811-102107.png 2048w,\n/static/67affa6cc5ae87b77a1849c89060aed7/8fc63/image-20230811-102107.png 2756w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>оно уже даже в экран не влазит, наверняка его можно написать грамотнее, компактнее и красивше, но сам факт - запрос махина, вот только что бы его проверить - нужно выкатить что то поломанное-медленное 🤷‍♂️</p>\n<p>но для заметки сгодиться, бо такую штуку с наскоку фиг напишешь</p>"}},"pageContext":{"id":"cb3f9f26-41c6-58ed-9705-51ca54058044"}},"staticQueryHashes":[],"slicesMap":{}}
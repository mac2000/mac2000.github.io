{"componentChunkName":"component---src-templates-note-js","path":"/mysql-vyiborka-s-ispolzovaniem-parent-id/","result":{"data":{"remark":{"fields":{"path":"mysql-vyiborka-s-ispolzovaniem-parent-id"},"meta":{"title":""},"headings":[{"value":"MySQL выборка с использованием parent_id"}],"html":"<h1>MySQL выборка с использованием parent_id</h1>\n<p>Простенькая задача: Существует таблица содержащая поля <code class=\"language-text\">id</code>, <code class=\"language-text\">title</code> и <code class=\"language-text\">parent_id</code>. Известно что данные могут быть вложены друг в друга не более чем на два уровня. Необходимо вывести список “детей”, <code class=\"language-text\">title</code>, которых будет содержать как свой заголовок, так и заголовок родителя.Для начала пример базы:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tree<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>title<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>parent_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tree<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>title<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>parent_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'parent1'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'parent2'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'parent3'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'child1'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'child2'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'child3'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>и собственно сам запрос:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> child<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> CONCAT<span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span> <span class=\"token string\">' - '</span><span class=\"token punctuation\">,</span> child<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> title\n<span class=\"token keyword\">FROM</span> tree <span class=\"token keyword\">AS</span> child\n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> tree <span class=\"token keyword\">As</span> parent\n<span class=\"token keyword\">ON</span> child<span class=\"token punctuation\">.</span>parent_id <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span>id\n<span class=\"token keyword\">WHERE</span> child<span class=\"token punctuation\">.</span>parent_id <span class=\"token operator\">IS</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span>\n<span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> title<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Результатом работы которого будет:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+----+------------------+\n| id | title            |\n+----+------------------+\n|  4 | parent1 - child1 |\n|  5 | parent1 - child2 |\n|  6 | parent3 - child3 |\n+----+------------------+</code></pre></div>"}},"pageContext":{"id":"f4f540d5-c9b9-53d1-a9a0-826e2674e075"}},"staticQueryHashes":[],"slicesMap":{}}
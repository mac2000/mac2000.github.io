{"componentChunkName":"component---src-templates-note-js","path":"/git-restore-master-branch/","result":{"data":{"remark":{"fields":{"path":"git-restore-master-branch"},"meta":{"title":""},"headings":[{"value":"git restore master branch"}],"html":"<h1>git restore master branch</h1>\n<p>Situation: we need to deploy hotfix urgently, but master branch is broken by non completed features</p>\n<p>Task: backup commits, rollback, fix</p>\n<p>Switch to master and pull fresh code</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> checkout master\n<span class=\"token function\">git</span> pull</code></pre></div>\n<p>Look in Octopus Deploy which commit is deployed right now to production (in our case it was был ffa7b5a)</p>\n<p>Revert</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> revert ffa7b5a<span class=\"token punctuation\">..</span>HEAD --no-commit\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"revert back to 43d2f1b 5 aug\"</span></code></pre></div>\n<p>Note: in our case for revert we need to add <code class=\"language-text\">-m 1</code> this flag which of the parent branches from merge commit to use</p>\n<p>Then commit our fix</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"hotfix\"</span></code></pre></div>\n<p>Deploy everything to prod</p>\n<p>And remove last two commits</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> log <span class=\"token parameter variable\">--oneline</span> <span class=\"token parameter variable\">-4</span>\nmpb:rabota.ua mac$ <span class=\"token function\">git</span> log <span class=\"token parameter variable\">--oneline</span> <span class=\"token parameter variable\">-4</span>\n89df2a908 <span class=\"token punctuation\">(</span>HEAD -<span class=\"token operator\">></span> master<span class=\"token punctuation\">)</span> hotfix\n00a2f9975 revert\n3bc9cecf3 <span class=\"token punctuation\">(</span>origin/master_12.04.2019_99cc647, backup<span class=\"token punctuation\">)</span> Merge branch <span class=\"token string\">'master'</span> of https://bitbucket.org/rabotaua/rabota.ua\n48bdc94f1 RUA-21250\n\n<span class=\"token function\">git</span> revert 89df2a908\n<span class=\"token function\">git</span> revert 00a2f9975\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">'remove 2 last commits'</span></code></pre></div>\n<p>And once again applying hotfix</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> cherry-pick 89df2a908</code></pre></div>"}},"pageContext":{"id":"b5a1be73-e362-5d88-81e0-3be17e19f961"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/drupal-import-nodes-with-cck-image-field-and-taxonomies","result":{"data":{"remark":{"fields":{"path":"drupal-import-nodes-with-cck-image-field-and-taxonomies"},"meta":{"title":""},"headings":[{"value":"Drupal import nodes with cck image field and taxonomies"}],"html":"<h1>Drupal import nodes with cck image field and taxonomies</h1>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token function\">chdir</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/hosting/mebelfan.com/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">require_once</span> <span class=\"token string single-quoted-string\">'./includes/bootstrap.inc'</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">drupal_bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token constant\">DRUPAL_BOOTSTRAP_FULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Images are stored in temporary folder:</span>\n<span class=\"token comment\">// /hosting/mebelfan.com/sites/default/panstar</span>\n<span class=\"token comment\">// that may be deleted after import</span>\n\n<span class=\"token comment\">// $item [title, image_filename, manufacturer_term_id, country_term_id, field_width|depth|height]</span>\n<span class=\"token variable\">$items</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$items</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Диван и кресло Мальта'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'mjagkaja_mebel_kyrier.com.ua_malta_maltadiv.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$items</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Аккорд угловой диван'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'mjagkaja_mebel_mebus_acord_ug_26_1.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$items</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Диван и кресло Саванна'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'mjagkaja_mebel_kyrier.com.ua_savanna_savdiv.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$items</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$node</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StdClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">type</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'product'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">uid</span> <span class=\"token operator\">=</span> <span class=\"token number\">16</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">title</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">promote</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//$node->created = time();</span>\n    <span class=\"token comment\">//$node->changed = $node->created;</span>\n    <span class=\"token comment\">//$node->status = 1; // Published by default</span>\n    <span class=\"token comment\">//$node->promote = 1;</span>\n    <span class=\"token comment\">//$node->sticky = 0;</span>\n    <span class=\"token comment\">//$node->format = 1;       // Filtered HTML</span>\n\n    <span class=\"token comment\">// add CCK field data</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">field_width</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'value'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">field_depth</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'value'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">field_height</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'value'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/////// FIELD_PHOTO ///////////////////////////////////////</span>\n    <span class=\"token comment\">// Image file path.</span>\n    <span class=\"token variable\">$image</span> <span class=\"token operator\">=</span> <span class=\"token function\">file_directory_path</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/panstar/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Load up the CCK field. First parameter image field name and second parameter node type. It can be chnaged to any field name and also and node type.</span>\n    <span class=\"token variable\">$field</span> <span class=\"token operator\">=</span> <span class=\"token function\">content_fields</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'field_photo'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'product'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Load up the appropriate validators</span>\n    <span class=\"token variable\">$validators</span> <span class=\"token operator\">=</span> <span class=\"token function\">array_merge</span><span class=\"token punctuation\">(</span><span class=\"token function\">filefield_widget_upload_validators</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$field</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">imagefield_widget_upload_validators</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$field</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Store file path.</span>\n    <span class=\"token variable\">$files_path</span> <span class=\"token operator\">=</span> <span class=\"token function\">filefield_widget_file_path</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$field</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Create the file object, replace existing file with new file as source and dest are the same</span>\n    <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token function\">field_file_save_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$validators</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$files_path</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">FILE_EXISTS_REPLACE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// put the file into node image field.</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">field_photo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/////// TAXONOMIES ///////////////////////////////////////</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">taxonomy</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// proizvoditel</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">taxonomy</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">26</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// stil</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">taxonomy</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// strana</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">taxonomy</span><span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">163</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// tip</span>\n    <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">taxonomy</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">164</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// jkategoria</span>\n\n    <span class=\"token comment\">// save node</span>\n    <span class=\"token function\">node_save</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$node</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'&lt;a href=\"http://mebelfan.com/node/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">nid</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/edit\">http://mebelfan.com/node/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$node</span><span class=\"token operator\">-></span><span class=\"token property\">nid</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/edit&lt;/a>&lt;br />'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>"}},"pageContext":{"id":"662af971-3a32-52ca-8044-862ddc33df89"}},"staticQueryHashes":[]}
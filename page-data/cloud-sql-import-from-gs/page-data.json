{"componentChunkName":"component---src-templates-note-js","path":"/cloud-sql-import-from-gs/","result":{"data":{"remark":{"fields":{"path":"cloud-sql-import-from-gs"},"meta":{"title":""},"headings":[{"value":"CloudSQL import data from GS"}],"html":"<h1>CloudSQL import data from GS</h1>\n<h3>Step 1: Connect thru web console to create database and table</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 962px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4274b716510b2abcf358ead9b07b8cc9/fbf08/image2018-12-14_13-35-50.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.70312499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVR42nWR2U6EMBSGeV4fQOMWH0ET45Xjeus7eGtcYkzMmBgXQGDYZgYoTAst8Hta3GK0yZee0/b8529rbR5PsHoYYOskwNqhj40jH+vE8r6eAyyPQizt+lgZ0ZnTACv7HtYOPKyOBnSNiQ+G2BqPH5CkU5TVAlzU4JwQAhWXYAsJx31DGEawbQd5zqDHnEkUlULJWwRpg4Vo6ayClzSwbH+KSVIizWokmTDEc06i0hRXVYXplBqWJbquQ9/3UG2PVkO5VB2t67UOtWxhXY5jnF/ZuLiPcftU4O6lxM1jjnlRG0FBbl3XRZqmUEp9iQ5osRaCc7OusRJy40c5HC8lp4zcCUSzb4ecUx4lBO1PIjBWkrvWiOuhhZum+RbsWupKmG4mlgZdIESFqgyRJA5mM4+u/kaxhyzLUBQF6ro2N2CMGVGdW42UlHwgP2kgZQ/XuUbg7sC19+C87sF+3obnnpH4nJiZZ9DoN9a5EZQk8BvdbXDI6WdzxHFEPz0xcxyF5oze/41s/hH8LJBSfV3lJ3+KqeHp3gFJj6HR+zuUOwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/4274b716510b2abcf358ead9b07b8cc9/fbf08/image2018-12-14_13-35-50.png\"\n        srcset=\"/static/4274b716510b2abcf358ead9b07b8cc9/6f3f2/image2018-12-14_13-35-50.png 256w,\n/static/4274b716510b2abcf358ead9b07b8cc9/01e7c/image2018-12-14_13-35-50.png 512w,\n/static/4274b716510b2abcf358ead9b07b8cc9/fbf08/image2018-12-14_13-35-50.png 962w\"\n        sizes=\"(max-width: 962px) 100vw, 962px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">DATABASES</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> vacrecom <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> utf8 <span class=\"token keyword\">COLLATE</span> utf8_general_ci<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">USE</span> vacrecom<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">SHOW</span> <span class=\"token keyword\">TABLES</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> vacrecom <span class=\"token punctuation\">(</span>\n  uid <span class=\"token keyword\">int</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  vid <span class=\"token keyword\">int</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  rating <span class=\"token keyword\">float</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Step 2: ACLs</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gcloud sql instances describe db <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> serviceAccountEmailAddress</code></pre></div>\n<p>Will output something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">serviceAccountEmailAddress: [serviceaccount@contoso.iam.gserviceaccount.com](mailto:serviceaccount@contoso.iam.gserviceaccount.com)\n\ngsutil acl ch -u [serviceaccount@contoso.iam.gserviceaccount.com](mailto:serviceaccount@contoso.iam.gserviceaccount.com):W gs://ruaml\n\ngsutil acl ch -u [serviceaccount@contoso.iam.gserviceaccount.com](mailto:serviceaccount@contoso.iam.gserviceaccount.com):R gs://ruaml/foo.csv</code></pre></div>\n<h3>Step 3: Import</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gcloud beta sql <span class=\"token function\">import</span> csv db gs://ruaml/foo.csv <span class=\"token parameter variable\">--database</span><span class=\"token operator\">=</span>vacrecom <span class=\"token parameter variable\">--table</span><span class=\"token operator\">=</span>vacrecom <span class=\"token parameter variable\">--columns</span><span class=\"token operator\">=</span>uid,vid,rating</code></pre></div>\n<p>For cronjobs:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gcloud beta sql <span class=\"token function\">import</span> csv db gs://ruaml/foo.csv <span class=\"token parameter variable\">--database</span><span class=\"token operator\">=</span>vacrecom <span class=\"token parameter variable\">--table</span><span class=\"token operator\">=</span>vacrecom **<span class=\"token punctuation\">\\</span>--async** <span class=\"token parameter variable\">--columns</span><span class=\"token operator\">=</span>uid,vid,rating **<span class=\"token punctuation\">\\</span>-q**</code></pre></div>\n<h3>Links:</h3>\n<ul>\n<li><a href=\"https://cloud.google.com/sql/docs/mysql/import-export/importing\">Importing Data into Cloud SQL</a> - warning - not working, used only for ACLs</li>\n<li><a href=\"https://cloud.google.com/sdk/gcloud/reference/beta/sql/import/csv\">gcloud beta sql import csv</a></li>\n</ul>"}},"pageContext":{"id":"2354c071-0f45-556c-ab84-2d2ab76546eb"}},"staticQueryHashes":[],"slicesMap":{}}
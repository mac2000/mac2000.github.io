{"componentChunkName":"component---src-templates-note-js","path":"/mysql-import-maxmind-world-cities","result":{"data":{"remark":{"fields":{"path":"mysql-import-maxmind-world-cities"},"meta":{"title":""},"headings":[{"value":"MySQL import MaxMind World Cities CSV"}],"html":"<h1>MySQL import MaxMind World Cities CSV</h1>\n<p>MaxMind has open source/free database of world cities</p>\n<p><a href=\"https://www.maxmind.com/en/worldcities\">https://www.maxmind.com/en/worldcities</a></p>\n<p>It is 140+ Mb CSV file containing 3+ M cities</p>\n<p>Here is script to import maxmind worldcities into MySQL:</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- import.sql</span>\n<span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> Cities<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> Cities <span class=\"token punctuation\">(</span>\n    Country <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    City <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    AccentCity <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Region <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Population <span class=\"token keyword\">INT</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    Latitude <span class=\"token keyword\">FLOAT</span><span class=\"token punctuation\">,</span>\n    Longitude <span class=\"token keyword\">FLOAT</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">LOAD</span> <span class=\"token keyword\">DATA</span> <span class=\"token keyword\">INFILE</span> <span class=\"token string\">'C:\\\\Users\\\\Alexandr\\\\Desktop\\\\worldcitiespop.txt'</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">TABLE</span> Cities\n    <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> latin1\n    <span class=\"token keyword\">FIELDS</span> <span class=\"token keyword\">TERMINATED</span> <span class=\"token keyword\">BY</span> <span class=\"token string\">','</span> <span class=\"token keyword\">ENCLOSED</span> <span class=\"token keyword\">BY</span> <span class=\"token string\">''</span> <span class=\"token keyword\">LINES</span> <span class=\"token keyword\">TERMINATED</span> <span class=\"token keyword\">BY</span> <span class=\"token string\">'\\n'</span>\n    <span class=\"token keyword\">IGNORE</span> <span class=\"token number\">1</span> <span class=\"token keyword\">LINES</span>\n    <span class=\"token punctuation\">(</span><span class=\"token variable\">@Country</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@City</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@AccentCity</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@Region</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@Population</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@Latitude</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">@Longitude</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">SET</span> Country <span class=\"token operator\">=</span> <span class=\"token variable\">@Country</span><span class=\"token punctuation\">,</span> City <span class=\"token operator\">=</span> <span class=\"token variable\">@City</span><span class=\"token punctuation\">,</span> AccentCity <span class=\"token operator\">=</span> <span class=\"token variable\">@AccentCity</span><span class=\"token punctuation\">,</span> Region <span class=\"token operator\">=</span> <span class=\"token variable\">@Region</span><span class=\"token punctuation\">,</span>\nPopulation <span class=\"token operator\">=</span> <span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> <span class=\"token variable\">@Population</span> <span class=\"token operator\">=</span> <span class=\"token string\">''</span> <span class=\"token keyword\">THEN</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">ELSE</span> <span class=\"token variable\">@Population</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">,</span>\nLatitude <span class=\"token operator\">=</span> <span class=\"token variable\">@Latitude</span><span class=\"token punctuation\">,</span>\nLongitude <span class=\"token operator\">=</span> <span class=\"token variable\">@Longitude</span>\n<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">CHARACTER SET latin1</code> is needed otherwise you will get <code class=\"language-text\">ERROR 1366 (HY000) at line 12: Incorrect string value: '\\xE0s' for column 'AccentCity' at row 1</code></p>\n<p><code class=\"language-text\">IGNORE 1 LINES</code> is needed to escape headers row, otherwise you will get <code class=\"language-text\">ERROR 1406 (22001) at line 12: Data too long for column 'Country' at row 1</code></p>\n<p>All after <code class=\"language-text\">IGNORE 1 LINES</code> is added just for <code class=\"language-text\">Population = CASE WHEN @Population = '' THEN NULL ELSE @Population END</code> otherwise you will get <code class=\"language-text\">ERROR 1366 (HY000) at line 12: Incorrect integer value: '' for column 'Population' at row 1</code></p>\n<p>And to import it run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql <span class=\"token parameter variable\">-u</span> root <span class=\"token parameter variable\">-proot</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"CREATE DATABASE maxmind\"</span><span class=\"token punctuation\">;</span>\nmysql <span class=\"token parameter variable\">-u</span> root <span class=\"token parameter variable\">-proot</span> maxmind <span class=\"token operator\">&lt;</span> import.sql</code></pre></div>\n<p>Here is some numbers:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">C:<span class=\"token punctuation\">\\</span><span class=\"token operator\">></span>mysql --login-path<span class=\"token operator\">=</span>local maxmind <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"SELECT COUNT(*) AS Cities FROM Cities\"</span>\n+---------+\n<span class=\"token operator\">|</span> Cities  <span class=\"token operator\">|</span>\n+---------+\n<span class=\"token operator\">|</span> <span class=\"token number\">3173958</span> <span class=\"token operator\">|</span>\n+---------+\n\nC:<span class=\"token punctuation\">\\</span><span class=\"token operator\">></span>mysql --login-path<span class=\"token operator\">=</span>local maxmind <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"SELECT COUNT(*) AS Countries FROM (SELECT DISTINCT Country FROM Cities) AS q\"</span>\n+-----------+\n<span class=\"token operator\">|</span> Countries <span class=\"token operator\">|</span>\n+-----------+\n<span class=\"token operator\">|</span>       <span class=\"token number\">234</span> <span class=\"token operator\">|</span>\n+-----------+\n\nC:<span class=\"token punctuation\">\\</span><span class=\"token operator\">></span>mysql --login-path<span class=\"token operator\">=</span>local maxmind <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"SELECT COUNT(*) AS Uniq FROM (SELECT DISTINCT Country, City FROM Cities) AS q\"</span>\n+---------+\n<span class=\"token operator\">|</span> Uniq    <span class=\"token operator\">|</span>\n+---------+\n<span class=\"token operator\">|</span> <span class=\"token number\">2611446</span> <span class=\"token operator\">|</span>\n+---------+\n\nC:<span class=\"token punctuation\">\\</span><span class=\"token operator\">></span>mysql --login-path<span class=\"token operator\">=</span>local maxmind <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"SELECT COUNT(*) AS Population FROM Cities WHERE Population IS NOT NULL\"</span>\n+------------+\n<span class=\"token operator\">|</span> Population <span class=\"token operator\">|</span>\n+------------+\n<span class=\"token operator\">|</span>      <span class=\"token number\">47980</span> <span class=\"token operator\">|</span>\n+------------+\n\nC:<span class=\"token punctuation\">\\</span><span class=\"token operator\">></span>mysql --login-path<span class=\"token operator\">=</span>local maxmind <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"SELECT * FROM Cities WHERE Country = 'ua' AND City IN ('Kiev', 'Kyiv')\"</span><span class=\"token punctuation\">\\</span>G\n*************************** <span class=\"token number\">1</span>. row ***************************\n    Country: ua\n        City: kiev\nAccentCity: Kiev\n    Region: <span class=\"token number\">12</span>\nPopulation: <span class=\"token number\">2514227</span>\n    Latitude: <span class=\"token number\">50.4333</span>\n    Longitude: <span class=\"token number\">30.5167</span>\n*************************** <span class=\"token number\">2</span>. row ***************************\n    Country: ua\n        City: kyiv\nAccentCity: Kyiv\n    Region: <span class=\"token number\">12</span>\nPopulation: NULL\n    Latitude: <span class=\"token number\">50.4333</span>\n    Longitude: <span class=\"token number\">30.5167</span></code></pre></div>\n<p>PS: To avoid \"Warning: Using a password on the command line interface can be insecure.\" run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql_config_editor <span class=\"token builtin class-name\">set</span> --login-path<span class=\"token operator\">=</span>local <span class=\"token parameter variable\">--host</span><span class=\"token operator\">=</span>localhost <span class=\"token parameter variable\">--user</span><span class=\"token operator\">=</span>root <span class=\"token parameter variable\">-p</span></code></pre></div>"}},"pageContext":{"id":"fb598c81-5579-5997-ab79-42704e110f07"}},"staticQueryHashes":[]}
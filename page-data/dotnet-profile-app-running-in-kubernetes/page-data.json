{"componentChunkName":"component---src-templates-note-js","path":"/dotnet-profile-app-running-in-kubernetes/","result":{"data":{"remark":{"fields":{"path":"dotnet-profile-app-running-in-kubernetes"},"meta":{"title":""},"headings":[{"value":"dotnet profile app running in kubernetes"}],"html":"<h1>dotnet profile app running in kubernetes</h1>\n<p>find application</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token function\">top</span> po --sort-by<span class=\"token operator\">=</span>cpu <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> chatapi</code></pre></div>\n<p>connect to it</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> chatapi-6d57d67769-vvzj2 -- <span class=\"token function\">bash</span></code></pre></div>\n<p>update packages and install required soft</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> update\n<span class=\"token function\">apt</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">wget</span> procps</code></pre></div>\n<p>install profiler</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /root/dotTrace <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> /root/dotTrace\n<span class=\"token function\">wget</span> <span class=\"token string\">\"https://download.jetbrains.com/resharper/dotUltimate.2020.3.4/JetBrains.dotTrace.CommandLineTools.linux-x64.2020.3.4.tar.gz\"</span>\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xzf</span> JetBrains.dotTrace.CommandLineTools.linux-x64.2020.3.4.tar.gz\n<span class=\"token function\">chmod</span> +x dotTrace.sh</code></pre></div>\n<p>find our process pid</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ps</span> aux</code></pre></div>\n<p>in my case output was (our app has pid - 1)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1 24.8  2.4 9623436 397544 ?      Ssl  10:56  12:59 dotnet RUA.ChatAPI.dll\nroot         263  0.0  0.0   4148  3404 pts/0    Ss   11:44   0:00 bash\nroot         659  0.0  0.0   7652  2692 pts/0    R+   11:48   0:00 ps aux</code></pre></div>\n<p>knowing the pid, run profiler</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./dotTrace.sh attach <span class=\"token number\">1</span>  <span class=\"token parameter variable\">--timeout</span><span class=\"token operator\">=</span>60s --save-to<span class=\"token operator\">=</span>/root/snapshot.dtp</code></pre></div>\n<p>after profiler done its work, disconnect from pod, and from local machine run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl <span class=\"token function\">cp</span> chatapi-6d57d67769-vvzj2:/root/snapshot.dtp  ~/Downloads/trace/snapshot.dtp\nkubectl <span class=\"token function\">cp</span> chatapi-6d57d67769-vvzj2:/root/snapshot.dtp.0000 ~/Downloads/trace/snapshot.dtp.0000\nkubectl <span class=\"token function\">cp</span> chatapi-6d57d67769-vvzj2:/root/snapshot.dtp.0001 ~/Downloads/trace/snapshot.dtp.0001\nkubectl <span class=\"token function\">cp</span> chatapi-6d57d67769-vvzj2:/root/snapshot.dtp.0002 ~/Downloads/trace/snapshot.dtp.0002\nkubectl <span class=\"token function\">cp</span> chatapi-6d57d67769-vvzj2:/root/snapshot.dtp.0003 ~/Downloads/trace/snapshot.dtp.0003</code></pre></div>\n<p>now open project in rider, switch to the same branch as in production (in my case it was simply master)</p>\n<p>next choose dotTrace Profiler menu and lick on icon with folder to open snapshot and open downloaded snapshot.dtp (he will open rest of the files on its own)</p>"}},"pageContext":{"id":"01a5c6da-8dfb-5660-9b83-698bd57afa56"}},"staticQueryHashes":[],"slicesMap":{}}
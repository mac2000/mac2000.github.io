{"componentChunkName":"component---src-templates-note-js","path":"/microsoft-graph-aad-users/","result":{"data":{"remark":{"fields":{"path":"microsoft-graph-aad-users"},"meta":{"title":""},"headings":[{"value":"Talking to Microsoft Graph API or how to retrieve AAD users"},{"value":"Creating and Azure app for device flow"}],"html":"<h1>Talking to Microsoft Graph API or how to retrieve AAD users</h1>\n<p>I want to get list of AD users so I can make an desicion for 3rd party app to remove deactivated users</p>\n<h2>Azure App Registration and Permissions</h2>\n<p>To do so we gonna need register our app which can be done from ActiveDirectory <a href=\"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps\">app registrations</a> section</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXElEQVR42o2Ry27VMBCG8zQsWbLpsxWhLth0wQbBmxQVJF6DItpyTnsS5+44iZ2L7XzIPi3qoipY+uSRPPPP/J7k1fkVrz/84uTzLSefbnjz8YbTS8HZ15R3l0fefrnn9OKes28p77/nL5JIs9H0E1ndoUbDNBmMOTJqg5lnvN/435Pslec6Lbj++YPdbocQgqIoyMOdHmirCrfMeOf+Fm3b9mwcBe22YZ2LD4/ExKFnrSt0njHub+nLmn7UzMuKnhZ6pTDTxGhmtNaYeUUpRVLWlkNaIGWLtfYoFrAWJTLK/W90mcdJD1lOXpSMWtM0TSSIhDrvHZt3JPOyodSAlJK+7xmGAfdgT08zbdfRDwOiarkTNXeiomklXSfjEKHOrit6cQipSdQwUNU1zlrWdY1476NgiMNygqV1WeI/Ps2zD3EYwHrPtFiS1sy0Sj27sWApy7Jo67HJv7b8Bz19W6odClSQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"register new app\"\n        title=\"\"\n        src=\"/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png\"\n        srcset=\"/static/f794d9541142f5850b53a7df5b1d3585/6f3f2/newregistration.png 256w,\n/static/f794d9541142f5850b53a7df5b1d3585/01e7c/newregistration.png 512w,\n/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png 1024w,\n/static/f794d9541142f5850b53a7df5b1d3585/71c1d/newregistration.png 1536w,\n/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png 1642w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>On a registration screen there is nothing fancy we are just give it a name and press create</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABvUlEQVR42q2UWY7bMAyGdfa5T2/QW0wfk3kIEm/xos2SbC3/gEycpkGCokEFfCAlWRRN/pA4Ho/Y7XZo2xaHwwH7/R60llLCO0PEdQVRUJBzQs4ZpRTmrYDjOKI7D1DGMMbOkEpDaQNtLKQ2mKTCEhMygFSes90vqmnGVzOh0esFtaCSAbUM7NeEDGhNRGfTU2hvdPESMCwLnPeIMWJZV/7lbZR7ysP8gXxNUYzDgK7rcD6fuTHzPMN7x3V9q4aDdqA6TtPEQTe2NSklQ/599i8DTnLC6XhE0zQsG4J8om0b1FXFF1TViYMaY6CVYmuthdaa/e0yYVzAoKjDFs455pUGSUp0cON+fsvQx4J5LYgZ/2UIay+/oJTk9DdBvxL23wQvqD6nU4W6rhmqHXW9a1vuOtH3PZRSt3oZc7E01+Rby7K7Zmj5AG2u68KS0cZg6HuG9ozWyCkhxfgHz7ouQggsbLIhXK33twZ57+Gv/iOBzy1wa8G8ZISYIZbgQWxBOID3LHDCXedEYPv7G+8u+3bJMCHBrRmiNQlf44p+TtAhQ4YE6YnMLPHfXh3x41Ph42eLX43nhfzGq3V/5BtNtS5HBhTT8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"registration\"\n        title=\"\"\n        src=\"/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png\"\n        srcset=\"/static/1fb66ea46a4753cda04005d177a80fff/6f3f2/register.png 256w,\n/static/1fb66ea46a4753cda04005d177a80fff/01e7c/register.png 512w,\n/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png 1024w,\n/static/1fb66ea46a4753cda04005d177a80fff/71c1d/register.png 1536w,\n/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png 1782w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After an app was created we want its client id and tenant id</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVR42p2QW4vbMBBG/f//WQsp3V12nW0cEuL4HsuyJfkiWTplnW1KKX3pwGFgHs7MfFGc3jgl7+z3MWVZ4IMnBM//VlQpy2A9xsNgA90cGOa7UE0OYwxqdgzaME0T/ejQ2qC1xlr7t/D1eCVJC9K641p3ZI2kvHXYZcYsK1op1GQ3yTSOjItjGs02X5Zlk4QQHkRZnlMVV9w8btjJMI8a5ywBaIWgFe3jgjXc+efLXXfj1rZIKbeXfm38KCs7xOVMn1+Z2wZUT5U35FmNkwLbiUdfZQt2JupEy7queP+Bv5/u7xnaKqd5+Y45HzGnA2uR0rw+ke6+UDx9+2THZfeV+nmH1wNRVtaood9CVkp9ZvFb2MYv6PORMT3hqxx5iOkPMUOyp0/2dD9iZPKOeHtmHSRR2QqqskQIgXPujzycUYhriixyZJ6h6pKmElwyQZoLbo0kGIXXCq8GgrP8BEZhZm3cgOFlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"identifiers\"\n        title=\"\"\n        src=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png\"\n        srcset=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/6f3f2/ids.png 256w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/01e7c/ids.png 512w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png 1024w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png 1460w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next navigate to client credentials to create new one</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAqklEQVR42pWPy3LEIAwE/f+/mOsmtWtsQwCDwZI6xb4ue8pUTUk6jNSaLt8/hJgQM9QMUUVEn1VQVf6j6bpFXKwsvztHP8nlIJdKbZ1SK621z5TpwyoPv3ozpuA3WqvI2VER/JiPShNjPwRTvVOa2XOZcfqFssxYCuQt4GZPXjeohWlQjNeGRjDGSO+dvBdus7sfcM6RUnoDluAJtytWMm5NfF0C65pATv4AwMQ4pSeZi2EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png\"\n        srcset=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/6f3f2/creds1.png 256w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/01e7c/creds1.png 512w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png 1024w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/71c1d/creds1.png 1536w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/a878e/creds1.png 2048w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png 2544w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.53125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJUlEQVR42nVT2Y7aQBD0//9LIkXKPm0UKV+wEsuGBBIw+AKPPZev8TGuqJvAJghaKrk1nq7uqVIHGGI4vcTb6heWy1e8LZfI0hSbzQab9Rrr9RphGCKKDthuf2MfhnDOYRgGzPOM2whm32NwFv0wwk8TJoKf4L2/Ypw8+mFA3/cPia6ErRshCgVrDBdQ98uXAMyoew9lLMqigFaKCR8hKJoR2lZ8cRzHu93n2f838S2o5pIHdpghlMbpdORn3Ys8zxHHMbIsQ5IkSNOUEUURnwkhkCQxcwRzL6F1iSw7QkrJP2nS82TnaZumYXRdB6P1OW9b1FXFeV3XjLZtEfRdA6MVm/FIbGrQNg0X0D0ibtuGzy5GETFpHhR1h32SoLKWC6y1XHDRhKJzDlIpKK1ZlqTQ2GYSm+iEXFq4rkNZljDGIDg6j0waiNOJtTJ/3b6G9+jyI6o0hk4iGEK0hwh35yZKQWvFg5BkgVYpC3oId4ijA2RZoK4smrpC3TYYSoE+P0EJAZmlEHEEUwhAlcD0rvVFrkBrgSxLcNiHiA57hLstkxJhVVUYjIQ7pjisvmO7eEG532G3eMHrt69YLhZYrVasKwU/2Y4zpKnYvVJKduvWHO86VIWAETngJ+x+/sCnjx/w+ekJX56fr9ujtUbgpom3gN5fFAX/vA0yi5pp2hYp2Rw6o+b0CjKE9Kc8UB1NWKOyhoW9OHtnXa6Ts2b/bMj7lRl/ANOpNNTIXTi9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png\"\n        srcset=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/6f3f2/creds2.png 256w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/01e7c/creds2.png 512w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png 1024w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png 1238w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.15625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVR42sWTy07DMBBF8///xYYdCAkQmzRI6SOhdT1+j+OLxk2rLloIK0a6Go89Pva15OapHfHcDnjpvvDRH9AfAzbE2N7Q++eAt26H19UWq4Gw1ly1oYw1MfpjQsPRI3NCShHeGaAU3IxSEJxDznyZ2u511agNDsbDBEYzlQJBWOegtYYxZpatmYyBJgIRgXM+sWdJHWNCjBGcGNNU0DCfTvTew1oHTSdIhRHBOVfXROXe7a+iiSHU8wSmlMJu3GPcKxDpWltrkVJCCGEZUCsFjgHehwrIsy3JAhIHYknqRcBzk2yq1kKoWazm+Tmk56xfgdM0XQoZX+sasBgoN1sS/wdkTn8G/gRusDgKHlqLx46QvLn7ob4B1kGwB1CCOzMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png\"\n        srcset=\"/static/bf7d3e8f821c4c47e816de2970fd8809/6f3f2/creds3.png 256w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/01e7c/creds3.png 512w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png 1024w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/71c1d/creds3.png 1536w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/a878e/creds3.png 2048w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png 2600w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Make sure to copy secret value (not secret id) and keep it secret</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVR42pWS21LDMAxE8/9fCSUtbeKrbPmeLBMFOoU3PHNmbT+spZWnmhSWZYXWCsYYOOdgrUEgwr7v+O+aVseoJcth3zf0scPFCs4FrW+obcjd2PCk/9m/MjlvYa1Da01Mcx24rgxlAxZNeCiCpQLP7SR+w10IaQiUT508BfTe0fsQw8OYvAN5j0AeRB7eHzg4ZyWOQ3/IKZ3kU6dPrfG430FEaK2KeWJGLgXKEogTUkqIMaKUIrm+sm3br6wnZVbM8weM1qg1S4UhBBmO84QYGcwnh+lRRTkqYn5qrfVpOpnAYjbG+B7MLtMOgbDL6xt6a+Cc0Z0G32/ozgjFKITbjGg0Wu+otWB6WC8t/qyjBa1WcAzIiQUOQb4VqwfU5Q3mNkPPF+jrjOXyjvU2S7ZqXfAFYndsT5YVC4wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png\"\n        srcset=\"/static/ecca13870b454a599d0ea42d3c941a9b/6f3f2/creds4.png 256w,\n/static/ecca13870b454a599d0ea42d3c941a9b/01e7c/creds4.png 512w,\n/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png 1024w,\n/static/ecca13870b454a599d0ea42d3c941a9b/71c1d/creds4.png 1536w,\n/static/ecca13870b454a599d0ea42d3c941a9b/a878e/creds4.png 2048w,\n/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png 2340w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now it is time to give our app some permissions, navigate to API permissions section and add some</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVR42o2Ty47UMBBF8/+/gtgCG3ZIsEAs0KCBadSMOq9x3rEdJ3acHGR3ZxhWUNJVShXXdT2uk3GZeaoqfp5OpGlKWRTkeU5ZFuRZxjRNbNvG/1oyWxuT9n2PiQHer2w7KGMx04RxG+MoGYYh/g9nD/DCD0i6yVE3Lcs8x8C6rnjvwzm8D8lbJPe3y/5ZoVoWRFWhlHomCuY3OAvLpewoqoFc9DcMpE8dWUTP5WkkEyOi0xGJnQb6vo1tz/P8fFMg7vWGaDXtYGgGg2gVVTfFxCpgMKSNoZEOvYBadpJWaoZxjK1aa2OVsULvqaqKummo6pqmbfHryrq6+H32/dV3zsb8REwzhRAIIZBSsm1XwtVasl9nyvSCSC+UeY4QT5Sipuw0WTOS1pKslhStomhGtNYkzmr6oWeUksmY6+aArW8Yzyfyb19JP3+iezyjzIySEqlUhA7qCOO5IS6lTR8pHr6T3d9Rn+6x8xxLd5NG1RVfPn7gzetXvH/3Fusck9ZxHHIc6buOl0OPsqlPPyJZcX+HOj9glEQriV8datlIe0837Vwlt2OMiViWJS7ygHMuyipppyUOPgT/tiD0HWU86+qjHoMFJRyEB3nAscykXyxdP7DdAn862G9SMvG1HJWE5EB6yOxAiIfYb2mQnelJdFnQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png\"\n        srcset=\"/static/6bb281754a5658c46a6a5ea2143e2681/6f3f2/perms1.png 256w,\n/static/6bb281754a5658c46a6a5ea2143e2681/01e7c/perms1.png 512w,\n/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png 1024w,\n/static/6bb281754a5658c46a6a5ea2143e2681/71c1d/perms1.png 1536w,\n/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png 1650w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Choose Microsoft Graph</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVR42l2SyY7WQAyE88C8DY/DjRsXOHBg+AcGJsufzr703lk+1A0TDdNSyZFll2NXZff7HSEEXdfR912K1lrO8+TlxW9jLUpKtm27cBwHb18Wm18X+BBw3uHChlKKfd9T4TQv1G2fiK1zSKVx3mOtSz0XoZTyvwnS7qzao0xgVRZtA8ZtSKlYhg45TchpRC8z5xY4tpAixx5XIVNK4py7COt5p2hm6m5NsRAzdb+yCsGHTz/5dXvk6esXyscH5nvJVOWMEc9PjFVBZowhIt4pYllm+r5nGIaUj6c4OWnzO+/ef+TzLef2/RvP+TNFVZIXBUVZUua/KW8PZLFZa30dv+8HklBNg2gEbdfRTJIwdex9hR86XEKbEMaOMA24rsFOA5moa6ZxTIJEwijSPI1JkBBCit5btDx4+tHSiJJxGDiCZzKBsh0ZGoFaZeLI2qZmXWaMlnhnUMZz7w2LtNeAEP6qmeclVVUla8WtjHO0cUOlrvNk8WavPbcfJ9qfHP9yUbBYHKdHC71skhB9+MavyYfe+8ukzlmMVmit0rrxT2KN84ZlESzLmuqTN8PBY93QCcE4jin/B0RTARGkHt8SAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png\"\n        srcset=\"/static/6b189a4656515865aae9f8720509e511/6f3f2/perms2.png 256w,\n/static/6b189a4656515865aae9f8720509e511/01e7c/perms2.png 512w,\n/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png 1024w,\n/static/6b189a4656515865aae9f8720509e511/71c1d/perms2.png 1536w,\n/static/6b189a4656515865aae9f8720509e511/a878e/perms2.png 2048w,\n/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png 2100w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Add wanted permissions</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.953125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfklEQVR42oWS227bMBBE9f/f1ufCfWhaO6llWxfeKd5PIao1UKRIBhgQSyzJmeEOxnmM1lhrsc7ivaeUSi6FHcImVqnZNk9tjcbHGBap2LzvRWugXULZwCotzifui2K83VnXhVUqtDGUnLDLgpom7Lpg1xWzLAQlGJSSOOuotVAq3BbLfZbMwrIIizMGJRa8c8QYCTFQUuJyOvHj24nx/JPb64Xr5cx0uTCs2nTLtVZqKczTnWl6IKTAGIe6jYhfb1Sju93W2tGbEi0nagzkzZNDYNsig9KSeZoIYeuNQiqElGzb1nONziKnByWG54UHj8xSyjjniTEdGV4fE+s8dzt7NtoXbNg/pBFjwGuNESvJGorb88v/suQjrpLJOTPMWuOd7+p2/M0phEDcPI+3kevLd6bzC+b6itcKZ/STRsljSozGW8MglOobKR2SSylP7i/v7P66x8+GBgapTR+JXe7/0Fp7V3/EIdfa1bw7+Gd9vS58+TpyHeee8WcKfwM8+QpauIw58AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png\"\n        srcset=\"/static/ab2a8e515283872d8b35dbb2381af6b3/6f3f2/perms3.png 256w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/01e7c/perms3.png 512w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png 1024w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/71c1d/perms3.png 1536w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/a878e/perms3.png 2048w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png 2840w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Note that we are choosing application level permissions so they will work in background</p>\n<p>Now we need to grant requested permissions (even so we have add them manually it is still requires contest)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.578125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0ElEQVR42k2P207EMAxE+/8fhkC8LCB4YW8PSO1uSzZJm8S59aCUixhprJE8HtvdOF6JUcg5o41FTRPqfORyeKc/ndm/vvGxP9JPGkmZhnVd+cV/3dAZrYkSSCnhfEBrQ7gpojU4NbG7v+Pl8YHnpx3GmG2olIJzbmMQof6EttrVWv+26CXRK6HUSkwJO8/4EHDeIyKbr/nbN62fJZCNQqzBXAaCudF578mlbIGprDip3zollnlmWWastTRfC2xsF+ZaIUXKNLCMA9fTAf858gWsITT00X8z4QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png\"\n        srcset=\"/static/a85237904d729be44937ceb281f22e7c/6f3f2/perms4.png 256w,\n/static/a85237904d729be44937ceb281f22e7c/01e7c/perms4.png 512w,\n/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png 1024w,\n/static/a85237904d729be44937ceb281f22e7c/71c1d/perms4.png 1536w,\n/static/a85237904d729be44937ceb281f22e7c/a878e/perms4.png 2048w,\n/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png 2690w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>It will just show an confirmation dialogue where we should press yes and if everything fine we should see green checkmars aside permissions</p>\n<h2>Microsoft Graph API</h2>\n<p>If previous septs were done correctly we should have:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span>xxx\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/api/user-list?view=graph-rest-1.0&amp;tabs=http</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">\".value\"</span></code></pre></div>\n<p>So with this approach we may talk to Azure ActiveDirectory in our background jobs</p>\n<h2>AZ CLI Azure App</h2>\n<p>There is a way to automate application creation</p>\n<p>BUT I was not able to setup permissions</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># STEP 0: AZ CLI</span>\n<span class=\"token builtin class-name\">echo</span> current\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> available\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> change\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span>\n\n<span class=\"token comment\"># STEP 1: APP REGISTRATION</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-admin-consent</span>\n<span class=\"token comment\"># az ad app permission admin-consent --id $client_id</span>\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-grant</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000</span>\n\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000</span>\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[*].{id:id,name:value}\" --output tsv</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='Directory.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='User.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n\n<span class=\"token comment\"># az ad sp create --id $client_id</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope Directory.Read.All</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope User.Read.All</span>\n\n\n<span class=\"token comment\"># STEP 2: TOKEN</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># STEP 3: API</span>\n<span class=\"token function\">curl</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq\n\n<span class=\"token comment\"># STEP 4: CLEANUP</span>\naz ad app delete <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span></code></pre></div>\n<h1>Creating and Azure app for device flow</h1>\n<p>Trying to mimicate <a href=\"https://moiaune.dev/2021/10/22/azure-device-flow-authentication-in-go/\">Azure Device Flow Authentication in Go</a> which has quite a good example of how to get up and running with device auth flow in Go.</p>\n<p>The same way as previous we need to make sure we are in the right subscription</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># current</span>\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># available</span>\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># change</span>\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token comment\"># tenant_id</span>\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span></code></pre></div>\n<p>Now we can create our app</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n<span class=\"token comment\"># allow public flows</span>\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/azure/healthcare-apis/register-application-cli-rest#change-the-flag-for-public-client-applications</span>\n<span class=\"token comment\"># https://github.com/Azure/azure-cli/issues/7955#issuecomment-611976458</span>\n<span class=\"token comment\"># az ad app show --id $client_id | grep ublic -C 1</span>\n<span class=\"token comment\"># this should enable \"Allow public client flows\" checkbox on \"Authentication\" tab in the sidebar</span>\naz ad app update <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">isFallbackPublicClient</span><span class=\"token operator\">=</span>true</code></pre></div>\n<p>The device authentication flow is described <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/devicecode\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>\n&amp;scope=user.read%20openid%20profile\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"user_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CW3AD73A4\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"device_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CAQABAAEAAAD--DLA3....\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"verification_uri\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://microsoft.com/devicelogin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">900</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"interval\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code CW3AD73A4 to authenticate.\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While user opens browsers and logs in, your app is expected to be pulling results</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"grant_type=urn:ietf:params:oauth:grant-type:device_code&amp;client_id=<span class=\"token variable\">$client_id</span>&amp;device_code=CAQABAAEAAAD--DLA3VO.....\"</span></code></pre></div>\n<p>And the response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"token_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"openid profile User.Read email\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"ext_expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"access_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLC...\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLCJhbG...\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Libraries in majority of languages will have something around validation of tokens but we will try to call user info endpoint found at <a href=\"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\">https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://graph.microsoft.com/oidc/userinfo <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25j...\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"g_461q6Bo2lIySX1faMNhrOkMY_Q2h6i-1GpzjinOqM\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"family_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"given_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"picture\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://graph.microsoft.com/v1.0/me/photo/$value\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AlexandrM@rabota.ua\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Noth that <code class=\"language-text\">access_token</code> is used, if you will try to use <code class=\"language-text\">id_token</code> you will get an error like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"InvalidAuthenticationToken\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Access token validation failure. Invalid audience.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"innerError\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2023-02-04T14:50:48\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"client-request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Go lang implementation will be something like:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"os\"</span>\n\n\t<span class=\"token string\">\"github.com/Azure/go-autorest/autorest/azure/auth\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tclientID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\ttenantID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\tdeviceConfig <span class=\"token operator\">:=</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">NewDeviceFlowConfig</span><span class=\"token punctuation\">(</span>clientID<span class=\"token punctuation\">,</span> tenantID<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// https://github.com/Azure/azure-sdk-for-go/issues/3804#issuecomment-452118022</span>\n\tspToken<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> deviceConfig<span class=\"token punctuation\">.</span><span class=\"token function\">ServicePrincipalToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ttoken <span class=\"token operator\">:=</span> spToken<span class=\"token punctuation\">.</span><span class=\"token function\">Token</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AccessToken\"</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>AccessToken<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>And to run it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run device/main.go <span class=\"token variable\">$client_id</span> <span class=\"token variable\">$tenant_id</span></code></pre></div>\n<p>But unfortunately at moment that does not work and complains about wrong requested scopes, so probably need to be done semi-manually</p>"}},"pageContext":{"id":"ade3278b-b573-5cfd-b631-454bb6d28559"}},"staticQueryHashes":[],"slicesMap":{}}
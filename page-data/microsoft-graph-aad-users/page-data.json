{"componentChunkName":"component---src-templates-note-js","path":"/microsoft-graph-aad-users/","result":{"data":{"remark":{"fields":{"path":"microsoft-graph-aad-users"},"meta":{"title":""},"headings":[{"value":"Talking to Microsoft Graph API or how to retrieve AAD users"},{"value":"Creating and Azure app for device flow"}],"html":"<h1>Talking to Microsoft Graph API or how to retrieve AAD users</h1>\n<p>I want to get list of AD users so I can make an desicion for 3rd party app to remove deactivated users</p>\n<h2>Azure App Registration and Permissions</h2>\n<p>To do so we gonna need register our app which can be done from ActiveDirectory <a href=\"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps\">app registrations</a> section</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVR42o1Ry07DMBDM13DkyKXfVoR64MKBC4I/ARUkfgMQbWlpG+f9cOI4juMMa7dFHCrA0sir9e7szNo7uXrF6fU7RncLjG7nOLuZYzxlmDxucTHd4fxhjfH9GpOnLS6fg1/h5c2AlEv4SYGybiBlg6bZoRZ0ty2MGfDf461Kg9k2xOztBcvlEowxhGGIwN7bDbI4Rq+ItO+/m4ZhOBo7Qk0JTcX24QBXWHF0SQwR+KhXC/AoAa8FWtVBSAVelmikRN20EEKQkw4l5bwo0diQwjzPoLXekVlQXDIf0eoDIgqc0o0fIAgjWoVAmqYOlsT2GUOiCF6rBkpWRJiDc46qqtDv7QnZIisKcMqxOMMnSwgx0ixHUeROhO3THalWPVgu4JVUHCcJeprS0YOFMcYR2th+jrXUKeX2+LNO72MrQFOPVBpeRjvISPaxYy35vu9sHYb89ctfPX1bqm8l90MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"register new app\"\n        title=\"\"\n        src=\"/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png\"\n        srcset=\"/static/f794d9541142f5850b53a7df5b1d3585/6f3f2/newregistration.png 256w,\n/static/f794d9541142f5850b53a7df5b1d3585/01e7c/newregistration.png 512w,\n/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png 1024w,\n/static/f794d9541142f5850b53a7df5b1d3585/71c1d/newregistration.png 1536w,\n/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png 1642w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>On a registration screen there is nothing fancy we are just give it a name and press create</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVR42q2U25KbMAyG/ex9n75B32J7mexFJuGUAD4BBmz+SgrsMplkOs3UzDeSLSTbkkCdz2ccDgeUZYnT6YTj8QheizHinaHmaQKz0JNSJBKWZRHeCtg0DaprDeOc4HwHbSyMdbDOQ5NstcE402bkEJfnbPurrO3wWbQo7HTHjMh0QE6wnjOkl25G5eNT2Nb08z1gGEf0w4B5njHS1fnK21j2LA/zB9J6RNXUNaqqwvV6lcJ0XYdh6CWvb+Wwtj04j23bStCNbU1rLbC+P/3LgK1ucaE2KYpC2oZhnSnLAnmWyQZZdpGgjgpnjRHpvYe1VvRtM+X6gNpwhT36vhde9SC3Ejtu7OdfJxzmBd20YE74L0N5f7+CMVqOvzX0q8b+W8Mrzs/lkiHPc4Fzx1WvqOLlyu12ow3NV76cu0ueW9Ypl9x26wm9OLBxmkZpGUsv17TGsM2RLVFeIznteVZ1FUKQxmYZwippvhVoIH1Y9UeC+NGHQTXoxoRAhVAjBWG2IBKA4AZn+nXOBJHf7wz93e4pmAuRAlPA0kV8NhNuXYQNCZoMemCSMM7/9tdRPz8Mfvwq8bsYZCG98dfau/wBTbUuRyzMVGcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"registration\"\n        title=\"\"\n        src=\"/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png\"\n        srcset=\"/static/1fb66ea46a4753cda04005d177a80fff/6f3f2/register.png 256w,\n/static/1fb66ea46a4753cda04005d177a80fff/01e7c/register.png 512w,\n/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png 1024w,\n/static/1fb66ea46a4753cda04005d177a80fff/71c1d/register.png 1536w,\n/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png 1782w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After an app was created we want its client id and tenant id</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVR42p2S2U7DMBBF+/9/BlIRtCoptFWrZt8cx0sWO/ZlmkARQrxg6ch2ZJ3xXGcVhBXOxzfs9wGyLIXzDp7471jl0kAYB00OYTyawUMMi1D2FlpryMFCKI2+79F2ForWSikYY34Ld6cIxzBFWDSIiLjkyKoGZhygxwlKShKbWdJ3HbrR0qzn7+M4zhLv/Z1VnCTI0wh26GZMrzF0CtYaeDpcM0bU9xtMfuHPlpumQlXX4JzPLX1VvA3DG7DrBW0SYahLyqBFnpRI4gKWM5iG3eeJU1EzkJCqT9ME52645epuydDkCcrtM/TlBH0+YEpDlLsXhOsHpC9Pn6xxXT+i2KzhlKCWswJStHPIknJZsvgW1sEWioRdeIajPT8EaAlx3KMlmvcAnP4S9rrBJDhWWc2QZxkYZWWt/ZGH1RIsCsFTEiUxZJGhzBmuMUOYMFT0gJ7OOEVIAW8NPgBGYWZtg16uAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"identifiers\"\n        title=\"\"\n        src=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png\"\n        srcset=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/6f3f2/ids.png 256w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/01e7c/ids.png 512w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png 1024w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png 1460w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next navigate to client credentials to create new one</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAq0lEQVR42pWPwY7DIAxE8/+/uNfuqg1JoEAgIYZX07S99LSWRmOQxzyGy+8fzgekNapKakWkvlyo6v+p4bp4jM9M95WtHMS0qTJ5L6Sc2ff9O9XqqSqn3r0CDc4uGsrIUfROsP286SJprJvobH1SNh0+lzUOO5GmkRYccXGY0RLnBXJi6BT9a7160HtPKYW4Jm6jeT5gjCGE8AFMzuJuV1qKmDnwc3HM6krFA8DEOKVsCIwNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png\"\n        srcset=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/6f3f2/creds1.png 256w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/01e7c/creds1.png 512w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png 1024w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/71c1d/creds1.png 1536w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/a878e/creds1.png 2048w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png 2544w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.53125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVR42nVT2Y7bMAzU//9LCxToPm1RoF9QIOtt2qRN4tix40uW5Puckkqd3QaJAEKyRA7JGVOg99EqB6/r33CcF7w6DsIgwHa7xXazwYbscDjA847Y7f7ApXPbtuj7HvM843aJeerQtwZdP2AaR4xs04hpmq42jBO99+i67iHQFbBuByRpDqO1DeDsy84GzCi7Cbk2yNIUKs8t4CMTaTVAmcI6DsNwN/s8T/9VfGscs5yF6WckuUIUnW1b91Ycx/B9H2EY4nQ6ISCO2TzPs3dJktC9bzHE3EkoldHDGVJK+8iVXiq7VFtVlbWmaaCVupzrGmVR2HNZltZquhNdU5FTbsV4RDYnqCmQA9iPgeu6sneLUAzMnIu0bOBSG4UxNsDQzgELJ7wacpTEcU7VMS2nVGEXSmy9CLE0aMk/yzJoElac2wmh1EiiyHKl/6l9XQTaxGcUgQ918qDZPBfJYX9JQqaoQy6EKRMqDyyhR3Lw6eeVWUrcGFRlgZLa6rMEXRwhJ25lGCDxCTBNgDwDxjeuF7qEUgkJcsLRpWk4ujjsdxaUAQsivdcS7TnAcf0Du9V3ZO4ee9pfvn2Fs1phvV5bXnnZls0wQ+rCqpdRyazWrThT26CgqnQS08eI/a+f+PTxAz4/PeHL8/N1ehRhiJbQeQq4/5Qmob/zL7JYnEzxtNDO4vAdJ+cuWBDmn88ib7hCejDaErsoe2dcrpVbzt5NyJvLjL/TqTTUfNvlHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png\"\n        srcset=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/6f3f2/creds2.png 256w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/01e7c/creds2.png 512w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png 1024w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png 1238w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.15625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGklEQVR42sWTTW+DMAyG+f//a5fdNk3apl0ok2gpjNJ8kG/e2YFWHNqNnWbplXHiPLYjUjyVHZ7LFi/VFz7qE+qzxUEGNDf0/tnirTridddg10rsRcg6yIg97ddnjyI4gxg8vHcwowKmCTeN1u04IsZwXWp6kdUJhZMyUDagSJTICE3JQggopRbp7CVJSAlJCjHO7EUcO+dJDsEHpDRRh2GuaIyB1gSVMyTDCDJSId5jTfe6X1nhrM31GDYMA45dj64fCCZyrLWm6/CwlLcJKOhQcJY6sBkQl7HYM4gn4JE43gS8JPGhPJq12fOocbkOzrnoV2BK6Rrw91prwGYgd7bF/g8Y6Kf+K/AncIHNNuGh1HisJLxRdx/UN9ZBsAcuKjgoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png\"\n        srcset=\"/static/bf7d3e8f821c4c47e816de2970fd8809/6f3f2/creds3.png 256w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/01e7c/creds3.png 512w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png 1024w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/71c1d/creds3.png 1536w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/a878e/creds3.png 2048w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png 2600w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Make sure to copy secret value (not secret id) and keep it secret</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABN0lEQVR42pWSbXODIBCE/f+/sk1NGhWQF09A0O1xJpm038rMM+cxuiy3dnlVGMcJWisYY2CtxTwbBO9xHAf+u7rJEnKK0hzHjlIP2CWDYsJWduStyl7d8aL8eX6ns25mRxbbtolozBXXiaDmgFF7DMpj9gmOtpPlARUhrFXw8ayd8wGlFKaKYBP2zjKOr+3gGecalscxyzhafRLX9SSetfvWGsP9zh96FssivhIhpsQuPTytWPnFZVmQeK/N9Z1933/NulNmQt9/wbBwzlEchhAkHOs8CxGITppoc5GaI+6fNef8Eu1MIBGrtT6COSTtEDhlOZ2D4kMoRhSrQfcbVyMkoxBuPRajOcDCwgndMDu54nO1K2g1gZbAbkggdtx+K1ID1OUDhkV0f4G+9hgvn5i4b7NV04gfYndsTwctoLwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png\"\n        srcset=\"/static/ecca13870b454a599d0ea42d3c941a9b/6f3f2/creds4.png 256w,\n/static/ecca13870b454a599d0ea42d3c941a9b/01e7c/creds4.png 512w,\n/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png 1024w,\n/static/ecca13870b454a599d0ea42d3c941a9b/71c1d/creds4.png 1536w,\n/static/ecca13870b454a599d0ea42d3c941a9b/a878e/creds4.png 2048w,\n/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png 2340w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now it is time to give our app some permissions, navigate to API permissions section and add some</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7klEQVR42o1Ty47UMBDM//8K4gpcuCEtB8QBgZbdQcNqkknGeTkPO4mdR1HtmSy7J2ipZKftrnRXt6N2GnHJc/w6HBDHMbI0xfl8RpZxTRJYa7GuK/7XotG5ELRtWwgULMuMdQP6wWHg2eBXtG2HpmnCudzdgRd7QVRbj6KsMI1jcMzzTMJF7nGV4DWQL7ef/TPDfpqgWHLf989EYuTCUTmcshpp3uCs9A0N4kuNJEDjdGmRqBaqNgGRsw20rkLZI7PcTYi1WaEqg6oZUBKq6pHXNgTmAvrikmedh5ko0cSSq86gadtQqqOekmXIkGvOzIuyRF4UKKsKC+/Msw/r83657r13IT5SdkSqFBTRdR11uhLOPEx+H5HFJygiY+eVuiBTBTJml5Qt4qJDQqTMPOW3MSzZOwPdaLQks8Nw7Rxt1SXa4wHnH98Qf/mM+unIro/oea+j3gIj0yHy3BCaUsVPSB9/Irn/juJwD0cdJXVvDfoix9e7T3j39g0+fngP5z0ssxA5Osqk6xovRQ9jUxweAllK9MdHDH0HQyzUp59WxHpBbTdcR27DwCoEE6dDGrnD82cyVlFlpyC8OF+bDPrGMheKv4R5FJNJ2Al3csHezEhPDrXmC7g5/law3UZpCK9lz0SChXQfsx3iF98faZCd6YiSy60AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png\"\n        srcset=\"/static/6bb281754a5658c46a6a5ea2143e2681/6f3f2/perms1.png 256w,\n/static/6bb281754a5658c46a6a5ea2143e2681/01e7c/perms1.png 512w,\n/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png 1024w,\n/static/6bb281754a5658c46a6a5ea2143e2681/71c1d/perms1.png 1536w,\n/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png 1650w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Choose Microsoft Graph</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABvElEQVR42l1SSZLUMBD0g/kNz+HGjQsc5sDQzTTT3m3Jq2RrseWkSuCOjlFERilKpVqyMinLEnVdQwgBKUW0xhgcx4Hz8H0ln1YK27Y9EELAx5Pw5+cA5z2ss7B+g9Ya+77HwGGcULUyJjbWQumF4hwVt/HPI6Giqs9HmR3z4qBXj1kbLMZjtRuU0pg6ATUMhB7LNOLYPAKBLcLOoyDRWsFSxfNU446sGVGJOdqsprucMRMtX7694c/litvLD+TXV4xljqFI0TPuN7IZknVdwWCeGBNVllKi67roZyroBW1a4tPnr/h+SXH59RP39I6syJFmGbI8R56+I7+8IuHPy7I8yJeyQ1xU0xBqtLSkZlDwg8AuCzga20a0Eb4X9NbBigaGbFJXFYa+jwvhhLykkTjihXgim61zxKUKuP1u0dQ5euo+eIeBeM7bHh0V1rOKOZK2qTDTmOui4OxKy3Ao5YpJmUcB7/9tM01zFEURpcVTrcR9yxNS0ZOehDl71tweDizuQPjv44VxMFdnCZ2TRLAOP+g16tCRnk6RWmuoW00d6Dgud8Ix1lHXU02YY3zUpg+4Vg0EKaAn2tj/F0RTARFEl/8aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png\"\n        srcset=\"/static/6b189a4656515865aae9f8720509e511/6f3f2/perms2.png 256w,\n/static/6b189a4656515865aae9f8720509e511/01e7c/perms2.png 512w,\n/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png 1024w,\n/static/6b189a4656515865aae9f8720509e511/71c1d/perms2.png 1536w,\n/static/6b189a4656515865aae9f8720509e511/a878e/perms2.png 2048w,\n/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png 2100w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Add wanted permissions</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.953125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVR42oVS2U7kMBDM/38bz6vhYYHJsMnM5HB8xnbsFGUHkBAraKnkuGN3V1W70dZBKwVjDIw1cM4hpYwtJZQQJmJeFNbVIe87dvwczbRIrCxSguehbIQ0nkUMrIu4TRL99YZ5npiTUFojbRFmmiCHAYZ5M8/Q3Hsp0Ei5wBqLnBNIDNfJ4DYuGIXBRFgWkGKCsxYhBPjgkWJEezrh+fGE/vyC66VF154xtC2aWekqOeeMTJnjcMMw3CEWAa0t5LWH+PeKrFWVu1NGPcuiO5lmNthox+Y9bQlkqMiG1L1f60FBWWJZ+HOtvgb6urBB4sWPggcOz2LcYDmHEOLhYXcfMI9jlVO8US7B+DKQnTkPR/ZazIiG3tni3/YVaTvs4rpx34y84NihsCvx4ZOnhEAp99ce3dNfDOcn6O7CBpK+qk9ozqC+En47Nm2ElDUR40E5pfSJ0rmg6qsaf3s0lLxwKOVJFLr/i33fv+1/QrNRamHz7eL7eukmPPyh7H6sHv/G8A08+QpaHZYmAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png\"\n        srcset=\"/static/ab2a8e515283872d8b35dbb2381af6b3/6f3f2/perms3.png 256w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/01e7c/perms3.png 512w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png 1024w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/71c1d/perms3.png 1536w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/a878e/perms3.png 2048w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png 2840w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Note that we are choosing application level permissions so they will work in background</p>\n<p>Now we need to grant requested permissions (even so we have add them manually it is still requires contest)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.578125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA0UlEQVR42k2P2U7DMBBF8/8fhqh4KVTwQrcHpKRNcG0njtfk4CmLuNJYo/FdZpq+vxJjIOeMNhY1DKjzkcvhnfZ0Zv/6xsf+SDtoQsoI1nXlF/97QWO0JgZPSgk3e7Q2+JsiWoNTA9vHB3ZPG16etxhj7qJSCs65e/kQWH5M5W2WZflL0VOiVYFSZ7EG2HFk9r4GzYQqFJ7w5Rr5z3WRbBShhptLhzc3mrmSc00UpLLiwvLdV8FUDadpxFqL8MRQSjbM1ZgUKUPH1HdcTwfmz54vrCE09CwYtPsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png\"\n        srcset=\"/static/a85237904d729be44937ceb281f22e7c/6f3f2/perms4.png 256w,\n/static/a85237904d729be44937ceb281f22e7c/01e7c/perms4.png 512w,\n/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png 1024w,\n/static/a85237904d729be44937ceb281f22e7c/71c1d/perms4.png 1536w,\n/static/a85237904d729be44937ceb281f22e7c/a878e/perms4.png 2048w,\n/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png 2690w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>It will just show an confirmation dialogue where we should press yes and if everything fine we should see green checkmars aside permissions</p>\n<h2>Microsoft Graph API</h2>\n<p>If previous septs were done correctly we should have:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span>xxx\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/api/user-list?view=graph-rest-1.0&amp;tabs=http</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">\".value\"</span></code></pre></div>\n<p>So with this approach we may talk to Azure ActiveDirectory in our background jobs</p>\n<h2>AZ CLI Azure App</h2>\n<p>There is a way to automate application creation</p>\n<p>BUT I was not able to setup permissions</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># STEP 0: AZ CLI</span>\n<span class=\"token builtin class-name\">echo</span> current\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> available\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> change\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span>\n\n<span class=\"token comment\"># STEP 1: APP REGISTRATION</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-admin-consent</span>\n<span class=\"token comment\"># az ad app permission admin-consent --id $client_id</span>\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-grant</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000</span>\n\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000</span>\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[*].{id:id,name:value}\" --output tsv</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='Directory.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='User.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n\n<span class=\"token comment\"># az ad sp create --id $client_id</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope Directory.Read.All</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope User.Read.All</span>\n\n\n<span class=\"token comment\"># STEP 2: TOKEN</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># STEP 3: API</span>\n<span class=\"token function\">curl</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq\n\n<span class=\"token comment\"># STEP 4: CLEANUP</span>\naz ad app delete <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span></code></pre></div>\n<h1>Creating and Azure app for device flow</h1>\n<p>Trying to mimicate <a href=\"https://moiaune.dev/2021/10/22/azure-device-flow-authentication-in-go/\">Azure Device Flow Authentication in Go</a> which has quite a good example of how to get up and running with device auth flow in Go.</p>\n<p>The same way as previous we need to make sure we are in the right subscription</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># current</span>\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># available</span>\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># change</span>\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token comment\"># tenant_id</span>\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span></code></pre></div>\n<p>Now we can create our app</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n<span class=\"token comment\"># allow public flows</span>\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/azure/healthcare-apis/register-application-cli-rest#change-the-flag-for-public-client-applications</span>\n<span class=\"token comment\"># https://github.com/Azure/azure-cli/issues/7955#issuecomment-611976458</span>\n<span class=\"token comment\"># az ad app show --id $client_id | grep ublic -C 1</span>\n<span class=\"token comment\"># this should enable \"Allow public client flows\" checkbox on \"Authentication\" tab in the sidebar</span>\naz ad app update <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">isFallbackPublicClient</span><span class=\"token operator\">=</span>true</code></pre></div>\n<p>The device authentication flow is described <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/devicecode\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>\n&amp;scope=user.read%20openid%20profile\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"user_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CW3AD73A4\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"device_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CAQABAAEAAAD--DLA3....\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"verification_uri\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://microsoft.com/devicelogin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">900</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"interval\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code CW3AD73A4 to authenticate.\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While user opens browsers and logs in, your app is expected to be pulling results</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"grant_type=urn:ietf:params:oauth:grant-type:device_code&amp;client_id=<span class=\"token variable\">$client_id</span>&amp;device_code=CAQABAAEAAAD--DLA3VO.....\"</span></code></pre></div>\n<p>And the response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"token_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"openid profile User.Read email\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"ext_expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"access_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLC...\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLCJhbG...\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Libraries in majority of languages will have something around validation of tokens but we will try to call user info endpoint found at <a href=\"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\">https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://graph.microsoft.com/oidc/userinfo <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25j...\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"g_461q6Bo2lIySX1faMNhrOkMY_Q2h6i-1GpzjinOqM\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"family_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"given_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"picture\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://graph.microsoft.com/v1.0/me/photo/$value\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AlexandrM@rabota.ua\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Noth that <code class=\"language-text\">access_token</code> is used, if you will try to use <code class=\"language-text\">id_token</code> you will get an error like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"InvalidAuthenticationToken\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Access token validation failure. Invalid audience.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"innerError\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2023-02-04T14:50:48\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"client-request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Go lang implementation will be something like:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"os\"</span>\n\n\t<span class=\"token string\">\"github.com/Azure/go-autorest/autorest/azure/auth\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tclientID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\ttenantID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\tdeviceConfig <span class=\"token operator\">:=</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">NewDeviceFlowConfig</span><span class=\"token punctuation\">(</span>clientID<span class=\"token punctuation\">,</span> tenantID<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// https://github.com/Azure/azure-sdk-for-go/issues/3804#issuecomment-452118022</span>\n\tspToken<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> deviceConfig<span class=\"token punctuation\">.</span><span class=\"token function\">ServicePrincipalToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ttoken <span class=\"token operator\">:=</span> spToken<span class=\"token punctuation\">.</span><span class=\"token function\">Token</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AccessToken\"</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>AccessToken<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>And to run it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run device/main.go <span class=\"token variable\">$client_id</span> <span class=\"token variable\">$tenant_id</span></code></pre></div>\n<p>But unfortunately at moment that does not work and complains about wrong requested scopes, so probably need to be done semi-manually</p>"}},"pageContext":{"id":"ade3278b-b573-5cfd-b631-454bb6d28559"}},"staticQueryHashes":[],"slicesMap":{}}
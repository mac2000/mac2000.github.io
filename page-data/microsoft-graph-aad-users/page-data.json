{"componentChunkName":"component---src-templates-note-js","path":"/microsoft-graph-aad-users/","result":{"data":{"remark":{"fields":{"path":"microsoft-graph-aad-users"},"meta":{"title":""},"headings":[{"value":"Talking to Microsoft Graph API or how to retrieve AAD users"},{"value":"Creating and Azure app for device flow"}],"html":"<h1>Talking to Microsoft Graph API or how to retrieve AAD users</h1>\n<p>I want to get list of AD users so I can make an desicion for 3rd party app to remove deactivated users</p>\n<h2>Azure App Registration and Permissions</h2>\n<p>To do so we gonna need register our app which can be done from ActiveDirectory <a href=\"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps\">app registrations</a> section</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbElEQVR42o2RwW7UMBCG8zYcuXLos5UChx64cEF9k8IiwWOgCkq7Zdeb7MZx4iR2Ysf2hxIWtBUg8Uv/zEgz+vXPTPbk9Q1P33zh7OqOs6tvPHt7y/n7HS9XgouV4MVK8PzdhvPrDa8+CC4/FVx+/Dez2kZkO7CTDbq3jMOAMRZjLb2x2HEkpERKkOZwxElJOsnZQxO53e75evOZ9fqePN+x3xcU+Y5CbFHlgehGUgj8D7IpJUKMf3ZMT5AlthD0D3d0ZUVrLM57zDDSao0dRvrB0RuDGRy6acgOcmIr9tS1IhxdzNaT9+hccFjf0x8KVCnZ5gXFvlwEqqpa2DSaaZqIMZJiIBtcQrfdIti27cJ5YEY/jKi6oe068lKxKSTf85JK1TR1jVKKuq6ZvMOMgVz1ZE3XUUq5iHjvcc79PoF3HjuvYwzeOWKYCMe5U4YwMYWIdRNZZUdUox+d79c3pZQIIdBaP/rw3/Gz/wNBSFuTZ41zEAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"register new app\"\n        title=\"\"\n        src=\"/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png\"\n        srcset=\"/static/f794d9541142f5850b53a7df5b1d3585/6f3f2/newregistration.png 256w,\n/static/f794d9541142f5850b53a7df5b1d3585/01e7c/newregistration.png 512w,\n/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png 1024w,\n/static/f794d9541142f5850b53a7df5b1d3585/71c1d/newregistration.png 1536w,\n/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png 1642w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>On a registration screen there is nothing fancy we are just give it a name and press create</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1klEQVR42p2Ua67bIBCFWXr30yV0F7d/k0pJ4/eThw0Yw7macWK51Y2SFukTIwwHODNY3G43nE4nVFWF6/WK8/kEGlvXFSkBKaW3oSbCsoCglmJEShH/20hT9F2PumkhlWaUMRik2mJtMEqFYZTwS0BMwBrTl0Q+YYLI+wnnYkCpPFNIj3y0KKTjmPp8dKj0gtoE1PovTECpF3TTdkvhvMc8z1hCgPceMabDFdLmI157Ge9zRd91qOsaTdNwYqZpgrUWIYQnPj1PCF+5VTO6vkff9yxK4kTXdTw2DANDcYzxRVISxDgMyG6/URQFLpcLQ3FZlkye52jqGlmWsbBWClJKaK1htIZSinlsJvRk0Y2UYcNeElSDz05AC79ir0MbEihBa3rt1es6TBB0bK0kpBz56O8seibOgpSILMvZt6LI2TdOTFVx1om2baHYNwVjDG+sD/5pY/aqEDSBFpDR/l6TNInGKNMsphT7SouOHMvl0YRzjkWop/p79I8EWTvv8Z9s9Wqdx7xETD7CLhHCO4vFWbi7CAnQRCpw4ihy3IihObOF8SuUXTH5FaLUAb+6BY1ZIV3EaCOGeesJv771n9kR3z9GfPtR4Wdh+RO95X/5B+7v/c4nGrctElJpNXYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"registration\"\n        title=\"\"\n        src=\"/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png\"\n        srcset=\"/static/1fb66ea46a4753cda04005d177a80fff/6f3f2/register.png 256w,\n/static/1fb66ea46a4753cda04005d177a80fff/01e7c/register.png 512w,\n/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png 1024w,\n/static/1fb66ea46a4753cda04005d177a80fff/71c1d/register.png 1536w,\n/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png 1782w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After an app was created we want its client id and tenant id</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVR42o2SiWrcMBCG/f6PVmhot2m8abzssr4PybIkX/LxlWgTQwuFDnwIjWZ+zQwTnJOGW/TK6zmkKnLYN8++7/yP/R0XlMahF+g36By0446eH0F6XLDWYsYFbSzDMNAN7uEzhnmeD9FPgudLTHTPiUtJXL3TktcSN0/08+oTzTBjbO8F+2lh6HusMUzT5EW2bTsIkiyjzBLcNHjmwTINFucevwspkVIcLW0f/MuCtm1oGoFSimEc/3h0qkXer6gsYRI1u1aUWU2eVLhWeBYl/bm2AuaJoJWCZV1Z19WX/NmCFywz6udv9LcL/TVizWPqn9+Jv34hPz0dvN+r0xOb1QRpUWF052eltT5m4QWLFBH+wN4ujPGVvcxQbyHdW4iOznRRiPz1QhudES8nFq0IikZSFjlSSpxzjzX4WIXFGmRyR2UpbZZgypyqlNxTQZwKmkqyGc1qOjbdsbmZ38JvZfGPXtuBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"identifiers\"\n        title=\"\"\n        src=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png\"\n        srcset=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/6f3f2/ids.png 256w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/01e7c/ids.png 512w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png 1024w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png 1460w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next navigate to client credentials to create new one</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAs0lEQVR42l2PUXODMAyD+f9/ca/rNgiEQAIhwfa3S+m6XnWns/UgW+o+b1+ENSIGaoaoInLxFEFVeYc9+Lr/6e57WnFrZgyJo1TSnonbTj4qOWdKKZfR7EnaE1VMBPSfZkoXZk85MnJWVIXZN31QxNiK3A+IXPOeQpXqR3Y3YGsg+YDrZ9LosbzRtRStWkMzLstCrZWUNvrB4b3HOUeM8Vl5DzNz/4PtiWGKfNwWximCnPwCnnE4bn8I1+0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png\"\n        srcset=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/6f3f2/creds1.png 256w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/01e7c/creds1.png 512w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png 1024w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/71c1d/creds1.png 1536w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/a878e/creds1.png 2048w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png 2544w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.53125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACNUlEQVR42nVT227bMAz1///KBgzoW4E97AuK9ZJmS9okvkeWrZuvki9nEDMHaYcREETR9CF5SAZwCazaYLN9w+blGZvNC7Isw9t+j/1+h93uN8LwhDiOcTi8kz4MA5xzWJblnxMsk4WzNZwbMc8zpmmie3Xw+jgvsM7BWnsF+p8E3TCiKCW0VvSDj345Pd1YFtTDDKE0Ss4hhPgQ7PamDHnjIE0NKQXGcfyQ/lW8fvP2AJ/BVltg3AIuFdj5TOXcygrKGCMO8zxHkiTIshRpmiKKIrIVRUH28zlHsFgBrQTy/EzlcM6vwCtg27Z0+r4napqmQdd1qOua7P696oHtWmglKd3PshY5jSM5exAfZOh7dP7dtnDOElX+u+c8KJsOYZKiNoZ+MMZQJsTJNBFgN1gIKSGVwuAcEq7wnlfYxQxMXPyrqoLWGgGzC87KgDNG5Xqj7/ZNB9AXOZosgU4imDSCjkPw0/ES5O/xiXjKAiUzpEmM8HREEkcQVYnaaLS1QeNLKhkGlkPwAiJLUMQhDGeAkR+at1IWKFUgyxJEfhuiE46HN1QlJ0BTGzglMOQpwtcNDj8fUJ0OODw+4OnHdzw/PeJ1u6Vl8KKUQmBGQJgaWiniwXfss8x9h5oXUAUD5gnHX1t8+/oFd3d3uL+/J4qWeaZZDoZxhNKa6q+qkjq2lrGOTedJlxLaGFRCkP9g7bXzPpGiYGibBoHsFlSqId78LK1cXADXWbxsyhrgdjNux82v3h8P2DRjTl0SZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png\"\n        srcset=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/6f3f2/creds2.png 256w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/01e7c/creds2.png 512w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png 1024w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png 1238w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.15625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPklEQVR42oVTy07DMBDM/38XJ04gJBBcGoQoaRulfsVve9BuMYqiph1pZO/aO57dKN3TbsRzf8LL54iP7wl74TGoiEEnDDr+MXHu/euEt88DXvsB/VHhRyXmoDOvexnRpWBRUkCKAW42uAVvZ6Ck//g4SRwmiVEaTNrB+ISulIoKYLYWUkporaGNgdbmstcaSilmSpnv1lqZKSX4EJgxJuRS0FGS4JzFPM9Q2jCNuQhSzjkHay1KKXy3CV5D573nw3m2EELgME4YJ8GOKCbBGCOLrgWvsZPijBg8rHM4C4GSMxflnBG4lQh6lOK6ENxC1w6pmNoiJ61FGsfawV3BZRu0Jye0EpeFy/imIDm7hVa8FtycYfsot9gEC8esuO2Qhr5+dcsh0Bxuu+zuzaU2V6h42Bk89grBavAPcUXwF+bPruRGdYyzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png\"\n        srcset=\"/static/bf7d3e8f821c4c47e816de2970fd8809/6f3f2/creds3.png 256w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/01e7c/creds3.png 512w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png 1024w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/71c1d/creds3.png 1536w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/a878e/creds3.png 2048w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png 2600w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Make sure to copy secret value (not secret id) and keep it secret</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVR42o2R2Y7bMBAE9f9fuRtrvZbFS7zES6yFKDtAkpc0UGiQAHtmOFOOK8uyIqVAKYkxBq0U1m70fnCp/zfT0wRyTrzVOhifCTGRy0HKjdI69YDa/qX8xWSMQmtNKWUE7rkxr55VOxZhB8omjC9/sL3cxoaN9eWNyVhHrXVw6gy2m2HbtjH2yXaejbm+QyuM0Rdas8d4sUdijEzfQrI8vsfDkvMIDiGw74lVW6yPxBBwzpFSonde9MFxHMPfmoR8Mt9uKCnIaSfnjHXu6sZsOB9GgRPvPSnGwR7C5TGMN78DlQsoKWmtXfvsHaUUzlr60ejHQS3nkiLVSMLjTjVqkJTA3me8EpRaySkxPbQZI73DjtaQYiV4N6qfeGcR5926IH59oL5uiPkT+XXj+fnBep9HE2J98gPG6WvbHNfU5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"\"\n        src=\"/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png\"\n        srcset=\"/static/ecca13870b454a599d0ea42d3c941a9b/6f3f2/creds4.png 256w,\n/static/ecca13870b454a599d0ea42d3c941a9b/01e7c/creds4.png 512w,\n/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png 1024w,\n/static/ecca13870b454a599d0ea42d3c941a9b/71c1d/creds4.png 1536w,\n/static/ecca13870b454a599d0ea42d3c941a9b/a878e/creds4.png 2048w,\n/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png 2340w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now it is time to give our app some permissions, navigate to API permissions section and add some</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVR42n1T267TMBDM/38LvCJ44QkJHpCQOIIDLS00SdPYiXPxLXZsZ5DdJqeADiuNNlLW49ndcTYajZpS/NjvURQFqqrC+Xy+5RJKKYTgcR8Lno9sMgZSKWBZEELYEENOFlop6NljHDmGoYf3HsuyPIuMSYumbTFNUyJybt4ORWUpL/jjov9FJowBoRSCczjntnZ8AA61xaliOJMeZf2E/MJQRNQdTvWAggyomUzIjOrRdyzNKqpcpxRVdXIBYQLtoNH0CnXLQTsJwq6gvUbRKDR8hjQAn2LLo0Q/DEmdMWZr13kPQkkaB20aMMbSP+8cvHfX7GaE2/dsDay1yIiacCEEhNTg45gOxZiNQXE84JKfUOcnXMoy1VSE4tIJlM2Igo4pV4yjakdIKZE5p9L24hb11jIQeobhsMf5y2fkHz+A/TxCaJ1mzYVIkFL9Y6GMFb9Q7b6h/PoAunuEnTSMNZilgKAEn96/w6uXL/D2zWtYO0NJieCjjUZ0XXdnzpttmv33RFY9PoAfd1CCQwqe7CNMQM4cmAxpSUsI0FonxAXGRa6Y5znZKmPKgjZtKvo7YoGYPFz00HJtLhJprdICV/JIuM4+6yaDrh8200bZ66uJr8RMelMRh36vLuYVK/FvZjKdZ8cl0PIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png\"\n        srcset=\"/static/6bb281754a5658c46a6a5ea2143e2681/6f3f2/perms1.png 256w,\n/static/6bb281754a5658c46a6a5ea2143e2681/01e7c/perms1.png 512w,\n/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png 1024w,\n/static/6bb281754a5658c46a6a5ea2143e2681/71c1d/perms1.png 1536w,\n/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png 1650w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Choose Microsoft Graph</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxUlEQVR42lWSya7UMBBF8798Dp/Dih0bhMQC6DfSnXQmO6Mdx0mcHOSCPD1KKlXs1HB96yZFnlOWJUop8bqumeeZ4zg4bd93nHNYY9i2lW3bxOP9aTE/euLn+b+EZV1ZFs+yblhrCGGTgq4fyCuF857Ze4y1+GWR71hzNk2MMW8HODAuME4e6xZGO0t0fsMYS68VY9eK277n2FaOdZXIHqSPNPTev0Ev+kBaDuRqJC070qIjVwNjUfDpyzOvl0eev38je/hFn6e02Y32fqO5vkhMpmkSfuJzI8ph6GgaTdM0xH9CBQf1LePDx898vdy4XH7wer2S3jNuacrtnpFdf5M9/CTRWkvh+WylG/K4qKqSZVW1omoNa1uz6Tu+qcVnXeN1xdoqlk7jVcncapKiyGmbhn0P0tDNnj5yZO3fxZhI/ow1gZenirLIaLQmLJ5uWkjrFl0WmHEkhEBSlQVD3zFZg5+dLCHXE71xEbJIaInbnD3Xa0qWZdRKYScrw2utZfjknNCTDMPAewv7gfU7+z8ZxoWdHEcEJ9cS3+nwTTYRQSw6RRrPbrIyVSZHJC7mTPR9Qd+Pgli0uQYe84q6LGjbVu7/AEKdAGQYa/TEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png\"\n        srcset=\"/static/6b189a4656515865aae9f8720509e511/6f3f2/perms2.png 256w,\n/static/6b189a4656515865aae9f8720509e511/01e7c/perms2.png 512w,\n/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png 1024w,\n/static/6b189a4656515865aae9f8720509e511/71c1d/perms2.png 1536w,\n/static/6b189a4656515865aae9f8720509e511/a878e/perms2.png 2048w,\n/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png 2100w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Add wanted permissions</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.953125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgUlEQVR42oWS6Y7bMAyE/f7P1t/tFugW2aSxE1+6b1tfYSXbBVqgS2AgiKSG5Iiddg6tFdbaBu8927axbYXDhE2sQhGCZ698at0iJMH7djnylctIE1ilxfrEbVb0w41lWRqx0oaSM3aZkdOIWWbMurQzSEEnlWid7UdXe2VYLPdJMq2GWVicMah1wTtHSokYI1vOnF++8fP7C8Pbidv5jf58Yjyf6VZt0Fqz73sbdRrvTOOIEAJtLGoYENcLu1Hstba8o/ieEjUnthjI3lFCwPtIp5RgmiZiCI1QSIUQEh8CxlqiNcjxTomhSdIID9RKrZCO8Z0jpvTQ8HqfWOaJlCKlZLQr2LA1RVOMOKUw60qyhmIf+pVSWu4D5SFX8xW6Wav2KUfFw+JTpxAj0Tvuv3qurz8YT6/o/oI7NsLoP9BKYppP4ayhE0qhlWqCH/ZYmQ/UbaPN9o7P1kZq3VYi5/xPsP5FUJ++/6Erz999f/wRfFBcrjNfvvb0w8xW8qeEvwHYbQl5yOsK8wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png\"\n        srcset=\"/static/ab2a8e515283872d8b35dbb2381af6b3/6f3f2/perms3.png 256w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/01e7c/perms3.png 512w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png 1024w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/71c1d/perms3.png 1536w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/a878e/perms3.png 2048w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png 2840w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Note that we are choosing application level permissions so they will work in background</p>\n<p>Now we need to grant requested permissions (even so we have add them manually it is still requires contest)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.578125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAz0lEQVR42k2P20rEQBBE8/8fJoovEcWXmGVBMDHZTWayc+u55MgEVi0oaLqbok4zTxMSAilFlN5YLjPLuWfsO75OZ7q3dz67nmFeCRKp2vedu+r8341WCgmeGAXrHEpp/Logm8ZeZ9rHB16fn3hpW7TWR0gpBWvtYR+Ev3ho6vG+UEYYlkAuOxIj283gQ8B6j4gcDep/ipEgQqpkeiFohf4e8Wqlcc6SUjoCYy7YUCoHUQRzu2GMYds2nHO/WDlncikQhXwZMNPIdPrAXWd+AJFKNNYOnBP7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"\"\n        src=\"/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png\"\n        srcset=\"/static/a85237904d729be44937ceb281f22e7c/6f3f2/perms4.png 256w,\n/static/a85237904d729be44937ceb281f22e7c/01e7c/perms4.png 512w,\n/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png 1024w,\n/static/a85237904d729be44937ceb281f22e7c/71c1d/perms4.png 1536w,\n/static/a85237904d729be44937ceb281f22e7c/a878e/perms4.png 2048w,\n/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png 2690w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>It will just show an confirmation dialogue where we should press yes and if everything fine we should see green checkmars aside permissions</p>\n<h2>Microsoft Graph API</h2>\n<p>If previous septs were done correctly we should have:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span>xxx\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/api/user-list?view=graph-rest-1.0&amp;tabs=http</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">\".value\"</span></code></pre></div>\n<p>So with this approach we may talk to Azure ActiveDirectory in our background jobs</p>\n<h2>AZ CLI Azure App</h2>\n<p>There is a way to automate application creation</p>\n<p>BUT I was not able to setup permissions</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># STEP 0: AZ CLI</span>\n<span class=\"token builtin class-name\">echo</span> current\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> available\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> change\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span>\n\n<span class=\"token comment\"># STEP 1: APP REGISTRATION</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-admin-consent</span>\n<span class=\"token comment\"># az ad app permission admin-consent --id $client_id</span>\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-grant</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000</span>\n\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000</span>\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[*].{id:id,name:value}\" --output tsv</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='Directory.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='User.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n\n<span class=\"token comment\"># az ad sp create --id $client_id</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope Directory.Read.All</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope User.Read.All</span>\n\n\n<span class=\"token comment\"># STEP 2: TOKEN</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># STEP 3: API</span>\n<span class=\"token function\">curl</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq\n\n<span class=\"token comment\"># STEP 4: CLEANUP</span>\naz ad app delete <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span></code></pre></div>\n<h1>Creating and Azure app for device flow</h1>\n<p>Trying to mimicate <a href=\"https://moiaune.dev/2021/10/22/azure-device-flow-authentication-in-go/\">Azure Device Flow Authentication in Go</a> which has quite a good example of how to get up and running with device auth flow in Go.</p>\n<p>The same way as previous we need to make sure we are in the right subscription</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># current</span>\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># available</span>\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># change</span>\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token comment\"># tenant_id</span>\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span></code></pre></div>\n<p>Now we can create our app</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n<span class=\"token comment\"># allow public flows</span>\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/azure/healthcare-apis/register-application-cli-rest#change-the-flag-for-public-client-applications</span>\n<span class=\"token comment\"># https://github.com/Azure/azure-cli/issues/7955#issuecomment-611976458</span>\n<span class=\"token comment\"># az ad app show --id $client_id | grep ublic -C 1</span>\n<span class=\"token comment\"># this should enable \"Allow public client flows\" checkbox on \"Authentication\" tab in the sidebar</span>\naz ad app update <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">isFallbackPublicClient</span><span class=\"token operator\">=</span>true</code></pre></div>\n<p>The device authentication flow is described <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/devicecode\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>\n&amp;scope=user.read%20openid%20profile\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"user_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CW3AD73A4\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"device_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CAQABAAEAAAD--DLA3....\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"verification_uri\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://microsoft.com/devicelogin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">900</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"interval\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code CW3AD73A4 to authenticate.\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While user opens browsers and logs in, your app is expected to be pulling results</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"grant_type=urn:ietf:params:oauth:grant-type:device_code&amp;client_id=<span class=\"token variable\">$client_id</span>&amp;device_code=CAQABAAEAAAD--DLA3VO.....\"</span></code></pre></div>\n<p>And the response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"token_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"openid profile User.Read email\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"ext_expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"access_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLC...\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLCJhbG...\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Libraries in majority of languages will have something around validation of tokens but we will try to call user info endpoint found at <a href=\"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\">https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://graph.microsoft.com/oidc/userinfo <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25j...\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"g_461q6Bo2lIySX1faMNhrOkMY_Q2h6i-1GpzjinOqM\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"family_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"given_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"picture\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://graph.microsoft.com/v1.0/me/photo/$value\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AlexandrM@rabota.ua\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Noth that <code class=\"language-text\">access_token</code> is used, if you will try to use <code class=\"language-text\">id_token</code> you will get an error like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"InvalidAuthenticationToken\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Access token validation failure. Invalid audience.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"innerError\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2023-02-04T14:50:48\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"client-request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Go lang implementation will be something like:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"os\"</span>\n\n\t<span class=\"token string\">\"github.com/Azure/go-autorest/autorest/azure/auth\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tclientID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\ttenantID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\tdeviceConfig <span class=\"token operator\">:=</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">NewDeviceFlowConfig</span><span class=\"token punctuation\">(</span>clientID<span class=\"token punctuation\">,</span> tenantID<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// https://github.com/Azure/azure-sdk-for-go/issues/3804#issuecomment-452118022</span>\n\tspToken<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> deviceConfig<span class=\"token punctuation\">.</span><span class=\"token function\">ServicePrincipalToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ttoken <span class=\"token operator\">:=</span> spToken<span class=\"token punctuation\">.</span><span class=\"token function\">Token</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AccessToken\"</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>AccessToken<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>And to run it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run device/main.go <span class=\"token variable\">$client_id</span> <span class=\"token variable\">$tenant_id</span></code></pre></div>\n<p>But unfortunately at moment that does not work and complains about wrong requested scopes, so probably need to be done semi-manually</p>"}},"pageContext":{"id":"ade3278b-b573-5cfd-b631-454bb6d28559"}},"staticQueryHashes":[],"slicesMap":{}}
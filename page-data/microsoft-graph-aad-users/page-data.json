{"componentChunkName":"component---src-templates-note-js","path":"/microsoft-graph-aad-users","result":{"data":{"remark":{"fields":{"path":"microsoft-graph-aad-users"},"meta":{"title":""},"headings":[{"value":"Talking to Microsoft Graph API or how to retrieve AAD users"},{"value":"Creating and Azure app for device flow"}],"html":"<h1>Talking to Microsoft Graph API or how to retrieve AAD users</h1>\n<p>I want to get list of AD users so I can make an desicion for 3rd party app to remove deactivated users</p>\n<h2>Azure App Registration and Permissions</h2>\n<p>To do so we gonna need register our app which can be done from ActiveDirectory <a href=\"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps\">app registrations</a> section</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABb0lEQVQoz42Ry4rVQBCG8wpuXbkTn05GxYUbNy6E8V1mBsEXER0VZk7OOcakc+tOTnf6ls4niTIIivrDR/9UFVVd3dm9l++5/+ojj9585uH5Jx68vubx5YFnV3ueXO55erXn7CLn7GLH87cHXrwr/kr2VUUO3cRNNVKqiV475MmitKU/TSjj0H7GhMQUEjYuP/mTT2THIXFTCL5cfyDf3SLKAlGViPIbojgim5oleiDxP8p8WvDz/HvGaOa2xpQFen/LqekYjcH7gLGOcRgw1qKtR2uDsR6lBrJWRuqmxxjNsvzotR6Ld4xlQbPfYURJXzcUpaCqG7SZ6LuOru9Rw0CMkZQSaY5k2iTqukNUFVJKxnHcCrZLWkcvFaPWVK3kWLUcqpZOKpRSW/1KDH57XyE12cnoLblOWBuFEDa/avV2mjDrqs4SQyB4j3cO71c8zrkt7mPiZANZNzlaqVj3XX5hlRAVeZ4j+/4u9q9P+Q4e1VhDAuS13wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"register new app\"\n        title=\"register new app\"\n        src=\"/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png\"\n        srcset=\"/static/f794d9541142f5850b53a7df5b1d3585/6f3f2/newregistration.png 256w,\n/static/f794d9541142f5850b53a7df5b1d3585/01e7c/newregistration.png 512w,\n/static/f794d9541142f5850b53a7df5b1d3585/2bef9/newregistration.png 1024w,\n/static/f794d9541142f5850b53a7df5b1d3585/71c1d/newregistration.png 1536w,\n/static/f794d9541142f5850b53a7df5b1d3585/799f3/newregistration.png 1642w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>On a registration screen there is nothing fancy we are just give it a name and press create</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.203125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB1klEQVQ4y6WU647bIBCFefy+Un/1AVbq/0qRGsVJfAcbMHd8VoPjdLdN1FRF+uQRNsPMOWDWdR0OhwP6vkdVVTgejzifzwghgMa6ri9Dg6UYEOO2+H8HJWWcC1zqFqOYC2JWGPhUYj5L8Emi5wKL9Qh5hU8ZIa2f8GlFzLcKO+nws5nQ64heJ3Q6opUerQq/kAGdiuWb7jfKnIoYlgDqmnnvsCwa3jlYa5FifNbQjacNby0LMYGMGYYBbdtCSgljDLz3T3V6zPaejcqiH0ZwzktComma4jptxMcR4ziW+X2T3dGHpkg543o5o6lrnE6nwseEBCWs67psSh3QGnoqpUo8zzNyzluF2nqMcoHUBu6m4/7y31q+ueziChPI9r8vfOkcaqUwCY5pEhBCIKX0MCFV/Sj+o0LSha4c6UY6kZYUE9frtczt7hNa66IZ6aeUvGu5X1VGR0SITewYY3FyWZZSLUEb0gKqiqr/yCMZGBlBCcgMSk5Ya8qcIcwWE1Td/txjYyyUS1AuQ/sMloJHCq7cFGMJC2sdFkpUkrvi/iesvZ8I5zxMSFh8gg0ZrJoCvl8sqimWXWabIUzGZLfYhvWV/8wd9vWHwpdvHd4q8+QWvPIvxJ13+iYtGDLRQfoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"registration\"\n        title=\"registration\"\n        src=\"/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png\"\n        srcset=\"/static/1fb66ea46a4753cda04005d177a80fff/6f3f2/register.png 256w,\n/static/1fb66ea46a4753cda04005d177a80fff/01e7c/register.png 512w,\n/static/1fb66ea46a4753cda04005d177a80fff/2bef9/register.png 1024w,\n/static/1fb66ea46a4753cda04005d177a80fff/71c1d/register.png 1536w,\n/static/1fb66ea46a4753cda04005d177a80fff/764d7/register.png 1782w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>After an app was created we want its client id and tenant id</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.67187499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVQoz42SD2vbMBTE/f2/WiFtQ5zQJm2TyLXjv5It2VYkW78t3pqVwWAHxwNx3Lt7KNonBfvdhm28ocgvhNlDCIQQ+B/8rYsK7TATDAE6B9IGjPsl0qNnGHq0ndDGMI6WbnD0xmCMwTl3N/1itHlLOIgL51wiCsm5UFwqiXdXzOgwWqNHR9dphmFY3m6GWndYaxeTeZ7vjEQiKLIEZweuY48dNKPReO8WcS0lSqk/FX/zX4iapqKqG5Rql43fcZUNzfmIShOcrAm6JUtL8rRkahu8aphaucy5leCuREo2eO8X3iJ/VbjBpoIqfsYcD/THN3wqyDdPJI8PZOsV2fqR7HmFWD0sutAboqwo70fWWt9vsSTMEuRLvJhZ8QFFhnqN6fZb9GFHu99Rv8TI1x31ds1sOqIkL/hMBHVTLynDty9jW0V1+qBJztTiRJt9kqYV76eS93NJmdfMumXqFFOrmH9W/gHhm2XOwR6YmAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"identifiers\"\n        title=\"identifiers\"\n        src=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png\"\n        srcset=\"/static/94bda61a32e1b30cad2f4c63fe6bb550/6f3f2/ids.png 256w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/01e7c/ids.png 512w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/2bef9/ids.png 1024w,\n/static/94bda61a32e1b30cad2f4c63fe6bb550/95e59/ids.png 1460w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next navigate to client credentials to create new one</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtElEQVQY012PV27EMAxEff8T5j/ZOC5qLpJVyLewnQ0WITBgH3K6r8c3Liw0BVWlNaHJjdoaIsJ/01+8x6+8683CtCQmv1JKZdkSW0ykIxNjJB/Hvaj6BgERtDWQBnr7s9d5a8lHopV8feOcvUiKKHuW6/ZZf5GdVu1MnAZ0DezWY0bHZhwad7qYErXWa/CUGUIg58y2R/qfATPPjOPAEsKf5Ogdtn8gcWM0Kx+fnnFe0Vp4ApvmOFHwSWiWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"where to create azure app client credentials\"\n        src=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png\"\n        srcset=\"/static/578e47c1c07b7ceb2490f96c0fe8a781/6f3f2/creds1.png 256w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/01e7c/creds1.png 512w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/2bef9/creds1.png 1024w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/71c1d/creds1.png 1536w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/a878e/creds1.png 2048w,\n/static/578e47c1c07b7ceb2490f96c0fe8a781/900ee/creds1.png 2544w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.53125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACKUlEQVQ4y22TfW/TMBDG8/0/DhpCTNrfTDCBkKYORNe0eU+TOLaTNnHefsiGhW7lpNNdHN/j556zPYaMST/y89eeH08bnjYb0jTF9312ux3b7ZYwCEjimMPh4PKu6xiGgWVZrtxb5hHTtwzDuC7O87zmsDDO0JsB0/cr0ItdAZ77kWNVI2VN3/cX3rm4LDMnM1OrhqoqEUK8OvAKsDyNCN1Si4pxHNdTL82CLg7EfTBNk3MLfBmte+24UNSKPEsdo7dtWDsej06/JEkIgoAoipzbtTiOyfOcMAxd7mFqGi3IshwhKldsjHnFtO+6dRBN07jc7jmfzy638SX3THd27Vrar9v8x9BKYYGs2322uNEarbUDsf9tbte96tyzjxNkXdO2LfXfaAvnafrD0AzUUlJLRW8MSaXYZYJtVJBVynVgh2VBvcLMZLKhOOYci8KxsK2tNs/0eUoTB6hwjw4P6HBPudtSC+EIWFdKOVKeEhFJdMDfPRMc9hR5hpKCVit022DKHJOnVGVJmcRk4QFZ5HBSVxJZ86QSpFlKFByIwoC9v0NUJd2ppW0bBi0ZsoRw88jztwdk4ON//8r9+3d8vv/El4eHtSPL2DtNC6JpUVI6Hax+b202hlZUqLKAaST2fT7c3PDx9pa7uzs3DKu5UhKvHydqpR1YWZbraZdT7voeYXXSmkoIpFKYYXBA9u7aWnvdrP6e7BaEOtE2ep3upSZvX83/3vCl/QbhTTS2Xj1hGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"where to create azure app client credentials\"\n        src=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png\"\n        srcset=\"/static/5e9bb7336f5d5237a4f997999fbb5c87/6f3f2/creds2.png 256w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/01e7c/creds2.png 512w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/2bef9/creds2.png 1024w,\n/static/5e9bb7336f5d5237a4f997999fbb5c87/d8817/creds2.png 1238w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.15625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPElEQVQoz42S207DMAyG8/4vxRW3CCQQ4oJtQmNTt6ptkubQnH5kb51K6TYs/aoT259dt+JpXeN5fcTLpsbHd4Nt67FTAfuZdjLg/euAt02F1/Ueq0phpyJrrxM/t12AiN4iB48weDijccu8NSg5Xs6HRqJqFGpp0GiH3keInAsKAGMdpFTQWqPve5Ym6R5Ka1aMiXNLKawQIrwf4L3HEAJSyhAxnjo6a2GMgToDGKg131HMWoucM+eOwCUTRKegsRZd16GqGxybDkopPhOQmlLeHLgkIbuW92edQ9u2yClxEUGGYUAIgWF0ngKvmRiDVEyvRcXOOfYJMp/gLnDalfyU0kXTQor9C0iT3bKxeA68usPxo9zSCORfrNyZkJY+73ptQqD8ul+c8N5eTons4eGzx+NKwht9nvYv8AceD66YYdjznwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"where to create azure app client credentials\"\n        src=\"/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png\"\n        srcset=\"/static/bf7d3e8f821c4c47e816de2970fd8809/6f3f2/creds3.png 256w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/01e7c/creds3.png 512w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/2bef9/creds3.png 1024w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/71c1d/creds3.png 1536w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/a878e/creds3.png 2048w,\n/static/bf7d3e8f821c4c47e816de2970fd8809/d2433/creds3.png 2600w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Make sure to copy secret value (not secret id) and keep it secret</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.01562499999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABM0lEQVQoz42S226EMAxE+f/P7O4CpeTmJOTGcipCS19raTSWJU/GdoayabQ2WGtxzuG9/2GB4+CK48r/gWHSgRg8v/E+QEnBh8SWGzFVcj2oO//CsEXXHZWSu2Bpb6Y1sprAoj2LErQkrC/YULA+X9zzi81Z+8kH5YSSM621LrjvDS8OL3KxF0TORy3i/visibNXby3dUC2F4bnMvB4faK0oOVFruXc5LQplrgm01ogItTVq2ymdG6VWaq33uofVKF6PB1qtt9OUcxfcUr4bznrNiRYD+xZpMdK2SI3hnq4LmpD7GMd9UZjnGWM0e6vsp4ucu8NiFXp8Eo0maoVXK2p8ol4PQgwELww6hN7QP8dxcLzf/eo5bR3pxBa742QU/nNElhk3j8jnhJ1GRH0h566d5RuIzGwi3AEFdgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"where to create azure app client credentials\"\n        title=\"where to create azure app client credentials\"\n        src=\"/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png\"\n        srcset=\"/static/ecca13870b454a599d0ea42d3c941a9b/6f3f2/creds4.png 256w,\n/static/ecca13870b454a599d0ea42d3c941a9b/01e7c/creds4.png 512w,\n/static/ecca13870b454a599d0ea42d3c941a9b/2bef9/creds4.png 1024w,\n/static/ecca13870b454a599d0ea42d3c941a9b/71c1d/creds4.png 1536w,\n/static/ecca13870b454a599d0ea42d3c941a9b/a878e/creds4.png 2048w,\n/static/ecca13870b454a599d0ea42d3c941a9b/92bee/creds4.png 2340w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now it is time to give our app some permissions, navigate to API permissions section and add some</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB70lEQVQoz41Sy27TQBT1//9PV2XBggULQEBUQqFJ2jh+e8bOvMf2+KB72zQChMSVju7xeObcZ6ajRycl8uMRZVlCCIG2adC2LcM5h5QS/teyECO01vzoioV/2jDBaIUwJwxnBSkFlmXGuq5Y1/Tif0cmzIS2F/De8cE8z1iWhTmJ80UAaQXzf1m6CNroubRxHBFjfL1AT78XEftTj6dS4LHocTh1zA+nHvu8xWMh8HASeCwlyk6j7DWyYEeMg0QIgfGsRtEA5VeIs8OgAwYVIM+euVSeMeiIZgwY7QI/A24Csl479FIihsADoJJJbV4WVFWFuqlR1TXqpoH3nquIMbAPwWNiHrhlhKxzAVXbomlqaKW4f2RzCCgPe7T5EX2RoykKvlO3HSppUPQKeadQCI1SGtTScELZPDucx4F7aK29dlmNGB/u8fTlE36+f4fqbgNlDLRWMOSVYv7X2ojDDqftHfLNZzTfvsI7C+csJu+g+g6bjx9we3ODt29uOSCVTdMn0WGQ1yFeptzvdijut6h/bGGedvDWwBrD+2ZiQi4TxnB9RKIkRsKcqdYwWnNPKVAm/YSmF1z/n7amBBcWLEtiToK0CZfhXDh5GiZnOIYJw/mM9DKMy/JSNMrG2ue+USZKKT6jltD3M3cMypbwC2YBnZS7w2JtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"adding permissions to azure app\"\n        src=\"/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png\"\n        srcset=\"/static/6bb281754a5658c46a6a5ea2143e2681/6f3f2/perms1.png 256w,\n/static/6bb281754a5658c46a6a5ea2143e2681/01e7c/perms1.png 512w,\n/static/6bb281754a5658c46a6a5ea2143e2681/2bef9/perms1.png 1024w,\n/static/6bb281754a5658c46a6a5ea2143e2681/71c1d/perms1.png 1536w,\n/static/6bb281754a5658c46a6a5ea2143e2681/573d3/perms1.png 1650w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Choose Microsoft Graph</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.21875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzElEQVQoz1WSaY7bMAyFfdxeqEdqgf4sOsUMuiCJHTveItmStVm2v0KaZtohQFCQSOrx8RX19Upd13RdR9/3OVprOY6Dh6VzuluWhRACMUbWdWXf93c5HAeFcy4/PhLCGvHeEeLGojXbFnPBNM/c+gHnfXZjLd6HfA7r+ta0UEr9+4ED4zcWGzBuRRuH9RG/bii9IMaRWUr0JNHzxJ5AxJUjRjhe0RZaa7z3b9AbuVF1M3U/U7WSSyOo+wnVtnz5euH84xfn71+pf76g2pq5uWafrhem5kphjMn8pHETSq1mhBAIITHGEuOW34aq5sPHT3x+OvHy/I3fpxPlteJcXrhUJWV5oXp+orjf76SmjyUMw0DTNNxuN9q2pR8GOqEI9w7bXbFDhxt77Njjx44gBrwYcWOHHTuKVJiaHn8ROh+YpGBZNCGsKKVx3mLmSHke6dsaOY7s3iG1oxklomszp2n7RdfecgOjFd4ZjPU0w4KcE+o987uuAWs9p3NFWZYZeZKQ8Wve/DzPecq07UJK+TZuivsBi3+NyZLuHhw/POVt2wb7xjv7X4cPkWYBa0WSU3KtFMY4nJUI2XK/i6y9zLePvNQtTVVm7p21/AEXeP/KinSWjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"adding permissions to azure app\"\n        src=\"/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png\"\n        srcset=\"/static/6b189a4656515865aae9f8720509e511/6f3f2/perms2.png 256w,\n/static/6b189a4656515865aae9f8720509e511/01e7c/perms2.png 512w,\n/static/6b189a4656515865aae9f8720509e511/2bef9/perms2.png 1024w,\n/static/6b189a4656515865aae9f8720509e511/71c1d/perms2.png 1536w,\n/static/6b189a4656515865aae9f8720509e511/a878e/perms2.png 2048w,\n/static/6b189a4656515865aae9f8720509e511/8079d/perms2.png 2100w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Add wanted permissions</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.953125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVQoz5WQSY7bMBBFdf9T5Bw5QlZZJItuOAjclh3NlDhInMQXkJY7DSebFPBAAvXJqv8raVZiCKSUSAms82zOY8wKJK6Dor41CDGhzFb6+75DjKT8zvs/hEA1LzNaafJvcYdfk6UdJM2gaEeFUvr+mdYYYwrBOa6nV86nV9r6je56oa0viFtNNQiBVooYIyFGun4ozItErxYzjei+xckZHwLe++JobhqmpmHpu8Lcdcz9QDUugr7rCIftfugZ+h4xzwghWNqG7u1MUJKYXcRYyNrsKg/IWzvncCFSlY3aBqM1wTtm5Vi0I1cWBWtRQpCCh7TzXOkYUnIFqkkqnLVHc2ezns06rLVsRtNdam4/ToxvP1G3C0YuaCXfUXLBaIlREqMV1ZQvOejDcvAe712xEoJn1YZVKVa54LQq/Y94d2gPfTUKwTSOxd5fdvj/qvS6IaUsOTwyeZBDX1fLLFesdSWSj/1/UT0H/Dj3dN/xy7eaT59f+Pr9jHcb9znpXfu84W/49gke7BfNtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"adding permissions to azure app\"\n        src=\"/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png\"\n        srcset=\"/static/ab2a8e515283872d8b35dbb2381af6b3/6f3f2/perms3.png 256w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/01e7c/perms3.png 512w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/2bef9/perms3.png 1024w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/71c1d/perms3.png 1536w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/a878e/perms3.png 2048w,\n/static/ab2a8e515283872d8b35dbb2381af6b3/3f99a/perms3.png 2840w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Note that we are choosing application level permissions so they will work in background</p>\n<p>Now we need to grant requested permissions (even so we have add them manually it is still requires contest)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.578125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzElEQVQY002Pi0rEMBBF+//fJYII4gMRsbuL4NLu2lfSTjJpmh5JRemFC8Mwcx9F2zTMITDPM/1gaJtv2sMHl2PJ1+FE+frG+fRJ3QzMcSFjXVf+kOc9C2sNqn4TnEQwg8H3LWp67LXm4faGl/s7np8eEZFNJKUFkQlxDh8CexRp59bZQNUpeeNVGUVwXhGXDeOWIKVEjBENgegd0Q6oGTCXGh1HCu8cy/JbJcSEaMpFUFWmcdxojcF7/18r38f8kwWbCluduZbv6NDxA6bSNOP3zcHPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"adding permissions to azure app\"\n        title=\"adding permissions to azure app\"\n        src=\"/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png\"\n        srcset=\"/static/a85237904d729be44937ceb281f22e7c/6f3f2/perms4.png 256w,\n/static/a85237904d729be44937ceb281f22e7c/01e7c/perms4.png 512w,\n/static/a85237904d729be44937ceb281f22e7c/2bef9/perms4.png 1024w,\n/static/a85237904d729be44937ceb281f22e7c/71c1d/perms4.png 1536w,\n/static/a85237904d729be44937ceb281f22e7c/a878e/perms4.png 2048w,\n/static/a85237904d729be44937ceb281f22e7c/b0f48/perms4.png 2690w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>It will just show an confirmation dialogue where we should press yes and if everything fine we should see green checkmars aside permissions</p>\n<h2>Microsoft Graph API</h2>\n<p>If previous septs were done correctly we should have:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span>xxx\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span>xxx\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/api/user-list?view=graph-rest-1.0&amp;tabs=http</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq <span class=\"token string\">\".value\"</span></code></pre></div>\n<p>So with this approach we may talk to Azure ActiveDirectory in our background jobs</p>\n<h2>AZ CLI Azure App</h2>\n<p>There is a way to automate application creation</p>\n<p>BUT I was not able to setup permissions</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># STEP 0: AZ CLI</span>\n<span class=\"token builtin class-name\">echo</span> current\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> available\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token builtin class-name\">echo</span> change\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span>\n\n<span class=\"token comment\"># STEP 1: APP REGISTRATION</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-admin-consent</span>\n<span class=\"token comment\"># az ad app permission admin-consent --id $client_id</span>\n\n<span class=\"token comment\"># # https://learn.microsoft.com/en-us/cli/azure/ad/app/permission?view=azure-cli-latest#az-ad-app-permission-grant</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000</span>\n\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000</span>\n<span class=\"token comment\"># # az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[*].{id:id,name:value}\" --output tsv</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='Directory.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n<span class=\"token comment\"># id=$(az ad sp show --id 00000003-0000-0000-c000-000000000000 --query \"appRoles[?value=='User.Read.All'].id\" --output tsv)</span>\n<span class=\"token comment\"># az ad app permission add --id $client_id --api 00000003-0000-0000-c000-000000000000 --api-permissions $id=Role</span>\n\n<span class=\"token comment\"># az ad sp create --id $client_id</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope Directory.Read.All</span>\n<span class=\"token comment\"># az ad app permission grant --id $client_id --api 00000003-0000-0000-c000-000000000000 --scope User.Read.All</span>\n\n\n<span class=\"token comment\"># STEP 2: TOKEN</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/graph/auth-v2-service?context=graph%2Fapi%2F1.0&amp;view=graph-rest-1.0#token-request</span>\n<span class=\"token assign-left variable\">token</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>&amp;scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&amp;client_secret=<span class=\"token variable\">$client_secret</span>&amp;grant_type=client_credentials\"</span> <span class=\"token operator\">|</span> jq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">\".access_token\"</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token comment\"># STEP 3: API</span>\n<span class=\"token function\">curl</span> https://graph.microsoft.com/v1.0/users <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer <span class=\"token variable\">$token</span>\"</span> <span class=\"token operator\">|</span> jq\n\n<span class=\"token comment\"># STEP 4: CLEANUP</span>\naz ad app delete <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span></code></pre></div>\n<h1>Creating and Azure app for device flow</h1>\n<p>Trying to mimicate <a href=\"https://moiaune.dev/2021/10/22/azure-device-flow-authentication-in-go/\">Azure Device Flow Authentication in Go</a> which has quite a good example of how to get up and running with device auth flow in Go.</p>\n<p>The same way as previous we need to make sure we are in the right subscription</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># current</span>\naz account show <span class=\"token parameter variable\">--query</span> name <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># available</span>\naz account list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[].{name:name}\"</span> <span class=\"token parameter variable\">--output</span> tsv\n<span class=\"token comment\"># change</span>\naz account <span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">--subscription</span><span class=\"token operator\">=</span><span class=\"token string\">\"mysubs\"</span>\n\n<span class=\"token comment\"># tenant_id</span>\n<span class=\"token assign-left variable\">tenant_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az account show <span class=\"token parameter variable\">--query</span> tenantId <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tenant_id: <span class=\"token variable\">$tenant_id</span>\"</span></code></pre></div>\n<p>Now we can create our app</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest</span>\naz ad app create --display-name mactemp\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app?view=azure-cli-latest#az-ad-app-list</span>\n<span class=\"token assign-left variable\">client_id</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app list <span class=\"token parameter variable\">--query</span> <span class=\"token string\">\"[?displayName=='mactemp'].{client_id:appId}[0]\"</span> <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_id: <span class=\"token variable\">$client_id</span>\"</span>\n\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/cli/azure/ad/app/credential?view=azure-cli-latest#az-ad-app-credential-reset</span>\n<span class=\"token assign-left variable\">client_secret</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>az ad app credential reset <span class=\"token parameter variable\">--id</span> $client_id <span class=\"token parameter variable\">--append</span> --display-name mactemp <span class=\"token parameter variable\">--years</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--query</span> password <span class=\"token parameter variable\">--output</span> tsv<span class=\"token variable\">)</span></span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"client_secret: <span class=\"token variable\">$client_secret</span>\"</span>\n\n<span class=\"token comment\"># allow public flows</span>\n<span class=\"token comment\"># https://learn.microsoft.com/en-us/azure/healthcare-apis/register-application-cli-rest#change-the-flag-for-public-client-applications</span>\n<span class=\"token comment\"># https://github.com/Azure/azure-cli/issues/7955#issuecomment-611976458</span>\n<span class=\"token comment\"># az ad app show --id $client_id | grep ublic -C 1</span>\n<span class=\"token comment\"># this should enable \"Allow public client flows\" checkbox on \"Authentication\" tab in the sidebar</span>\naz ad app update <span class=\"token parameter variable\">--id</span> <span class=\"token variable\">$client_id</span> <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">isFallbackPublicClient</span><span class=\"token operator\">=</span>true</code></pre></div>\n<p>The device authentication flow is described <a href=\"https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code\">here</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/devicecode\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"client_id=<span class=\"token variable\">$client_id</span>\n&amp;scope=user.read%20openid%20profile\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"user_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CW3AD73A4\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"device_code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"CAQABAAEAAAD--DLA3....\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"verification_uri\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://microsoft.com/devicelogin\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">900</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"interval\"</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code CW3AD73A4 to authenticate.\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While user opens browsers and logs in, your app is expected to be pulling results</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token string\">\"https://login.microsoftonline.com/<span class=\"token variable\">$tenant_id</span>/oauth2/v2.0/token\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type: application/x-www-form-urlencoded\"</span> <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"grant_type=urn:ietf:params:oauth:grant-type:device_code&amp;client_id=<span class=\"token variable\">$client_id</span>&amp;device_code=CAQABAAEAAAD--DLA3VO.....\"</span></code></pre></div>\n<p>And the response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"token_type\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Bearer\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scope\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"openid profile User.Read email\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"ext_expires_in\"</span><span class=\"token operator\">:</span><span class=\"token number\">4184</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"access_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLC...\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id_token\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"eyJ0eXAiOiJKV1QiLCJhbG...\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Libraries in majority of languages will have something around validation of tokens but we will try to call user info endpoint found at <a href=\"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\">https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> https://graph.microsoft.com/oidc/userinfo <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25j...\"</span></code></pre></div>\n<p>The response will be something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"sub\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"g_461q6Bo2lIySX1faMNhrOkMY_Q2h6i-1GpzjinOqM\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"family_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Marchenko\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"given_name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Alexandr\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"picture\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"https://graph.microsoft.com/v1.0/me/photo/$value\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"AlexandrM@rabota.ua\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Noth that <code class=\"language-text\">access_token</code> is used, if you will try to use <code class=\"language-text\">id_token</code> you will get an error like:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"code\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"InvalidAuthenticationToken\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Access token validation failure. Invalid audience.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"innerError\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"2023-02-04T14:50:48\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"client-request-id\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"b9a5ab76-0620-4f44-9987-9970e7438d2f\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Go lang implementation will be something like:</p>\n<p><div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"os\"</span>\n\n\t<span class=\"token string\">\"github.com/Azure/go-autorest/autorest/azure/auth\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tclientID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\ttenantID <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span>Args<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\tdeviceConfig <span class=\"token operator\">:=</span> auth<span class=\"token punctuation\">.</span><span class=\"token function\">NewDeviceFlowConfig</span><span class=\"token punctuation\">(</span>clientID<span class=\"token punctuation\">,</span> tenantID<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\">// https://github.com/Azure/azure-sdk-for-go/issues/3804#issuecomment-452118022</span>\n\tspToken<span class=\"token punctuation\">,</span> <span class=\"token boolean\">_</span> <span class=\"token operator\">:=</span> deviceConfig<span class=\"token punctuation\">.</span><span class=\"token function\">ServicePrincipalToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ttoken <span class=\"token operator\">:=</span> spToken<span class=\"token punctuation\">.</span><span class=\"token function\">Token</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AccessToken\"</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>AccessToken<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div></p>\n<p>And to run it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">go run device/main.go <span class=\"token variable\">$client_id</span> <span class=\"token variable\">$tenant_id</span></code></pre></div>\n<p>But unfortunately at moment that does not work and complains about wrong requested scopes, so probably need to be done semi-manually</p>"}},"pageContext":{"id":"ade3278b-b573-5cfd-b631-454bb6d28559"}},"staticQueryHashes":[]}
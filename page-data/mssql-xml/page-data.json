{"componentChunkName":"component---src-templates-note-js","path":"/mssql-xml/","result":{"data":{"remark":{"fields":{"path":"mssql-xml"},"meta":{"title":""},"headings":[{"value":"MsSQL XML"}],"html":"<h1>MsSQL XML</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d450905ec76e9d1c74843a7d6f241d9/cd536/sql_xml10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.609375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACfUlEQVR42o2T247jRBBA8/9/gJBWfAEvsPCwD7wsM0IrpIVdJnHiOPElvrYvHae7fT/ITiazA4uEpeOqsqzT7uryam07WI7H2j7y1+6A5UY4Yc4+KnBTSVprsotmn134+feAN+92fPfO4tu3n/jmhz8W3vz0ke9/+cyP759YuYcd9t4iijwC3+NwsEnSiFMccQhD/DgliHO0qunMBQYNTDfGW+SaTz2r/X7Nk+XxeeOx3toLu+OeveNzdE6Ekc85lbRCURUFsigxRYmqzpRVS14o8qKkri+4nscqTY9U544s14iyIhEVpSw5VzW6Upi6ZFINnBsGrRi1BmOg6+h7aNuJtm0ZhgEhclZC+PhBw9E94/o++2NMFArKQ0QVZCRBjIobaKDrO4Z+ANMwNc0iM3rEaL1IL0qxynOfKNVkuSSMEzIxb6XCFIJWSWg7pmFguvfqpYN88Wy+1FUYIApFIStk2dGonou+0I3D69cnmKblduclnRYWYVl6nLscoQWJisl1zjAOd8H/YVnvWRicfGzHwdrtltP1Tj5RHJMk6UIcJwvP9T9J04yqqijLEinlfMqCp/WGjWVxlvK22nAHriz5jTnv+56u76+xu0ZtzNzDAtdLOIWSJK3JhCLNFHFyIYovhNGV53omEzVN0yyj0t+kc661mcemwHYqNtuazVZi7SS2I8kLTV4YxDyfuVnqOc9zQyX1ffZeCc1N6BxKLEviHBRHVxFG+rq95df6N9M0vpI9C80sLArJ1pb8+Wn+OsPWNrieYRgnxpGvM305iy+xaVpWnv+RwP0Vz3kk8n4jiz4gog9U4r9Jw0dC74Hk9EgcPBD5D8TBe8p8x9+YtHPZKDmKWQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screenshot\"\n        title=\"\"\n        src=\"/static/4d450905ec76e9d1c74843a7d6f241d9/2bef9/sql_xml10.png\"\n        srcset=\"/static/4d450905ec76e9d1c74843a7d6f241d9/6f3f2/sql_xml10.png 256w,\n/static/4d450905ec76e9d1c74843a7d6f241d9/01e7c/sql_xml10.png 512w,\n/static/4d450905ec76e9d1c74843a7d6f241d9/2bef9/sql_xml10.png 1024w,\n/static/4d450905ec76e9d1c74843a7d6f241d9/cd536/sql_xml10.png 1114w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">-- Defaine temporary MailTplTmp table for example purposes</span>\n<span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> tempdb<span class=\"token punctuation\">.</span>sys<span class=\"token punctuation\">.</span><span class=\"token keyword\">tables</span> <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">LEFT</span><span class=\"token punctuation\">(</span>Name<span class=\"token punctuation\">,</span> CHARINDEX<span class=\"token punctuation\">(</span><span class=\"token string\">'_'</span><span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">'#MailTplTmp_'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token comment\">#MailTplTmp</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token comment\">#MailTplTmp (TplHtml VARCHAR(MAX));</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token comment\">#MailTplTmp VALUES('&lt;html>&lt;a href=\"{data(Email)}\">{data(Name)}&lt;/a>&lt;/html>');</span>\n\n<span class=\"token comment\">-- Define temporary MailDataTmp table for example purposes</span>\n<span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> tempdb<span class=\"token punctuation\">.</span>sys<span class=\"token punctuation\">.</span><span class=\"token keyword\">tables</span> <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">LEFT</span><span class=\"token punctuation\">(</span>Name<span class=\"token punctuation\">,</span> CHARINDEX<span class=\"token punctuation\">(</span><span class=\"token string\">'_'</span><span class=\"token punctuation\">,</span> Name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">'#MailDataTmp_'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token comment\">#MailDataTmp</span>\n\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token comment\">#MailDataTmp (Email VARCHAR(MAX), Name VARCHAR(MAX));</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token comment\">#MailDataTmp VALUES('alex@example.com', 'Alex');</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token comment\">#MailDataTmp VALUES('oleg@example.com', 'Oleg');</span>\n\n<span class=\"token comment\">-- @TPL will contain selected template for email</span>\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@TPL</span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@TPL</span> <span class=\"token operator\">=</span> TplHtml <span class=\"token keyword\">FROM</span> <span class=\"token comment\">#MailTplTmp;</span>\n<span class=\"token comment\">-- will return:</span>\n<span class=\"token comment\">-- +------+------------------+</span>\n<span class=\"token comment\">-- | Alex | alex@example.com |</span>\n<span class=\"token comment\">-- | Oleg | oleg@example.com |</span>\n<span class=\"token comment\">-- +------+------------------+</span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token comment\">#MailDataTmp;</span>\n<span class=\"token comment\">-- will return xml representation of table above (select into xml):</span>\n<span class=\"token comment\">-- &lt;Item>&lt;Email>Alex&lt;/Email>&lt;Name>alex@example.com&lt;/Name>&lt;/Item>&lt;Item>&lt;Email>Oleg&lt;/Email>&lt;Name>oleg@example.com&lt;/Name>&lt;/Item></span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token comment\">#MailDataTmp FOR XML PATH('Item'), TYPE, ELEMENTS ) AS XmlRow;</span>\n\n<span class=\"token comment\">-- will return transformed xml</span>\n<span class=\"token keyword\">SELECT</span> x<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;html>&lt;a href=\"{data(Email)}\">{data(Name)}&lt;/a>&lt;/html>'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> Html <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token comment\">#MailDataTmp FOR XML PATH('Item'), TYPE, ELEMENTS ) AS XmlRow ) AS data CROSS APPLY XmlRow.nodes('Item') x(y);</span>\n\n<span class=\"token comment\">-- To avoid: \"The argument 1 of the XML data type method \"query\" must be a string literal.\" -- error, we use sp_executesql</span>\n\n<span class=\"token keyword\">DECLARE</span> <span class=\"token variable\">@SQL</span> NVARCHAR<span class=\"token punctuation\">(</span>MAX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SET</span> <span class=\"token variable\">@SQL</span> <span class=\"token operator\">=</span> <span class=\"token string\">'SELECT x.y.query('''</span> <span class=\"token operator\">+</span> <span class=\"token variable\">@TPL</span> <span class=\"token operator\">+</span> <span class=\"token string\">''') AS Html_sp_executesql FROM ( SELECT ( SELECT * FROM #MailDataTmp FOR XML PATH(''Item''), TYPE, ELEMENTS ) AS XmlRow ) AS data CROSS APPLY XmlRow.nodes(''Item'') x(y)'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">EXEC</span> sp_executesql <span class=\"token variable\">@SQL</span><span class=\"token punctuation\">;</span></code></pre></div>"}},"pageContext":{"id":"7b463f71-31f7-5c47-84d4-0e5f1a69e6bb"}},"staticQueryHashes":[],"slicesMap":{}}
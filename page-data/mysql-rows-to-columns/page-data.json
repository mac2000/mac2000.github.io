{"componentChunkName":"component---src-templates-note-js","path":"/mysql-rows-to-columns","result":{"data":{"remark":{"fields":{"path":"mysql-rows-to-columns"},"meta":{"title":""},"headings":[{"value":"MySQL rows to columns"}],"html":"<h1>MySQL rows to columns</h1>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">START</span> <span class=\"token keyword\">TRANSACTION</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">USE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'11'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'22'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'33'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'33'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rows2cols<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">.</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_properties<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>product_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>property_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'44'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">COMMIT</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here is tables data:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> use rows2cols<span class=\"token punctuation\">;</span>\nDatabase changed\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> * from products<span class=\"token punctuation\">;</span>\n+----+-------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name  <span class=\"token operator\">|</span>\n+----+-------+\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> prod1 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> prod2 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> prod3 <span class=\"token operator\">|</span>\n+----+-------+\n<span class=\"token number\">3</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> * from properties<span class=\"token punctuation\">;</span>\n+----+--------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name   <span class=\"token operator\">|</span>\n+----+--------+\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> price  <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> weight <span class=\"token operator\">|</span>\n+----+--------+\n<span class=\"token number\">2</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\nmysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> * from product_properties<span class=\"token punctuation\">;</span>\n+----+------------+-------------+-------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> product_id <span class=\"token operator\">|</span> property_id <span class=\"token operator\">|</span> value <span class=\"token operator\">|</span>\n+----+------------+-------------+-------+\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span>          <span class=\"token number\">1</span> <span class=\"token operator\">|</span>           <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">11</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span>          <span class=\"token number\">1</span> <span class=\"token operator\">|</span>           <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">22</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span>          <span class=\"token number\">2</span> <span class=\"token operator\">|</span>           <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">22</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">4</span> <span class=\"token operator\">|</span>          <span class=\"token number\">2</span> <span class=\"token operator\">|</span>           <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">33</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">5</span> <span class=\"token operator\">|</span>          <span class=\"token number\">3</span> <span class=\"token operator\">|</span>           <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">33</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">6</span> <span class=\"token operator\">|</span>          <span class=\"token number\">3</span> <span class=\"token operator\">|</span>           <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">44</span>    <span class=\"token operator\">|</span>\n+----+------------+-------------+-------+\n<span class=\"token number\">6</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Bad way to retrive data:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     products.id,\n    -<span class=\"token operator\">></span>     products.name,\n    -<span class=\"token operator\">></span>     properties.name,\n    -<span class=\"token operator\">></span>     product_properties.value\n    -<span class=\"token operator\">></span>\n    -<span class=\"token operator\">></span> FROM products\n    -<span class=\"token operator\">></span> JOIN product_properties\n    -<span class=\"token operator\">></span> ON products.id <span class=\"token operator\">=</span> product_properties.product_id\n    -<span class=\"token operator\">></span> JOIN properties\n    -<span class=\"token operator\">></span> ON product_properties.property_id <span class=\"token operator\">=</span> properties.id<span class=\"token punctuation\">;</span>\n+----+-------+--------+-------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name  <span class=\"token operator\">|</span> name   <span class=\"token operator\">|</span> value <span class=\"token operator\">|</span>\n+----+-------+--------+-------+\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> prod1 <span class=\"token operator\">|</span> price  <span class=\"token operator\">|</span> <span class=\"token number\">11</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> prod1 <span class=\"token operator\">|</span> weight <span class=\"token operator\">|</span> <span class=\"token number\">22</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> prod2 <span class=\"token operator\">|</span> price  <span class=\"token operator\">|</span> <span class=\"token number\">22</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> prod2 <span class=\"token operator\">|</span> weight <span class=\"token operator\">|</span> <span class=\"token number\">33</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> prod3 <span class=\"token operator\">|</span> price  <span class=\"token operator\">|</span> <span class=\"token number\">33</span>    <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> prod3 <span class=\"token operator\">|</span> weight <span class=\"token operator\">|</span> <span class=\"token number\">44</span>    <span class=\"token operator\">|</span>\n+----+-------+--------+-------+\n<span class=\"token number\">6</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Good way:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> SELECT\n    -<span class=\"token operator\">></span>     products.id,\n    -<span class=\"token operator\">></span>     products.name,\n    -<span class=\"token operator\">></span>     GROUP_CONCAT<span class=\"token punctuation\">(</span>if<span class=\"token punctuation\">(</span>properties.name <span class=\"token operator\">=</span> <span class=\"token string\">'price'</span>, value, NULL<span class=\"token punctuation\">))</span> AS <span class=\"token string\">'price'</span>,\n    -<span class=\"token operator\">></span>     GROUP_CONCAT<span class=\"token punctuation\">(</span>if<span class=\"token punctuation\">(</span>properties.name <span class=\"token operator\">=</span> <span class=\"token string\">'weight'</span>, value, NULL<span class=\"token punctuation\">))</span> AS <span class=\"token string\">'weight'</span>\n\n    -<span class=\"token operator\">></span>\n    -<span class=\"token operator\">></span> FROM products\n    -<span class=\"token operator\">></span> JOIN product_properties\n    -<span class=\"token operator\">></span> ON products.id <span class=\"token operator\">=</span> product_properties.product_id\n    -<span class=\"token operator\">></span> JOIN properties\n    -<span class=\"token operator\">></span> ON product_properties.property_id <span class=\"token operator\">=</span> properties.id\n    -<span class=\"token operator\">></span> GROUP BY products.id<span class=\"token punctuation\">;</span>\n+----+-------+-------+--------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name  <span class=\"token operator\">|</span> price <span class=\"token operator\">|</span> weight <span class=\"token operator\">|</span>\n+----+-------+-------+--------+\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> prod1 <span class=\"token operator\">|</span> <span class=\"token number\">11</span>    <span class=\"token operator\">|</span> <span class=\"token number\">22</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> prod2 <span class=\"token operator\">|</span> <span class=\"token number\">22</span>    <span class=\"token operator\">|</span> <span class=\"token number\">33</span>     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span> prod3 <span class=\"token operator\">|</span> <span class=\"token number\">33</span>    <span class=\"token operator\">|</span> <span class=\"token number\">44</span>     <span class=\"token operator\">|</span>\n+----+-------+-------+--------+\n<span class=\"token number\">3</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>So here is SQL:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>\n    products<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n    products<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n    GROUP_CONCAT<span class=\"token punctuation\">(</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">'price'</span><span class=\"token punctuation\">,</span>\n    GROUP_CONCAT<span class=\"token punctuation\">(</span><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>properties<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'weight'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">'weight'</span>\n\n<span class=\"token keyword\">FROM</span> products\n<span class=\"token keyword\">JOIN</span> product_properties\n<span class=\"token keyword\">ON</span> products<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> product_properties<span class=\"token punctuation\">.</span>product_id\n<span class=\"token keyword\">JOIN</span> properties\n<span class=\"token keyword\">ON</span> product_properties<span class=\"token punctuation\">.</span>property_id <span class=\"token operator\">=</span> properties<span class=\"token punctuation\">.</span>id\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> products<span class=\"token punctuation\">.</span>id</code></pre></div>"}},"pageContext":{"id":"1050e2a1-e17d-5e4e-91dd-8c03fe2a01f5"}},"staticQueryHashes":[]}
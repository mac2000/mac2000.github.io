{"componentChunkName":"component---src-templates-note-js","path":"/mysql-php-aes/","result":{"data":{"remark":{"fields":{"path":"mysql-php-aes"},"meta":{"title":""},"headings":[{"value":"MySQL, PHP, AES encryption and decryption"}],"html":"<h1>MySQL, PHP, AES encryption and decryption</h1>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">global</span> <span class=\"token variable\">$pdo</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$pdo</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PDO</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'mysql:host=localhost;dbname=[DATABASE]'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'[LOGIN]'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'[PASSWORD]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$text</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'Hello World!'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$key</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'Secret'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$mysql_enc</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_aes_encrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$mysql_dec</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$mysql_enc</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$php_enc</span> <span class=\"token operator\">=</span> <span class=\"token function\">php_aes_encrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$php_dec</span> <span class=\"token operator\">=</span> <span class=\"token function\">php_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$php_enc</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token variable\">$php_by_mysql</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$php_enc</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$mysql_by_php</span> <span class=\"token operator\">=</span> <span class=\"token function\">php_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$mysql_enc</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Encryption is '</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$mysql_enc</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$php_enc</span> <span class=\"token operator\">?</span> <span class=\"token string single-quoted-string\">'equal'</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'not equal'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token constant\">PHP_EOL</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Decryption is '</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$mysql_dec</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$text</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$php_dec</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$text</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$php_by_mysql</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$text</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$mysql_by_php</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string single-quoted-string\">'equal'</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'not equal'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">mysql_aes_encrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">global</span> <span class=\"token variable\">$pdo</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$stmt</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$pdo</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"SELECT AES_ENCRYPT(?, ?)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$stmt</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$stmt</span><span class=\"token operator\">-></span><span class=\"token function\">fetchColumn</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">mysql_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">global</span> <span class=\"token variable\">$pdo</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$stmt</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$pdo</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"SELECT AES_DECRYPT(?, ?)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$stmt</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$stmt</span><span class=\"token operator\">-></span><span class=\"token function\">fetchColumn</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">php_aes_encrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$key</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_aes_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$pad_value</span> <span class=\"token operator\">=</span> <span class=\"token number\">16</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$text</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_pad</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$pad_value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">mcrypt_encrypt</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MCRYPT_RIJNDAEL_128</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_MODE_ECB</span><span class=\"token punctuation\">,</span> <span class=\"token function\">mcrypt_create_iv</span><span class=\"token punctuation\">(</span><span class=\"token function\">mcrypt_get_iv_size</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MCRYPT_RIJNDAEL_128</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_MODE_ECB</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_DEV_URANDOM</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">php_aes_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$key</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_aes_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$text</span> <span class=\"token operator\">=</span> <span class=\"token function\">mcrypt_decrypt</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MCRYPT_RIJNDAEL_128</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_MODE_ECB</span><span class=\"token punctuation\">,</span> <span class=\"token function\">mcrypt_create_iv</span><span class=\"token punctuation\">(</span><span class=\"token function\">mcrypt_get_iv_size</span><span class=\"token punctuation\">(</span><span class=\"token constant\">MCRYPT_RIJNDAEL_128</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_MODE_ECB</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">MCRYPT_DEV_URANDOM</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">rtrim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"\\0..\\16\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">mysql_aes_key</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$new_key</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_repeat</span><span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$len</span><span class=\"token operator\">=</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token variable\">$i</span><span class=\"token operator\">&lt;</span><span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span><span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$new_key</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$new_key</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token operator\">%</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> <span class=\"token variable\">$key</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$new_key</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p>This code will return:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Encryption is equal\nDecryption is equal</code></pre></div>\n<p>Do not forget to change database connection string.</p>\n<p>Also notice that if you want to save aes encrypted values to database - use <code class=\"language-text\">varbinary(150)</code> instead of <code class=\"language-text\">varchar(100)</code>, and give it more space (at least half)</p>\n<p>Found at: <a href=\"http://coding.smashingmagazine.com/2012/05/20/replicating-mysql-aes-encryption-methods-with-php/\">http://coding.smashingmagazine.com/2012/05/20/replicating-mysql-aes-encryption-methods-with-php/</a></p>"}},"pageContext":{"id":"ed763557-c6fa-5abe-9cf9-1b3147f5bca6"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-note-js","path":"/docker-localhost-ssl","result":{"data":{"remark":{"fields":{"path":"docker-localhost-ssl"},"meta":{"title":""},"headings":[{"value":"docker localhost ssl"}],"html":"<h1>docker localhost ssl</h1>\n<p>Two ways of having trusted self signed certs for local development needs</p>\n<p>First one with <a href=\"https://github.com/FiloSottile/mkcert\">mkcert</a> which will add root ca to system so it will trust it</p>\n<p>Installation and generating certificates is as easy as:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> mkcert\nmkcert <span class=\"token parameter variable\">-install</span>\nmkcert -cert-file vcap.me.crt -key-file vcap.me.key <span class=\"token string\">\"*.vcap.me\"</span>\n<span class=\"token function\">cp</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>mkcert <span class=\"token parameter variable\">-CAROOT</span><span class=\"token variable\">)</span></span>/rootCA.pem\"</span> ca.crt</code></pre></div>\n<p>Note that I'm using <code class=\"language-text\">vcap.me</code> which is resolving to <code class=\"language-text\">127.0.0.1</code></p>\n<p>And here is <code class=\"language-text\">docker-compose.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.5'</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">nginx-proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> proxy\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/nginx<span class=\"token punctuation\">-</span>proxy\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'80:80'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'443:443'</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/tmp/docker.sock<span class=\"token punctuation\">:</span>ro\n      <span class=\"token punctuation\">-</span> ./certs<span class=\"token punctuation\">:</span>/etc/nginx/certs\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.20.0.200\n\n  <span class=\"token key atrule\">whoami</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> whoami\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/whoami\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./certs/ca.crt<span class=\"token punctuation\">:</span>/usr/local/share/ca<span class=\"token punctuation\">-</span>certificates/ca.crt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> VIRTUAL_HOST=whoami.vcap.me\n      <span class=\"token punctuation\">-</span> VIRTUAL_PORT=8000\n    <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'nginx.vcap.me:172.20.0.200'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'whoami.vcap.me:172.20.0.200'</span>\n\n  <span class=\"token key atrule\">nginx</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./certs/ca.crt<span class=\"token punctuation\">:</span>/usr/local/share/ca<span class=\"token punctuation\">-</span>certificates/ca.crt\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> VIRTUAL_HOST=nginx.vcap.me\n      <span class=\"token punctuation\">-</span> VIRTUAL_PORT=80\n    <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'nginx.vcap.me:172.20.0.200'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'whoami.vcap.me:172.20.0.200'</span>\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">ipam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 172.20.0.0/16</code></pre></div>\n<p>With such setup ssl will work not only from outside docker but between containers alsto.</p>\n<p>There is <a href=\"https://localhost.tools/\">localhost.tools</a> guys registered domain and configured lets encrypt wild card certificates which allows to achieve the same result without installing anything on system like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.5'</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">proxy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> proxy\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> tarampampam/localhost\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'80:80'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'443:443'</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro\n    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">ipv4_address</span><span class=\"token punctuation\">:</span> 172.20.0.200\n\n  <span class=\"token key atrule\">whoami</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> whoami\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jwilder/whoami\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">traefik.frontend.rule</span><span class=\"token punctuation\">:</span> Host<span class=\"token punctuation\">:</span>whoami.localhost.tools\n      <span class=\"token key atrule\">traefik.protocol</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">traefik.port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8000</span>\n    <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'whoami.localhost.tools:172.20.0.200'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'api.localhost.tools:172.20.0.200'</span>\n\n  <span class=\"token key atrule\">api</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> api\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> api\n      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./api<span class=\"token punctuation\">:</span>/app\n      <span class=\"token punctuation\">-</span> /api/bin\n      <span class=\"token punctuation\">-</span> /api/obj\n    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">traefik.frontend.rule</span><span class=\"token punctuation\">:</span> Host<span class=\"token punctuation\">:</span>api.localhost.tools\n      <span class=\"token key atrule\">traefik.protocol</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">traefik.port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5000</span>\n    <span class=\"token key atrule\">extra_hosts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'whoami.localhost.tools:172.20.0.200'</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'api.localhost.tools:172.20.0.200'</span>\n\n<span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">ipam</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">subnet</span><span class=\"token punctuation\">:</span> 172.20.0.0/16</code></pre></div>"}},"pageContext":{"id":"83507e72-e2a8-5531-82fc-8e4fcae4eacd"}},"staticQueryHashes":[]}